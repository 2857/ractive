{"version":3,"file":"ractive.runtime.min.js","sources":["ractive.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tMon Dec 07 2015 22:22:07 GMT+0000 (UTC) - commit a48905ef60165b816ae279aae65e4fd13db51895\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  global.Ractive = factory();\n}(this, function () { 'use strict';\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = typeof navigator !== 'undefined' && /jsDom/.test(navigator.appName);\n  var hasConsole = typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function';\n\n  var magicSupported = undefined;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch (e) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ? doc.implementation.hasFeature('http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1') : false;\n\n  var vendors = ['o', 'ms', 'moz', 'webkit'];\n\n  var defaults = {\n  \t// render placement:\n  \tel: void 0,\n  \tappend: false,\n\n  \t// template:\n  \ttemplate: null,\n\n  \t// parse:\n  \tdelimiters: ['{{', '}}'],\n  \ttripleDelimiters: ['{{{', '}}}'],\n  \tstaticDelimiters: ['[[', ']]'],\n  \tstaticTripleDelimiters: ['[[[', ']]]'],\n  \tcsp: true,\n  \tinterpolate: false,\n  \tpreserveWhitespace: false,\n  \tsanitize: false,\n  \tstripComments: true,\n\n  \t// data & binding:\n  \tdata: {},\n  \tcomputed: {},\n  \tmagic: false,\n  \tmodifyArrays: true,\n  \tadapt: [],\n  \tisolated: false,\n  \ttwoway: true,\n  \tlazy: false,\n\n  \t// transitions:\n  \tnoIntro: false,\n  \ttransitionsEnabled: true,\n  \tcomplete: void 0,\n\n  \t// css:\n  \tcss: null,\n  \tnoCssTransform: false\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(escapeKeyPattern, '\\\\$&');\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise(ref) {\n  \treturn ref ? ref.replace(refPattern, '.$1') : '';\n  }\n\n  function splitKeypath(keypath) {\n  \tvar parts = normalise(keypath).split(splitPattern),\n  \t    result = [];\n\n  \tfor (var i = 0; i < parts.length; i += 2) {\n  \t\tresult.push(parts[i] + (parts[i + 1] || ''));\n  \t}\n\n  \treturn result;\n  }\n\n  function unescapeKey(key) {\n  \tif (typeof key === 'string') {\n  \t\treturn key.replace(unescapeKeyPattern, '$1$2');\n  \t}\n\n  \treturn key;\n  }\n\n  function noop () {}\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if (hasConsole) {\n  \t(function () {\n  \t\tvar welcomeIntro = ['%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...', 'color: rgb(114, 157, 52); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(85, 85, 85); font-weight: normal;', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'];\n  \t\tvar welcomeMessage = 'You\\'re running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n';\n\n  \t\twelcome = function () {\n  \t\t\tvar hasGroup = !!console.groupCollapsed;\n  \t\t\tconsole[hasGroup ? 'groupCollapsed' : 'log'].apply(console, welcomeIntro);\n  \t\t\tconsole.log(welcomeMessage);\n  \t\t\tif (hasGroup) {\n  \t\t\t\tconsole.groupEnd(welcomeIntro);\n  \t\t\t}\n\n  \t\t\twelcome = noop;\n  \t\t};\n\n  \t\tprintWarning = function (message, args) {\n  \t\t\twelcome();\n\n  \t\t\t// extract information about the instance this message pertains to, if applicable\n  \t\t\tif (typeof args[args.length - 1] === 'object') {\n  \t\t\t\tvar options = args.pop();\n  \t\t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\t\tif (ractive) {\n  \t\t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t\t// it to the message\n  \t\t\t\t\tvar _name = undefined;\n  \t\t\t\t\tif (ractive.component && (_name = ractive.component.name)) {\n  \t\t\t\t\t\tmessage = '<' + _name + '> ' + message;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar node = undefined;\n  \t\t\t\t\tif (node = options.node || ractive.fragment && ractive.fragment.rendered && ractive.find('*')) {\n  \t\t\t\t\t\targs.push(node);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tconsole.warn.apply(console, ['%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);'].concat(args));\n  \t\t};\n\n  \t\tlog = function () {\n  \t\t\tconsole.log.apply(console, arguments);\n  \t\t};\n  \t})();\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format(message, args) {\n  \treturn message.replace(/%s/g, function () {\n  \t\treturn args.shift();\n  \t});\n  }\n\n  function fatal(message) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tmessage = format(message, args);\n  \tthrow new Error(message);\n  }\n\n  function logIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\tlog.apply(null, arguments);\n  \t}\n  }\n\n  function warn(message) {\n  \tfor (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n  \t\targs[_key2 - 1] = arguments[_key2];\n  \t}\n\n  \tmessage = format(message, args);\n  \tprintWarning(message, args);\n  }\n\n  function warnOnce(message) {\n  \tfor (var _len3 = arguments.length, args = Array(_len3 > 1 ? _len3 - 1 : 0), _key3 = 1; _key3 < _len3; _key3++) {\n  \t\targs[_key3 - 1] = arguments[_key3];\n  \t}\n\n  \tmessage = format(message, args);\n\n  \tif (alreadyWarned[message]) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[message] = true;\n  \tprintWarning(message, args);\n  }\n\n  function warnIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarn.apply(null, arguments);\n  \t}\n  }\n\n  function warnOnceIfDebug() {\n  \tif (Ractive.DEBUG) {\n  \t\twarnOnce.apply(null, arguments);\n  \t}\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' + 'and will likely be removed in a future release. ' + 'You can either use the \"oninit\" method which will fire ' + 'only once prior to, and regardless of, any eventual ractive ' + 'instance being rendered, or if you need to access the ' + 'rendered DOM, use \"onrender\" instead. ' + 'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = (function () {\n  \tfunction Hook(event) {\n  \t\tclassCallCheck(this, Hook);\n\n  \t\tthis.event = event;\n  \t\tthis.method = 'on' + event;\n  \t\tthis.deprecate = deprecations[event];\n  \t}\n\n  \tHook.prototype.call = function call(method, ractive, arg) {\n  \t\tif (ractive[method]) {\n  \t\t\targ ? ractive[method](arg) : ractive[method]();\n  \t\t\treturn true;\n  \t\t}\n  \t};\n\n  \tHook.prototype.fire = function fire(ractive, arg) {\n  \t\tthis.call(this.method, ractive, arg);\n\n  \t\t// handle deprecations\n  \t\tif (!ractive[this.method] && this.deprecate && this.call(this.deprecate.deprecated, ractive, arg)) {\n  \t\t\tif (this.deprecate.message) {\n  \t\t\t\twarnIfDebug(this.deprecate.message);\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \t\targ ? ractive.fire(this.event, arg) : ractive.fire(this.event);\n  \t};\n\n  \treturn Hook;\n  })();\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n\n  function isArray(thing) {\n  \treturn toString.call(thing) === '[object Array]';\n  }\n\n  function isEqual(a, b) {\n  \tif (a === null && b === null) {\n  \t\treturn true;\n  \t}\n\n  \tif (typeof a === 'object' || typeof b === 'object') {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n\n  function isNumeric(thing) {\n  \treturn !isNaN(parseFloat(thing)) && isFinite(thing);\n  }\n\n  function isObject(thing) {\n  \treturn thing && toString.call(thing) === '[object Object]';\n  }\n\n  function addToArray(array, value) {\n  \tvar index = array.indexOf(value);\n\n  \tif (index === -1) {\n  \t\tarray.push(value);\n  \t}\n  }\n\n  function arrayContains(array, value) {\n  \tfor (var i = 0, c = array.length; i < c; i++) {\n  \t\tif (array[i] == value) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch(a, b) {\n  \tvar i;\n\n  \tif (!isArray(a) || !isArray(b)) {\n  \t\treturn false;\n  \t}\n\n  \tif (a.length !== b.length) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile (i--) {\n  \t\tif (a[i] !== b[i]) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray(x) {\n  \tif (typeof x === 'string') {\n  \t\treturn [x];\n  \t}\n\n  \tif (x === undefined) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem(array) {\n  \treturn array[array.length - 1];\n  }\n\n  function removeFromArray(array, member) {\n  \tif (!array) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf(member);\n\n  \tif (index !== -1) {\n  \t\tarray.splice(index, 1);\n  \t}\n  }\n\n  function toArray(arrayLike) {\n  \tvar array = [],\n  \t    i = arrayLike.length;\n  \twhile (i--) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if (typeof Promise === 'function') {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function (callback) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t    rejectedHandlers = [],\n  \t\t    state = PENDING,\n  \t\t    result,\n  \t\t    dispatchHandlers,\n  \t\t    makeResolver,\n  \t\t    fulfil,\n  \t\t    reject,\n  \t\t    promise;\n\n  \t\tmakeResolver = function (newState) {\n  \t\t\treturn function (value) {\n  \t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher(state === FULFILLED ? fulfilledHandlers : rejectedHandlers, result);\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait(dispatchHandlers);\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver(FULFILLED);\n  \t\treject = makeResolver(REJECTED);\n\n  \t\ttry {\n  \t\t\tcallback(fulfil, reject);\n  \t\t} catch (err) {\n  \t\t\treject(err);\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function (onFulfilled, onRejected) {\n  \t\t\t\tvar promise2 = new _Promise(function (fulfil, reject) {\n\n  \t\t\t\t\tvar processResolutionHandler = function (handler, handlers, forward) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif (typeof handler === 'function') {\n  \t\t\t\t\t\t\thandlers.push(function (p1result) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler(p1result);\n  \t\t\t\t\t\t\t\t\tresolve(promise2, x, fulfil, reject);\n  \t\t\t\t\t\t\t\t} catch (err) {\n  \t\t\t\t\t\t\t\t\treject(err);\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push(forward);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler(onFulfilled, fulfilledHandlers, fulfil);\n  \t\t\t\t\tprocessResolutionHandler(onRejected, rejectedHandlers, reject);\n\n  \t\t\t\t\tif (state !== PENDING) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait(dispatchHandlers);\n  \t\t\t\t\t}\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise['catch'] = function (onRejected) {\n  \t\t\treturn this.then(null, onRejected);\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function (promises) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\tvar result = [],\n  \t\t\t    pending,\n  \t\t\t    i,\n  \t\t\t    processPromise;\n\n  \t\t\tif (!promises.length) {\n  \t\t\t\tfulfil(result);\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function (promise, i) {\n  \t\t\t\tif (promise && typeof promise.then === 'function') {\n  \t\t\t\t\tpromise.then(function (value) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t\t}, reject);\n  \t\t\t\t} else {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil(result);\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tprocessPromise(promises[i], i);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function (value) {\n  \t\treturn new _Promise(function (fulfil) {\n  \t\t\tfulfil(value);\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function (reason) {\n  \t\treturn new _Promise(function (fulfil, reject) {\n  \t\t\treject(reason);\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait(callback) {\n  \tsetTimeout(callback, 0);\n  }\n\n  function makeDispatcher(handlers, result) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile (handler = handlers.shift()) {\n  \t\t\thandler(result);\n  \t\t}\n  \t};\n  }\n\n  function resolve(promise, x, fulfil, reject) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif (x === promise) {\n  \t\tthrow new TypeError('A promise\\'s fulfillment handler cannot return the same promise');\n  \t}\n\n  \t// 2.3.2\n  \tif (x instanceof _Promise) {\n  \t\tx.then(fulfil, reject);\n  \t}\n\n  \t// 2.3.3\n  \telse if (x && (typeof x === 'object' || typeof x === 'function')) {\n  \t\t\ttry {\n  \t\t\t\tthen = x.then; // 2.3.3.1\n  \t\t\t} catch (e) {\n  \t\t\t\treject(e); // 2.3.3.2\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// 2.3.3.3\n  \t\t\tif (typeof then === 'function') {\n  \t\t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\t\tresolvePromise = function (y) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\tresolve(promise, y, fulfil, reject);\n  \t\t\t\t};\n\n  \t\t\t\trejectPromise = function (r) {\n  \t\t\t\t\tif (called) {\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treject(r);\n  \t\t\t\t};\n\n  \t\t\t\ttry {\n  \t\t\t\t\tthen.call(x, resolvePromise, rejectPromise);\n  \t\t\t\t} catch (e) {\n  \t\t\t\t\tif (!called) {\n  \t\t\t\t\t\t// 2.3.3.3.4.1\n  \t\t\t\t\t\treject(e); // 2.3.3.3.4.2\n  \t\t\t\t\t\tcalled = true;\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tfulfil(x);\n  \t\t\t}\n  \t\t} else {\n  \t\t\tfulfil(x);\n  \t\t}\n  }\n\n  var TransitionManager = (function () {\n  \tfunction TransitionManager(callback, parent) {\n  \t\tclassCallCheck(this, TransitionManager);\n\n  \t\tthis.callback = callback;\n  \t\tthis.parent = parent;\n\n  \t\tthis.intros = [];\n  \t\tthis.outros = [];\n\n  \t\tthis.children = [];\n  \t\tthis.totalChildren = this.outroChildren = 0;\n\n  \t\tthis.detachQueue = [];\n  \t\tthis.outrosComplete = false;\n\n  \t\tif (parent) {\n  \t\t\tparent.addChild(this);\n  \t\t}\n  \t}\n\n  \tTransitionManager.prototype.add = function add(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tlist.push(transition);\n  \t};\n\n  \tTransitionManager.prototype.addChild = function addChild(child) {\n  \t\tthis.children.push(child);\n\n  \t\tthis.totalChildren += 1;\n  \t\tthis.outroChildren += 1;\n  \t};\n\n  \tTransitionManager.prototype.decrementOutros = function decrementOutros() {\n  \t\tthis.outroChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.decrementTotal = function decrementTotal() {\n  \t\tthis.totalChildren -= 1;\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.detachNodes = function detachNodes() {\n  \t\tthis.detachQueue.forEach(detach);\n  \t\tthis.children.forEach(_detachNodes);\n  \t};\n\n  \tTransitionManager.prototype.remove = function remove(transition) {\n  \t\tvar list = transition.isIntro ? this.intros : this.outros;\n  \t\tremoveFromArray(list, transition);\n  \t\tcheck(this);\n  \t};\n\n  \tTransitionManager.prototype.start = function start() {\n  \t\tthis.intros.concat(this.outros).forEach(function (t) {\n  \t\t\treturn t.start();\n  \t\t});\n  \t\tthis.ready = true;\n  \t\tcheck(this);\n  \t};\n\n  \treturn TransitionManager;\n  })();\n\n  function detach(element) {\n  \telement.detach();\n  }\n\n  function _detachNodes(tm) {\n  \t// _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check(tm) {\n  \tif (!tm.ready || tm.outros.length || tm.outroChildren) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif (!tm.outrosComplete) {\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementOutros(tm);\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif (!tm.intros.length && !tm.totalChildren) {\n  \t\tif (typeof tm.callback === 'function') {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif (tm.parent) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var changeHook = new Hook('change');\n\n  var batch = undefined;\n\n  var runloop = {\n  \tstart: function (instance, returnPromise) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif (returnPromise) {\n  \t\t\tpromise = new Promise$1(function (f) {\n  \t\t\t\treturn fulfilPromise = f;\n  \t\t\t});\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager(fulfilPromise, batch && batch.transitionManager),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function (fragment) {\n  \t\taddToArray(batch.fragments, fragment);\n  \t},\n\n  \taddObserver: function (observer, defer) {\n  \t\taddToArray(defer ? batch.deferredObservers : batch.immediateObservers, observer);\n  \t},\n\n  \tregisterTransition: function (transition) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add(transition);\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function (thing) {\n  \t\tbatch.transitionManager.detachQueue.push(thing);\n  \t},\n\n  \tscheduleTask: function (task, postRender) {\n  \t\tvar _batch;\n\n  \t\tif (!batch) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile (postRender && _batch.previousBatch) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push(task);\n  \t\t}\n  \t}\n  };\n\n  function dispatch(observer) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges() {\n  \tbatch.immediateObservers.forEach(dispatch);\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment = undefined;\n\n  \twhile (i--) {\n  \t\tfragment = batch.fragments[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire(ractive, ractive.viewmodel.changes);\n  \t\tractive.viewmodel.changes = {};\n\n  \t\tfragment.update();\n  \t}\n  \tbatch.fragments.length = 0;\n\n  \tbatch.transitionManager.start();\n\n  \tbatch.deferredObservers.forEach(dispatch);\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor (i = 0; i < tasks.length; i += 1) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif (batch.fragments.length) return flushChanges();\n  }\n\n  function Ractive$updateModel(keypath, cascade) {\n  \tvar promise = runloop.start(this, true);\n\n  \tif (!keypath) {\n  \t\tthis.viewmodel.updateFromBindings(true);\n  \t} else {\n  \t\tthis.viewmodel.joinAll(splitKeypath(keypath)).updateFromBindings(cascade !== false);\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var updateHook = new Hook('update');\n  function Ractive$update(keypath) {\n  \tvar model = keypath ? this.viewmodel.joinAll(splitKeypath(keypath)) : this.viewmodel;\n\n  \tvar promise = runloop.start(this, true);\n  \tmodel.mark();\n  \trunloop.end();\n\n  \tupdateHook.fire(this, model);\n\n  \treturn promise;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices(length, methodName, args) {\n  \tvar spliceArguments,\n  \t    newIndices = [],\n  \t    removeStart,\n  \t    removeEnd,\n  \t    balance,\n  \t    i;\n\n  \tspliceArguments = getSpliceEquivalent(length, methodName, args);\n\n  \tif (!spliceArguments) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = spliceArguments.length - 2 - spliceArguments[1];\n\n  \tremoveStart = Math.min(length, spliceArguments[0]);\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor (i = 0; i < removeStart; i += 1) {\n  \t\tnewIndices.push(i);\n  \t}\n\n  \tfor (; i < removeEnd; i += 1) {\n  \t\tnewIndices.push(-1);\n  \t}\n\n  \tfor (; i < length; i += 1) {\n  \t\tnewIndices.push(i + balance);\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif (balance !== 0) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent(length, methodName, args) {\n  \tswitch (methodName) {\n  \t\tcase 'splice':\n  \t\t\tif (args[0] !== undefined && args[0] < 0) {\n  \t\t\t\targs[0] = length + Math.max(args[0], -length);\n  \t\t\t}\n\n  \t\t\twhile (args.length < 2) {\n  \t\t\t\targs.push(length - args[0]);\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min(args[1], length - args[0]);\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif (length) {\n  \t\t\t\treturn [length - 1, 1];\n  \t\t\t}\n  \t\t\treturn [0, 0];\n\n  \t\tcase 'push':\n  \t\t\treturn [length, 0].concat(args);\n\n  \t\tcase 'shift':\n  \t\t\treturn [0, length ? 1 : 0];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [0, 0].concat(args);\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod (methodName) {\n  \treturn function (keypath) {\n  \t\tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tvar array = model.get();\n\n  \t\tif (!isArray(array)) {\n  \t\t\tthrow new Error('shuffle array method ' + methodName + ' called on non-array at ' + model.getKeypath());\n  \t\t}\n\n  \t\tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\t\targs[_key - 1] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(array.length, methodName, args);\n  \t\tvar result = arrayProto[methodName].apply(array, args);\n\n  \t\tvar promise = runloop.start(this, true).then(function () {\n  \t\t\treturn result;\n  \t\t});\n\n  \t\tif (newIndices) {\n  \t\t\tmodel.shuffle(newIndices);\n  \t\t} else {\n  \t\t\tmodel.set(result);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var unshift = makeArrayMethod('unshift');\n\n  var unrenderHook$1 = new Hook('unrender');\n  function Ractive$unrender() {\n  \tif (!this.fragment.rendered) {\n  \t\twarnIfDebug('ractive.unrender() was called on a Ractive instance that was not rendered');\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender(shouldDestroy);\n\n  \tremoveFromArray(this.el.__ractive_instances__, this);\n\n  \tunrenderHook$1.fire(this);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function unlink(here) {\n  \tvar ln = this._links[here];\n\n  \tif (ln) {\n  \t\tln.unlink();\n  \t\tdelete this._links[here];\n  \t\treturn this.set(here, ln.intialValue);\n  \t} else {\n  \t\treturn Promise$1.resolve(true);\n  \t}\n  }\n\n  function Ractive$toHTML() {\n  \treturn this.fragment.toString(true);\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function (name, type) {\n    return 'Missing \"' + name + '\" ' + type + ' plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#' + type + 's';\n  };\n\n  function Ractive$toggle(keypath) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new TypeError(badArguments);\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tchanges[model.getKeypath()] = !model.get();\n  \t\t});\n\n  \t\treturn this.set(changes);\n  \t}\n\n  \treturn this.set(keypath, !this.get(keypath));\n  }\n\n  function _bind(x) {\n    x.bind();\n  }\n\n  function cancel(x) {\n    x.cancel();\n  }\n\n  function _handleChange(x) {\n    x.handleChange();\n  }\n\n  function _mark(x) {\n    x.mark();\n  }\n\n  function _render(x) {\n    x.render();\n  }\n\n  function _rebind(x) {\n    x.rebind();\n  }\n\n  function _teardown(x) {\n    x.teardown();\n  }\n\n  function _unbind(x) {\n    x.unbind();\n  }\n\n  function _unrender(x) {\n    x.unrender();\n  }\n\n  function unrenderAndDestroy$1(x) {\n    x.unrender(true);\n  }\n\n  function _update(x) {\n    x.update();\n  }\n\n  function _toString(x) {\n    return x.toString();\n  }\n\n  function toEscapedString(x) {\n    return x.toString(true);\n  }\n\n  var teardownHook = new Hook('teardown');\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown() {\n  \tvar _this = this;\n\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach(cancel);\n\n  \tif (this.fragment.rendered && this.el.__ractive_instances__) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = this.fragment.rendered ? this.unrender() : Promise$1.resolve();\n\n  \tObject.keys(this._links).forEach(function (k) {\n  \t\treturn _this._links[k].unlink();\n  \t});\n\n  \tteardownHook.fire(this);\n\n  \treturn promise;\n  }\n\n  var errorMessage$1 = 'Cannot add to a non-numeric value';\n  function add(ractive, keypath, d) {\n  \tif (typeof keypath !== 'string' || !isNumeric(d)) {\n  \t\tthrow new Error('Bad arguments');\n  \t}\n\n  \tvar changes = undefined;\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif (!isNumeric(value)) throw new Error(errorMessage$1);\n\n  \t\t\tchanges[model.getKeypath()] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set(changes);\n  \t}\n\n  \tvar value = ractive.get(keypath);\n\n  \tif (!isNumeric(value)) {\n  \t\tthrow new Error(errorMessage$1);\n  \t}\n\n  \treturn ractive.set(keypath, +value + d);\n  }\n\n  function Ractive$subtract(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? -1 : -d);\n  }\n\n  var splice = makeArrayMethod('splice');\n\n  var sort = makeArrayMethod('sort');\n\n  var shift = makeArrayMethod('shift');\n\n  function bind(fn, context) {\n  \tif (!/this/.test(fn.toString())) return fn;\n\n  \tvar bound = fn.bind(context);\n  \tfor (var prop in fn) {\n  \t\tbound[prop] = fn[prop];\n  \t}return bound;\n  }\n\n  function Ractive$set(keypath, value) {\n  \tvar promise = runloop.start(this, true);\n\n  \t// Set multiple keypaths in one go\n  \tif (isObject(keypath)) {\n  \t\tvar map = keypath;\n\n  \t\tfor (keypath in map) {\n  \t\t\tif (map.hasOwnProperty(keypath)) {\n  \t\t\t\tset(this, keypath, map[keypath]);\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\t\tset(this, keypath, value);\n  \t\t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  function set(ractive, keypath, value) {\n  \tif (typeof value === 'function') value = bind(value, ractive);\n\n  \tif (/\\*/.test(keypath)) {\n  \t\tractive.viewmodel.findMatches(splitKeypath(keypath)).forEach(function (model) {\n  \t\t\tmodel.set(value);\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll(splitKeypath(keypath));\n  \t\tmodel.set(value);\n  \t}\n  }\n\n  var reverse = makeArrayMethod('reverse');\n\n  var TEMPLATE_VERSION = 3;\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function fromExpression(body) {\n  \tvar length = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  \tvar args = new Array(length);\n\n  \twhile (length--) {\n  \t\targs[length] = '_' + length;\n  \t}\n\n  \t// Functions created directly with new Function() look like this:\n  \t//     function anonymous (_0 /**/) { return _0*2 }\n  \t//\n  \t// With this workaround, we get a little more compact:\n  \t//     function (_0){return _0*2}\n  \treturn new Function([], 'return function (' + args.join(',') + '){return(' + body + ');};')();\n  }\n\n  function fromComputationString(str, bindTo) {\n  \tvar hasThis = undefined;\n\n  \tvar functionBody = 'return (' + str.replace(pattern, function (match, keypath) {\n  \t\thasThis = true;\n  \t\treturn '__ractive.get(\"' + keypath + '\")';\n  \t}) + ');';\n\n  \tif (hasThis) functionBody = 'var __ractive = this; ' + functionBody;\n  \tvar fn = new Function(functionBody);\n  \treturn hasThis ? fn.bind(bindTo) : fn;\n  }\n\n  var html = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1 = 'http://www.w3.org/2000/svg';\n  var xlink = 'http://www.w3.org/1999/xlink';\n  var xml = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns = 'http://www.w3.org/2000/xmlns';\n\n  var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i$1;\n  var j$1;\n  var makeFunction;\n  // Test for SVG support\n  if (!svg) {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (ns && ns !== html) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t};\n  } else {\n  \tcreateElement = function (type, ns, extend) {\n  \t\tif (!ns || ns === html) {\n  \t\t\treturn extend ? doc.createElement(type, extend) : doc.createElement(type);\n  \t\t}\n\n  \t\treturn extend ? doc.createElementNS(ns, type, extend) : doc.createElementNS(ns, type);\n  \t};\n  }\n\n  function createDocumentFragment() {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement(input) {\n  \tvar output;\n\n  \tif (!input || typeof input === 'boolean') {\n  \t\treturn;\n  \t}\n\n  \tif (!win || !doc || !input) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif (input.nodeType) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif (typeof input === 'string') {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById(input);\n\n  \t\t// then as selector, if possible\n  \t\tif (!output && doc.querySelector) {\n  \t\t\toutput = doc.querySelector(input);\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif (output && output.nodeType) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif (input[0] && input[0].nodeType) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if (!isClient) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement('div');\n  \tmethodNames = ['matches', 'matchesSelector'];\n\n  \tmakeFunction = function (methodName) {\n  \t\treturn function (node, selector) {\n  \t\t\treturn node[methodName](selector);\n  \t\t};\n  \t};\n\n  \ti$1 = methodNames.length;\n\n  \twhile (i$1-- && !matches) {\n  \t\tunprefixed = methodNames[i$1];\n\n  \t\tif (div[unprefixed]) {\n  \t\t\tmatches = makeFunction(unprefixed);\n  \t\t} else {\n  \t\t\tj$1 = vendors.length;\n  \t\t\twhile (j$1--) {\n  \t\t\t\tprefixed = vendors[i$1] + unprefixed.substr(0, 1).toUpperCase() + unprefixed.substring(1);\n\n  \t\t\t\tif (div[prefixed]) {\n  \t\t\t\t\tmatches = makeFunction(prefixed);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif (!matches) {\n  \t\tmatches = function (node, selector) {\n  \t\t\tvar nodes, parentNode, i$1;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif (!parentNode) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild(node);\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll(selector);\n\n  \t\t\ti$1 = nodes.length;\n  \t\t\twhile (i$1--) {\n  \t\t\t\tif (nodes[i$1] === node) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode(node) {\n  \tif (node && typeof node.parentNode !== 'unknown' && node.parentNode) {\n  \t\tnode.parentNode.removeChild(node);\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue(value) {\n  \treturn value == null || !value.toString ? '' : '' + value;\n  }\n\n  var legacy = null;\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tif (doc) {\n  \t\tObject.defineProperty(createElement('div'), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch (err) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function (obj, prop, desc) {\n  \t\tobj[prop] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch (err) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif (doc) {\n  \t\tObject.defineProperties(createElement('div'), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch (err) {\n  \tdefineProperties = function (obj, props) {\n  \t\tvar prop;\n\n  \t\tfor (prop in props) {\n  \t\t\tif (props.hasOwnProperty(prop)) {\n  \t\t\t\tdefineProperty(obj, prop, props[prop]);\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create(null);\n\n  \tcreate = Object.create;\n  } catch (err) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function (proto, props) {\n  \t\t\tvar obj;\n\n  \t\t\tif (proto === null) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif (props) {\n  \t\t\t\tObject.defineProperties(obj, props);\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t})();\n  }\n\n  function extend(target) {\n  \tvar prop, source;\n\n  \tfor (var _len = arguments.length, sources = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\tsources[_key - 1] = arguments[_key];\n  \t}\n\n  \twhile (source = sources.shift()) {\n  \t\tfor (prop in source) {\n  \t\t\tif (hasOwn.call(source, prop)) {\n  \t\t\t\ttarget[prop] = source[prop];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var functions = create(null);\n  function getFunction(str, i) {\n  \tif (functions[str]) return functions[str];\n  \treturn functions[str] = createFunction(str, i);\n  }\n\n  function addFunctions(template) {\n  \tif (!template) return;\n\n  \tvar exp = template.e;\n\n  \tif (!exp) return;\n\n  \tObject.keys(exp).forEach(function (str) {\n  \t\tif (functions[str]) return;\n  \t\tfunctions[str] = exp[str];\n  \t});\n  }\n\n  var parse = null;\n\n  var parseOptions = ['delimiters', 'tripleDelimiters', 'staticDelimiters', 'staticTripleDelimiters', 'csp', 'interpolate', 'preserveWhitespace', 'sanitize', 'stripComments'];\n\n  var TEMPLATE_INSTRUCTIONS = 'Either preparse or use a ractive runtime source that includes the parser. ';\n\n  var COMPUTATION_INSTRUCTIONS = 'Either use:\\n\\n\\tRactive.parse.computedStrings( component.computed )\\n\\nat build time to pre-convert the strings to functions, or use functions instead of strings in computed properties.';\n\n  function throwNoParse(method, error, instructions) {\n  \tif (!method) {\n  \t\tfatal('Missing Ractive.parse - cannot parse ' + error + '. ' + instructions);\n  \t}\n  }\n\n  function createFunction(body, length) {\n  \tthrowNoParse(fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS);\n  \treturn fromExpression(body, length);\n  }\n\n  function createFunctionFromString(str, bindTo) {\n  \tthrowNoParse(fromComputationString, 'compution string \"${str}\"', COMPUTATION_INSTRUCTIONS);\n  \treturn fromComputationString(str, bindTo);\n  }\n\n  var parser = {\n\n  \tfromId: function (id, options) {\n  \t\tif (!doc) {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Cannot retrieve template #' + id + ' as Ractive is not running in a browser.');\n  \t\t}\n\n  \t\tif (id) id = id.replace(/^#/, '');\n\n  \t\tvar template = undefined;\n\n  \t\tif (!(template = doc.getElementById(id))) {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Could not find template element with id #' + id);\n  \t\t}\n\n  \t\tif (template.tagName.toUpperCase() !== 'SCRIPT') {\n  \t\t\tif (options && options.noThrow) {\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t\tthrow new Error('Template element with id #' + id + ', must be a <script> element');\n  \t\t}\n\n  \t\treturn 'textContent' in template ? template.textContent : template.innerHTML;\n  \t},\n\n  \tisParsed: function (template) {\n  \t\treturn !(typeof template === 'string');\n  \t},\n\n  \tgetParseOptions: function (ractive) {\n  \t\t// Could be Ractive or a Component\n  \t\tif (ractive.defaults) {\n  \t\t\tractive = ractive.defaults;\n  \t\t}\n\n  \t\treturn parseOptions.reduce(function (val, key) {\n  \t\t\tval[key] = ractive[key];\n  \t\t\treturn val;\n  \t\t}, {});\n  \t},\n\n  \tparse: function (template, options) {\n  \t\tthrowNoParse(parse, 'template', TEMPLATE_INSTRUCTIONS);\n  \t\tvar parsed = parse(template, options);\n  \t\taddFunctions(parsed);\n  \t\treturn parsed;\n  \t},\n\n  \tparseFor: function (template, ractive) {\n  \t\treturn this.parse(template, this.getParseOptions(ractive));\n  \t}\n  };\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function (Parent, proto, options) {\n  \t\t// only assign if exists\n  \t\tif ('template' in options) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif (typeof template === 'function') {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseTemplate(template, proto);\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif (typeof template === 'function') {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate(ractive, fn);\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseTemplate(template, ractive);\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif (template.p) {\n  \t\t\textendPartials(ractive.partials, template.p);\n  \t\t}\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = resetValue(ractive);\n\n  \t\tif (result) {\n  \t\t\tvar parsed = parseTemplate(result, ractive);\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials(ractive.partials, parsed.p, true);\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue(ractive) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif (!initial || !initial.fn) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate(ractive, initial.fn);\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif (result !== initial.result) {\n  \t\tinitial.result = result;\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate(ractive, fn) {\n  \treturn fn.call(ractive, {\n  \t\tfromId: parser.fromId,\n  \t\tisParsed: parser.isParsed,\n  \t\tparse: function (template) {\n  \t\t\tvar options = arguments.length <= 1 || arguments[1] === undefined ? parser.getParseOptions(ractive) : arguments[1];\n\n  \t\t\treturn parser.parse(template, options);\n  \t\t}\n  \t});\n  }\n\n  function parseTemplate(template, ractive) {\n  \tif (typeof template === 'string') {\n  \t\t// parse will validate and add expression functions\n  \t\ttemplate = parseAsString(template, ractive);\n  \t} else {\n  \t\t// need to validate and add exp for already parsed template\n  \t\tvalidate$1(template);\n  \t\taddFunctions(template);\n  \t}\n\n  \treturn template;\n  }\n\n  function parseAsString(template, ractive) {\n  \t// ID of an element containing the template?\n  \tif (template[0] === '#') {\n  \t\ttemplate = parser.fromId(template);\n  \t}\n\n  \treturn parser.parseFor(template, ractive);\n  }\n\n  function validate$1(template) {\n\n  \t// Check that the template even exists\n  \tif (template == undefined) {\n  \t\tthrow new Error('The template cannot be ' + template + '.');\n  \t}\n\n  \t// Check the parsed template has a version at all\n  \telse if (typeof template.v !== 'number') {\n  \t\t\tthrow new Error('The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.');\n  \t\t}\n\n  \t\t// Check we're using the correct version\n  \t\telse if (template.v !== TEMPLATE_VERSION) {\n  \t\t\t\tthrow new Error('Mismatched template version (expected ' + TEMPLATE_VERSION + ', got ' + template.v + ') Please ensure you are using the latest version of Ractive.js in your build process as well as in your app');\n  \t\t\t}\n  }\n\n  function extendPartials(existingPartials, newPartials, overwrite) {\n  \tif (!newPartials) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor (var key in newPartials) {\n  \t\tif (overwrite || !existingPartials.hasOwnProperty(key)) {\n  \t\t\texistingPartials[key] = newPartials[key];\n  \t\t}\n  \t}\n  }\n\n  var TEXT = 1;\n  var INTERPOLATOR = 2;\n  var TRIPLE = 3;\n  var SECTION = 4;\n  var ELEMENT = 7;\n  var PARTIAL = 8;\n  var COMPONENT = 15;\n  var YIELDER = 16;\n  var DOCTYPE = 18;\n  var ALIAS = 19;\n\n  var NUMBER_LITERAL = 20;\n  var STRING_LITERAL = 21;\n  var REFERENCE = 30;\n  var SECTION_IF = 50;\n  var SECTION_UNLESS = 51;\n  var SECTION_EACH = 52;\n  var SECTION_WITH = 53;\n  var SECTION_IF_WITH = 54;\n\n  var Item = (function () {\n  \tfunction Item(options) {\n  \t\tclassCallCheck(this, Item);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.ractive = options.parentFragment.ractive;\n\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n  \t\tthis.type = options.template.t;\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tItem.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tItem.prototype.find = function find() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAll = function findAll() {\n  \t\t// noop\n  \t};\n\n  \tItem.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tItem.prototype.findAllComponents = function findAllComponents() {\n  \t\t// noop;\n  \t};\n\n  \tItem.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.parentFragment.findNextNode(this);\n  \t};\n\n  \treturn Item;\n  })();\n\n  function badReference(key) {\n  \tthrow new Error('An index or key reference (' + key + ') cannot have child properties');\n  }\n  function resolveAmbiguousReference(fragment, ref) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypath(ref);\n  \tvar key = keys[0];\n\n  \tvar hasContextChain = undefined;\n  \tvar crossedComponentBoundary = undefined;\n  \tvar aliases = undefined;\n\n  \twhile (fragment) {\n  \t\t// repeated fragments\n  \t\tif (fragment.isIteration) {\n  \t\t\tif (key === fragment.parent.keyRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif (key === fragment.parent.indexRef) {\n  \t\t\t\tif (keys.length > 1) badReference(key);\n  \t\t\t\treturn fragment.context.getIndexModel(fragment.index);\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif (((aliases = fragment.owner.aliases) || (aliases = fragment.aliases)) && aliases.hasOwnProperty(key)) {\n  \t\t\tvar model = aliases[key];\n\n  \t\t\tif (keys.length === 1) return model;else if (typeof model.joinAll === 'function') {\n  \t\t\t\treturn model.joinAll(keys.slice(1));\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.context) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif (!fragment.isRoot || fragment.ractive.component) hasContextChain = true;\n\n  \t\t\tif (fragment.context.has(key)) {\n  \t\t\t\tif (crossedComponentBoundary) {\n  \t\t\t\t\tlocalViewmodel.map(key, fragment.context.joinKey(key));\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll(keys);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (fragment.componentParent && !fragment.ractive.isolated) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif (!hasContextChain) {\n  \t\treturn localViewmodel.joinAll(keys);\n  \t}\n  }\n\n  var stack = [];\n  var captureGroup = undefined;\n\n  function startCapturing() {\n  \tstack.push(captureGroup = []);\n  }\n\n  function stopCapturing() {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[stack.length - 1];\n  \treturn dependencies;\n  }\n\n  function capture(model) {\n  \tif (captureGroup) {\n  \t\tcaptureGroup.push(model);\n  \t}\n  }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if (!win) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function (vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif (win.requestAnimationFrame) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor (x = 0; x < vendors.length && !win.requestAnimationFrame; ++x) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x] + 'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif (!win.requestAnimationFrame) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function (callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max(0, 16 - (currTime - lastTime));\n  \t\t\t\tid = setTimeout(function () {\n  \t\t\t\t\tcallback(currTime + timeToCall);\n  \t\t\t\t}, timeToCall);\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n  \t})(vendors, 0, win);\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = win && win.performance && typeof win.performance.now === 'function' ? function () {\n  \treturn win.performance.now();\n  } : function () {\n  \treturn Date.now();\n  };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick() {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i = undefined;\n  \tvar ticker = undefined;\n\n  \tfor (i = 0; i < tickers.length; i += 1) {\n  \t\tticker = tickers[i];\n\n  \t\tif (!ticker.tick(now)) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice(i--, 1);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif (tickers.length) {\n  \t\trAF(tick);\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = (function () {\n  \tfunction Ticker(options) {\n  \t\tclassCallCheck(this, Ticker);\n\n  \t\tthis.duration = options.duration;\n  \t\tthis.step = options.step;\n  \t\tthis.complete = options.complete;\n  \t\tthis.easing = options.easing;\n\n  \t\tthis.start = getTime();\n  \t\tthis.end = this.start + this.duration;\n\n  \t\tthis.running = true;\n\n  \t\ttickers.push(this);\n  \t\tif (!running) rAF(tick);\n  \t}\n\n  \tTicker.prototype.tick = function tick(now) {\n  \t\tif (!this.running) return false;\n\n  \t\tif (now > this.end) {\n  \t\t\tif (this.step) this.step(1);\n  \t\t\tif (this.complete) this.complete(1);\n\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar elapsed = now - this.start;\n  \t\tvar eased = this.easing(elapsed / this.duration);\n\n  \t\tif (this.step) this.step(eased);\n\n  \t\treturn true;\n  \t};\n\n  \tTicker.prototype.stop = function stop() {\n  \t\tif (this.abort) this.abort();\n  \t\tthis.running = false;\n  \t};\n\n  \treturn Ticker;\n  })();\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath(obj, prefix) {\n  \tvar prefixed = {},\n  \t    key;\n\n  \tif (!prefix) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor (key in obj) {\n  \t\tif (obj.hasOwnProperty(key)) {\n  \t\t\tprefixed[prefix + key] = obj[key];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n  function getPrefixer(rootKeypath) {\n  \tvar rootDot;\n\n  \tif (!prefixers[rootKeypath]) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[rootKeypath] = function (relativeKeypath, value) {\n  \t\t\tvar obj;\n\n  \t\t\tif (typeof relativeKeypath === 'string') {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[rootDot + relativeKeypath] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif (typeof relativeKeypath === 'object') {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath(relativeKeypath, rootKeypath) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[rootKeypath];\n  }\n\n  var KeyModel = (function () {\n  \tfunction KeyModel(key) {\n  \t\tclassCallCheck(this, KeyModel);\n\n  \t\tthis.value = key;\n  \t\tthis.isReadonly = true;\n  \t\tthis.dependants = [];\n  \t}\n\n  \tKeyModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeyModel.prototype.rebind = function rebind(key) {\n  \t\tthis.value = key;\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeyModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeyModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeyModel;\n  })();\n\n  var KeypathModel = (function () {\n  \tfunction KeypathModel(parent, ractive) {\n  \t\tclassCallCheck(this, KeypathModel);\n\n  \t\tthis.parent = parent;\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = ractive ? parent.getKeypath(ractive) : parent.getKeypath();\n  \t\tthis.dependants = [];\n  \t\tthis.children = [];\n  \t}\n\n  \tKeypathModel.prototype.addChild = function addChild(model) {\n  \t\tthis.children.push(model);\n  \t\tmodel.owner = this;\n  \t};\n\n  \tKeypathModel.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.value;\n  \t};\n\n  \tKeypathModel.prototype.handleChange = function handleChange() {\n  \t\tthis.value = this.ractive ? this.parent.getKeypath(this.ractive) : this.parent.getKeypath();\n  \t\tif (this.ractive && this.owner) {\n  \t\t\tthis.ractive.viewmodel.keypathModels[this.owner.value] = this;\n  \t\t}\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.dependants.forEach(_handleChange);\n  \t};\n\n  \tKeypathModel.prototype.register = function register(dependant) {\n  \t\tthis.dependants.push(dependant);\n  \t};\n\n  \tKeypathModel.prototype.removeChild = function removeChild(model) {\n  \t\tremoveFromArray(this.children, model);\n  \t};\n\n  \tKeypathModel.prototype.teardown = function teardown() {\n  \t\tif (this.owner) this.owner.removeChild(this);\n  \t\tthis.children.forEach(_teardown);\n  \t};\n\n  \tKeypathModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.dependants, dependant);\n  \t};\n\n  \treturn KeypathModel;\n  })();\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function _updateFromBindings(model) {\n  \tmodel.updateFromBindings(true);\n  }\n\n  function _updateKeypathDependants(model) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = (function () {\n  \tfunction Model(parent, key) {\n  \t\tclassCallCheck(this, Model);\n\n  \t\tthis.deps = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.indexModels = [];\n\n  \t\tthis.unresolved = [];\n  \t\tthis.unresolvedByKey = {};\n\n  \t\tthis.bindings = [];\n\n  \t\tthis.value = undefined;\n\n  \t\tthis.ticker = null;\n\n  \t\tif (parent) {\n  \t\t\tthis.parent = parent;\n  \t\t\tthis.root = parent.root;\n  \t\t\tthis.key = unescapeKey(key);\n  \t\t\tthis.isReadonly = parent.isReadonly;\n\n  \t\t\tif (parent.value) {\n  \t\t\t\tthis.value = parent.value[this.key];\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tModel.prototype.adapt = function adapt() {\n  \t\tvar adaptors = this.root.adaptors;\n  \t\tvar value = this.value;\n  \t\tvar len = adaptors.length;\n\n  \t\t// TODO remove this legacy nonsense\n  \t\tvar ractive = this.root.ractive;\n  \t\tvar keypath = this.getKeypath();\n\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar adaptor = adaptors[i];\n  \t\t\tif (adaptor.filter(value, keypath, ractive)) {\n  \t\t\t\tthis.wrapper = adaptor.wrap(ractive, value, keypath, getPrefixer(keypath));\n  \t\t\t\tthis.wrapper.value = this.value;\n  \t\t\t\tthis.wrapper.__model = this; // massive temporary hack to enable array adaptor\n\n  \t\t\t\tthis.value = this.wrapper.get();\n\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.addUnresolved = function addUnresolved(key, resolver) {\n  \t\tif (!this.unresolvedByKey[key]) {\n  \t\t\tthis.unresolved.push(key);\n  \t\t\tthis.unresolvedByKey[key] = [];\n  \t\t}\n\n  \t\tthis.unresolvedByKey[key].push(resolver);\n  \t};\n\n  \tModel.prototype.animate = function animate(from, to, options, interpolator) {\n  \t\tvar _this = this;\n\n  \t\tif (this.ticker) this.ticker.stop();\n\n  \t\tvar fulfilPromise = undefined;\n  \t\tvar promise = new Promise$1(function (fulfil) {\n  \t\t\treturn fulfilPromise = fulfil;\n  \t\t});\n\n  \t\tthis.ticker = new Ticker({\n  \t\t\tduration: options.duration,\n  \t\t\teasing: options.easing,\n  \t\t\tstep: function (t) {\n  \t\t\t\tvar value = interpolator(t);\n  \t\t\t\t_this.applyValue(value);\n  \t\t\t\tif (options.step) options.step(t, value);\n  \t\t\t},\n  \t\t\tcomplete: function () {\n  \t\t\t\t_this.applyValue(to);\n  \t\t\t\tif (options.complete) options.complete(to);\n\n  \t\t\t\t_this.ticker = null;\n  \t\t\t\tfulfilPromise();\n  \t\t\t}\n  \t\t});\n\n  \t\tpromise.stop = this.ticker.stop;\n  \t\treturn promise;\n  \t};\n\n  \tModel.prototype.applyValue = function applyValue(value) {\n  \t\tif (isEqual(value, this.value)) return;\n\n  \t\t// TODO deprecate this nonsense\n  \t\tthis.root.changes[this.getKeypath()] = value;\n\n  \t\tif (this.parent.wrapper && this.parent.wrapper.set) {\n  \t\t\tthis.parent.wrapper.set(this.key, value);\n  \t\t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\t\tthis.value = this.parent.value[this.key];\n  \t\t\t// TODO should this value be adapted? probably\n  \t\t} else if (this.wrapper) {\n  \t\t\t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset(value) === false;\n\n  \t\t\t\tif (shouldTeardown) {\n  \t\t\t\t\tthis.wrapper.teardown();\n  \t\t\t\t\tthis.wrapper = null;\n  \t\t\t\t\tthis.parent.value[this.key] = this.value = value;\n  \t\t\t\t\tthis.adapt();\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.value = this.wrapper.get();\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch(this.key);\n  \t\t\t\tparentValue[this.key] = value;\n\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n\n  \t\tthis.parent.clearUnresolveds();\n  \t\tthis.clearUnresolveds();\n\n  \t\t// notify dependants\n  \t\tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \t\toriginatingModel = this;\n\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.deps.forEach(_handleChange);\n\n  \t\tvar parent = this.parent;\n  \t\twhile (parent) {\n  \t\t\tparent.deps.forEach(_handleChange);\n  \t\t\tparent = parent.parent;\n  \t\t}\n\n  \t\toriginatingModel = previousOriginatingModel;\n  \t};\n\n  \tModel.prototype.clearUnresolveds = function clearUnresolveds(specificKey) {\n  \t\tvar i = this.unresolved.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar key = this.unresolved[i];\n\n  \t\t\tif (specificKey && key !== specificKey) continue;\n\n  \t\t\tvar resolvers = this.unresolvedByKey[key];\n  \t\t\tvar hasKey = this.has(key);\n\n  \t\t\tvar j = resolvers.length;\n  \t\t\twhile (j--) {\n  \t\t\t\tif (hasKey) resolvers[j].attemptResolution();\n  \t\t\t\tif (resolvers[j].resolved) resolvers.splice(j, 1);\n  \t\t\t}\n\n  \t\t\tif (!resolvers.length) {\n  \t\t\t\tthis.unresolved.splice(i, 1);\n  \t\t\t\tthis.unresolvedByKey[key] = null;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.createBranch = function createBranch(key) {\n  \t\tvar branch = isNumeric(key) ? [] : {};\n  \t\tthis.set(branch);\n\n  \t\treturn branch;\n  \t};\n\n  \tModel.prototype.discard = function discard() {\n  \t\tvar _this2 = this;\n\n  \t\tthis.deps.forEach(function (d) {\n  \t\t\tif (d.boundsSensitive) _this2.unregister(d);\n  \t\t});\n  \t};\n\n  \tModel.prototype.findMatches = function findMatches(keys) {\n  \t\tvar len = keys.length;\n\n  \t\tvar existingMatches = [this];\n  \t\tvar matches = undefined;\n  \t\tvar i = undefined;\n\n  \t\tvar _loop = function () {\n  \t\t\tvar key = keys[i];\n\n  \t\t\tif (key === '*') {\n  \t\t\t\tmatches = [];\n  \t\t\t\texistingMatches.forEach(function (model) {\n\n  \t\t\t\t\tfunction addChildKey(key) {\n  \t\t\t\t\t\tmatches.push(model.joinKey(key));\n  \t\t\t\t\t}\n\n  \t\t\t\t\tfunction addChildren(children) {\n  \t\t\t\t\t\tObject.keys(children).forEach(addChildKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar value = model.get();\n\n  \t\t\t\t\tif (isArray(value)) {\n  \t\t\t\t\t\t// special case - array.length. This is a horrible kludge, but\n  \t\t\t\t\t\t// it'll do for now. Alternatives welcome\n  \t\t\t\t\t\tif (originatingModel && originatingModel.parent === model && originatingModel.key === 'length') {\n  \t\t\t\t\t\t\tmatches.push(originatingModel);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tvalue.map(function (m, i) {\n  \t\t\t\t\t\t\treturn i;\n  \t\t\t\t\t\t}).forEach(addChildKey);\n  \t\t\t\t\t} else if (isObject(value) || typeof value === 'function') {\n\n  \t\t\t\t\t\taddChildren(value);\n\n  \t\t\t\t\t\t// special case - computed properties and mappings of root\n  \t\t\t\t\t\tif (model.isRoot) {\n  \t\t\t\t\t\t\taddChildren(model.computations);\n  \t\t\t\t\t\t\taddChildren(model.mappings);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (value != null) {\n  \t\t\t\t\t\tthrow new Error('Cannot get values of ' + model.getKeypath() + '.* as ' + model.getKeypath() + ' is not an array, object or function');\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t} else {\n  \t\t\t\tmatches = existingMatches.map(function (model) {\n  \t\t\t\t\treturn model.joinKey(key);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\texistingMatches = matches;\n  \t\t};\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t_loop();\n  \t\t}\n\n  \t\treturn matches;\n  \t};\n\n  \tModel.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n  \t\treturn this.value;\n  \t};\n\n  \tModel.prototype.getIndexModel = function getIndexModel(fragmentIndex) {\n  \t\tvar indexModels = this.parent.indexModels;\n\n  \t\t// non-numeric keys are a special of a numeric index in a object iteration\n  \t\tif (typeof this.key === 'string' && fragmentIndex !== undefined) {\n  \t\t\treturn new KeyModel(fragmentIndex);\n  \t\t} else if (!indexModels[this.key]) {\n  \t\t\tindexModels[this.key] = new KeyModel(this.key);\n  \t\t}\n\n  \t\treturn indexModels[this.key];\n  \t};\n\n  \tModel.prototype.getKeyModel = function getKeyModel() {\n  \t\t// TODO... different to IndexModel because key can never change\n  \t\treturn new KeyModel(escapeKey(this.key));\n  \t};\n\n  \tModel.prototype.getKeypathModel = function getKeypathModel(ractive) {\n  \t\tvar keypath = this.getKeypath(),\n  \t\t    model = this.keypathModel || (this.keypathModel = new KeypathModel(this));\n\n  \t\tif (ractive && ractive.component) {\n  \t\t\tvar mapped = this.getKeypath(ractive);\n  \t\t\tif (mapped !== keypath) {\n  \t\t\t\tvar map = ractive.viewmodel.keypathModels || (ractive.viewmodel.keypathModels = {});\n  \t\t\t\tvar child = map[keypath] || (map[keypath] = new KeypathModel(this, ractive));\n  \t\t\t\tmodel.addChild(child);\n  \t\t\t\treturn child;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.getKeypath = function getKeypath(ractive) {\n  \t\tvar root = this.parent.isRoot ? escapeKey(this.key) : this.parent.getKeypath() + '.' + escapeKey(this.key);\n\n  \t\tif (ractive && ractive.component) {\n  \t\t\tvar map = ractive.viewmodel.mappings;\n  \t\t\tfor (var k in map) {\n  \t\t\t\tif (root.indexOf(map[k].getKeypath()) >= 0) {\n  \t\t\t\t\troot = root.replace(map[k].getKeypath(), k);\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn root;\n  \t};\n\n  \tModel.prototype.has = function has(key) {\n  \t\tvar value = this.get();\n  \t\tif (!value) return false;\n\n  \t\tkey = unescapeKey(key);\n  \t\tif (hasProp.call(value, key)) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile (constructor !== Function && constructor !== Array && constructor !== Object) {\n  \t\t\tif (hasProp.call(constructor.prototype, key)) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new Model(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tModel.prototype.joinAll = function joinAll(keys) {\n  \t\tvar model = this;\n  \t\tfor (var i = 0; i < keys.length; i += 1) {\n  \t\t\tmodel = model.joinKey(keys[i]);\n  \t\t}\n\n  \t\treturn model;\n  \t};\n\n  \tModel.prototype.mark = function mark() {\n  \t\tvar value = this.retrieve();\n\n  \t\tif (!isEqual(value, this.value)) {\n  \t\t\tthis.value = value;\n\n  \t\t\tthis.children.forEach(_mark);\n\n  \t\t\tthis.deps.forEach(_handleChange);\n  \t\t\tthis.clearUnresolveds();\n  \t\t}\n  \t};\n\n  \tModel.prototype.merge = function merge(array, comparator) {\n  \t\tvar oldArray = comparator ? this.value.map(comparator) : this.value;\n  \t\tvar newArray = comparator ? array.map(comparator) : array;\n\n  \t\tvar oldLength = oldArray.length;\n\n  \t\tvar usedIndices = {};\n  \t\tvar firstUnusedIndex = 0;\n\n  \t\tvar newIndices = oldArray.map(function (item) {\n  \t\t\tvar index = undefined;\n  \t\t\tvar start = firstUnusedIndex;\n\n  \t\t\tdo {\n  \t\t\t\tindex = newArray.indexOf(item, start);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\treturn -1;\n  \t\t\t\t}\n\n  \t\t\t\tstart = index + 1;\n  \t\t\t} while (usedIndices[index] === true && start < oldLength);\n\n  \t\t\t// keep track of the first unused index, so we don't search\n  \t\t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\t\tif (index === firstUnusedIndex) {\n  \t\t\t\tfirstUnusedIndex += 1;\n  \t\t\t}\n  \t\t\t// allow next instance of next \"equal\" to be found item\n  \t\t\tusedIndices[index] = true;\n  \t\t\treturn index;\n  \t\t});\n\n  \t\tthis.parent.value[this.key] = array;\n  \t\tthis._merged = true;\n  \t\tthis.shuffle(newIndices);\n  \t};\n\n  \tModel.prototype.register = function register(dep) {\n  \t\tthis.deps.push(dep);\n  \t};\n\n  \tModel.prototype.registerTwowayBinding = function registerTwowayBinding(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.parent.value ? this.parent.value[this.key] : undefined;\n  \t};\n\n  \tModel.prototype.set = function set(value) {\n  \t\tif (this.ticker) this.ticker.stop();\n  \t\tthis.applyValue(value);\n  \t};\n\n  \tModel.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tvar indexModels = [];\n  \t\tvar max = 0,\n  \t\t    child = undefined;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex > max) max = newIndex;\n\n  \t\t\tif (! ~newIndex) return;\n\n  \t\t\tvar model = _this3.indexModels[oldIndex];\n\n  \t\t\tif (!model) return;\n\n  \t\t\tindexModels[newIndex] = model;\n\n  \t\t\tif (newIndex !== oldIndex) {\n  \t\t\t\tmodel.rebind(newIndex);\n  \t\t\t}\n  \t\t});\n\n  \t\t// some children, notably computations, need to be notified when they are\n  \t\t// no longer attached to anything so they don't recompute\n  \t\twhile (child = this.childByKey[++max]) {\n  \t\t\tif (typeof child.discard === 'function') child.discard();\n  \t\t}\n\n  \t\tthis.indexModels = indexModels;\n\n  \t\t// shuffles need to happen before marks...\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (dep.shuffle) dep.shuffle(newIndices);\n  \t\t});\n\n  \t\tthis.updateKeypathDependants();\n  \t\tthis.mark();\n\n  \t\t// ...but handleChange must happen after (TODO document why)\n  \t\tthis.deps.forEach(function (dep) {\n  \t\t\tif (!dep.shuffle) dep.handleChange();\n  \t\t});\n  \t};\n\n  \tModel.prototype.teardown = function teardown() {\n  \t\tthis.children.forEach(_teardown);\n  \t\tif (this.wrapper) this.wrapper.teardown();\n  \t\tif (this.keypathModels) {\n  \t\t\tfor (var k in this.keypathModels) {\n  \t\t\t\tthis.keypathModels[k].teardown();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tModel.prototype.unregister = function unregister(dependant) {\n  \t\tremoveFromArray(this.deps, dependant);\n  \t};\n\n  \tModel.prototype.unregisterTwowayBinding = function unregisterTwowayBinding(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t};\n\n  \tModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) this.set(value);\n  \t\t}\n\n  \t\tif (cascade) {\n  \t\t\tthis.children.forEach(_updateFromBindings);\n  \t\t}\n  \t};\n\n  \tModel.prototype.updateKeypathDependants = function updateKeypathDependants() {\n  \t\tthis.children.forEach(_updateKeypathDependants);\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n  \t};\n\n  \treturn Model;\n  })();\n\n  var GlobalModel = (function (_Model) {\n  \tinherits(GlobalModel, _Model);\n\n  \tfunction GlobalModel() {\n  \t\tclassCallCheck(this, GlobalModel);\n\n  \t\t_Model.call(this, null, '@global');\n  \t\tthis.value = typeof global !== 'undefined' ? global : window;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.changes = {};\n  \t}\n\n  \tGlobalModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@global';\n  \t};\n\n  \treturn GlobalModel;\n  })(Model);\n\n  var GlobalModel$1 = new GlobalModel();\n\n  function resolveReference(fragment, ref) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif (ref === '.' || ref === 'this') return context;\n  \tif (ref === '@keypath') return context.getKeypathModel(fragment.ractive);\n  \tif (ref === '@rootpath') return context.getKeypathModel();\n  \tif (ref === '@index') {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif (!repeater.isIteration) return;\n  \t\treturn repeater.context.getIndexModel(repeater.index);\n  \t}\n  \tif (ref === '@key') return fragment.findRepeatingFragment().context.getKeyModel();\n  \tif (ref === '@ractive') {\n  \t\treturn fragment.ractive.viewmodel.getRactiveModel();\n  \t}\n  \tif (ref === '@global') {\n  \t\treturn GlobalModel$1;\n  \t}\n\n  \t// ancestor references\n  \tif (ref[0] === '~') return fragment.ractive.viewmodel.joinAll(splitKeypath(ref.slice(2)));\n  \tif (ref[0] === '.') {\n  \t\tvar parts = ref.split('/');\n\n  \t\twhile (parts[0] === '.' || parts[0] === '..') {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif (part === '..') {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join('/');\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif (ref[0] === '.') ref = ref.slice(1);\n  \t\treturn context.joinAll(splitKeypath(ref));\n  \t}\n\n  \treturn resolveAmbiguousReference(fragment, ref);\n  }\n\n  var ComputationChild = (function (_Model) {\n  \tinherits(ComputationChild, _Model);\n\n  \tfunction ComputationChild() {\n  \t\tclassCallCheck(this, ComputationChild);\n\n  \t\t_Model.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[this.key] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \t// TODO this causes problems with inter-component mappings\n  \t// set () {\n  \t// \tthrow new Error( `Cannot set read-only property of computed value (${this.getKeypath()})` );\n  \t// }\n  \treturn ComputationChild;\n  })(Model);\n\n  function getValue(model) {\n  \treturn model ? model.get(true) : undefined;\n  }\n\n  var ExpressionProxy = (function (_Model) {\n  \tinherits(ExpressionProxy, _Model);\n\n  \tfunction ExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ExpressionProxy);\n\n  \t\t_Model.call(this, fragment.ractive.viewmodel, null);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = getFunction(template.s, template.r.length);\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = template.r.map(function (ref, index) {\n  \t\t\tvar model = resolveReference(fragment, ref);\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (!model) {\n  \t\t\t\tresolver = fragment.resolve(ref, function (model) {\n  \t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t_this.models[index] = model;\n  \t\t\t\t\t_this.bubble();\n  \t\t\t\t});\n\n  \t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype.bubble = function bubble() {\n  \t\tvar _this2 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace(/_(\\d+)/g, function (match, i) {\n  \t\t\tif (i >= _this2.models.length) return match;\n\n  \t\t\tvar model = _this2.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = _this2.models.map(getValue);\n  \t\t\t\treturn _this2.fn.apply(ractive, values);\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute(key, signature);\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif (this.computation) {\n  \t\t\tthis.computation.unregister(this);\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register(this);\n\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.get = function get(shouldCapture) {\n  \t\treturn this.computation.get(shouldCapture);\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ExpressionProxy;\n  })(Model);\n\n  var ReferenceExpressionProxy = (function (_Model) {\n  \tinherits(ReferenceExpressionProxy, _Model);\n\n  \tfunction ReferenceExpressionProxy(fragment, template) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, ReferenceExpressionProxy);\n\n  \t\t_Model.call(this, null, null);\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$1(fragment, template);\n  \t\tvar baseResolver = undefined;\n\n  \t\tif (!this.base) {\n  \t\t\tbaseResolver = fragment.resolve(template.r, function (model) {\n  \t\t\t\t_this.base = model;\n  \t\t\t\t_this.bubble();\n\n  \t\t\t\tremoveFromArray(_this.resolvers, baseResolver);\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push(baseResolver);\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.bubble();\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.members = template.m.map(function (template, i) {\n  \t\t\tif (typeof template === 'string') {\n  \t\t\t\treturn { get: function () {\n  \t\t\t\t\t\treturn template;\n  \t\t\t\t\t} };\n  \t\t\t}\n\n  \t\t\tvar model = undefined;\n  \t\t\tvar resolver = undefined;\n\n  \t\t\tif (template.t === REFERENCE) {\n  \t\t\t\tmodel = resolveReference(fragment, template.n);\n\n  \t\t\t\tif (model) {\n  \t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve(template.n, function (model) {\n  \t\t\t\t\t\t_this.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register(intermediary);\n  \t\t\t\t\t\t_this.bubble();\n\n  \t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t});\n\n  \t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy(fragment, template);\n  \t\t\tmodel.register(intermediary);\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble() {\n  \t\tif (!this.base) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile (i--) {\n  \t\t\tif (!this.members[i]) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map(function (model) {\n  \t\t\treturn escapeKey(String(model.get()));\n  \t\t});\n  \t\tvar model = this.base.joinAll(keys);\n\n  \t\tif (this.model) {\n  \t\t\tthis.model.unregister(this);\n  \t\t\tthis.model.unregisterTwowayBinding(this);\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register(this);\n  \t\tmodel.registerTwowayBinding(this);\n\n  \t\tif (this.keypathModel) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution() {\n  \t\tthis.resolvers.forEach(function (resolver) {\n  \t\t\treturn resolver.forceResolution();\n  \t\t});\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n\n  \tReferenceExpressionProxy.prototype.getValue = function getValue() {\n  \t\tvar i = this.bindings.length;\n  \t\twhile (i--) {\n  \t\t\tvar value = this.bindings[i].getValue();\n  \t\t\tif (value !== this.value) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath() {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange() {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve() {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set(value) {\n  \t\tif (!this.model) throw new Error('Unresolved reference expression. This should not happen!');\n  \t\tthis.model.set(value);\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind() {\n  \t\tthis.resolvers.forEach(_unbind);\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  })(Model);\n\n  function resolve$1(fragment, template) {\n  \tif (template.r) {\n  \t\treturn resolveReference(fragment, template.r);\n  \t} else if (template.x) {\n  \t\treturn new ExpressionProxy(fragment, template.x);\n  \t} else {\n  \t\treturn new ReferenceExpressionProxy(fragment, template.rx);\n  \t}\n  }\n\n  function resolveAliases(section) {\n  \tif (section.template.z) {\n  \t\tsection.aliases = {};\n\n  \t\tvar refs = section.template.z;\n  \t\tfor (var i = 0; i < refs.length; i++) {\n  \t\t\tsection.aliases[refs[i].n] = resolve$1(section.parentFragment, refs[i].x);\n  \t\t}\n  \t}\n  }\n\n  var Alias = (function (_Item) {\n  \tinherits(Alias, _Item);\n\n  \tfunction Alias(options) {\n  \t\tclassCallCheck(this, Alias);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype.bind = function bind() {\n  \t\tresolveAliases(this);\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t}).bind();\n  \t};\n\n  \tAlias.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tAlias.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tAlias.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tAlias.prototype.rebind = function rebind() {\n  \t\tresolveAliases(this);\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAlias.prototype.render = function render(target) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target);\n  \t};\n\n  \tAlias.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tAlias.prototype.unbind = function unbind() {\n  \t\tthis.aliases = {};\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n\n  \t\tthis.fragment.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Alias;\n  })(Item);\n\n  var Doctype = (function (_Item) {\n  \tinherits(Doctype, _Item);\n\n  \tfunction Doctype() {\n  \t\tclassCallCheck(this, Doctype);\n\n  \t\t_Item.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString() {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender() {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  })(Item);\n\n  var Mustache = (function (_Item) {\n  \tinherits(Mustache, _Item);\n\n  \tfunction Mustache(options) {\n  \t\tclassCallCheck(this, Mustache);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\t// try to find a model for this view\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif (this.isStatic) {\n  \t\t\tthis.model = { get: function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t} };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve(this.template.r, function (model) {\n  \t\t\t\t_this.model = model;\n  \t\t\t\tmodel.register(_this);\n\n  \t\t\t\t_this.handleChange();\n  \t\t\t\t_this.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange() {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind() {\n  \t\tif (this.isStatic || !this.model) return;\n\n  \t\tvar model = resolve$1(this.parentFragment, this.template);\n\n  \t\tif (model === this.model) return;\n\n  \t\tthis.model.unregister(this);\n\n  \t\tthis.model = model;\n\n  \t\tif (model) {\n  \t\t\tmodel.register(this);\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind() {\n  \t\tif (!this.isStatic) {\n  \t\t\tthis.model && this.model.unregister(this);\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  })(Item);\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830 };\n  var controlCharacters = [8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376];\n  var entityPattern = new RegExp('&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys(htmlEntities).join('|') + '));?', 'g');\n  var codePointSupport = typeof String.fromCodePoint === 'function';\n  var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;\n\n  function decodeCharacterReferences(html) {\n  \treturn html.replace(entityPattern, function (match, entity) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif (entity[0] !== '#') {\n  \t\t\tcode = htmlEntities[entity];\n  \t\t} else if (entity[1] === 'x') {\n  \t\t\tcode = parseInt(entity.substring(2), 16);\n  \t\t} else {\n  \t\t\tcode = parseInt(entity.substring(1), 10);\n  \t\t}\n\n  \t\tif (!code) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn codeToChar(validateCode(code));\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n  var invalid = 65533;\n\n  function escapeHtml(str) {\n  \treturn str.replace(amp, '&amp;').replace(lessThan, '&lt;').replace(greaterThan, '&gt;');\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode(code) {\n  \tif (!code) {\n  \t\treturn invalid;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif (code === 10) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif (code < 128) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing € signs and so on\n  \tif (code <= 159) {\n  \t\treturn controlCharacters[code - 128];\n  \t}\n\n  \t// basic multilingual plane\n  \tif (code < 55296) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif (code <= 57343) {\n  \t\treturn invalid;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif (code <= 65535) {\n  \t\treturn code;\n  \t} else if (!codePointSupport) {\n  \t\treturn invalid;\n  \t}\n\n  \t// supplementary multilingual plane 0x10000 - 0x1ffff\n  \tif (code >= 65536 && code <= 131071) {\n  \t\treturn code;\n  \t}\n\n  \t// supplementary ideographic plane 0x20000 - 0x2ffff\n  \tif (code >= 131072 && code <= 196607) {\n  \t\treturn code;\n  \t}\n\n  \treturn invalid;\n  }\n\n  var Interpolator = (function (_Mustache) {\n  \tinherits(Interpolator, _Mustache);\n\n  \tfunction Interpolator() {\n  \t\tclassCallCheck(this, Interpolator);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString() {\n  \t\treturn this.model ? safeToStringValue(this.model.get()) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render(target, occupants) {\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== value) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(value);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(value);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString(escape) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml(string) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf() {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  })(Mustache);\n\n  function findInViewHierarchy(registryName, ractive, name) {\n  \tvar instance = findInstance(registryName, ractive, name);\n  \treturn instance ? instance[registryName][name] : null;\n  }\n\n  function findInstance(registryName, ractive, name) {\n  \twhile (ractive) {\n  \t\tif (name in ractive[registryName]) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif (ractive.isolated) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function getPartialTemplate(ractive, name, parentFragment) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry(ractive, name, parentFragment || {});\n  \tif (partial) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId(name, { noThrow: true });\n  \tif (partial) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parseFor(partial, ractive);\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[name] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry(ractive, name, parentFragment) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial(name, parentFragment.owner);\n  \tif (partial) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance('partials', ractive, name);\n\n  \tif (!instance) {\n  \t\treturn;\n  \t}\n\n  \tpartial = instance.partials[name];\n\n  \t// partial is a function?\n  \tvar fn = undefined;\n  \tif (typeof partial === 'function') {\n  \t\tfn = partial.bind(instance);\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call(ractive, parser);\n  \t}\n\n  \tif (!partial && partial !== '') {\n  \t\twarnIfDebug(noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif (!parser.isParsed(partial)) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parseFor(partial, instance);\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif (parsed.p) {\n  \t\t\twarnIfDebug('Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner(instance, name);\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[name] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif (fn) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner(ractive, key) {\n  \treturn ractive.partials.hasOwnProperty(key) ? ractive : findConstructor(ractive.constructor, key);\n  }\n\n  function findConstructor(constructor, key) {\n  \tif (!constructor) {\n  \t\treturn;\n  \t}\n  \treturn constructor.partials.hasOwnProperty(key) ? constructor : findConstructor(constructor._Parent, key);\n  }\n\n  function findParentPartial(name, parent) {\n  \tif (parent) {\n  \t\tif (parent.template && parent.template.p && parent.template.p[name]) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if (parent.parentFragment && parent.parentFragment.owner) {\n  \t\t\treturn findParentPartial(name, parent.parentFragment.owner);\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (_Mustache) {\n  \tinherits(Partial, _Mustache);\n\n  \tfunction Partial() {\n  \t\tclassCallCheck(this, Partial);\n\n  \t\t_Mustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate(this.ractive, this.refName, this.parentFragment) || null : null;\n\n  \t\tif (template) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate(this.template.r, template);\n  \t\t} else if ((!this.model || typeof this.model.get() !== 'string') && this.refName) {\n  \t\t\tthis.setTemplate(this.refName, template);\n  \t\t} else {\n  \t\t\tthis.setTemplate(this.model.get());\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tPartial.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.fragment.findAll(selector, query);\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tthis.fragment.findAllComponents(name, query);\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate() {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif (this.refName) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.refName, this.parentFragment);\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif (!this.partialTemplate) {\n  \t\t\tthis.partialTemplate = getPartialTemplate(this.ractive, this.name, this.parentFragment);\n  \t\t}\n\n  \t\tif (!this.partialTemplate) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + this.name + '\\'');\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\t_Mustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render(target, occupants) {\n  \t\tthis.fragment.render(target, occupants);\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate(name, template) {\n  \t\tthis.name = name;\n\n  \t\tif (!template && template !== null) template = getPartialTemplate(this.ractive, name, this.parentFragment);\n\n  \t\tif (!template) {\n  \t\t\twarnOnceIfDebug('Could not find template for partial \\'' + name + '\\'');\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tPartial.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tPartial.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (!this.named) {\n  \t\t\t\tif (this.model && typeof this.model.get() === 'string' && this.model.get() !== this.name) {\n  \t\t\t\t\tthis.setTemplate(this.model.get());\n  \t\t\t\t\tthis.fragment.resetTemplate(this.partialTemplate);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  })(Mustache);\n\n  function getRefs(ref, value, parent) {\n  \tvar refs = undefined;\n\n  \tif (ref) {\n  \t\trefs = {};\n  \t\tObject.keys(parent).forEach(function (ref) {\n  \t\t\trefs[ref] = parent[ref];\n  \t\t});\n  \t\trefs[ref] = value;\n  \t} else {\n  \t\trefs = parent;\n  \t}\n\n  \treturn refs;\n  }\n\n  var RepeatedFragment = (function () {\n  \tfunction RepeatedFragment(options) {\n  \t\tclassCallCheck(this, RepeatedFragment);\n\n  \t\tthis.parent = options.owner.parentFragment;\n\n  \t\t// bit of a hack, so reference resolution works without another\n  \t\t// layer of indirection\n  \t\tthis.parentFragment = this;\n  \t\tthis.owner = options.owner;\n  \t\tthis.ractive = this.parent.ractive;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.iterations = [];\n\n  \t\tthis.template = options.template;\n\n  \t\tthis.indexRef = options.indexRef;\n  \t\tthis.keyRef = options.keyRef;\n  \t\tthis.indexByKey = null; // for `{{#each object}}...`\n\n  \t\tthis.pendingNewIndices = null;\n  \t\tthis.previousIterations = null;\n\n  \t\t// track array versus object so updates of type rest\n  \t\tthis.isArray = false;\n  \t}\n\n  \tRepeatedFragment.prototype.bind = function bind(context) {\n  \t\tvar _this = this;\n\n  \t\tthis.context = context;\n  \t\tvar value = context.get();\n\n  \t\t// {{#each array}}...\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\t// we can't use map, because of sparse arrays\n  \t\t\tthis.iterations = [];\n  \t\t\tfor (var i = 0; i < value.length; i += 1) {\n  \t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t}\n  \t\t}\n\n  \t\t// {{#each object}}...\n  \t\telse if (isObject(value)) {\n  \t\t\t\tthis.isArray = false;\n\n  \t\t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\t\tif (this.indexRef) {\n  \t\t\t\t\tvar refs = this.indexRef.split(',');\n  \t\t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\t\tthis.indexRef = refs[1];\n  \t\t\t\t}\n\n  \t\t\t\tthis.indexByKey = {};\n  \t\t\t\tthis.iterations = Object.keys(value).map(function (key, index) {\n  \t\t\t\t\t_this.indexByKey[key] = index;\n  \t\t\t\t\treturn _this.createIteration(key, index);\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.bubble = function bubble() {\n  \t\tthis.owner.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.createIteration = function createIteration(key, index) {\n  \t\tvar parentFragment = this.owner.parentFragment;\n  \t\tvar keyRefs = getRefs(this.keyRef, key, parentFragment.keyRefs);\n  \t\tvar indexRefs = getRefs(this.indexRef, index, parentFragment.indexRefs);\n\n  \t\tvar fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template,\n  \t\t\tindexRefs: indexRefs,\n  \t\t\tkeyRefs: keyRefs\n  \t\t});\n\n  \t\t// TODO this is a bit hacky\n  \t\tfragment.key = key;\n  \t\tfragment.index = index;\n  \t\tfragment.isIteration = true;\n\n  \t\tvar model = this.context.joinKey(key);\n\n  \t\t// set up an iteration alias if there is one\n  \t\tif (this.owner.template.z) {\n  \t\t\tfragment.aliases = {};\n  \t\t\tfragment.aliases[this.owner.template.z[0].n] = model;\n  \t\t}\n\n  \t\treturn fragment.bind(model);\n  \t};\n\n  \tRepeatedFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.iterations.forEach(function (fragment) {\n  \t\t\treturn docFrag.appendChild(fragment.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tRepeatedFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.iterations[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tvar len = this.iterations.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.iterations[i].findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.findNextNode = function findNextNode(iteration) {\n  \t\tif (iteration.index < this.iterations.length - 1) {\n  \t\t\tfor (var i = iteration.index + 1; i < this.iterations.length; i++) {\n  \t\t\t\tvar node = this.iterations[i].firstNode();\n  \t\t\t\tif (node) return node;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this.owner.findNextNode();\n  \t};\n\n  \tRepeatedFragment.prototype.firstNode = function firstNode() {\n  \t\treturn this.iterations[0] ? this.iterations[0].firstNode() : null;\n  \t};\n\n  \tRepeatedFragment.prototype.rebind = function rebind(context) {\n  \t\tvar _this2 = this;\n\n  \t\tthis.context = context;\n\n  \t\t// {{#each array}}...\n  \t\tif (isArray(context.get())) {\n  \t\t\tthis.iterations.forEach(function (fragment, i) {\n  \t\t\t\tvar model = context.joinKey(i);\n  \t\t\t\tif (_this2.owner.template.z) {\n  \t\t\t\t\tfragment.aliases = {};\n  \t\t\t\t\tfragment.aliases[_this2.owner.template.z[0].n] = model;\n  \t\t\t\t}\n  \t\t\t\tfragment.rebind(model);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.render = function render(target, occupants) {\n  \t\t// TODO use docFrag.cloneNode...\n\n  \t\tif (this.iterations) {\n  \t\t\tthis.iterations.forEach(function (fragment) {\n  \t\t\t\treturn fragment.render(target, occupants);\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tRepeatedFragment.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this3 = this;\n\n  \t\tif (!this.pendingNewIndices) this.previousIterations = this.iterations.slice();\n\n  \t\tif (!this.pendingNewIndices) this.pendingNewIndices = [];\n\n  \t\tthis.pendingNewIndices.push(newIndices);\n\n  \t\tvar iterations = [];\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tif (newIndex === -1) return;\n\n  \t\t\tvar fragment = _this3.iterations[oldIndex];\n  \t\t\titerations[newIndex] = fragment;\n\n  \t\t\tif (newIndex !== oldIndex && fragment) fragment.dirty = true;\n  \t\t});\n\n  \t\tthis.iterations = iterations;\n\n  \t\tthis.bubble();\n  \t};\n\n  \tRepeatedFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.iterations ? this.iterations.map(escape ? toEscapedString : _toString).join('') : '';\n  \t};\n\n  \tRepeatedFragment.prototype.unbind = function unbind() {\n  \t\tthis.iterations.forEach(_unbind);\n  \t\treturn this;\n  \t};\n\n  \tRepeatedFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.iterations.forEach(shouldDestroy ? unrenderAndDestroy$1 : _unrender);\n  \t\tif (this.pendingNewIndices && this.previousIterations) {\n  \t\t\tthis.previousIterations.forEach(function (fragment) {\n  \t\t\t\tif (fragment.rendered) shouldDestroy ? unrenderAndDestroy$1(fragment) : _unrender(fragment);\n  \t\t\t});\n  \t\t}\n  \t\tthis.rendered = false;\n  \t};\n\n  \t// TODO smart update\n\n  \tRepeatedFragment.prototype.update = function update() {\n  \t\tvar _this4 = this;\n\n  \t\t// skip dirty check, since this is basically just a facade\n\n  \t\tif (this.pendingNewIndices) {\n  \t\t\tthis.updatePostShuffle();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = this.context.get(),\n  \t\t    wasArray = this.isArray;\n\n  \t\tvar toRemove = undefined;\n  \t\tvar oldKeys = undefined;\n  \t\tvar reset = true;\n  \t\tvar i = undefined;\n\n  \t\tif (this.isArray = isArray(value)) {\n  \t\t\tif (wasArray) {\n  \t\t\t\treset = false;\n  \t\t\t\tif (this.iterations.length > value.length) {\n  \t\t\t\t\ttoRemove = this.iterations.splice(value.length);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t} else if (isObject(value) && !wasArray) {\n  \t\t\treset = false;\n  \t\t\ttoRemove = [];\n  \t\t\toldKeys = {};\n  \t\t\ti = this.iterations.length;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _fragment = this.iterations[i];\n  \t\t\t\tif (_fragment.key in value) {\n  \t\t\t\t\toldKeys[_fragment.key] = true;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations.splice(i, 1);\n  \t\t\t\t\ttoRemove.push(_fragment);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (reset) {\n  \t\t\ttoRemove = this.iterations;\n  \t\t\tthis.iterations = [];\n  \t\t}\n\n  \t\tif (toRemove) {\n  \t\t\ttoRemove.forEach(function (fragment) {\n  \t\t\t\tfragment.unbind();\n  \t\t\t\tfragment.unrender(true);\n  \t\t\t});\n  \t\t}\n\n  \t\t// update the remaining ones\n  \t\tthis.iterations.forEach(_update);\n\n  \t\t// add new iterations\n  \t\tvar newLength = isArray(value) ? value.length : isObject(value) ? Object.keys(value).length : 0;\n\n  \t\tvar docFrag = undefined;\n  \t\tvar fragment = undefined;\n\n  \t\tif (newLength > this.iterations.length) {\n  \t\t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\t\ti = this.iterations.length;\n\n  \t\t\tif (isArray(value)) {\n  \t\t\t\twhile (i < value.length) {\n  \t\t\t\t\tfragment = this.createIteration(i, i);\n\n  \t\t\t\t\tthis.iterations.push(fragment);\n  \t\t\t\t\tif (this.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t} else if (isObject(value)) {\n  \t\t\t\tObject.keys(value).forEach(function (key) {\n  \t\t\t\t\tif (!oldKeys || !(key in oldKeys)) {\n  \t\t\t\t\t\tfragment = _this4.createIteration(key, i);\n\n  \t\t\t\t\t\t_this4.iterations.push(fragment);\n  \t\t\t\t\t\tif (_this4.rendered) fragment.render(docFrag);\n\n  \t\t\t\t\t\ti += 1;\n  \t\t\t\t\t}\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\t\tvar anchor = this.parent.findNextNode(this.owner);\n\n  \t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tRepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle() {\n  \t\tvar _this5 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[0];\n\n  \t\t// map first shuffle through\n  \t\tthis.pendingNewIndices.slice(1).forEach(function (indices) {\n  \t\t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\t\tnewIndices[oldIndex] = indices[newIndex];\n  \t\t\t});\n  \t\t});\n\n  \t\t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t\t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t\t// but it seems to work for now\n  \t\tvar previousNewIndex = -1;\n  \t\tvar reinsertFrom = null;\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\tvar fragment = _this5.previousIterations[oldIndex];\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tfragment.unbind().unrender(true);\n  \t\t\t} else {\n  \t\t\t\tfragment.index = newIndex;\n  \t\t\t\tvar model = _this5.context.joinKey(newIndex);\n  \t\t\t\tif (_this5.owner.template.z) {\n  \t\t\t\t\tfragment.aliases = {};\n  \t\t\t\t\tfragment.aliases[_this5.owner.template.z[0].n] = model;\n  \t\t\t\t}\n  \t\t\t\tfragment.rebind(model);\n\n  \t\t\t\tif (reinsertFrom === null && newIndex !== previousNewIndex + 1) {\n  \t\t\t\t\treinsertFrom = oldIndex;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tpreviousNewIndex = newIndex;\n  \t\t});\n\n  \t\t// create new iterations\n  \t\tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \t\tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \t\tvar len = this.context.get().length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar existingFragment = this.iterations[i];\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tif (existingFragment) {\n  \t\t\t\t\tif (reinsertFrom !== null && i >= reinsertFrom) {\n  \t\t\t\t\t\tdocFrag.appendChild(existingFragment.detach());\n  \t\t\t\t\t} else if (docFrag.childNodes.length) {\n  \t\t\t\t\t\tparentNode.insertBefore(docFrag, existingFragment.firstNode());\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t\tthis.iterations[i].render(docFrag);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif (!this.rendered) {\n  \t\t\t\tif (!existingFragment) {\n  \t\t\t\t\tthis.iterations[i] = this.createIteration(i, i);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (this.rendered && docFrag.childNodes.length) {\n  \t\t\tparentNode.insertBefore(docFrag, this.owner.findNextNode());\n  \t\t}\n\n  \t\tthis.iterations.forEach(_update);\n\n  \t\tthis.pendingNewIndices = null;\n  \t};\n\n  \treturn RepeatedFragment;\n  })();\n\n  function isEmpty(value) {\n  \treturn !value || isArray(value) && value.length === 0 || isObject(value) && Object.keys(value).length === 0;\n  }\n\n  function getType(value, hasIndexRef) {\n  \tif (hasIndexRef || isArray(value)) return SECTION_EACH;\n  \tif (isObject(value) || typeof value === 'function') return SECTION_WITH;\n  \tif (value === undefined) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (_Mustache) {\n  \tinherits(Section, _Mustache);\n\n  \tfunction Section(options) {\n  \t\tclassCallCheck(this, Section);\n\n  \t\t_Mustache.call(this, options);\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype.bind = function bind() {\n  \t\t_Mustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif (this.model) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach() {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find(selector) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment && this.fragment.firstNode();\n  \t};\n\n  \tSection.prototype.rebind = function rebind() {\n  \t\t_Mustache.prototype.rebind.call(this);\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.rebind(this.sectionType === SECTION_IF ? null : this.model);\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n  \t\tif (this.fragment) this.fragment.render(target, occupants);\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (this.fragment && this.sectionType === SECTION_EACH) {\n  \t\t\tthis.fragment.shuffle(newIndices);\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment ? this.fragment.toString(escape) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind() {\n  \t\t_Mustache.prototype.unbind.call(this);\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && this.fragment) this.fragment.unrender(shouldDestroy);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n  \t\tif (!this.model && this.sectionType !== SECTION_UNLESS) return;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif (this.sectionType === null || this.templateSectionType === null) this.sectionType = getType(value, this.template.i);\n  \t\tif (lastType && lastType !== this.sectionType && this.fragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment = undefined;\n\n  \t\tif (this.sectionType === SECTION_EACH) {\n  \t\t\tif (this.fragment) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind(this.model);\n  \t\t\t}\n  \t\t}\n\n  \t\t// TODO same comment as before - WITH should be IF_WITH\n  \t\telse if (this.sectionType === SECTION_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else if (this.sectionType === SECTION_IF_WITH) {\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (isEmpty(value)) {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t}\n  \t\t\t\t} else if (!isEmpty(value)) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(this.model);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty(value) : !!value && !isEmpty(value);\n\n  \t\t\t\tif (this.fragment) {\n  \t\t\t\t\tif (fragmentShouldExist) {\n  \t\t\t\t\t\tthis.fragment.update();\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tif (this.rendered) {\n  \t\t\t\t\t\t\tthis.fragment.unbind().unrender(true);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tthis.fragment = null;\n  \t\t\t\t\t}\n  \t\t\t\t} else if (fragmentShouldExist) {\n  \t\t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\t\towner: this,\n  \t\t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t\t}).bind(null);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\tif (newFragment) {\n  \t\t\tif (this.rendered) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render(docFrag);\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Section;\n  })(Mustache);\n\n  var elementCache = {};\n\n  var ieBug = undefined;\n  var ieBlacklist = undefined;\n\n  try {\n  \tcreateElement('table').innerHTML = 'foo';\n  } catch (err) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE: ['<table class=\"x\">', '</table>'],\n  \t\tTHEAD: ['<table><thead class=\"x\">', '</thead></table>'],\n  \t\tTBODY: ['<table><tbody class=\"x\">', '</tbody></table>'],\n  \t\tTR: ['<table><tr class=\"x\">', '</tr></table>'],\n  \t\tSELECT: ['<select class=\"x\">', '</select>']\n  \t};\n  }\n\n  function insertHtml (html, node, docFrag) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif (html == null || html === '') return nodes;\n\n  \tvar container = undefined;\n  \tvar wrapper = undefined;\n  \tvar selectedOption = undefined;\n\n  \tif (ieBug && (wrapper = ieBlacklist[node.tagName])) {\n  \t\tcontainer = element('DIV');\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector('.x');\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t} else if (node.namespaceURI === svg$1) {\n  \t\tcontainer = element('DIV');\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector('.x');\n  \t} else {\n  \t\tcontainer = element(node.tagName);\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif (container.tagName === 'SELECT') {\n  \t\t\tselectedOption = container.options[container.selectedIndex];\n  \t\t}\n  \t}\n\n  \tvar child = undefined;\n  \twhile (child = container.firstChild) {\n  \t\tnodes.push(child);\n  \t\tdocFrag.appendChild(child);\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i = undefined;\n  \tif (node.tagName === 'SELECT') {\n  \t\ti = nodes.length;\n  \t\twhile (i--) {\n  \t\t\tif (nodes[i] !== selectedOption) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element(tagName) {\n  \treturn elementCache[tagName] || (elementCache[tagName] = createElement(tagName));\n  }\n\n  var Triple = (function (_Mustache) {\n  \tinherits(Triple, _Mustache);\n\n  \tfunction Triple(options) {\n  \t\tclassCallCheck(this, Triple);\n\n  \t\t_Mustache.call(this, options);\n  \t}\n\n  \tTriple.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach(function (node) {\n  \t\t\treturn docFrag.appendChild(node);\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find(selector) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (matches(node, selector)) return node;\n\n  \t\t\tvar queryResult = node.querySelector(selector);\n  \t\t\tif (queryResult) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll(selector, query) {\n  \t\tvar len = this.nodes.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar node = this.nodes[i];\n\n  \t\t\tif (node.nodeType !== 1) continue;\n\n  \t\t\tif (query.test(node)) query.add(node);\n\n  \t\t\tvar queryAllResult = node.querySelectorAll(selector);\n  \t\t\tif (queryAllResult) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j = undefined;\n\n  \t\t\t\tfor (j = 0; j < numNodes; j += 1) {\n  \t\t\t\t\tquery.add(queryAllResult[j]);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent() {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode() {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render(target) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml(html, this.parentFragment.findParentNode(), target);\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString() {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences('' + this.model.get()) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender() {\n  \t\tif (this.nodes) this.nodes.forEach(function (node) {\n  \t\t\treturn detachNode(node);\n  \t\t});\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update() {\n  \t\tif (this.rendered && this.dirty) {\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render(docFrag);\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode(this);\n\n  \t\t\tparentNode.insertBefore(docFrag, anchor);\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  })(Mustache);\n\n  var Yielder = (function (_Item) {\n  \tinherits(Yielder, _Item);\n\n  \tfunction Yielder(options) {\n  \t\tclassCallCheck(this, Yielder);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype.bind = function bind() {\n  \t\tvar name = this.name;\n\n  \t\t(this.component.yielders[name] || (this.component.yielders[name] = [])).push(this);\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[name || 'content'];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tif (!template) {\n  \t\t\twarnIfDebug('Could not find template for partial \"' + name + '\"', { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.containerFragment.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tYielder.prototype.detach = function detach() {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find(selector) {\n  \t\treturn this.fragment.find(selector);\n  \t};\n\n  \tYielder.prototype.findAll = function findAll(selector, queryResult) {\n  \t\tthis.fragment.find(selector, queryResult);\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent(name) {\n  \t\treturn this.fragment.findComponent(name);\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents(name, queryResult) {\n  \t\tthis.fragment.findAllComponents(name, queryResult);\n  \t};\n\n  \tYielder.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.containerFragment.findNextNode(this);\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode() {\n  \t\treturn this.fragment.firstNode();\n  \t};\n\n  \tYielder.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tYielder.prototype.render = function render(target, occupants) {\n  \t\treturn this.fragment.render(target, occupants);\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate(name) {\n  \t\tvar template = this.parentFragment.ractive.partials[name];\n\n  \t\tif (typeof template === 'string') {\n  \t\t\ttemplate = parse(template).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString(escape) {\n  \t\treturn this.fragment.toString(escape);\n  \t};\n\n  \tYielder.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray(this.component.yielders[this.name], this);\n  \t};\n\n  \tYielder.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.fragment.unrender(shouldDestroy);\n  \t};\n\n  \tYielder.prototype.update = function update() {\n  \t\tthis.fragment.update();\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Yielder;\n  })(Item);\n\n  var textTypes = [undefined, 'text', 'search', 'url', 'email', 'hidden', 'password', 'search', 'reset', 'submit'];\n  function getUpdateDelegate(attribute) {\n  \tvar element = attribute.element;\n  \tvar name = attribute.name;\n\n  \tif (name === 'id') return updateId;\n\n  \tif (name === 'value') {\n  \t\t// special case - selects\n  \t\tif (element.name === 'select' && name === 'value') {\n  \t\t\treturn element.getAttribute('multiple') ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif (element.name === 'textarea') return updateStringValue;\n\n  \t\t// special case - contenteditable\n  \t\tif (element.getAttribute('contenteditable') != null) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif (element.name === 'input') {\n  \t\t\tvar type = element.getAttribute('type');\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif (type === 'file') return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif (type === 'radio' && element.binding && element.binding.attribute.name === 'name') return updateRadioValue;\n\n  \t\t\tif (~textTypes.indexOf(type)) return updateStringValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif (attribute.isTwoway && name === 'name') {\n  \t\tif (node.type === 'radio') return updateRadioName;\n  \t\tif (node.type === 'checkbox') return updateCheckboxName;\n  \t}\n\n  \t// special case - style attributes in Internet Exploder\n  \tif (name === 'style' && node.style.setAttribute) return updateIEStyleAttribute;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif (name === 'class' && (!node.namespaceURI || node.namespaceURI === html)) return updateClassName;\n\n  \tif (attribute.isBoolean) return updateBoolean;\n\n  \tif (attribute.namespace && attribute.namespace !== attribute.node.namespaceURI) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId() {\n  \tvar node = this.node;\n\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[node.id];\n  \tthis.ractive.nodes[value] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!isArray(value)) value = [value];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile (i--) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains(value, optionValue);\n  \t}\n  }\n\n  function updateSelectValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\t// TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif (optionValue == value) {\n  \t\t\t\t// double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// if we're still here, it means the new value didn't match any of the options...\n  \t// TODO figure out what to do in this situation\n  }\n\n  function updateContentEditableValue() {\n  \tvar value = this.getValue();\n\n  \tif (!this.locked) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue() {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute('name');\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif (wasChecked && !node.checked && this.element.binding && this.element.binding.rendered) {\n  \t\tthis.element.binding.group.model.set(this.element.binding.group.getValue());\n  \t}\n  }\n\n  function updateValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute('value', value);\n  \t}\n  }\n\n  function updateStringValue() {\n  \tif (!this.locked) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node._ractive.value = value;\n\n  \t\tthis.node.value = safeToStringValue(value);\n  \t\tthis.node.setAttribute('value', safeToStringValue(value));\n  \t}\n  }\n\n  function updateRadioName() {\n  \tthis.node.checked = this.getValue() == this.node._ractive.value;\n  }\n\n  function updateCheckboxName() {\n  \tvar element = this.element;\n  \tvar node = this.node;\n\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute('value');\n\n  \tif (!isArray(value)) {\n  \t\tbinding.isChecked = node.checked = value == valueAttribute;\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile (i--) {\n  \t\t\tif (valueAttribute == value[i]) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateIEStyleAttribute() {\n  \tthis.node.style.setAttribute('cssText', this.getValue() || '');\n  }\n\n  function updateClassName() {\n  \tthis.node.className = safeToStringValue(this.getValue());\n  }\n\n  function updateBoolean() {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif (!this.locked) {\n  \t\tif (this.useProperty) {\n  \t\t\tthis.node[this.propertyName] = this.getValue();\n  \t\t} else {\n  \t\t\tif (this.getValue()) {\n  \t\t\t\tthis.node.setAttribute(this.propertyName, '');\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute(this.propertyName);\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute() {\n  \tthis.node.setAttribute(this.name, safeToStringValue(this.getString()));\n  }\n\n  function updateNamespacedAttribute() {\n  \tthis.node.setAttributeNS(this.namespace, this.name.slice(this.name.indexOf(':') + 1), safeToStringValue(this.getString()));\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  function lookupNamespace(node, prefix) {\n  \tvar qualified = 'xmlns:' + prefix;\n\n  \twhile (node) {\n  \t\tif (node.hasAttribute(qualified)) return node.getAttribute(qualified);\n  \t\tnode = node.parentNode;\n  \t}\n\n  \treturn namespaces[prefix];\n  }\n\n  var Attribute = (function (_Item) {\n  \tinherits(Attribute, _Item);\n\n  \tfunction Attribute(options) {\n  \t\tclassCallCheck(this, Attribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.name = options.name;\n  \t\tthis.namespace = null;\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif (!isArray(options.template)) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif (this.value === 0) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment && this.fragment.items.length === 1 && this.fragment.items[0].type === INTERPOLATOR && this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype.bind = function bind() {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString() {\n  \t\treturn this.fragment ? this.fragment.toString() : this.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n\n  \tAttribute.prototype.getValue = function getValue() {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test(this.name) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tAttribute.prototype.render = function render() {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif (!node.namespaceURI || node.namespaceURI === namespaces.html) {\n  \t\t\tthis.propertyName = propertyNames[this.name] || this.name;\n\n  \t\t\tif (node[this.propertyName] !== undefined) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif (booleanAttributes.test(this.name) || this.isTwoway) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif (this.propertyName === 'value') {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (node.namespaceURI) {\n  \t\t\tvar index = this.name.indexOf(':');\n  \t\t\tif (index !== -1) {\n  \t\t\t\tthis.namespace = lookupNamespace(node, this.name.slice(0, index));\n  \t\t\t} else {\n  \t\t\t\tthis.namespace = node.namespaceURI;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate(this);\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString() {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif (this.name === 'value' && (this.element.getAttribute('contenteditable') !== undefined || this.element.name === 'select' || this.element.name === 'textarea')) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case – bound radio `name` attributes\n  \t\tif (this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute('type') === 'radio') {\n  \t\t\treturn 'name=\"{{' + this.interpolator.model.getKeypath() + '}}\"';\n  \t\t}\n\n  \t\tif (booleanAttributes.test(this.name)) return value ? this.name : '';\n  \t\tif (value == null) return '';\n\n  \t\tvar str = safeToStringValue(this.getString()).replace(/&/g, '&amp;').replace(/\"/g, '&quot;').replace(/'/g, '&#39;');\n\n  \t\treturn str ? this.name + '=\"' + str + '\"' : this.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind() {\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tif (this.fragment) this.fragment.update();\n  \t\t\tif (this.rendered) this.updateDelegate();\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  })(Item);\n\n  var div$1 = doc ? createElement('div') : null;\n\n  var ConditionalAttribute = (function (_Item) {\n  \tinherits(ConditionalAttribute, _Item);\n\n  \tfunction ConditionalAttribute(options) {\n  \t\tclassCallCheck(this, ConditionalAttribute);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [this.template]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype.bind = function bind() {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind() {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render() {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString() {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind() {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender() {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update() {\n  \t\tvar _this = this;\n\n  \t\tvar str = undefined;\n  \t\tvar attrs = undefined;\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes(str, this.isSvg);\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter(function (a) {\n  \t\t\t\t\treturn notIn(attrs, a);\n  \t\t\t\t}).forEach(function (a) {\n  \t\t\t\t\t_this.node.removeAttribute(a.name);\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach(function (a) {\n  \t\t\t\t\t_this.node.setAttribute(a.name, a.value);\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  })(Item);\n\n  function parseAttributes(str, isSvg) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \tdiv$1.innerHTML = '<' + tagName + ' ' + str + '></' + tagName + '>';\n\n  \treturn toArray(div$1.childNodes[0].attributes);\n  }\n\n  function notIn(haystack, needle) {\n  \tvar i = haystack.length;\n\n  \twhile (i--) {\n  \t\tif (haystack[i].name === needle.name) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = (function () {\n  \tfunction Decorator(owner, template) {\n  \t\tclassCallCheck(this, Decorator);\n\n  \t\tthis.owner = owner;\n  \t\tthis.template = template;\n\n  \t\tthis.parentFragment = owner.parentFragment;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tthis.dynamicName = typeof template.n === 'object';\n  \t\tthis.dynamicArgs = !!template.d;\n\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.name = template.n || template;\n  \t\t}\n\n  \t\tif (this.dynamicArgs) {\n  \t\t\tthis.argsFragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t});\n  \t\t} else {\n  \t\t\tthis.args = template.a || [];\n  \t\t}\n\n  \t\tthis.node = null;\n  \t\tthis.intermediary = null;\n  \t}\n\n  \tDecorator.prototype.bind = function bind() {\n  \t\tif (this.dynamicName) {\n  \t\t\tthis.nameFragment.bind();\n  \t\t\tthis.name = this.nameFragment.toString();\n  \t\t}\n\n  \t\tif (this.dynamicArgs) this.argsFragment.bind();\n  \t};\n\n  \tDecorator.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.rebind = function rebind() {\n  \t\tif (this.dynamicName) this.nameFragment.rebind();\n  \t\tif (this.dynamicArgs) this.argsFragment.rebind();\n  \t};\n\n  \tDecorator.prototype.render = function render() {\n  \t\tvar fn = findInViewHierarchy('decorators', this.ractive, this.name);\n\n  \t\tif (!fn) {\n  \t\t\twarnOnce(missingPlugin(this.name, 'decorator'));\n  \t\t\tthis.intermediary = missingDecorator;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis.node = this.owner.node;\n\n  \t\tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \t\tthis.intermediary = fn.apply(this.ractive, [this.node].concat(args));\n\n  \t\tif (!this.intermediary || !this.intermediary.teardown) {\n  \t\t\tthrow new Error('The \\'' + this.name + '\\' decorator must return an object with a teardown method');\n  \t\t}\n  \t};\n\n  \tDecorator.prototype.unbind = function unbind() {\n  \t\tif (this.dynamicName) this.nameFragment.unbind();\n  \t\tif (this.dynamicArgs) this.argsFragment.unbind();\n  \t};\n\n  \tDecorator.prototype.unrender = function unrender() {\n  \t\tif (this.intermediary) this.intermediary.teardown();\n  \t};\n\n  \tDecorator.prototype.update = function update() {\n  \t\tif (!this.dirty) return;\n\n  \t\tvar nameChanged = false;\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tvar _name = this.nameFragment.toString();\n  \t\t\tnameChanged = _name !== this.name;\n  \t\t\tthis.name = _name;\n  \t\t}\n\n  \t\tif (this.intermediary) {\n  \t\t\tif (nameChanged || !this.intermediary.update) {\n  \t\t\t\tthis.unrender();\n  \t\t\t\tthis.render();\n  \t\t\t} else {\n  \t\t\t\tif (this.dynamicArgs) {\n  \t\t\t\t\tif (this.argsFragment.dirty) {\n  \t\t\t\t\t\tvar args = this.argsFragment.getArgsList();\n  \t\t\t\t\t\tthis.intermediary.update.apply(this.ractive, args);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.intermediary.update.apply(this.ractive, this.args);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// need to run these for unrender/render cases\n  \t\t// so can't just be in conditional if above\n\n  \t\tif (this.dynamicName && this.nameFragment.dirty) {\n  \t\t\tthis.nameFragment.update();\n  \t\t}\n\n  \t\tif (this.dynamicArgs && this.argsFragment.dirty) {\n  \t\t\tthis.argsFragment.update();\n  \t\t}\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Decorator;\n  })();\n\n  function enqueue(ractive, event) {\n  \tif (ractive.event) {\n  \t\tractive._eventQueue.push(ractive.event);\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue(ractive) {\n  \tif (ractive._eventQueue.length) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n\n  function getPotentialWildcardMatches(keypath) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypath(keypath);\n  \tif (!(starMap = starMaps[keys.length])) {\n  \t\tstarMap = getStarMap(keys.length);\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function (star, i) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile (i--) {\n  \t\twildcardKeypath = starMap[i].map(mapper).join('.');\n\n  \t\tif (!result.hasOwnProperty(wildcardKeypath)) {\n  \t\t\tresult.push(wildcardKeypath);\n  \t\t\tresult[wildcardKeypath] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap(num) {\n  \tvar ones = '',\n  \t    max,\n  \t    binary,\n  \t    starMap,\n  \t    mapper,\n  \t    i,\n  \t    j,\n  \t    l,\n  \t    map;\n\n  \tif (!starMaps[num]) {\n  \t\tstarMap = [];\n\n  \t\twhile (ones.length < num) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt(ones, 2);\n\n  \t\tmapper = function (digit) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor (i = 0; i <= max; i += 1) {\n  \t\t\tbinary = i.toString(2);\n  \t\t\twhile (binary.length < num) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push(mapper(binary[j]));\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[num] = starMap;\n  \t}\n\n  \treturn starMaps[num];\n  }\n\n  var wildcardCache = {};\n  function fireEvent(ractive, eventName) {\n  \tvar options = arguments.length <= 2 || arguments[2] === undefined ? {} : arguments[2];\n\n  \tif (!eventName) {\n  \t\treturn;\n  \t}\n\n  \tif (!options.event) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames(eventName);\n\n  \tfireEventAs(ractive, eventNames, options.event, options.args, true);\n  }\n\n  function getWildcardNames(eventName) {\n  \tif (wildcardCache.hasOwnProperty(eventName)) {\n  \t\treturn wildcardCache[eventName];\n  \t} else {\n  \t\treturn wildcardCache[eventName] = getPotentialWildcardMatches(eventName);\n  \t}\n  }\n\n  function fireEventAs(ractive, eventNames, event, args) {\n  \tvar initialFire = arguments.length <= 4 || arguments[4] === undefined ? false : arguments[4];\n\n  \tvar subscribers,\n  \t    i,\n  \t    bubble = true;\n\n  \tenqueue(ractive, event);\n\n  \tfor (i = eventNames.length; i >= 0; i--) {\n  \t\tsubscribers = ractive._subs[eventNames[i]];\n\n  \t\tif (subscribers) {\n  \t\t\tbubble = notifySubscribers(ractive, subscribers, event, args) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue(ractive);\n\n  \tif (ractive.parent && bubble) {\n\n  \t\tif (initialFire && ractive.component) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[eventNames.length - 1];\n  \t\t\teventNames = getWildcardNames(fullName);\n\n  \t\t\tif (event && !event.component) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs(ractive.parent, eventNames, event, args);\n  \t}\n  }\n\n  function notifySubscribers(ractive, subscribers, event, args) {\n  \tvar originalEvent = null,\n  \t    stopEvent = false;\n\n  \tif (event && !event._noArg) {\n  \t\targs = [event].concat(args);\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor (var i = 0, len = subscribers.length; i < len; i += 1) {\n  \t\tif (subscribers[i].apply(ractive, args) === false) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif (event && !event._noArg && stopEvent && (originalEvent = event.original)) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = (function () {\n  \tfunction EventDirective(owner, event, template) {\n  \t\tclassCallCheck(this, EventDirective);\n\n  \t\tthis.owner = owner;\n  \t\tthis.event = event;\n  \t\tthis.template = template;\n\n  \t\tthis.ractive = owner.parentFragment.ractive;\n  \t\tthis.parentFragment = owner.parentFragment;\n\n  \t\tthis.context = null;\n  \t\tthis.passthru = false;\n\n  \t\t// method calls\n  \t\tthis.method = null;\n  \t\tthis.resolvers = null;\n  \t\tthis.models = null;\n  \t\tthis.argsFn = null;\n\n  \t\t// handler directive\n  \t\tthis.action = null;\n  \t\tthis.args = null;\n  \t}\n\n  \tEventDirective.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tthis.method = template.m;\n\n  \t\t\t// pass-thru \"...arguments\"\n  \t\t\tthis.passthru = !!template.g;\n\n  \t\t\tif (template.a) {\n  \t\t\t\tthis.resolvers = [];\n  \t\t\t\tthis.models = template.a.r.map(function (ref, i) {\n\n  \t\t\t\t\tif (eventPattern.test(ref)) {\n  \t\t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\t\tkeys: ref.length > 5 ? splitKeypath(ref.slice(6)) : [],\n  \t\t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar argMatch = argumentsPattern.exec(ref);\n  \t\t\t\t\tif (argMatch) {\n  \t\t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar dollarMatch = dollarArgsPattern.exec(ref);\n  \t\t\t\t\tif (dollarMatch) {\n  \t\t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\t\treturn {\n  \t\t\t\t\t\t\targument: true,\n  \t\t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t\t};\n  \t\t\t\t\t}\n\n  \t\t\t\t\tvar resolver = undefined;\n\n  \t\t\t\t\tvar model = resolveReference(_this.parentFragment, ref);\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\tresolver = _this.parentFragment.resolve(ref, function (model) {\n  \t\t\t\t\t\t\t_this.models[i] = model;\n  \t\t\t\t\t\t\tremoveFromArray(_this.resolvers, resolver);\n  \t\t\t\t\t\t});\n\n  \t\t\t\t\t\t_this.resolvers.push(resolver);\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model;\n  \t\t\t\t});\n\n  \t\t\t\tthis.argsFn = getFunction(template.a.s, template.a.r.length);\n  \t\t\t}\n  \t\t} else {\n  \t\t\t// TODO deprecate this style of directive\n  \t\t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate : typeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\ttemplate.n : new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.n\n  \t\t\t});\n\n  \t\t\tthis.args = template.a ? // static arguments\n  \t\t\ttypeof template.a === 'string' ? [template.a] : template.a : template.d ? // dynamic arguments\n  \t\t\tnew Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}) : []; // no arguments\n  \t\t}\n\n  \t\tif (this.template.n && typeof this.template.n !== 'string') this.action.bind();\n  \t\tif (this.template.d) this.args.bind();\n  \t};\n\n  \tEventDirective.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.fire = function fire(event) {\n  \t\tvar passedArgs = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  \t\t// augment event object\n  \t\tif (event) {\n  \t\t\tevent.keypath = this.context.getKeypath(this.ractive);\n  \t\t\tevent.rootpath = this.context.getKeypath();\n  \t\t\tevent.context = this.context.get();\n  \t\t\tevent.index = this.parentFragment.indexRefs;\n  \t\t}\n\n  \t\tif (this.method) {\n  \t\t\tif (typeof this.ractive[this.method] !== 'function') {\n  \t\t\t\tthrow new Error('Attempted to call a non-existent method (\"' + this.method + '\")');\n  \t\t\t}\n\n  \t\t\tvar args = undefined;\n\n  \t\t\tif (event) passedArgs.unshift(event);\n\n  \t\t\tif (this.models) {\n  \t\t\t\tvar values = this.models.map(function (model) {\n  \t\t\t\t\tif (!model) return undefined;\n\n  \t\t\t\t\tif (model.event) {\n  \t\t\t\t\t\tvar obj = event;\n  \t\t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\t\twhile (keys.length) obj = obj[keys.shift()];\n  \t\t\t\t\t\treturn obj;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.argument) {\n  \t\t\t\t\t\treturn passedArgs ? passedArgs[model.index] : void 0;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (model.wrapper) {\n  \t\t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t\t}\n\n  \t\t\t\t\treturn model.get();\n  \t\t\t\t});\n\n  \t\t\t\targs = this.argsFn.apply(null, values);\n  \t\t\t}\n\n  \t\t\tif (this.passthru) {\n  \t\t\t\targs = args ? args.concat(passedArgs) : passedArgs;\n  \t\t\t}\n\n  \t\t\t// make event available as `this.event`\n  \t\t\tvar ractive = this.ractive;\n  \t\t\tvar oldEvent = ractive.event;\n\n  \t\t\tractive.event = event;\n  \t\t\tvar result = ractive[this.method].apply(ractive, args);\n\n  \t\t\t// Auto prevent and stop if return is explicitly false\n  \t\t\tvar original = undefined;\n  \t\t\tif (result === false && (original = event.original)) {\n  \t\t\t\toriginal.preventDefault && original.preventDefault();\n  \t\t\t\toriginal.stopPropagation && original.stopPropagation();\n  \t\t\t}\n\n  \t\t\tractive.event = oldEvent;\n  \t\t} else {\n  \t\t\tvar action = this.action.toString();\n  \t\t\tvar args = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\t\tif (passedArgs.length) args = args.concat(passedArgs);\n\n  \t\t\tif (event) event.name = action;\n\n  \t\t\tfireEvent(this.ractive, action, {\n  \t\t\t\tevent: event,\n  \t\t\t\targs: args\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.rebind = function rebind() {\n  \t\tthis.unbind();\n  \t\tthis.bind();\n  \t};\n\n  \tEventDirective.prototype.render = function render() {\n  \t\tthis.event.listen(this);\n  \t};\n\n  \tEventDirective.prototype.unbind = function unbind() {\n  \t\tvar template = this.template;\n\n  \t\tif (template.m) {\n  \t\t\tif (this.resolvers) this.resolvers.forEach(_unbind);\n  \t\t\tthis.resolvers = [];\n\n  \t\t\tthis.models = null;\n  \t\t} else {\n  \t\t\t// TODO this is brittle and non-explicit, fix it\n  \t\t\tif (this.action.unbind) this.action.unbind();\n  \t\t\tif (this.args.unbind) this.args.unbind();\n  \t\t}\n  \t};\n\n  \tEventDirective.prototype.unrender = function unrender() {\n  \t\tthis.event.unlisten();\n  \t};\n\n  \tEventDirective.prototype.update = function update() {\n  \t\tif (this.method) return; // nothing to do\n\n  \t\t// ugh legacy\n  \t\tif (this.action.update) this.action.update();\n  \t\tif (this.template.d) this.args.update();\n\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn EventDirective;\n  })();\n\n  var DOMEvent = (function () {\n  \tfunction DOMEvent(name, owner) {\n  \t\tclassCallCheck(this, DOMEvent);\n\n  \t\tif (name.indexOf('*') !== -1) {\n  \t\t\tfatal('Only component proxy-events may contain \"*\" wildcards, <' + owner.name + ' on-' + name + '=\"...\"/> is not valid');\n  \t\t}\n\n  \t\tthis.name = name;\n  \t\tthis.owner = owner;\n  \t\tthis.node = null;\n  \t\tthis.handler = null;\n  \t}\n\n  \tDOMEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar name = this.name;\n\n  \t\tif (!('on' + name in node)) {\n  \t\t\twarnOnce(missingPlugin(name, 'events'));\n  \t\t}\n\n  \t\tnode.addEventListener(name, this.handler = function (event) {\n  \t\t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false);\n  \t};\n\n  \tDOMEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.node.removeEventListener(this.name, this.handler, false);\n  \t};\n\n  \treturn DOMEvent;\n  })();\n\n  var CustomEvent = (function () {\n  \tfunction CustomEvent(eventPlugin, owner) {\n  \t\tclassCallCheck(this, CustomEvent);\n\n  \t\tthis.eventPlugin = eventPlugin;\n  \t\tthis.owner = owner;\n  \t\tthis.handler = null;\n  \t}\n\n  \tCustomEvent.prototype.listen = function listen(directive) {\n  \t\tvar node = this.owner.node;\n\n  \t\tthis.handler = this.eventPlugin(node, function () {\n  \t\t\tvar event = arguments.length <= 0 || arguments[0] === undefined ? {} : arguments[0];\n\n  \t\t\tevent.node = event.node || node;\n  \t\t\tdirective.fire(event);\n  \t\t});\n  \t};\n\n  \tCustomEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.teardown();\n  \t};\n\n  \treturn CustomEvent;\n  })();\n\n  function camelCase (hyphenatedStr) {\n  \treturn hyphenatedStr.replace(/-([a-zA-Z])/g, function (match, $1) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var prefix$1 = undefined;\n\n  if (!isClient) {\n  \tprefix$1 = null;\n  } else {\n  \t(function () {\n  \t\tvar prefixCache = {};\n  \t\tvar testStyle = createElement('div').style;\n\n  \t\tprefix$1 = function (prop) {\n  \t\t\tprop = camelCase(prop);\n\n  \t\t\tif (!prefixCache[prop]) {\n  \t\t\t\tif (testStyle[prop] !== undefined) {\n  \t\t\t\t\tprefixCache[prop] = prop;\n  \t\t\t\t} else {\n  \t\t\t\t\t// test vendors...\n  \t\t\t\t\tvar capped = prop.charAt(0).toUpperCase() + prop.substring(1);\n\n  \t\t\t\t\tvar i = vendors.length;\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\t\tif (testStyle[vendor + capped] !== undefined) {\n  \t\t\t\t\t\t\tprefixCache[prop] = vendor + capped;\n  \t\t\t\t\t\t\tbreak;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn prefixCache[prop];\n  \t\t};\n  \t})();\n  }\n\n  var prefix$2 = prefix$1;\n\n  var visible = undefined;\n  var hidden = 'hidden';\n\n  if (doc) {\n  \tvar prefix$3 = undefined;\n\n  \tif (hidden in doc) {\n  \t\tprefix$3 = '';\n  \t} else {\n  \t\tvar i$2 = vendors.length;\n  \t\twhile (i$2--) {\n  \t\t\tvar vendor = vendors[i$2];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif (hidden in doc) {\n  \t\t\t\tprefix$3 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif (prefix$3 !== undefined) {\n  \t\tdoc.addEventListener(prefix$3 + 'visibilitychange', onChange);\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ('onfocusout' in doc) {\n  \t\t\tdoc.addEventListener('focusout', onHide);\n  \t\t\tdoc.addEventListener('focusin', onShow);\n  \t\t} else {\n  \t\t\twin.addEventListener('pagehide', onHide);\n  \t\t\twin.addEventListener('blur', onHide);\n\n  \t\t\twin.addEventListener('pageshow', onShow);\n  \t\t\twin.addEventListener('focus', onShow);\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange() {\n  \tvisible = !doc[hidden];\n  }\n\n  function onHide() {\n  \tvisible = false;\n  }\n\n  function onShow() {\n  \tvisible = true;\n  }\n\n  var interpolators = {\n  \tnumber: function (from, to) {\n  \t\tvar delta;\n\n  \t\tif (!isNumeric(from) || !isNumeric(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif (!delta) {\n  \t\t\treturn function () {\n  \t\t\t\treturn from;\n  \t\t\t};\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\treturn from + t * delta;\n  \t\t};\n  \t},\n\n  \tarray: function (from, to) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif (!isArray(from) || !isArray(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min(from.length, to.length);\n  \t\twhile (i--) {\n  \t\t\tinterpolators[i] = interpolate(from[i], to[i]);\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor (i = len; i < from.length; i += 1) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor (i = len; i < to.length; i += 1) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tintermediate[i] = interpolators[i](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function (from, to) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif (!isObject(from) || !isObject(to)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor (prop in from) {\n  \t\t\tif (hasOwn.call(from, prop)) {\n  \t\t\t\tif (hasOwn.call(to, prop)) {\n  \t\t\t\t\tproperties.push(prop);\n  \t\t\t\t\tinterpolators[prop] = interpolate(from[prop], to[prop]);\n  \t\t\t\t} else {\n  \t\t\t\t\tintermediate[prop] = from[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor (prop in to) {\n  \t\t\tif (hasOwn.call(to, prop) && !hasOwn.call(from, prop)) {\n  \t\t\t\tintermediate[prop] = to[prop];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function (t) {\n  \t\t\tvar i = len,\n  \t\t\t    prop;\n\n  \t\t\twhile (i--) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[prop] = interpolators[prop](t);\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var interpolators$1 = interpolators;\n\n  function interpolate(from, to, ractive, type) {\n  \tif (from === to) return null;\n\n  \tif (type) {\n  \t\tvar interpol = findInViewHierarchy('interpolators', ractive, type);\n  \t\tif (interpol) return interpol(from, to) || null;\n\n  \t\tfatal(missingPlugin(type, 'interpolator'));\n  \t}\n\n  \treturn interpolators$1.number(from, to) || interpolators$1.array(from, to) || interpolators$1.object(from, to) || null;\n  }\n\n  var unprefixPattern = new RegExp('^-(?:' + vendors.join('|') + ')-');\n\n  function unprefix (prop) {\n  \treturn prop.replace(unprefixPattern, '');\n  }\n\n  var vendorPattern = new RegExp('^(?:' + vendors.join('|') + ')([A-Z])');\n\n  function hyphenate (str) {\n  \tif (!str) return ''; // edge case\n\n  \tif (vendorPattern.test(str)) str = '-' + str;\n\n  \treturn str.replace(/[A-Z]/g, function (match) {\n  \t\treturn '-' + match.toLowerCase();\n  \t});\n  }\n\n  var createTransitions = undefined;\n\n  if (!isClient) {\n  \tcreateTransitions = null;\n  } else {\n  \t(function () {\n  \t\tvar testStyle = createElement('div').style;\n  \t\tvar linear = function (x) {\n  \t\t\treturn x;\n  \t\t};\n\n  \t\tvar canUseCssTransitions = {};\n  \t\tvar cannotUseCssTransitions = {};\n\n  \t\t// determine some facts about our environment\n  \t\tvar TRANSITION = undefined;\n  \t\tvar TRANSITIONEND = undefined;\n  \t\tvar CSS_TRANSITIONS_ENABLED = undefined;\n  \t\tvar TRANSITION_DURATION = undefined;\n  \t\tvar TRANSITION_PROPERTY = undefined;\n  \t\tvar TRANSITION_TIMING_FUNCTION = undefined;\n\n  \t\tif (testStyle.transition !== undefined) {\n  \t\t\tTRANSITION = 'transition';\n  \t\t\tTRANSITIONEND = 'transitionend';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else if (testStyle.webkitTransition !== undefined) {\n  \t\t\tTRANSITION = 'webkitTransition';\n  \t\t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\t\tCSS_TRANSITIONS_ENABLED = true;\n  \t\t} else {\n  \t\t\tCSS_TRANSITIONS_ENABLED = false;\n  \t\t}\n\n  \t\tif (TRANSITION) {\n  \t\t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t\t}\n\n  \t\tcreateTransitions = function (t, to, options, changedProperties, resolve) {\n\n  \t\t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t\t// TODO use a fastdom-style mechanism?\n  \t\t\tsetTimeout(function () {\n  \t\t\t\tvar jsTransitionsComplete = undefined;\n  \t\t\t\tvar cssTransitionsComplete = undefined;\n\n  \t\t\t\tfunction checkComplete() {\n  \t\t\t\t\tif (jsTransitionsComplete && cssTransitionsComplete) {\n  \t\t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\t\tt.ractive.fire(t.name + ':end', t.node, t.isIntro);\n  \t\t\t\t\t\tresolve();\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t\t// which properties\n  \t\t\t\tvar hashPrefix = (t.node.namespaceURI || '') + t.node.tagName;\n\n  \t\t\t\tt.node.style[TRANSITION_PROPERTY] = changedProperties.map(prefix$2).map(hyphenate).join(',');\n  \t\t\t\tt.node.style[TRANSITION_TIMING_FUNCTION] = hyphenate(options.easing || 'linear');\n  \t\t\t\tt.node.style[TRANSITION_DURATION] = options.duration / 1000 + 's';\n\n  \t\t\t\tfunction transitionEndHandler(event) {\n  \t\t\t\t\tvar index = changedProperties.indexOf(camelCase(unprefix(event.propertyName)));\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (changedProperties.length) {\n  \t\t\t\t\t\t// still transitioning...\n  \t\t\t\t\t\treturn;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n\n  \t\t\t\tt.node.addEventListener(TRANSITIONEND, transitionEndHandler, false);\n\n  \t\t\t\tsetTimeout(function () {\n  \t\t\t\t\tvar i = changedProperties.length;\n  \t\t\t\t\tvar hash = undefined;\n  \t\t\t\t\tvar originalValue = undefined;\n  \t\t\t\t\tvar index = undefined;\n  \t\t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\t\tvar prop = undefined;\n  \t\t\t\t\tvar suffix = undefined;\n  \t\t\t\t\tvar interpolator = undefined;\n\n  \t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\t\tif (CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\tt.node.style[prefix$2(prop)] = to[prop];\n\n  \t\t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\t\tif (!canUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n\n  \t\t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\t\tcanUseCssTransitions[hash] = t.getStyle(prop) != to[prop];\n  \t\t\t\t\t\t\t\tcannotUseCssTransitions[hash] = !canUseCssTransitions[hash];\n\n  \t\t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\t\tif (cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t\t\tt.node.style[prefix$2(prop)] = originalValue;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tif (!CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[hash]) {\n  \t\t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\t\tif (originalValue === undefined) {\n  \t\t\t\t\t\t\t\toriginalValue = t.getStyle(prop);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\t\tindex = changedProperties.indexOf(prop);\n  \t\t\t\t\t\t\tif (index === -1) {\n  \t\t\t\t\t\t\t\twarnIfDebug('Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t\tchangedProperties.splice(index, 1);\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\t\tsuffix = /[^\\d]*$/.exec(to[prop])[0];\n  \t\t\t\t\t\t\tinterpolator = interpolate(parseFloat(originalValue), parseFloat(to[prop])) || function () {\n  \t\t\t\t\t\t\t\treturn to[prop];\n  \t\t\t\t\t\t\t};\n\n  \t\t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\t\tname: prefix$2(prop),\n  \t\t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\t// javascript transitions\n  \t\t\t\t\tif (propertiesToTransitionInJs.length) {\n  \t\t\t\t\t\tvar easing = undefined;\n\n  \t\t\t\t\t\tif (typeof options.easing === 'string') {\n  \t\t\t\t\t\t\teasing = t.ractive.easing[options.easing];\n\n  \t\t\t\t\t\t\tif (!easing) {\n  \t\t\t\t\t\t\t\twarnOnceIfDebug(missingPlugin(options.easing, 'easing'));\n  \t\t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t} else if (typeof options.easing === 'function') {\n  \t\t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\teasing = linear;\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\t\tstep: function (pos) {\n  \t\t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\t\twhile (i--) {\n  \t\t\t\t\t\t\t\t\tvar _prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\t\tt.node.style[_prop.name] = _prop.interpolator(pos) + _prop.suffix;\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t},\n  \t\t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t});\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif (!changedProperties.length) {\n  \t\t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\t\tt.node.removeEventListener(TRANSITIONEND, transitionEndHandler, false);\n  \t\t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t}\n  \t\t\t\t}, 0);\n  \t\t\t}, options.delay || 0);\n  \t\t};\n  \t})();\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle(node, style) {\n  \tif (style) {\n  \t\tnode.setAttribute('style', style);\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute('style');\n  \t\tnode.removeAttribute('style');\n  \t}\n  }\n\n  var getComputedStyle = win && (win.getComputedStyle || legacy.getComputedStyle);\n  var resolved = Promise$1.resolve();\n\n  var Transition = (function () {\n  \tfunction Transition(owner, template, isIntro) {\n  \t\tclassCallCheck(this, Transition);\n\n  \t\tthis.owner = owner;\n  \t\tthis.isIntro = isIntro;\n  \t\tthis.ractive = owner.ractive;\n\n  \t\tvar ractive = owner.ractive;\n\n  \t\tvar name = template.n || template;\n\n  \t\tif (typeof name !== 'string') {\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: name\n  \t\t\t}).bind(); // TODO need a way to capture values without bind()\n\n  \t\t\tname = fragment.toString();\n  \t\t\tfragment.unbind();\n\n  \t\t\tif (name === '') {\n  \t\t\t\t// empty string okay, just no transition\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.name = name;\n\n  \t\tif (template.a) {\n  \t\t\tthis.params = template.a;\n  \t\t} else if (template.d) {\n  \t\t\t// TODO is there a way to interpret dynamic arguments without all the\n  \t\t\t// 'dependency thrashing'?\n  \t\t\tvar fragment = new Fragment({\n  \t\t\t\towner: owner,\n  \t\t\t\ttemplate: template.d\n  \t\t\t}).bind();\n\n  \t\t\tthis.params = fragment.getArgsList();\n  \t\t\tfragment.unbind();\n  \t\t}\n\n  \t\tthis._fn = findInViewHierarchy('transitions', ractive, name);\n\n  \t\tif (!this._fn) {\n  \t\t\twarnOnceIfDebug(missingPlugin(name, 'transition'), { ractive: ractive });\n  \t\t}\n  \t}\n\n  \tTransition.prototype.animateStyle = function animateStyle(style, value, options) {\n  \t\tvar _this = this;\n\n  \t\tif (arguments.length === 4) {\n  \t\t\tthrow new Error('t.animateStyle() returns a promise - use .then() instead of passing a callback');\n  \t\t}\n\n  \t\t// Special case - page isn't visible. Don't animate anything, because\n  \t\t// that way you'll never get CSS transitionend events\n  \t\tif (!visible) {\n  \t\t\tthis.setStyle(style, value);\n  \t\t\treturn resolved;\n  \t\t}\n\n  \t\tvar to = undefined;\n\n  \t\tif (typeof style === 'string') {\n  \t\t\tto = {};\n  \t\t\tto[style] = value;\n  \t\t} else {\n  \t\t\tto = style;\n\n  \t\t\t// shuffle arguments\n  \t\t\toptions = value;\n  \t\t}\n\n  \t\t// As of 0.3.9, transition authors should supply an `option` object with\n  \t\t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t\t// callback function that gets called after the animation completes\n\n  \t\t// TODO remove this check in a future version\n  \t\tif (!options) {\n  \t\t\twarnOnceIfDebug('The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name);\n  \t\t\toptions = this;\n  \t\t}\n\n  \t\treturn new Promise$1(function (fulfil) {\n  \t\t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\t\tif (!options.duration) {\n  \t\t\t\t_this.setStyle(to);\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\t// Get a list of the properties we're animating\n  \t\t\tvar propertyNames = Object.keys(to);\n  \t\t\tvar changedProperties = [];\n\n  \t\t\t// Store the current styles\n  \t\t\tvar computedStyle = getComputedStyle(_this.node);\n\n  \t\t\tvar i = propertyNames.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar prop = propertyNames[i];\n  \t\t\t\tvar current = computedStyle[prefix$2(prop)];\n\n  \t\t\t\tif (current === '0px') current = 0;\n\n  \t\t\t\t// we need to know if we're actually changing anything\n  \t\t\t\tif (current != to[prop]) {\n  \t\t\t\t\t// use != instead of !==, so we can compare strings with numbers\n  \t\t\t\t\tchangedProperties.push(prop);\n\n  \t\t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t\t// e.g. height='auto'\n  \t\t\t\t\t_this.node.style[prefix$2(prop)] = current;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// If we're not actually changing anything, the transitionend event\n  \t\t\t// will never fire! So we complete early\n  \t\t\tif (!changedProperties.length) {\n  \t\t\t\tfulfil();\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tcreateTransitions$1(_this, to, options, changedProperties, fulfil);\n  \t\t});\n  \t};\n\n  \tTransition.prototype.getStyle = function getStyle(props) {\n  \t\tvar computedStyle = getComputedStyle(this.node);\n\n  \t\tif (typeof props === 'string') {\n  \t\t\tvar value = computedStyle[prefix$2(props)];\n  \t\t\treturn value === '0px' ? 0 : value;\n  \t\t}\n\n  \t\tif (!isArray(props)) {\n  \t\t\tthrow new Error('Transition$getStyle must be passed a string, or an array of strings representing CSS properties');\n  \t\t}\n\n  \t\tvar styles = {};\n\n  \t\tvar i = props.length;\n  \t\twhile (i--) {\n  \t\t\tvar prop = props[i];\n  \t\t\tvar value = computedStyle[prefix$2(prop)];\n\n  \t\t\tif (value === '0px') value = 0;\n  \t\t\tstyles[prop] = value;\n  \t\t}\n\n  \t\treturn styles;\n  \t};\n\n  \tTransition.prototype.processParams = function processParams(params, defaults) {\n  \t\tif (typeof params === 'number') {\n  \t\t\tparams = { duration: params };\n  \t\t} else if (typeof params === 'string') {\n  \t\t\tif (params === 'slow') {\n  \t\t\t\tparams = { duration: 600 };\n  \t\t\t} else if (params === 'fast') {\n  \t\t\t\tparams = { duration: 200 };\n  \t\t\t} else {\n  \t\t\t\tparams = { duration: 400 };\n  \t\t\t}\n  \t\t} else if (!params) {\n  \t\t\tparams = {};\n  \t\t}\n\n  \t\treturn extend({}, defaults, params);\n  \t};\n\n  \tTransition.prototype.setStyle = function setStyle(style, value) {\n  \t\tif (typeof style === 'string') {\n  \t\t\tthis.node.style[prefix$2(style)] = value;\n  \t\t} else {\n  \t\t\tvar prop = undefined;\n  \t\t\tfor (prop in style) {\n  \t\t\t\tif (style.hasOwnProperty(prop)) {\n  \t\t\t\t\tthis.node.style[prefix$2(prop)] = style[prop];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tTransition.prototype.start = function start() {\n  \t\tvar _this2 = this;\n\n  \t\tvar node = this.node = this.owner.node;\n  \t\tvar originalStyle = node.getAttribute('style');\n\n  \t\tvar completed = undefined;\n\n  \t\t// create t.complete() - we don't want this on the prototype,\n  \t\t// because we don't want `this` silliness when passing it as\n  \t\t// an argument\n  \t\tthis.complete = function (noReset) {\n  \t\t\tif (completed) {\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (!noReset && _this2.isIntro) {\n  \t\t\t\tresetStyle(node, originalStyle);\n  \t\t\t}\n\n  \t\t\t_this2._manager.remove(_this2);\n\n  \t\t\tcompleted = true;\n  \t\t};\n\n  \t\t// If the transition function doesn't exist, abort\n  \t\tif (!this._fn) {\n  \t\t\tthis.complete();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tthis._fn.apply(this.root, [this].concat(this.params));\n  \t};\n\n  \treturn Transition;\n  })();\n\n  function updateLiveQueries$1(element) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + selector];\n\n  \t\t\tif (query.test(node)) {\n  \t\t\t\tquery.add(node);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm(element) {\n  \twhile (element = element.parent) {\n  \t\tif (element.name === 'form') {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity(description, ractive) {\n  \twarnOnceIfDebug('The ' + description + ' being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: ractive });\n  }\n\n  var Binding = (function () {\n  \tfunction Binding(element) {\n  \t\tvar name = arguments.length <= 1 || arguments[1] === undefined ? 'value' : arguments[1];\n  \t\tclassCallCheck(this, Binding);\n\n  \t\tthis.element = element;\n  \t\tthis.ractive = element.ractive;\n  \t\tthis.attribute = element.attributeByName[name];\n\n  \t\tvar interpolator = this.attribute.interpolator;\n  \t\tinterpolator.twowayBinding = this;\n\n  \t\tvar model = interpolator.model;\n\n  \t\t// not bound?\n  \t\tif (!model) {\n  \t\t\t// try to force resolution\n  \t\t\tinterpolator.resolver.forceResolution();\n  \t\t\tmodel = interpolator.model;\n\n  \t\t\twarnAboutAmbiguity('\\'' + interpolator.template.r + '\\' reference', this.ractive);\n  \t\t} else if (model.isUnresolved) {\n  \t\t\t// reference expressions (e.g. foo[bar])\n  \t\t\tmodel.forceResolution();\n  \t\t\twarnAboutAmbiguity('expression', this.ractive);\n  \t\t}\n\n  \t\t// TODO include index/key/keypath refs as read-only\n  \t\telse if (model.isReadonly) {\n  \t\t\t\tvar keypath = model.getKeypath().replace(/^@/, '');\n  \t\t\t\twarnOnceIfDebug('Cannot use two-way binding on <' + element.name + '> element: ' + keypath + ' is read-only. To suppress this warning use <' + element.name + ' twoway=\\'false\\'...>', { ractive: this.ractive });\n  \t\t\t\treturn false;\n  \t\t\t}\n\n  \t\tthis.attribute.isTwoway = true;\n  \t\tthis.model = model;\n\n  \t\t// initialise value, if it's undefined\n  \t\tvar value = model.get();\n  \t\tthis.wasUndefined = value === undefined;\n\n  \t\tif (value === undefined && this.getInitialValue) {\n  \t\t\tvalue = this.getInitialValue();\n  \t\t\tmodel.set(value);\n  \t\t}\n\n  \t\tvar parentForm = findParentForm(element);\n  \t\tif (parentForm) {\n  \t\t\tthis.resetValue = value;\n  \t\t\tparentForm.formBindings.push(this);\n  \t\t}\n  \t}\n\n  \tBinding.prototype.bind = function bind() {\n  \t\tthis.model.registerTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.handleChange = function handleChange() {\n  \t\tvar _this = this;\n\n  \t\trunloop.start(this.root);\n  \t\tthis.attribute.locked = true;\n  \t\tthis.model.set(this.getValue());\n  \t\trunloop.scheduleTask(function () {\n  \t\t\treturn _this.attribute.locked = false;\n  \t\t});\n  \t\trunloop.end();\n  \t};\n\n  \tBinding.prototype.rebind = function rebind() {\n  \t\t// TODO what does this work with CheckboxNameBinding et al?\n  \t\tthis.unbind();\n  \t\tthis.model = this.attribute.interpolator.model;\n  \t\tthis.bind();\n  \t};\n\n  \tBinding.prototype.render = function render() {\n  \t\tthis.node = this.element.node;\n  \t\tthis.node._ractive.binding = this;\n  \t\tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  \tBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.value);\n  \t};\n\n  \tBinding.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t};\n\n  \tBinding.prototype.unrender = function unrender() {\n  \t\t// noop?\n  \t};\n\n  \treturn Binding;\n  })();\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n\n  function handleDomEvent() {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (_Binding) {\n  \tinherits(CheckboxBinding, _Binding);\n\n  \tfunction CheckboxBinding(element) {\n  \t\tclassCallCheck(this, CheckboxBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n  \t}\n\n  \tCheckboxBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn !!this.element.getAttribute('checked');\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \treturn CheckboxBinding;\n  })(Binding);\n\n  function getBindingGroup(group, model, getValue) {\n  \tvar hash = group + \"-bindingGroup\";\n  \treturn model[hash] || (model[hash] = new BindingGroup(hash, model, getValue));\n  }\n\n  var BindingGroup = (function () {\n  \tfunction BindingGroup(hash, model, getValue) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, BindingGroup);\n\n  \t\tthis.model = model;\n  \t\tthis.hash = hash;\n  \t\tthis.getValue = function () {\n  \t\t\t_this.value = getValue.call(_this);\n  \t\t\treturn _this.value;\n  \t\t};\n\n  \t\tthis.bindings = [];\n  \t}\n\n  \tBindingGroup.prototype.add = function add(binding) {\n  \t\tthis.bindings.push(binding);\n  \t};\n\n  \tBindingGroup.prototype.bind = function bind() {\n  \t\tthis.value = this.model.get();\n  \t\tthis.model.registerTwowayBinding(this);\n  \t\tthis.bound = true;\n  \t};\n\n  \tBindingGroup.prototype.remove = function remove(binding) {\n  \t\tremoveFromArray(this.bindings, binding);\n  \t\tif (!this.bindings.length) {\n  \t\t\tthis.unbind();\n  \t\t}\n  \t};\n\n  \tBindingGroup.prototype.unbind = function unbind() {\n  \t\tthis.model.unregisterTwowayBinding(this);\n  \t\tthis.bound = false;\n  \t\tdelete this.model[this.hash];\n  \t};\n\n  \treturn BindingGroup;\n  })();\n\n  var push$1 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function (b) {\n  \t\treturn b.node && b.node.checked;\n  \t}).map(function (b) {\n  \t\treturn b.element.getAttribute('value');\n  \t});\n  \tvar res = [];\n  \tall.forEach(function (v) {\n  \t\tif (!arrayContains(res, v)) res.push(v);\n  \t});\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (_Binding) {\n  \tinherits(CheckboxNameBinding, _Binding);\n\n  \tfunction CheckboxNameBinding(element) {\n  \t\tclassCallCheck(this, CheckboxNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup('checkboxes', this.model, getValue$1);\n  \t\tthis.group.add(this);\n\n  \t\tif (this.noInitialValue) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif (this.group.noInitialValue && this.element.getAttribute('checked')) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\t\tif (!arrayContains(existingValue, bindingValue)) {\n  \t\t\t\tpush$1.call(existingValue, bindingValue); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype.bind = function bind() {\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed() {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange() {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute('value');\n  \t\tif (this.isChecked && !arrayContains(this.group.value, value)) {\n  \t\t\tthis.group.value.push(value);\n  \t\t} else if (!this.isChecked && arrayContains(this.group.value, value)) {\n  \t\t\tremoveFromArray(this.group.value, value);\n  \t\t}\n  \t\t_Binding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute('value');\n\n  \t\tif (isArray(existingValue)) {\n  \t\t\tthis.isChecked = arrayContains(existingValue, bindingValue);\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.group.bindings.forEach(function (binding) {\n  \t\t\treturn binding.wasUndefined = true;\n  \t\t});\n\n  \t\tif (node.checked) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push(this.element.getAttribute('value'));\n\n  \t\t\tthis.group.model.set(valueSoFar);\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn CheckboxNameBinding;\n  })(Binding);\n\n  var ContentEditableBinding = (function (_Binding) {\n  \tinherits(ContentEditableBinding, _Binding);\n\n  \tfunction ContentEditableBinding() {\n  \t\tclassCallCheck(this, ContentEditableBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n  \t\tnode.addEventListener('blur', handleDomEvent, false);\n\n  \t\tif (!this.ractive.lazy) {\n  \t\t\tnode.addEventListener('input', handleDomEvent, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', handleDomEvent, false);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.innerHTML);\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('blur', handleDomEvent, false);\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', handleDomEvent, false);\n  \t\tnode.removeEventListener('keyup', handleDomEvent, false);\n  \t};\n\n  \treturn ContentEditableBinding;\n  })(Binding);\n\n  function handleBlur() {\n  \thandleDomEvent.call(this);\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay(delay) {\n  \tvar timeout = undefined;\n\n  \treturn function () {\n  \t\tvar _this = this;\n\n  \t\tif (timeout) clearTimeout(timeout);\n\n  \t\ttimeout = setTimeout(function () {\n  \t\t\tvar binding = _this._ractive.binding;\n  \t\t\tif (binding.rendered) handleDomEvent.call(_this);\n  \t\t\ttimeout = null;\n  \t\t}, delay);\n  \t};\n  }\n\n  var GenericBinding = (function (_Binding) {\n  \tinherits(GenericBinding, _Binding);\n\n  \tfunction GenericBinding() {\n  \t\tclassCallCheck(this, GenericBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif (this.element.template.a && 'lazy' in this.element.template.a) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif (lazy === 0) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif (lazy === 'false') lazy = false;\n\n  \t\tif (isNumeric(lazy)) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay(timeout) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (!lazy) {\n  \t\t\tnode.addEventListener('input', this.handler, false);\n\n  \t\t\tif (node.attachEvent) {\n  \t\t\t\tnode.addEventListener('keyup', this.handler, false);\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener('blur', handleBlur, false);\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('input', this.handler, false);\n  \t\tnode.removeEventListener('keyup', this.handler, false);\n  \t\tnode.removeEventListener('blur', handleBlur, false);\n  \t};\n\n  \treturn GenericBinding;\n  })(Binding);\n\n  var MultipleSelectBinding = (function (_Binding) {\n  \tinherits(MultipleSelectBinding, _Binding);\n\n  \tfunction MultipleSelectBinding() {\n  \t\tclassCallCheck(this, MultipleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn this.element.options.filter(function (option) {\n  \t\t\treturn option.getAttribute('selected');\n  \t\t}).map(function (option) {\n  \t\t\treturn option.getAttribute('value');\n  \t\t});\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.selected) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push(optionValue);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange() {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (previousValue === undefined || !arrayContentsMatch(value, previousValue)) {\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.model.get() === undefined) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar i = node.selectedOptions.length;\n  \t\tvar result = new Array(i);\n\n  \t\twhile (i--) {\n  \t\t\tvar option = node.selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set(result);\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue() {\n  \t\tthrow new Error('TODO not implemented yet');\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel() {\n  \t\tif (this.attribute.value === undefined || !this.attribute.value.length) {\n  \t\t\tthis.keypath.set(this.initialValue);\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  })(Binding);\n\n  var NumericBinding = (function (_GenericBinding) {\n  \tinherits(NumericBinding, _GenericBinding);\n\n  \tfunction NumericBinding() {\n  \t\tclassCallCheck(this, NumericBinding);\n\n  \t\t_GenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue() {\n  \t\tvar value = parseFloat(this.node.value);\n  \t\treturn isNaN(value) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar value = parseFloat(node.value);\n  \t\tif (!isNaN(value)) this.model.set(value);\n  \t};\n\n  \treturn NumericBinding;\n  })(GenericBinding);\n\n  var siblings = {};\n\n  function getSiblings(hash) {\n  \treturn siblings[hash] || (siblings[hash] = []);\n  }\n\n  var RadioBinding = (function (_Binding) {\n  \tinherits(RadioBinding, _Binding);\n\n  \tfunction RadioBinding(element) {\n  \t\tclassCallCheck(this, RadioBinding);\n\n  \t\t_Binding.call(this, element, 'checked');\n\n  \t\tthis.siblings = getSiblings(this.ractive._guid + this.element.getAttribute('name'));\n  \t\tthis.siblings.push(this);\n  \t}\n\n  \tRadioBinding.prototype.getValue = function getValue() {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange() {\n  \t\trunloop.start(this.root);\n\n  \t\tthis.siblings.forEach(function (binding) {\n  \t\t\tbinding.model.set(binding.getValue());\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (this.node.attachEvent) {\n  \t\t\tthis.node.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tthis.model.set(node.checked);\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.siblings, this);\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t\tthis.node.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioBinding;\n  })(Binding);\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter(function (b) {\n  \t\treturn b.node.checked;\n  \t});\n  \tif (checked.length > 0) {\n  \t\treturn checked[0].element.getAttribute('value');\n  \t}\n  }\n\n  var RadioNameBinding = (function (_Binding) {\n  \tinherits(RadioNameBinding, _Binding);\n\n  \tfunction RadioNameBinding(element) {\n  \t\tclassCallCheck(this, RadioNameBinding);\n\n  \t\t_Binding.call(this, element, 'name');\n\n  \t\tthis.group = getBindingGroup('radioname', this.model, getValue$2);\n  \t\tthis.group.add(this);\n\n  \t\tif (element.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.group.bound) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () {\n  \t\t\t\treturn _this.node.name = '{{' + _this.model.getKeypath() + '}}';\n  \t\t\t}\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('checked')) {\n  \t\t\treturn this.element.getAttribute('value');\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue() {\n  \t\treturn this.element.getAttribute('value');\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange() {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif (this.node.checked) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\t_Binding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.model.get() == this.element.getAttribute('value');\n\n  \t\tnode.addEventListener('change', handleDomEvent, false);\n\n  \t\tif (node.attachEvent) {\n  \t\t\tnode.addEventListener('click', handleDomEvent, false);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tif (node.checked) {\n  \t\t\tthis.group.model.set(this.element.getAttribute('value'));\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind() {\n  \t\tthis.group.remove(this);\n\n  \t\tthis.model.getKeypathModel().unregister(this.nameAttributeBinding);\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender() {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener('change', handleDomEvent, false);\n  \t\tnode.removeEventListener('click', handleDomEvent, false);\n  \t};\n\n  \treturn RadioNameBinding;\n  })(Binding);\n\n  var SingleSelectBinding = (function (_Binding) {\n  \tinherits(SingleSelectBinding, _Binding);\n\n  \tfunction SingleSelectBinding() {\n  \t\tclassCallCheck(this, SingleSelectBinding);\n\n  \t\t_Binding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate() {\n  \t\tvar _this = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif (value !== undefined) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.attribute.locked = false;\n  \t\t\t});\n  \t\t\tthis.model.set(value);\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue() {\n  \t\tif (this.element.getAttribute('value') !== undefined) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif (!len) return;\n\n  \t\tvar value = undefined;\n  \t\tvar optionWasSelected = undefined;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile (i--) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (option.getAttribute('selected')) {\n  \t\t\t\tif (!option.getAttribute('disabled')) {\n  \t\t\t\t\tvalue = option.getAttribute('value');\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif (!optionWasSelected) {\n  \t\t\twhile (++i < len) {\n  \t\t\t\tif (!options[i].getAttribute('disabled')) {\n  \t\t\t\t\tvalue = options[i].getAttribute('value');\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif (value !== undefined) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue() {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i = undefined;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif (options[i].selected && !options[i].disabled) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render() {\n  \t\t_Binding.prototype.render.call(this);\n  \t\tthis.node.addEventListener('change', handleDomEvent, false);\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode(node) {\n  \t\tvar option = node.selectedOptions[0];\n  \t\tthis.model.set(option._ractive ? option._ractive.value : option.value);\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n\n  \tSingleSelectBinding.prototype.setValue = function setValue(value) {\n  \t\tthis.model.set(value);\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('change', handleDomEvent, false);\n  \t};\n\n  \treturn SingleSelectBinding;\n  })(Binding);\n\n  function isBindable(attribute) {\n  \treturn attribute && attribute.template.length === 1 && attribute.template[0].t === INTERPOLATOR && !attribute.template[0].s;\n  }\n\n  function selectBinding(element) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif (element.getAttribute('contenteditable') || isBindable(attributes.contenteditable)) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable(attributes.value) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif (element.name === 'input') {\n  \t\tvar type = element.getAttribute('type');\n\n  \t\tif (type === 'radio' || type === 'checkbox') {\n  \t\t\tvar bindName = isBindable(attributes.name);\n  \t\t\tvar bindChecked = isBindable(attributes.checked);\n\n  \t\t\t// we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif (bindName && bindChecked) {\n  \t\t\t\twarnIfDebug('A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t}\n\n  \t\t\tif (bindName) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif (bindChecked) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif (type === 'file' && isBindable(attributes.value)) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif (isBindable(attributes.value)) {\n  \t\t\treturn type === 'number' || type === 'range' ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif (element.name === 'select' && isBindable(attributes.value)) {\n  \t\treturn element.getAttribute('multiple') ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif (element.name === 'textarea' && isBindable(attributes.value)) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1(query) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (_Item) {\n  \tinherits(Element, _Item);\n\n  \tfunction Element(options) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, Element);\n\n  \t\t_Item.call(this, options);\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test(this.name);\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\tthis.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\tif (this.parent && this.parent.name === 'option') {\n  \t\t\tthrow new Error('An <option> element cannot contain other elements (encountered <' + this.name + '>)');\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (name) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif (name === 'twoway' || name === 'lazy') return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: _this,\n  \t\t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\t\ttemplate: _this.template.a[name]\n  \t\t\t\t});\n\n  \t\t\t\t_this.attributeByName[name] = attribute;\n\n  \t\t\t\tif (name !== 'value' && name !== 'type') _this.attributes.push(attribute);\n  \t\t\t});\n\n  \t\t\tif (this.attributeByName.type) this.attributes.unshift(this.attributeByName.type);\n  \t\t\tif (this.attributeByName.value) this.attributes.push(this.attributeByName.value);\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = (this.template.m || []).map(function (template) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: _this,\n  \t\t\t\tparentFragment: _this.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif (this.template.o) {\n  \t\t\tthis.decorator = new Decorator(this, this.template.o);\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) {\n  \t\t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\t\tvar eventNames = key.split('-');\n  \t\t\t\tvar template = _this.template.v[key];\n\n  \t\t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\t\tvar fn = findInViewHierarchy('events', _this.ractive, eventName);\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent(fn, _this) : new DOMEvent(eventName, _this);\n  \t\t\t\t\t_this.eventHandlers.push(new EventDirective(_this, event, template));\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif (options.template.f && !options.noContent) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype.bind = function bind() {\n  \t\tthis.attributes.forEach(_bind);\n  \t\tthis.conditionalAttributes.forEach(_bind);\n  \t\tthis.eventHandlers.forEach(_bind);\n\n  \t\tif (this.decorator) this.decorator.bind();\n  \t\tif (this.fragment) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif (this.binding = this.createTwowayBinding()) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding() {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif (!attributes) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ? attributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\tthis.ractive.twoway;\n\n  \t\tif (!shouldBind) return null;\n\n  \t\tvar Binding = selectBinding(this);\n\n  \t\tif (!Binding) return null;\n\n  \t\tvar binding = new Binding(this);\n\n  \t\treturn binding && binding.model ? binding : null;\n  \t};\n\n  \tElement.prototype.detach = function detach() {\n  \t\tif (this.decorator) this.decorator.unrender();\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tElement.prototype.find = function find(selector) {\n  \t\tif (matches(this.node, selector)) return this.node;\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.find(selector);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll(selector, query) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test(this.node);\n  \t\tif (matches) {\n  \t\t\tquery.add(this.node);\n  \t\t\tif (query.live) this.liveQueries.push(query);\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAll(selector, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent(name) {\n  \t\tif (this.fragment) {\n  \t\t\treturn this.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.fragment) {\n  \t\t\tthis.fragment.findAllComponents(name, query);\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode() {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute(name) {\n  \t\tvar attribute = this.attributeByName[name];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind() {\n  \t\tthis.attributes.forEach(_rebind);\n  \t\tthis.conditionalAttributes.forEach(_rebind);\n  \t\tthis.eventHandlers.forEach(_rebind);\n  \t\tif (this.decorator) this.decorator.rebind();\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t\tif (this.binding) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach(makeDirty$1);\n  \t};\n\n  \tElement.prototype.render = function render(target, occupants) {\n  \t\tvar _this2 = this;\n\n  \t\t// TODO determine correct namespace\n  \t\tthis.namespace = getNamespace(this);\n\n  \t\tvar node = undefined;\n  \t\tvar existing = false;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = undefined;\n  \t\t\twhile (n = occupants.shift()) {\n  \t\t\t\tif (n.nodeName === this.template.e.toUpperCase() && n.namespaceURI === this.namespace) {\n  \t\t\t\t\tthis.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode(n);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif (!node) {\n  \t\t\tnode = createElement(this.template.e, this.namespace, this.getAttribute('is'));\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tvar context = this.parentFragment.findContext();\n\n  \t\tdefineProperty(node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tractive: this.ractive,\n  \t\t\t\tfragment: this.parentFragment,\n  \t\t\t\tcontext: context,\n  \t\t\t\tkeypath: context.getKeypath(this.ractive),\n  \t\t\t\trootpath: context.getKeypath()\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif (this.parentFragment.cssIds) {\n  \t\t\tnode.setAttribute('data-ractive-css', this.parentFragment.cssIds.map(function (x) {\n  \t\t\t\treturn '{' + x + '}';\n  \t\t\t}).join(' '));\n  \t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tvar children = existing ? toArray(node.childNodes) : undefined;\n  \t\t\tthis.fragment.render(node, children);\n\n  \t\t\t// clean up leftover children\n  \t\t\tif (children) {\n  \t\t\t\tchildren.forEach(detachNode);\n  \t\t\t}\n  \t\t}\n\n  \t\tif (existing) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif (this.binding && this.binding.wasUndefined) this.binding.setFromNode(node);\n\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tvar _name = node.attributes[i].name;\n  \t\t\t\tif (!this.template.a || !(_name in this.template.a)) node.removeAttribute(_name);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach(_render);\n  \t\tthis.conditionalAttributes.forEach(_render);\n\n  \t\tif (this.decorator) runloop.scheduleTask(function () {\n  \t\t\treturn _this2.decorator.render();\n  \t\t}, true);\n  \t\tif (this.binding) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach(_render);\n\n  \t\tupdateLiveQueries$1(this);\n\n  \t\t// transitions\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t1;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar transition = new Transition(this, transitionTemplate, true);\n  \t\t\trunloop.registerTransition(transition);\n\n  \t\t\tthis._introTransition = transition; // so we can abort if it gets removed\n  \t\t}\n\n  \t\tif (!existing) {\n  \t\t\ttarget.appendChild(node);\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString() {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map(stringifyAttribute).join('') + this.conditionalAttributes.map(stringifyAttribute).join('');\n\n  \t\t// Special case - selected options\n  \t\tif (this.name === 'option' && this.isSelected()) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif (this.name === 'input' && inputIsCheckedRadio(this)) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = '<' + tagName + attrs + '>';\n\n  \t\tif (this.isVoid) return str;\n\n  \t\t// Special case - textarea\n  \t\tif (this.name === 'textarea' && this.getAttribute('value') !== undefined) {\n  \t\t\tstr += escapeHtml(this.getAttribute('value'));\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if (this.getAttribute('contenteditable') !== undefined) {\n  \t\t\t\tstr += this.getAttribute('value') || '';\n  \t\t\t}\n\n  \t\tif (this.fragment) {\n  \t\t\tstr += this.fragment.toString(!/^(?:script|style)$/i.test(this.template.e)); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += '</' + tagName + '>';\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind() {\n  \t\tthis.attributes.forEach(_unbind);\n  \t\tthis.conditionalAttributes.forEach(_unbind);\n\n  \t\tif (this.decorator) this.decorator.unbind();\n  \t\tif (this.fragment) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (!this.rendered) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif (transition) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif (this.name === 'option') {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if (shouldDestroy) {\n  \t\t\trunloop.detachWhenReady(this);\n  \t\t}\n\n  \t\tif (this.fragment) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach(_unrender);\n\n  \t\tif (this.binding) this.binding.unrender();\n  \t\tif (!shouldDestroy && this.decorator) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tvar transitionTemplate = this.template.t0 || this.template.t2;\n  \t\tif (transitionTemplate && this.ractive.transitionsEnabled) {\n  \t\t\tvar _transition = new Transition(this, transitionTemplate, false);\n  \t\t\trunloop.registerTransition(_transition);\n  \t\t}\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif (id) {\n  \t\t\tdelete this.ractive.nodes[id.getValue()];\n  \t\t}\n\n  \t\tremoveFromLiveQueries(this);\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.attributes.forEach(_update);\n  \t\t\tthis.conditionalAttributes.forEach(_update);\n  \t\t\tthis.eventHandlers.forEach(_update);\n\n  \t\t\tif (this.decorator) this.decorator.update();\n  \t\t\tif (this.fragment) this.fragment.update();\n\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \treturn Element;\n  })(Item);\n\n  function inputIsCheckedRadio(element) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute = attributes.name;\n\n  \tif (!typeAttribute || typeAttribute.value !== 'radio' || !valueAttribute || !nameAttribute.interpolator) {\n  \t\treturn;\n  \t}\n\n  \tif (valueAttribute.getValue() === nameAttribute.interpolator.model.get()) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute(attribute) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries(element) {\n  \tvar i = element.liveQueries.length;\n  \twhile (i--) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove(element.node);\n  \t}\n  }\n\n  function getNamespace(element) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute('xmlns');\n  \tif (xmlns) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif (element.name === 'svg') return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif (parent) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif (parent.name === 'foreignobject') return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Input = (function (_Element) {\n  \tinherits(Input, _Element);\n\n  \tfunction Input() {\n  \t\tclassCallCheck(this, Input);\n\n  \t\t_Element.apply(this, arguments);\n  \t}\n\n  \tInput.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  })(Element);\n\n  var Textarea = (function (_Input) {\n  \tinherits(Textarea, _Input);\n\n  \tfunction Textarea(options) {\n  \t\tclassCallCheck(this, Textarea);\n\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif (template.a && template.a.value && isBindable({ template: template.a.value })) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if (template.f && (!template.a || !template.a.value) && isBindable({ template: template.f })) {\n  \t\t\t\tif (!template.a) template.a = {};\n  \t\t\t\ttemplate.a.value = template.f;\n  \t\t\t\toptions.noContent = true;\n  \t\t\t}\n\n  \t\t_Input.call(this, options);\n  \t}\n\n  \tTextarea.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered && !this.binding && this.fragment) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t\t_this.node.value = _this.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  })(Input);\n\n  function valueContains(selectValue, optionValue) {\n  \tvar i = selectValue.length;\n  \twhile (i--) {\n  \t\tif (selectValue[i] == optionValue) return true;\n  \t}\n  }\n\n  var Select = (function (_Element) {\n  \tinherits(Select, _Element);\n\n  \tfunction Select(options) {\n  \t\tclassCallCheck(this, Select);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype.bubble = function bubble() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.rendered) {\n  \t\t\t\trunloop.scheduleTask(function () {\n  \t\t\t\t\t_this.sync();\n  \t\t\t\t\t_this.dirty = false;\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile (i--) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync() {\n  \t\tvar selectNode = this.node;\n\n  \t\tif (!selectNode) return;\n\n  \t\tvar options = toArray(selectNode.options);\n\n  \t\tvar selectValue = this.getAttribute('value');\n  \t\tvar isMultiple = this.getAttribute('multiple');\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif (selectValue !== undefined) {\n  \t\t\tvar optionWasSelected = undefined;\n\n  \t\t\toptions.forEach(function (o) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains(selectValue, optionValue) : selectValue == optionValue;\n\n  \t\t\t\tif (shouldSelect) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif (!optionWasSelected && !isMultiple) {\n  \t\t\t\tif (options[0]) {\n  \t\t\t\t\toptions[0].selected = true;\n  \t\t\t\t}\n\n  \t\t\t\tif (this.binding) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if (this.binding) {\n  \t\t\t\tthis.binding.forceUpdate();\n  \t\t\t}\n  \t};\n\n  \tSelect.prototype.update = function update() {\n  \t\t_Element.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  })(Element);\n\n  function findParentSelect(element) {\n  \twhile (element) {\n  \t\tif (element.name === 'select') return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (_Element) {\n  \tinherits(Option, _Element);\n\n  \tfunction Option(options) {\n  \t\tclassCallCheck(this, Option);\n\n  \t\tvar template = options.template;\n  \t\tif (!template.a) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif (template.a.value === undefined && !('disabled' in template)) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\t_Element.call(this, options);\n\n  \t\tthis.select = findParentSelect(this.parent);\n  \t}\n\n  \tOption.prototype.bind = function bind() {\n  \t\tif (!this.select) {\n  \t\t\t_Element.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif (selectedAttribute && this.select.getAttribute('value') !== undefined) {\n  \t\t\tvar index = this.attributes.indexOf(selectedAttribute);\n  \t\t\tthis.attributes.splice(index, 1);\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\t_Element.prototype.bind.call(this);\n  \t\tthis.select.options.push(this);\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected() {\n  \t\tvar optionValue = this.getAttribute('value');\n\n  \t\tif (optionValue === undefined || !this.select) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute('value');\n\n  \t\tif (selectValue == optionValue) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif (this.select.getAttribute('multiple') && isArray(selectValue)) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile (i--) {\n  \t\t\t\tif (selectValue[i] == optionValue) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind() {\n  \t\t_Element.prototype.unbind.call(this);\n\n  \t\tif (this.select) {\n  \t\t\tremoveFromArray(this.select.options, this);\n  \t\t}\n  \t};\n\n  \treturn Option;\n  })(Element);\n\n  var Form = (function (_Element) {\n  \tinherits(Form, _Element);\n\n  \tfunction Form(options) {\n  \t\tclassCallCheck(this, Form);\n\n  \t\t_Element.call(this, options);\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype.render = function render(target, occupants) {\n  \t\t_Element.prototype.render.call(this, target, occupants);\n  \t\tthis.node.addEventListener('reset', handleReset, false);\n  \t};\n\n  \tForm.prototype.unrender = function unrender() {\n  \t\tthis.node.removeEventListener('reset', handleReset, false);\n  \t};\n\n  \treturn Form;\n  })(Element);\n\n  function handleReset() {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach(updateModel);\n  \trunloop.end();\n  }\n\n  function updateModel(binding) {\n  \tbinding.model.set(binding.resetValue);\n  }\n\n  function processWrapper (wrapper, array, methodName, newIndices) {\n  \tvar __model = wrapper.__model;\n\n  \tif (newIndices) {\n  \t\t__model.shuffle(newIndices);\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = ['pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift'];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach(function (methodName) {\n  \tvar method = function () {\n  \t\tfor (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\t\targs[_key] = arguments[_key];\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices(this.length, methodName, args);\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[methodName].apply(this, arguments);\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile (i--) {\n  \t\t\tprocessWrapper(this._ractive.wrappers[i], this, methodName, newIndices);\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty(patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods = undefined;\n  var unpatchArrayMethods = undefined;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if (({}).__proto__) {\n  \t// yes, we can\n  \tpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = patchedArrayProto;\n  \t};\n  \tunpatchArrayMethods = function (array) {\n  \t\treturn array.__proto__ = Array.prototype;\n  \t};\n  } else {\n  \t// no, we can't\n  \tpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty(array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[methodName],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function (array) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile (i--) {\n  \t\t\tdelete array[mutatorMethods[i]];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function (object) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray(object) && (!object._ractive || !object._ractive.setting);\n  \t},\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new ArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  var ArrayWrapper = (function () {\n  \tfunction ArrayWrapper(ractive, array) {\n  \t\tclassCallCheck(this, ArrayWrapper);\n\n  \t\tthis.root = ractive;\n  \t\tthis.value = array;\n  \t\tthis.__model = null; // filled in later\n\n  \t\t// if this array hasn't already been ractified, ractify it\n  \t\tif (!array._ractive) {\n  \t\t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\t\tdefineProperty(array, '_ractive', {\n  \t\t\t\tvalue: {\n  \t\t\t\t\twrappers: [],\n  \t\t\t\t\tinstances: [],\n  \t\t\t\t\tsetting: false\n  \t\t\t\t},\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n\n  \t\t\tpatch(array);\n  \t\t}\n\n  \t\t// store the ractive instance, so we can handle transitions later\n  \t\tif (!array._ractive.instances[ractive._guid]) {\n  \t\t\tarray._ractive.instances[ractive._guid] = 0;\n  \t\t\tarray._ractive.instances.push(ractive);\n  \t\t}\n\n  \t\tarray._ractive.instances[ractive._guid] += 1;\n  \t\tarray._ractive.wrappers.push(this);\n  \t}\n\n  \tArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tArrayWrapper.prototype.teardown = function teardown() {\n  \t\tvar array, storage, wrappers, instances, index;\n\n  \t\tarray = this.value;\n  \t\tstorage = array._ractive;\n  \t\twrappers = storage.wrappers;\n  \t\tinstances = storage.instances;\n\n  \t\t// if teardown() was invoked because we're clearing the cache as a result of\n  \t\t// a change that the array itself triggered, we can save ourselves the teardown\n  \t\t// and immediate setup\n  \t\tif (storage.setting) {\n  \t\t\treturn false; // so that we don't remove it from cached wrappers\n  \t\t}\n\n  \t\tindex = wrappers.indexOf(this);\n  \t\tif (index === -1) {\n  \t\t\tthrow new Error(errorMessage);\n  \t\t}\n\n  \t\twrappers.splice(index, 1);\n\n  \t\t// if nothing else depends on this array, we can revert it to its\n  \t\t// natural state\n  \t\tif (!wrappers.length) {\n  \t\t\tdelete array._ractive;\n  \t\t\tpatch.unpatch(this.value);\n  \t\t} else {\n  \t\t\t// remove ractive instance if possible\n  \t\t\tinstances[this.root._guid] -= 1;\n  \t\t\tif (!instances[this.root._guid]) {\n  \t\t\t\tindex = instances.indexOf(this.root);\n\n  \t\t\t\tif (index === -1) {\n  \t\t\t\t\tthrow new Error(errorMessage);\n  \t\t\t\t}\n\n  \t\t\t\tinstances.splice(index, 1);\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ArrayWrapper;\n  })();\n\n  var magicAdaptor = undefined;\n\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function (value) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function (ractive, value, keypath) {\n  \t\t\treturn new MagicWrapper(ractive, value, keypath);\n  \t\t}\n  \t};\n  } catch (err) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor(originalDescriptor, ractive, keypath) {\n  \tif (originalDescriptor.set && originalDescriptor.set.__magic) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting = undefined;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function (value) {\n  \t\t\tif (setting) return;\n\n  \t\t\tif ('value' in originalDescriptor) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set(value);\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach(function (_ref) {\n  \t\t\t\tvar ractive = _ref.ractive;\n  \t\t\t\tvar keypath = _ref.keypath;\n\n  \t\t\t\tractive.set(keypath, value);\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert(descriptor, ractive, keypath) {\n  \tif (!descriptor.set || !descriptor.set.__magic) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile (i--) {\n  \t\tvar dependant = dependants[i];\n  \t\tif (dependant.ractive === ractive && dependant.keypath === keypath) {\n  \t\t\tdependants.splice(i, 1);\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = (function () {\n  \tfunction MagicWrapper(ractive, value, keypath) {\n  \t\tvar _this = this;\n\n  \t\tclassCallCheck(this, MagicWrapper);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.value = value;\n  \t\tthis.keypath = keypath;\n\n  \t\tthis.originalDescriptors = {};\n\n  \t\t// wrap all properties with getters\n  \t\tObject.keys(value).forEach(function (key) {\n  \t\t\tvar originalDescriptor = Object.getOwnPropertyDescriptor(_this.value, key);\n  \t\t\t_this.originalDescriptors[key] = originalDescriptor;\n\n  \t\t\tvar childKeypath = keypath ? keypath + '.' + escapeKey(key) : escapeKey(key);\n\n  \t\t\tvar descriptor = createOrWrapDescriptor(originalDescriptor, ractive, childKeypath);\n\n  \t\t\tObject.defineProperty(_this.value, key, descriptor);\n  \t\t});\n  \t}\n\n  \tMagicWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicWrapper.prototype.reset = function reset() {\n  \t\tthrow new Error('TODO magic adaptor reset'); // does this ever happen?\n  \t};\n\n  \tMagicWrapper.prototype.set = function set(key, value) {\n  \t\tthis.value[key] = value;\n  \t};\n\n  \tMagicWrapper.prototype.teardown = function teardown() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.value).forEach(function (key) {\n  \t\t\tvar descriptor = Object.getOwnPropertyDescriptor(_this2.value, key);\n  \t\t\tif (!descriptor.set || !descriptor.set.__magic) return;\n\n  \t\t\trevert(descriptor);\n\n  \t\t\tif (descriptor.set.__magic.dependants.length === 1) {\n  \t\t\t\tObject.defineProperty(_this2.value, key, descriptor.set.__magic.originalDescriptor);\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \treturn MagicWrapper;\n  })();\n\n  var MagicArrayWrapper = (function () {\n  \tfunction MagicArrayWrapper(ractive, array, keypath) {\n  \t\tclassCallCheck(this, MagicArrayWrapper);\n\n  \t\tthis.value = array;\n\n  \t\tthis.magic = true;\n\n  \t\tthis.magicWrapper = magicAdaptor$1.wrap(ractive, array, keypath);\n  \t\tthis.arrayWrapper = arrayAdaptor.wrap(ractive, array, keypath);\n\n  \t\t// ugh, this really is a terrible hack\n  \t\tObject.defineProperty(this, '__model', {\n  \t\t\tget: function () {\n  \t\t\t\treturn this.arrayWrapper.__model;\n  \t\t\t},\n  \t\t\tset: function (model) {\n  \t\t\t\tthis.arrayWrapper.__model = model;\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \tMagicArrayWrapper.prototype.get = function get() {\n  \t\treturn this.value;\n  \t};\n\n  \tMagicArrayWrapper.prototype.teardown = function teardown() {\n  \t\tthis.arrayWrapper.teardown();\n  \t\tthis.magicWrapper.teardown();\n  \t};\n\n  \tMagicArrayWrapper.prototype.reset = function reset(value) {\n  \t\treturn this.magicWrapper.reset(value);\n  \t};\n\n  \treturn MagicArrayWrapper;\n  })();\n\n  var magicArrayAdaptor = {\n  \tfilter: function (object, keypath, ractive) {\n  \t\treturn magicAdaptor$1.filter(object, keypath, ractive) && arrayAdaptor.filter(object);\n  \t},\n\n  \twrap: function (ractive, array, keypath) {\n  \t\treturn new MagicArrayWrapper(ractive, array, keypath);\n  \t}\n  };\n\n  function validate(data) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif (data && data.constructor !== Object) {\n  \t\tif (typeof data === 'function') {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if (typeof data !== 'object') {\n  \t\t\t\tfatal('data option must be an object or a function, `' + data + '` is not valid');\n  \t\t\t} else {\n  \t\t\t\twarnIfDebug('If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged');\n  \t\t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function (Parent, proto, options) {\n  \t\tvar key = undefined;\n  \t\tvar value = undefined;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif (options.data && isObject(options.data)) {\n  \t\t\tfor (key in options.data) {\n  \t\t\t\tvalue = options.data[key];\n\n  \t\t\t\tif (value && typeof value === 'object') {\n  \t\t\t\t\tif (isObject(value) || isArray(value)) {\n  \t\t\t\t\t\twarnIfDebug('Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }');\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1(proto.data, options.data);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\tvar result = combine$1(Parent.prototype.data, options.data);\n\n  \t\tif (typeof result === 'function') result = result.call(ractive);\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif (result && result.constructor === Object) {\n  \t\t\tfor (var prop in result) {\n  \t\t\t\tif (typeof result[prop] === 'function') result[prop] = bind(result[prop], ractive);\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function (ractive) {\n  \t\tvar result = this.init(ractive.constructor, ractive, ractive.viewmodel);\n  \t\tractive.viewmodel.root.set(result);\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1(parentValue, childValue) {\n  \tvalidate(childValue);\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif (!childValue && !parentIsFn) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif (!parentIsFn && !childIsFn) {\n  \t\treturn fromProperties(childValue, parentValue);\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction(childValue, this) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction(parentValue, this) : parentValue;\n\n  \t\treturn fromProperties(child, parent);\n  \t};\n  }\n\n  function callDataFunction(fn, context) {\n  \tvar data = fn.call(context);\n\n  \tif (!data) return;\n\n  \tif (typeof data !== 'object') {\n  \t\tfatal('Data function must return an object');\n  \t}\n\n  \tif (data.constructor !== Object) {\n  \t\twarnOnceIfDebug('Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged');\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties(primary, secondary) {\n  \tif (primary && secondary) {\n  \t\tfor (var key in secondary) {\n  \t\t\tif (!(key in primary)) {\n  \t\t\t\tprimary[key] = secondary[key];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify(fnBody) {\n  \tvar lines = fnBody.replace(/^\\t+/gm, function (tabs) {\n  \t\treturn tabs.split('\\t').join('  ');\n  \t}).split('\\n');\n\n  \tvar minIndent = lines.length < 2 ? 0 : lines.slice(1).reduce(function (prev, line) {\n  \t\treturn Math.min(prev, /^\\s*/.exec(line)[0].length);\n  \t}, Infinity);\n\n  \treturn lines.map(function (line, i) {\n  \t\treturn '    ' + (i ? line.substring(minIndent) : line);\n  \t}).join('\\n');\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack(stack) {\n  \tif (!stack) return '';\n\n  \tvar lines = stack.split('\\n');\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor (var i = 1; i < len; i += 1) {\n  \t\tvar line = lines[i];\n\n  \t\tif (~line.indexOf(name)) {\n  \t\t\treturn truncated.join('\\n');\n  \t\t} else {\n  \t\t\ttruncated.push(line);\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (_Model) {\n  \tinherits(Computation, _Model);\n\n  \tfunction Computation(viewmodel, signature, key) {\n  \t\tclassCallCheck(this, Computation);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n  \t\tthis.key = key; // not actually used, but helps with debugging\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n\n  \t\t// TODO: computations don't shuffle, but this is a bit hackish\n  \t\tthis.shuffle = undefined;\n  \t}\n\n  \tComputation.prototype.get = function get(shouldCapture) {\n  \t\tif (shouldCapture) capture(this);\n\n  \t\tif (this.dirty) {\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t\tthis.dirty = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue() {\n  \t\tstartCapturing();\n  \t\tvar result = undefined;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call(this.context);\n  \t\t} catch (err) {\n  \t\t\twarnIfDebug('Failed to compute ' + this.getKeypath() + ': ' + (err.message || err));\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif (console.groupCollapsed) console.groupCollapsed('%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;');\n  \t\t\tvar functionBody = prettify(this.signature.getterString);\n  \t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack(err.stack) : '';\n  \t\t\tconsole.error(err.name + ': ' + err.message + '\\n\\n' + functionBody + stack);\n  \t\t\tif (console.groupCollapsed) console.groupEnd();\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies(dependencies);\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange() {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_handleChange);\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === undefined || key === '') return this;\n\n  \t\tif (!this.childByKey.hasOwnProperty(key)) {\n  \t\t\tvar child = new ComputationChild(this, key);\n  \t\t\tthis.children.push(child);\n  \t\t\tthis.childByKey[key] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[key];\n  \t};\n\n  \tComputation.prototype.mark = function mark() {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set(value) {\n  \t\tif (!this.signature.setter) {\n  \t\t\tthrow new Error('Cannot set read-only computed value \\'' + this.key + '\\'');\n  \t\t}\n\n  \t\tthis.signature.setter(value);\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies(dependencies) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar i = this.dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = this.dependencies[i];\n  \t\t\tif (! ~dependencies.indexOf(model)) model.unregister(this);\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile (i--) {\n  \t\t\tvar model = dependencies[i];\n  \t\t\tif (! ~this.dependencies.indexOf(model)) model.register(this);\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \treturn Computation;\n  })(Model);\n\n  var RactiveModel = (function (_Model) {\n  \tinherits(RactiveModel, _Model);\n\n  \tfunction RactiveModel(ractive) {\n  \t\tclassCallCheck(this, RactiveModel);\n\n  \t\t_Model.call(this, null, '');\n  \t\tthis.value = ractive;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.ractive = ractive;\n  \t\tthis.changes = {};\n  \t}\n\n  \tRactiveModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@ractive';\n  \t};\n\n  \treturn RactiveModel;\n  })(Model);\n\n  var RootModel = (function (_Model) {\n  \tinherits(RootModel, _Model);\n\n  \tfunction RootModel(options) {\n  \t\tclassCallCheck(this, RootModel);\n\n  \t\t_Model.call(this, null, null);\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype.applyChanges = function applyChanges() {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute(key, signature) {\n  \t\tvar computation = new Computation(this, signature, key);\n  \t\tthis.computations[key] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.get = function get(shouldCapture) {\n  \t\tvar _this = this;\n\n  \t\tif (shouldCapture) capture(this);\n  \t\tvar result = extend({}, this.value);\n\n  \t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\tresult[key] = _this.mappings[key].value;\n  \t\t});\n\n  \t\tObject.keys(this.computations).forEach(function (key) {\n  \t\t\tif (key[0] !== '@') {\n  \t\t\t\t// exclude template expressions\n  \t\t\t\tresult[key] = _this.computations[key].value;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.getRactiveModel = function getRactiveModel() {\n  \t\treturn this.ractiveModel || (this.ractiveModel = new RactiveModel(this.ractive));\n  \t};\n\n  \tRootModel.prototype.has = function has(key) {\n  \t\treturn key in this.mappings || key in this.computations || _Model.prototype.has.call(this, key);\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey(key) {\n  \t\tif (key === '@global') return GlobalModel$1;\n  \t\tif (key === '@ractive') return this.getRactiveModel();\n\n  \t\treturn this.mappings.hasOwnProperty(key) ? this.mappings[key] : this.computations.hasOwnProperty(key) ? this.computations[key] : _Model.prototype.joinKey.call(this, key);\n  \t};\n\n  \tRootModel.prototype.map = function map(localKey, origin) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[localKey] = origin;\n  \t};\n\n  \tRootModel.prototype.set = function set(value) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif (wrapper) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset(value) === false;\n\n  \t\t\tif (shouldTeardown) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach(_handleChange);\n  \t\tthis.children.forEach(_mark);\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve() {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings(cascade) {\n  \t\tvar _this2 = this;\n\n  \t\t_Model.prototype.updateFromBindings.call(this, cascade);\n\n  \t\tif (cascade) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys(this.mappings).forEach(function (key) {\n  \t\t\t\tvar model = _this2.mappings[key];\n  \t\t\t\tmodel.updateFromBindings(cascade);\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  })(Model);\n\n  function getComputationSignature(ractive, key, signature) {\n  \tvar getter = undefined;\n  \tvar setter = undefined;\n\n  \t// useful for debugging\n  \tvar getterString = undefined;\n  \tvar getterUseStack = undefined;\n  \tvar setterString = undefined;\n\n  \tif (typeof signature === 'function') {\n  \t\tgetter = bind(signature, ractive);\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif (typeof signature === 'string') {\n  \t\tgetter = createFunctionFromString(signature, ractive);\n  \t\tgetterString = signature;\n  \t}\n\n  \tif (typeof signature === 'object') {\n  \t\tif (typeof signature.get === 'string') {\n  \t\t\tgetter = createFunctionFromString(signature.get, ractive);\n  \t\t\tgetterString = signature.get;\n  \t\t} else if (typeof signature.get === 'function') {\n  \t\t\tgetter = bind(signature.get, ractive);\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal('`%s` computation must have a `get()` method', key);\n  \t\t}\n\n  \t\tif (typeof signature.set === 'function') {\n  \t\t\tsetter = bind(signature.set, ractive);\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook('construct');\n\n  var registryNames = ['adaptors', 'components', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var uid = 0;\n  function construct(ractive, options) {\n  \tif (Ractive.DEBUG) welcome();\n\n  \tinitialiseProperties(ractive);\n\n  \t// TODO remove this, eventually\n  \tdefineProperty(ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire(ractive, options);\n\n  \t// Add registries\n  \tregistryNames.forEach(function (name) {\n  \t\tractive[name] = extend(create(ractive.constructor[name] || null), options[name]);\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors(ractive, ractive.adapt, options),\n  \t\tdata: dataConfigurator.init(ractive.constructor, ractive, options),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extend(create(ractive.constructor.prototype.computed), options.computed);\n\n  \tfor (var key in computed) {\n  \t\tvar signature = getComputationSignature(ractive, key, computed[key]);\n  \t\tviewmodel.compute(key, signature);\n  \t}\n  }\n\n  function combine(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors(ractive, protoAdapt, options) {\n  \tprotoAdapt = protoAdapt.map(lookup);\n  \tvar adapt = ensureArray(options.adapt).map(lookup);\n\n  \tadapt = combine(protoAdapt, adapt);\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif (magic) {\n  \t\tif (!magicSupported) {\n  \t\t\tthrow new Error('Getters and setters (magic mode) are not supported in this browser');\n  \t\t}\n\n  \t\tif (modifyArrays) {\n  \t\t\tadapt.push(magicArrayAdaptor);\n  \t\t}\n\n  \t\tadapt.push(magicAdaptor$1);\n  \t}\n\n  \tif (modifyArrays) {\n  \t\tadapt.push(arrayAdaptor);\n  \t}\n\n  \treturn adapt;\n\n  \tfunction lookup(adaptor) {\n  \t\tif (typeof adaptor === 'string') {\n  \t\t\tadaptor = findInViewHierarchy('adaptors', ractive, adaptor);\n\n  \t\t\tif (!adaptor) {\n  \t\t\t\tfatal(missingPlugin(adaptor, 'adaptor'));\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties(ractive) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create(null);\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// links\n  \tractive._links = {};\n\n  \tif (!ractive.component) {\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n  }\n\n  function deprecateRactiveData() {\n  \tthrow new Error('Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead');\n  }\n\n  function getChildQueue(queue, ractive) {\n  \treturn queue[ractive._guid] || (queue[ractive._guid] = []);\n  }\n\n  function fire(hookQueue, ractive) {\n  \tvar childQueue = getChildQueue(hookQueue.queue, ractive);\n\n  \thookQueue.hook.fire(ractive);\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile (childQueue.length) {\n  \t\tfire(hookQueue, childQueue.shift());\n  \t}\n\n  \tdelete hookQueue.queue[ractive._guid];\n  }\n\n  var HookQueue = (function () {\n  \tfunction HookQueue(event) {\n  \t\tclassCallCheck(this, HookQueue);\n\n  \t\tthis.hook = new Hook(event);\n  \t\tthis.inProcess = {};\n  \t\tthis.queue = {};\n  \t}\n\n  \tHookQueue.prototype.begin = function begin(ractive) {\n  \t\tthis.inProcess[ractive._guid] = true;\n  \t};\n\n  \tHookQueue.prototype.end = function end(ractive) {\n  \t\tvar parent = ractive.parent;\n\n  \t\t// If this is *isn't* a child of a component that's in process,\n  \t\t// it should call methods or fire at this point\n  \t\tif (!parent || !this.inProcess[parent._guid]) {\n  \t\t\tfire(this, ractive);\n  \t\t}\n  \t\t// elsewise, handoff to parent to fire when ready\n  \t\telse {\n  \t\t\t\tgetChildQueue(this.queue, parent).push(ractive);\n  \t\t\t}\n\n  \t\tdelete this.inProcess[ractive._guid];\n  \t};\n\n  \treturn HookQueue;\n  })();\n\n  var css;\n  var update;\n  var styleElement;\n  var head;\n  var styleSheet;\n  var inDom;\n  var prefix = '/* Ractive.js component styles */\\n';\n  var styles = [];\n  var dirty = false;\n  if (!doc) {\n  \t// TODO handle encapsulated CSS in server-rendered HTML!\n  \tcss = {\n  \t\tadd: noop,\n  \t\tapply: noop\n  \t};\n  } else {\n  \tstyleElement = doc.createElement('style');\n  \tstyleElement.type = 'text/css';\n\n  \thead = doc.getElementsByTagName('head')[0];\n\n  \tinDom = false;\n\n  \t// Internet Exploder won't let you use styleSheet.innerHTML - we have to\n  \t// use styleSheet.cssText instead\n  \tstyleSheet = styleElement.styleSheet;\n\n  \tupdate = function () {\n  \t\tvar css = prefix + styles.map(function (s) {\n  \t\t\treturn '\\n/* {' + s.id + '} */\\n' + s.styles;\n  \t\t}).join('\\n');\n\n  \t\tif (styleSheet) {\n  \t\t\tstyleSheet.cssText = css;\n  \t\t} else {\n  \t\t\tstyleElement.innerHTML = css;\n  \t\t}\n\n  \t\tif (!inDom) {\n  \t\t\thead.appendChild(styleElement);\n  \t\t\tinDom = true;\n  \t\t}\n  \t};\n\n  \tcss = {\n  \t\tadd: function (s) {\n  \t\t\tstyles.push(s);\n  \t\t\tdirty = true;\n  \t\t},\n\n  \t\tapply: function () {\n  \t\t\tif (dirty) {\n  \t\t\t\tupdate();\n  \t\t\t\tdirty = false;\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  var css$1 = css;\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?:::?[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1(str) {\n  \treturn str.trim();\n  }\n\n  function extractString(unit) {\n  \treturn unit.str;\n  }\n\n  function transformSelector(selector, parent) {\n  \tvar selectorUnits = [];\n  \tvar match = undefined;\n\n  \twhile (match = selectorUnitPattern.exec(selector)) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map(extractString);\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile (i--) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push(appended.join(' '), prepended.join(' '));\n  \t}\n\n  \treturn transformed.join(', ');\n  }\n  function transformCss(css, id) {\n  \tvar dataAttr = '[data-ractive-css~=\"{' + id + '}\"]';\n\n  \tvar transformed = undefined;\n\n  \tif (dataRvcGuidPattern.test(css)) {\n  \t\ttransformed = css.replace(dataRvcGuidPattern, dataAttr);\n  \t} else {\n  \t\ttransformed = css.replace(commentsPattern, '').replace(selectorsPattern, function (match, $1) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif (excludePattern.test($1)) return match;\n\n  \t\t\tvar selectors = $1.split(',').map(trim$1);\n  \t\t\tvar transformed = selectors.map(function (selector) {\n  \t\t\t\treturn transformSelector(selector, dataAttr);\n  \t\t\t}).join(', ') + ' ';\n\n  \t\t\treturn match.replace($1, transformed);\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  var uid$1 = 1;\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \textend: function (Parent, proto, options) {\n  \t\tif (options.css) {\n  \t\t\tvar id = uid$1++;\n  \t\t\tvar styles = options.noCssTransform ? options.css : transformCss(options.css, id);\n\n  \t\t\tproto.cssId = id;\n  \t\t\tcss$1.add({ id: id, styles: styles });\n  \t\t}\n  \t},\n\n  \tinit: function () {}\n  };\n\n  var adaptConfigurator = {\n  \textend: function (Parent, proto, options) {\n  \t\tproto.adapt = combine$2(proto.adapt, ensureArray(options.adapt));\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine$2(a, b) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile (i--) {\n  \t\tif (! ~c.indexOf(b[i])) {\n  \t\t\tc.push(b[i]);\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var registryNames$1 = ['adaptors', 'components', 'computed', 'decorators', 'easing', 'events', 'interpolators', 'partials', 'transitions'];\n\n  var Registry = (function () {\n  \tfunction Registry(name, useDefaults) {\n  \t\tclassCallCheck(this, Registry);\n\n  \t\tthis.name = name;\n  \t\tthis.useDefaults = useDefaults;\n  \t}\n\n  \tRegistry.prototype.extend = function extend(Parent, proto, options) {\n  \t\tthis.configure(this.useDefaults ? Parent.defaults : Parent, this.useDefaults ? proto : proto.constructor, options);\n  \t};\n\n  \tRegistry.prototype.init = function init() {\n  \t\t// noop\n  \t};\n\n  \tRegistry.prototype.configure = function configure(Parent, target, options) {\n  \t\tvar name = this.name;\n  \t\tvar option = options[name];\n\n  \t\tvar registry = create(Parent[name]);\n\n  \t\tfor (var key in option) {\n  \t\t\tregistry[key] = option[key];\n  \t\t}\n\n  \t\ttarget[name] = registry;\n  \t};\n\n  \tRegistry.prototype.reset = function reset(ractive) {\n  \t\tvar registry = ractive[this.name];\n  \t\tvar changed = false;\n\n  \t\tObject.keys(registry).forEach(function (key) {\n  \t\t\tvar item = registry[key];\n\n  \t\t\tif (item._fn) {\n  \t\t\t\tif (item._fn.isOwner) {\n  \t\t\t\t\tregistry[key] = item._fn;\n  \t\t\t\t} else {\n  \t\t\t\t\tdelete registry[key];\n  \t\t\t\t}\n  \t\t\t\tchanged = true;\n  \t\t\t}\n  \t\t});\n\n  \t\treturn changed;\n  \t};\n\n  \treturn Registry;\n  })();\n\n  var registries = registryNames$1.map(function (name) {\n  \treturn new Registry(name, name === 'computed');\n  });\n\n  function wrap(parent, name, method) {\n  \tif (!/_super/.test(method)) return method;\n\n  \tfunction wrapper() {\n  \t\tvar superMethod = getSuperMethod(wrapper._parent, name);\n  \t\tvar hasSuper = ('_super' in this);\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply(this, arguments);\n\n  \t\tif (hasSuper) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod(parent, name) {\n  \tif (name in parent) {\n  \t\tvar _ret = (function () {\n  \t\t\tvar value = parent[name];\n\n  \t\t\treturn {\n  \t\t\t\tv: typeof value === 'function' ? value : function () {\n  \t\t\t\t\treturn value;\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage(deprecated, correct, isError) {\n  \treturn 'options.' + deprecated + ' has been deprecated in favour of options.' + correct + '.' + (isError ? ' You cannot specify both options, please use options.' + correct + '.' : '');\n  }\n\n  function deprecateOption(options, deprecatedOption, correct) {\n  \tif (deprecatedOption in options) {\n  \t\tif (!(correct in options)) {\n  \t\t\twarnIfDebug(getMessage(deprecatedOption, correct));\n  \t\t\toptions[correct] = options[deprecatedOption];\n  \t\t} else {\n  \t\t\tthrow new Error(getMessage(deprecatedOption, correct, true));\n  \t\t}\n  \t}\n  }\n  function deprecate(options) {\n  \tdeprecateOption(options, 'beforeInit', 'onconstruct');\n  \tdeprecateOption(options, 'init', 'onrender');\n  \tdeprecateOption(options, 'complete', 'oncomplete');\n  \tdeprecateOption(options, 'eventDefinitions', 'events');\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif (isArray(options.adaptors)) {\n  \t\tdeprecateOption(options, 'adaptors', 'adapt');\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys(defaults);\n\n  var isStandardKey = makeObj(defaultKeys.filter(function (key) {\n  \treturn !custom[key];\n  }));\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj(defaultKeys.concat(registries.map(function (r) {\n  \treturn r.name;\n  })));\n\n  var order = [].concat(defaultKeys.filter(function (key) {\n  \treturn !registries[key] && !custom[key];\n  }), registries,\n  //custom.data,\n  custom.template, custom.css);\n\n  var config = {\n  \textend: function (Parent, proto, options) {\n  \t\treturn configure('extend', Parent, proto, options);\n  \t},\n\n  \tinit: function (Parent, ractive, options) {\n  \t\treturn configure('init', Parent, ractive, options);\n  \t},\n\n  \treset: function (ractive) {\n  \t\treturn order.filter(function (c) {\n  \t\t\treturn c.reset && c.reset(ractive);\n  \t\t}).map(function (c) {\n  \t\t\treturn c.name;\n  \t\t});\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure(method, Parent, target, options) {\n  \tdeprecate(options);\n\n  \tfor (var key in options) {\n  \t\tif (isStandardKey.hasOwnProperty(key)) {\n  \t\t\tvar value = options[key];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif (key !== 'el' && typeof value === 'function') {\n  \t\t\t\twarnIfDebug(key + ' is a Ractive option that does not expect a function and will be ignored', method === 'init' ? target : null);\n  \t\t\t} else {\n  \t\t\t\ttarget[key] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif (options.append && options.enhance) {\n  \t\tthrow new Error('Cannot use append and enhance at the same time');\n  \t}\n\n  \tregistries.forEach(function (registry) {\n  \t\tregistry[method](Parent, target, options);\n  \t});\n\n  \tadaptConfigurator[method](Parent, target, options);\n  \ttemplateConfigurator[method](Parent, target, options);\n  \tcssConfigurator[method](Parent, target, options);\n\n  \textendOtherMethods(Parent.prototype, target, options);\n  }\n\n  function extendOtherMethods(parent, target, options) {\n  \tfor (var key in options) {\n  \t\tif (!isBlacklisted[key] && options.hasOwnProperty(key)) {\n  \t\t\tvar member = options[key];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif (typeof member === 'function') {\n  \t\t\t\tmember = wrap(parent, key, member);\n  \t\t\t}\n\n  \t\t\ttarget[key] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj(array) {\n  \tvar obj = {};\n  \tarray.forEach(function (x) {\n  \t\treturn obj[x] = true;\n  \t});\n  \treturn obj;\n  }\n\n  var configHook = new Hook('config');\n  var initHook = new HookQueue('init');\n  function initialise(ractive, userOptions, options) {\n  \tObject.keys(ractive.viewmodel.computations).forEach(function (key) {\n  \t\tvar computation = ractive.viewmodel.computations[key];\n\n  \t\tif (ractive.viewmodel.value.hasOwnProperty(key)) {\n  \t\t\tcomputation.set(ractive.viewmodel.value[key]);\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init(ractive.constructor, ractive, userOptions);\n\n  \tconfigHook.fire(ractive);\n  \tinitHook.begin(ractive);\n\n  \tvar fragment = undefined;\n\n  \t// Render virtual DOM\n  \tif (ractive.template) {\n  \t\tvar cssIds = undefined;\n\n  \t\tif (options.cssIds || ractive.cssId) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif (ractive.cssId) {\n  \t\t\t\tcssIds.push(ractive.cssId);\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds,\n  \t\t\tindexRefs: options.indexRefs || {},\n  \t\t\tkeyRefs: options.keyRefs || {}\n  \t\t}).bind(ractive.viewmodel);\n  \t}\n\n  \tinitHook.end(ractive);\n\n  \tif (fragment) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement(ractive.el);\n  \t\tif (el) {\n  \t\t\tvar promise = ractive.render(el, ractive.append);\n\n  \t\t\tif (Ractive.DEBUG_PROMISES) {\n  \t\t\t\tpromise['catch'](function (err) {\n  \t\t\t\t\twarnOnceIfDebug('Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;');\n  \t\t\t\t\twarnIfDebug('An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\terr.stack && logIfDebug(err.stack);\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var renderHook$1 = new Hook('render');\n  var completeHook$1 = new Hook('complete');\n  function render(ractive, target, anchor, occupants) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif (ractive.noIntro) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start(ractive, true);\n  \trunloop.scheduleTask(function () {\n  \t\treturn renderHook$1.fire(ractive);\n  \t}, true);\n\n  \tif (ractive.fragment.rendered) {\n  \t\tthrow new Error('You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first');\n  \t}\n\n  \tanchor = getElement(anchor) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif (ractive.cssId) css$1.apply();\n\n  \tif (target) {\n  \t\t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(ractive);\n\n  \t\tif (anchor) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render(docFrag);\n  \t\t\ttarget.insertBefore(docFrag, anchor);\n  \t\t} else {\n  \t\t\tractive.fragment.render(target, occupants);\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then(function () {\n  \t\treturn completeHook$1.fire(ractive);\n  \t});\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function (message) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function (str, options) {\n  \tvar items,\n  \t    item,\n  \t    lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split('\\n');\n  \tthis.lineEnds = this.lines.map(function (line) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0);\n\n  \t// Custom init logic\n  \tif (this.init) this.init(str, options);\n\n  \titems = [];\n\n  \twhile (this.pos < this.str.length && (item = this.read())) {\n  \t\titems.push(item);\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess(items, options) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function (converters) {\n  \t\tvar pos, i, len, item;\n\n  \t\tif (!converters) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tthis.pos = pos; // reset for each attempt\n\n  \t\t\tif (item = converters[i](this)) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function (char) {\n  \t\tvar lineNum = 0,\n  \t\t    lineStart = 0,\n  \t\t    columnNum;\n\n  \t\twhile (char >= this.lineEnds[lineNum]) {\n  \t\t\tlineStart = this.lineEnds[lineNum];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [lineNum + 1, columnNum + 1, char]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function (message) {\n  \t\tvar pos = this.getLinePos(this.pos);\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[pos[0] - 1];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace(/\\t/g, function (match, char) {\n  \t\t\tif (char < pos[1]) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array(pos[1] + numTabs).join(' ') + '^----';\n\n  \t\tvar error = new ParseError(message + ' at line ' + lineNum + ' character ' + columnNum + ':\\n' + annotation);\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function (string) {\n  \t\tif (this.str.substr(this.pos, string.length) === string) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function (pattern) {\n  \t\tvar match;\n\n  \t\tif (match = pattern.exec(this.remaining())) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern(leadingWhitespace);\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring(this.pos);\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt(this.pos);\n  \t}\n  };\n\n  Parser.extend = function (proto) {\n  \tvar Parent = this,\n  \t    Child,\n  \t    key;\n\n  \tChild = function (str, options) {\n  \t\tParser.call(this, str, options);\n  \t};\n\n  \tChild.prototype = create(Parent.prototype);\n\n  \tfor (key in proto) {\n  \t\tif (hasOwn.call(proto, key)) {\n  \t\t\tChild.prototype[key] = proto[key];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher (okQuote) {\n  \treturn function (parser) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next = undefined;\n\n  \t\twhile (!done) {\n  \t\t\tnext = parser.matchPattern(stringMiddlePattern) || parser.matchPattern(escapeSequencePattern) || parser.matchString(okQuote);\n  \t\t\tif (next) {\n  \t\t\t\tif (next === '\"') {\n  \t\t\t\t\tliteral += '\\\\\"';\n  \t\t\t\t} else if (next === '\\\\\\'') {\n  \t\t\t\t\tliteral += '\\'';\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern(lineContinuationPattern);\n  \t\t\t\tif (next) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ('000' + next.charCodeAt(1).toString(16)).slice(-4);\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse(literal);\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher('\"');\n  var getDoubleQuotedString = makeQuotedStringMatcher('\\'');\n\n  function readStringLiteral (parser) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif (parser.matchString('\"')) {\n  \t\tstring = getDoubleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\"')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif (parser.matchString('\\'')) {\n  \t\tstring = getSingleQuotedString(parser);\n\n  \t\tif (!parser.matchString('\\'')) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  function readNumberLiteral(parser) {\n  \tvar result;\n\n  \tif (result = parser.matchPattern(numberPattern$1)) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n\n  function readKey(parser) {\n  \tvar token;\n\n  \tif (token = readStringLiteral(parser)) {\n  \t\treturn identifier.test(token.v) ? token.v : '\"' + token.v.replace(/\"/g, '\\\\\"') + '\"';\n  \t}\n\n  \tif (token = readNumberLiteral(parser)) {\n  \t\treturn token.v;\n  \t}\n\n  \tif (token = parser.matchPattern(name)) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp('^(?:' + Object.keys(specials).join('|') + ')');\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function (str, options) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function (result) {\n  \t\tif (result.length !== 1 || !onlyWhitespace.test(this.leftover)) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [function getPlaceholder(parser) {\n  \t\tif (!parser.values) return null;\n\n  \t\tvar placeholder = parser.matchPattern(placeholderAtStartPattern);\n\n  \t\tif (placeholder && parser.values.hasOwnProperty(placeholder)) {\n  \t\t\treturn { v: parser.values[placeholder] };\n  \t\t}\n  \t}, function getSpecial(parser) {\n  \t\tvar special = parser.matchPattern(specialsPattern);\n  \t\tif (special) return { v: specials[special] };\n  \t}, function getNumber(parser) {\n  \t\tvar number = parser.matchPattern(numberPattern);\n  \t\tif (number) return { v: +number };\n  \t}, function getString(parser) {\n  \t\tvar stringLiteral = readStringLiteral(parser);\n  \t\tvar values = parser.values;\n\n  \t\tif (stringLiteral && values) {\n  \t\t\treturn {\n  \t\t\t\tv: stringLiteral.v.replace(placeholderPattern, function (match, $1) {\n  \t\t\t\t\treturn $1 in values ? values[$1] : $1;\n  \t\t\t\t})\n  \t\t\t};\n  \t\t}\n\n  \t\treturn stringLiteral;\n  \t}, function getObject(parser) {\n  \t\tif (!parser.matchString('{')) return null;\n\n  \t\tvar result = {};\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString('}')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar pair = undefined;\n  \t\twhile (pair = getKeyValuePair(parser)) {\n  \t\t\tresult[pair.key] = pair.value;\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString('}')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t}, function getArray(parser) {\n  \t\tif (!parser.matchString('[')) return null;\n\n  \t\tvar result = [];\n\n  \t\tparser.allowWhitespace();\n\n  \t\tif (parser.matchString(']')) {\n  \t\t\treturn { v: result };\n  \t\t}\n\n  \t\tvar valueToken = undefined;\n  \t\twhile (valueToken = parser.read()) {\n  \t\t\tresult.push(valueToken.v);\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif (parser.matchString(']')) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tif (!parser.matchString(',')) {\n  \t\t\t\treturn null;\n  \t\t\t}\n\n  \t\t\tparser.allowWhitespace();\n  \t\t}\n\n  \t\treturn null;\n  \t}]\n  });\n\n  function getKeyValuePair(parser) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey(parser);\n\n  \tif (!key) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif (!parser.matchString(':')) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif (!valueToken) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON (str, values) {\n  \tvar parser = new JsonParser(str, { values: values });\n  \treturn parser.result;\n  }\n\n  var RactiveEvent = (function () {\n  \tfunction RactiveEvent(ractive, name) {\n  \t\tclassCallCheck(this, RactiveEvent);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.name = name;\n  \t\tthis.handler = null;\n  \t}\n\n  \tRactiveEvent.prototype.listen = function listen(directive) {\n  \t\tvar ractive = this.ractive;\n\n  \t\tthis.handler = ractive.on(this.name, function () {\n  \t\t\tvar event = undefined;\n\n  \t\t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\t\tif (arguments.length && arguments[0] && arguments[0].node) {\n  \t\t\t\tevent = Array.prototype.shift.call(arguments);\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n\n  \t\t\tvar args = Array.prototype.slice.call(arguments);\n  \t\t\tdirective.fire(event, args);\n\n  \t\t\t// cancel bubbling\n  \t\t\treturn false;\n  \t\t});\n  \t};\n\n  \tRactiveEvent.prototype.unlisten = function unlisten() {\n  \t\tthis.handler.cancel();\n  \t};\n\n  \treturn RactiveEvent;\n  })();\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n\n  function updateLiveQueries(component) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile (i--) {\n  \t\t\tvar _name = liveQueries[i];\n  \t\t\tvar query = liveQueries[\"_\" + _name];\n\n  \t\t\tif (query.test(component)) {\n  \t\t\t\tquery.add(component.instance);\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n  \t} while (instance = instance.parent);\n  }\n\n  function removeFromLiveComponentQueries(component) {\n  \tvar instance = component.ractive;\n\n  \twhile (instance) {\n  \t\tvar query = instance._liveComponentQueries['_' + component.name];\n  \t\tif (query) query.remove(component);\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty(query) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook$1 = new Hook('teardown');\n\n  var Component = (function (_Item) {\n  \tinherits(Component, _Item);\n\n  \tfunction Component(options, ComponentConstructor) {\n  \t\tclassCallCheck(this, Component);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create(ComponentConstructor.prototype);\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif (instance.el) {\n  \t\t\twarnIfDebug('The <' + this.name + '> component has a default \\'el\\' property; it has been disregarded');\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif (!('content' in partials)) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container = undefined;\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct(this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif (this.template.v) this.setupEvents();\n  \t}\n\n  \tComponent.prototype.bind = function bind() {\n  \t\tvar _this = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n  \t\t\t\tvar fragment = undefined;\n\n  \t\t\t\tif (template === 0) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(true);\n  \t\t\t\t} else if (typeof template === 'string') {\n  \t\t\t\t\tvar parsed = parseJSON(template);\n  \t\t\t\t\tviewmodel.joinKey(localKey).set(parsed ? parsed.value : template);\n  \t\t\t\t} else if (isArray(template)) {\n  \t\t\t\t\tif (template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\t\tmodel = resolve$1(_this.parentFragment, template[0]);\n\n  \t\t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\t_this.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = _this.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map(localKey, model);\n\n  \t\t\t\t\t\tif (model.get() === undefined && localKey in childData) {\n  \t\t\t\t\t\t\tmodel.set(childData[localKey]);\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: _this,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey(localKey);\n  \t\t\t\t\t\tmodel.set(fragment.valueOf());\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call(fragment);\n  \t\t\t\t\t\t\tmodel.set(fragment.valueOf());\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\t_this.complexMappings.push(fragment);\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise(this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tindexRefs: this.instance.isolated ? {} : this.parentFragment.indexRefs,\n  \t\t\tkeyRefs: this.instance.isolated ? {} : this.parentFragment.keyRefs,\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach(_bind);\n  \t};\n\n  \tComponent.prototype.bubble = function bubble() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders() {\n  \t\tvar _this2 = this;\n\n  \t\tObject.keys(this.yielders).forEach(function (name) {\n  \t\t\tif (_this2.yielders[name].length > 1) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error('A component template can only have one {{yield' + (name ? ' ' + name : '') + '}} declaration at a time');\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach() {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find(selector) {\n  \t\treturn this.instance.fragment.find(selector);\n  \t};\n\n  \tComponent.prototype.findAll = function findAll(selector, query) {\n  \t\tthis.instance.fragment.findAll(selector, query);\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent(name) {\n  \t\tif (!name || this.name === name) return this.instance;\n\n  \t\tif (this.instance.fragment) {\n  \t\t\treturn this.instance.fragment.findComponent(name);\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (query.test(this)) {\n  \t\t\tquery.add(this.instance);\n\n  \t\t\tif (query.live) {\n  \t\t\t\tthis.liveQueries.push(query);\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents(name, query);\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode() {\n  \t\treturn this.instance.fragment.firstNode();\n  \t};\n\n  \tComponent.prototype.rebind = function rebind() {\n  \t\tvar _this3 = this;\n\n  \t\tthis.complexMappings.forEach(_rebind);\n\n  \t\tthis.liveQueries.forEach(makeDirty);\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif (this.template.a) {\n  \t\t\tObject.keys(this.template.a).forEach(function (localKey) {\n  \t\t\t\tvar template = _this3.template.a[localKey];\n  \t\t\t\tvar model = undefined;\n\n  \t\t\t\tif (isArray(template) && template.length === 1 && template[0].t === INTERPOLATOR) {\n  \t\t\t\t\tmodel = resolve$1(_this3.parentFragment, template[0]);\n\n  \t\t\t\t\tif (!model) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug('The ' + localKey + '=\\'{{' + template[0].r + '}}\\' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity', { ractive: _this3.instance });\n  \t\t\t\t\t\t_this3.parentFragment.ractive.get(localKey); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = _this3.parentFragment.findContext().joinKey(localKey);\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map(localKey, model);\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind(viewmodel);\n  \t};\n\n  \tComponent.prototype.render = function render$$(target, occupants) {\n  \t\trender(this.instance, target, null, occupants);\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_render);\n  \t\tupdateLiveQueries(this);\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents() {\n  \t\tvar _this4 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys(this.template.v).forEach(function (key) {\n  \t\t\tvar eventNames = key.split('-');\n  \t\t\tvar template = _this4.template.v[key];\n\n  \t\t\teventNames.forEach(function (eventName) {\n  \t\t\t\tvar event = new RactiveEvent(_this4.instance, eventName);\n  \t\t\t\thandlers.push(new EventDirective(_this4, event, template));\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString() {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind() {\n  \t\tthis.complexMappings.forEach(_unbind);\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach(cancel);\n\n  \t\tremoveFromLiveComponentQueries(this);\n\n  \t\tif (instance.fragment.rendered && instance.el.__ractive_instances__) {\n  \t\t\tremoveFromArray(instance.el.__ractive_instances__, instance);\n  \t\t}\n\n  \t\tObject.keys(instance._links).forEach(function (k) {\n  \t\t\treturn instance._links[k].unlink();\n  \t\t});\n\n  \t\tteardownHook$1.fire(instance);\n  \t};\n\n  \tComponent.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tvar _this5 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach(_unrender);\n  \t\tthis.liveQueries.forEach(function (query) {\n  \t\t\treturn query.remove(_this5.instance);\n  \t\t});\n  \t};\n\n  \tComponent.prototype.update = function update() {\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach(_update);\n  \t\tthis.dirty = false;\n  \t};\n\n  \treturn Component;\n  })(Item);\n\n  var Text = (function (_Item) {\n  \tinherits(Text, _Item);\n\n  \tfunction Text(options) {\n  \t\tclassCallCheck(this, Text);\n\n  \t\t_Item.call(this, options);\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype.bind = function bind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach() {\n  \t\treturn detachNode(this.node);\n  \t};\n\n  \tText.prototype.firstNode = function firstNode() {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render(target, occupants) {\n  \t\tthis.rendered = true;\n\n  \t\tif (occupants) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif (n && n.nodeType === 3) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif (n.nodeValue !== this.template) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode(this.template);\n  \t\t\t\tif (occupants[0]) {\n  \t\t\t\t\ttarget.insertBefore(n, occupants[0]);\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild(n);\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode(this.template);\n  \t\t\ttarget.appendChild(this.node);\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString(escape) {\n  \t\treturn escape ? escapeHtml(this.template) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tif (this.rendered && shouldDestroy) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update() {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf() {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  })(Item);\n\n  // finds the component constructor in the registry or view hierarchy registries\n\n  function getComponentConstructor(ractive, name) {\n  \tvar instance = findInstance('components', ractive, name);\n  \tvar Component = undefined;\n\n  \tif (instance) {\n  \t\tComponent = instance.components[name];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif (!Component._Parent) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind(instance);\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty(name);\n  \t\t\tComponent = fn();\n\n  \t\t\tif (!Component) {\n  \t\t\t\twarnIfDebug(noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif (typeof Component === 'string') {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor(ractive, Component);\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[name] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ALIAS] = Alias;\n  constructors[DOCTYPE] = Doctype;\n  constructors[INTERPOLATOR] = Interpolator;\n  constructors[PARTIAL] = Partial;\n  constructors[SECTION] = Section;\n  constructors[TRIPLE] = Triple;\n  constructors[YIELDER] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n  function createItem(options) {\n  \tif (typeof options.template === 'string') {\n  \t\treturn new Text(options);\n  \t}\n\n  \tif (options.template.t === ELEMENT) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor(options.parentFragment.ractive, options.template.e);\n  \t\tif (ComponentConstructor) {\n  \t\t\treturn new Component(options, ComponentConstructor);\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[tagName] || Element;\n  \t\treturn new ElementConstructor(options);\n  \t}\n\n  \tvar Item = constructors[options.template.t];\n\n  \tif (!Item) throw new Error('Unrecognised item type ' + options.template.t);\n\n  \treturn new Item(options);\n  }\n\n  var ReferenceResolver = (function () {\n  \tfunction ReferenceResolver(fragment, reference, callback) {\n  \t\tclassCallCheck(this, ReferenceResolver);\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.reference = normalise(reference);\n  \t\tthis.callback = callback;\n\n  \t\tthis.keys = splitKeypath(reference);\n  \t\tthis.resolved = false;\n\n  \t\t// TODO the consumer should take care of addUnresolved\n  \t\t// we attach to all the contexts between here and the root\n  \t\t// - whenever their values change, they can quickly\n  \t\t// check to see if we can resolve\n  \t\twhile (fragment) {\n  \t\t\tif (fragment.context) {\n  \t\t\t\tfragment.context.addUnresolved(this.keys[0], this);\n  \t\t\t}\n\n  \t\t\tfragment = fragment.componentParent || fragment.parent;\n  \t\t}\n  \t}\n\n  \tReferenceResolver.prototype.attemptResolution = function attemptResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = resolveAmbiguousReference(this.fragment, this.reference);\n\n  \t\tif (model) {\n  \t\t\tthis.resolved = true;\n  \t\t\tthis.callback(model);\n  \t\t}\n  \t};\n\n  \tReferenceResolver.prototype.forceResolution = function forceResolution() {\n  \t\tif (this.resolved) return;\n\n  \t\tvar model = this.fragment.findContext().joinAll(this.keys);\n  \t\tthis.callback(model);\n  \t\tthis.resolved = true;\n  \t};\n\n  \tReferenceResolver.prototype.unbind = function unbind() {\n  \t\tremoveFromArray(this.fragment.unresolved, this);\n  \t};\n\n  \treturn ReferenceResolver;\n  })();\n\n  // TODO all this code needs to die\n\n  function processItems(items, values, guid) {\n  \tvar counter = arguments.length <= 3 || arguments[3] === undefined ? 0 : arguments[3];\n\n  \treturn items.map(function (item) {\n  \t\tif (item.type === TEXT) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif (item.fragment) {\n  \t\t\tif (item.fragment.iterations) {\n  \t\t\t\treturn item.fragment.iterations.map(function (fragment) {\n  \t\t\t\t\treturn processItems(fragment.items, values, guid, counter);\n  \t\t\t\t}).join('');\n  \t\t\t} else {\n  \t\t\t\treturn processItems(item.fragment.items, values, guid, counter);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = guid + '-' + counter++;\n\n  \t\tvalues[placeholderId] = item.model ? item.model.wrapper ? item.model.wrapper.value : item.model.get() : undefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join('');\n  }\n\n  function unrenderAndDestroy(item) {\n  \titem.unrender(true);\n  }\n\n  var Fragment = (function () {\n  \tfunction Fragment(options) {\n  \t\tclassCallCheck(this, Fragment);\n\n  \t\tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \t\tthis.isRoot = !options.owner.parentFragment;\n  \t\tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \t\tthis.ractive = options.ractive || (this.isRoot ? options.owner : this.parent.ractive);\n\n  \t\tthis.componentParent = this.isRoot && this.ractive.component ? this.ractive.component.parentFragment : null;\n\n  \t\tthis.context = null;\n  \t\tthis.rendered = false;\n  \t\tthis.indexRefs = options.indexRefs || (this.parent ? this.parent.indexRefs : []);\n  \t\tthis.keyRefs = options.keyRefs || (this.parent ? this.parent.keyRefs : {});\n\n  \t\t// encapsulated styles should be inherited until they get applied by an element\n  \t\tthis.cssIds = 'cssIds' in options ? options.cssIds : this.parent ? this.parent.cssIds : null;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.dirty = false;\n  \t\tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \t\tthis.template = options.template || [];\n  \t\tthis.createItems();\n  \t}\n\n  \tFragment.prototype.bind = function bind(context) {\n  \t\tthis.context = context;\n  \t\tthis.items.forEach(_bind);\n  \t\tthis.bound = true;\n\n  \t\t// in rare cases, a forced resolution (or similar) will cause the\n  \t\t// fragment to be dirty before it's even finished binding. In those\n  \t\t// cases we update immediately\n  \t\tif (this.dirty) this.update();\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.bubble = function bubble() {\n  \t\tthis.dirtyArgs = this.dirtyValue = true;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.isRoot) {\n  \t\t\t\t// TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\t\tif (this.ractive.component) {\n  \t\t\t\t\tthis.ractive.component.bubble();\n  \t\t\t\t} else if (this.bound) {\n  \t\t\t\t\trunloop.addFragment(this);\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tthis.owner.bubble();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.createItems = function createItems() {\n  \t\tvar _this = this;\n\n  \t\tthis.items = this.template.map(function (template, index) {\n  \t\t\treturn createItem({ parentFragment: _this, template: template, index: index });\n  \t\t});\n  \t};\n\n  \tFragment.prototype.detach = function detach() {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn docFrag.appendChild(item.detach());\n  \t\t});\n  \t\treturn docFrag;\n  \t};\n\n  \tFragment.prototype.find = function find(selector) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].find(selector);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAll = function findAll(selector, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAll) {\n  \t\t\t\t\titem.findAll(selector, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findComponent = function findComponent(name) {\n  \t\tvar len = this.items.length;\n  \t\tvar i = undefined;\n\n  \t\tfor (i = 0; i < len; i += 1) {\n  \t\t\tvar found = this.items[i].findComponent(name);\n  \t\t\tif (found) return found;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.findAllComponents = function findAllComponents(name, query) {\n  \t\tif (this.items) {\n  \t\t\tvar len = this.items.length;\n  \t\t\tvar i = undefined;\n\n  \t\t\tfor (i = 0; i < len; i += 1) {\n  \t\t\t\tvar item = this.items[i];\n\n  \t\t\t\tif (item.findAllComponents) {\n  \t\t\t\t\titem.findAllComponents(name, query);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn query;\n  \t};\n\n  \tFragment.prototype.findContext = function findContext() {\n  \t\tvar fragment = this;\n  \t\twhile (!fragment.context) fragment = fragment.parent;\n  \t\treturn fragment.context;\n  \t};\n\n  \tFragment.prototype.findNextNode = function findNextNode(item) {\n  \t\tvar nextItem = this.items[item.index + 1];\n\n  \t\tif (nextItem) return nextItem.firstNode();\n\n  \t\t// if this is the root fragment, and there are no more items,\n  \t\t// it means we're at the end...\n  \t\tif (this.isRoot) {\n  \t\t\tif (this.ractive.component) {\n  \t\t\t\treturn this.ractive.component.parentFragment.findNextNode(this.ractive.component);\n  \t\t\t}\n\n  \t\t\t// TODO possible edge case with other content\n  \t\t\t// appended to this.ractive.el?\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn this.owner.findNextNode(this); // the argument is in case the parent is a RepeatedFragment\n  \t};\n\n  \tFragment.prototype.findParentNode = function findParentNode() {\n  \t\tvar fragment = this;\n\n  \t\tdo {\n  \t\t\tif (fragment.owner.type === ELEMENT) {\n  \t\t\t\treturn fragment.owner.node;\n  \t\t\t}\n\n  \t\t\tif (fragment.isRoot && !fragment.ractive.component) {\n  \t\t\t\t// TODO encapsulate check\n  \t\t\t\treturn fragment.ractive.el;\n  \t\t\t}\n\n  \t\t\tif (fragment.owner.type === YIELDER) {\n  \t\t\t\tfragment = fragment.owner.containerFragment;\n  \t\t\t} else {\n  \t\t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t\t}\n  \t\t} while (fragment);\n\n  \t\tthrow new Error('Could not find parent node'); // TODO link to issue tracker\n  \t};\n\n  \tFragment.prototype.findRepeatingFragment = function findRepeatingFragment() {\n  \t\tvar fragment = this;\n  \t\t// TODO better check than fragment.parent.iterations\n  \t\twhile (fragment.parent && !fragment.isIteration) {\n  \t\t\tfragment = fragment.parent || fragment.componentParent;\n  \t\t}\n\n  \t\treturn fragment;\n  \t};\n\n  \tFragment.prototype.firstNode = function firstNode() {\n  \t\tvar node = undefined;\n  \t\tfor (var i = 0; i < this.items.length; i++) {\n  \t\t\tnode = this.items[i].firstNode();\n\n  \t\t\tif (node) {\n  \t\t\t\treturn node;\n  \t\t\t}\n  \t\t}\n  \t\treturn this.parent.findNextNode(this.owner);\n  \t};\n\n  \t// TODO ideally, this would be deprecated in favour of an\n  \t// expression-like approach\n\n  \tFragment.prototype.getArgsList = function getArgsList() {\n  \t\tif (this.dirtyArgs) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON('[' + source + ']', values);\n\n  \t\t\tthis.argsList = parsed ? parsed.value : [this.toString()];\n\n  \t\t\tthis.dirtyArgs = false;\n  \t\t}\n\n  \t\treturn this.argsList;\n  \t};\n\n  \tFragment.prototype.rebind = function rebind(context) {\n  \t\tthis.context = context;\n\n  \t\tthis.items.forEach(_rebind);\n  \t};\n\n  \tFragment.prototype.render = function render(target, occupants) {\n  \t\tif (this.rendered) throw new Error('Fragment is already rendered!');\n  \t\tthis.rendered = true;\n\n  \t\tthis.items.forEach(function (item) {\n  \t\t\treturn item.render(target, occupants);\n  \t\t});\n  \t};\n\n  \tFragment.prototype.resetTemplate = function resetTemplate(template) {\n  \t\tvar wasBound = this.bound;\n  \t\tvar wasRendered = this.rendered;\n\n  \t\t// TODO ensure transitions are disabled globally during reset\n\n  \t\tif (wasBound) {\n  \t\t\tif (wasRendered) this.unrender(true);\n  \t\t\tthis.unbind();\n  \t\t}\n\n  \t\tthis.template = template;\n  \t\tthis.createItems();\n\n  \t\tif (wasBound) {\n  \t\t\tthis.bind(this.context);\n\n  \t\t\tif (wasRendered) {\n  \t\t\t\tvar parentNode = this.findParentNode();\n  \t\t\t\tvar anchor = this.parent ? this.parent.findNextNode(this.owner) : null;\n\n  \t\t\t\tif (anchor) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tthis.render(docFrag);\n  \t\t\t\t\tparentNode.insertBefore(docFrag, anchor);\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.render(parentNode);\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tFragment.prototype.resolve = function resolve(template, callback) {\n  \t\tif (!this.context) {\n  \t\t\treturn this.parent.resolve(template, callback);\n  \t\t}\n\n  \t\tvar resolver = new ReferenceResolver(this, template, callback);\n  \t\tthis.resolvers.push(resolver);\n\n  \t\treturn resolver; // so we can e.g. force resolution\n  \t};\n\n  \tFragment.prototype.toHtml = function toHtml() {\n  \t\treturn this.toString();\n  \t};\n\n  \tFragment.prototype.toString = function toString(escape) {\n  \t\treturn this.items.map(escape ? toEscapedString : _toString).join('');\n  \t};\n\n  \tFragment.prototype.unbind = function unbind() {\n  \t\tthis.items.forEach(_unbind);\n  \t\tthis.bound = false;\n\n  \t\treturn this;\n  \t};\n\n  \tFragment.prototype.unrender = function unrender(shouldDestroy) {\n  \t\tthis.items.forEach(shouldDestroy ? unrenderAndDestroy : _unrender);\n  \t\tthis.rendered = false;\n  \t};\n\n  \tFragment.prototype.update = function update() {\n  \t\tif (this.dirty) {\n  \t\t\tthis.items.forEach(_update);\n  \t\t\tthis.dirty = false;\n  \t\t}\n  \t};\n\n  \tFragment.prototype.valueOf = function valueOf() {\n  \t\tif (this.items.length === 1) {\n  \t\t\treturn this.items[0].valueOf();\n  \t\t}\n\n  \t\tif (this.dirtyValue) {\n  \t\t\tvar values = {};\n  \t\t\tvar source = processItems(this.items, values, this.ractive._guid);\n  \t\t\tvar parsed = parseJSON(source, values);\n\n  \t\t\tthis.value = parsed ? parsed.value : this.toString();\n\n  \t\t\tthis.dirtyValue = false;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \treturn Fragment;\n  })();\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate(template) {\n  \ttemplateConfigurator.init(null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif (component) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif (component) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind().unrender(true);\n\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n\n  \tvar docFrag = createDocumentFragment();\n  \tthis.fragment.bind(this.viewmodel).render(docFrag);\n  \tthis.el.insertBefore(docFrag, this.anchor);\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  function collect(source, name, dest) {\n  \tsource.forEach(function (item) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif (item.type === PARTIAL && (item.refName === name || item.name === name)) {\n  \t\t\tdest.push(item);\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif (item.fragment) {\n  \t\t\tcollect(item.fragment.iterations || item.fragment.items, name, dest);\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if (isArray(item.items)) {\n  \t\t\t\tcollect(item.items, name, dest);\n  \t\t\t}\n\n  \t\t\t// or if it is a component, step in and process its items\n  \t\t\telse if (item.type === COMPONENT && item.instance) {\n  \t\t\t\t\t// ...unless the partial is shadowed\n  \t\t\t\t\tif (item.instance.partials[name]) return;\n  \t\t\t\t\tcollect(item.instance.fragment.items, name, dest);\n  \t\t\t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif (item.type === ELEMENT) {\n  \t\t\tif (isArray(item.attributes)) {\n  \t\t\t\tcollect(item.attributes, name, dest);\n  \t\t\t}\n\n  \t\t\tif (isArray(item.conditionalAttributes)) {\n  \t\t\t\tcollect(item.conditionalAttributes, name, dest);\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate(partial) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial (name, partial) {\n  \tvar collection = [];\n  \tcollect(this.fragment.items, name, collection);\n\n  \tvar promise = runloop.start(this, true);\n\n  \tthis.partials[name] = partial;\n  \tcollection.forEach(forceResetTemplate);\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var shouldRerender = ['template', 'partials', 'components', 'decorators', 'events'];\n\n  var completeHook = new Hook('complete');\n  var resetHook = new Hook('reset');\n  var renderHook = new Hook('render');\n  var unrenderHook = new Hook('unrender');\n  function Ractive$reset(data) {\n  \tdata = data || {};\n\n  \tif (typeof data !== 'object') {\n  \t\tthrow new Error('The reset method takes either no arguments, or an object containing new data');\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init(this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start(this, true);\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif (wrapper && wrapper.reset) {\n  \t\tif (wrapper.reset(data) === false) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set(data);\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set(data);\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset(this);\n  \tvar rerender = undefined;\n\n  \tvar i = changes.length;\n  \twhile (i--) {\n  \t\tif (shouldRerender.indexOf(changes[i]) > -1) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif (rerender) {\n  \t\tunrenderHook.fire(this);\n  \t\tthis.fragment.resetTemplate(this.template);\n  \t\trenderHook.fire(this);\n  \t\tcompleteHook.fire(this);\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire(this, data);\n\n  \treturn promise;\n  }\n\n  function Ractive$render(target, anchor) {\n  \ttarget = getElement(target) || this.el;\n\n  \tif (!this.append && target) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif (others) others.forEach(_teardown);\n\n  \t\t// make sure we are the only occupants\n  \t\tif (!this.enhance) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray(target.childNodes) : null;\n  \tvar promise = render(this, target, anchor, occupants);\n\n  \tif (occupants) {\n  \t\twhile (occupants.length) target.removeChild(occupants.pop());\n  \t}\n\n  \treturn promise;\n  }\n\n  var push = makeArrayMethod('push');\n\n  var pop = makeArrayMethod('pop');\n\n  function Ractive$once(eventName, handler) {\n  \tvar listener = this.on(eventName, function () {\n  \t\thandler.apply(this, arguments);\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  function trim (str) {\n    return str.trim();\n  }\n\n  function notEmptyString (str) {\n    return str !== '';\n  }\n\n  function Ractive$on(eventName, callback) {\n  \tvar _this = this;\n\n  \t// allow mutliple listeners to be bound in one go\n  \tif (typeof eventName === 'object') {\n  \t\tvar _ret = (function () {\n  \t\t\tvar listeners = [];\n  \t\t\tvar n = undefined;\n\n  \t\t\tfor (n in eventName) {\n  \t\t\t\tif (eventName.hasOwnProperty(n)) {\n  \t\t\t\t\tlisteners.push(_this.on(n, eventName[n]));\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn {\n  \t\t\t\tv: {\n  \t\t\t\t\tcancel: function () {\n  \t\t\t\t\t\tvar listener = undefined;\n  \t\t\t\t\t\twhile (listener = listeners.pop()) listener.cancel();\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n  \t\t})();\n\n  \t\tif (typeof _ret === 'object') return _ret.v;\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \teventNames.forEach(function (eventName) {\n  \t\t(_this._subs[eventName] || (_this._subs[eventName] = [])).push(callback);\n  \t});\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\treturn _this.off(eventName, callback);\n  \t\t}\n  \t};\n  }\n\n  function Ractive$off(eventName, callback) {\n  \tvar _this = this;\n\n  \t// if no arguments specified, remove all callbacks\n  \tif (!eventName) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor (eventName in this._subs) {\n  \t\t\tdelete this._subs[eventName];\n  \t\t}\n  \t} else {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split(' ').map(trim).filter(notEmptyString);\n\n  \t\teventNames.forEach(function (eventName) {\n  \t\t\tvar subscribers = _this._subs[eventName];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif (subscribers) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif (callback) {\n  \t\t\t\t\tvar index = subscribers.indexOf(callback);\n  \t\t\t\t\tif (index !== -1) {\n  \t\t\t\t\t\tsubscribers.splice(index, 1);\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\t\t_this._subs[eventName] = [];\n  \t\t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  var onceOptions = { init: false, once: true };\n  function observeOnce(keypath, callback, options) {\n  \tif (isObject(keypath) || typeof keypath === 'function') {\n  \t\toptions = extend(callback || {}, onceOptions);\n  \t\treturn this.observe(keypath, options);\n  \t}\n\n  \toptions = extend(options || {}, onceOptions);\n  \treturn this.observe(keypath, callback, options);\n  }\n\n  function observeList(keypath, callback, options) {\n  \tif (typeof keypath !== 'string') {\n  \t\tthrow new Error('ractive.observeList() must be passed a string as its first argument');\n  \t}\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar observer = new ListObserver(this, model, callback, options || {});\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push(observer);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne() {\n  \treturn -1;\n  }\n\n  var ListObserver = (function () {\n  \tfunction ListObserver(context, model, callback, options) {\n  \t\tclassCallCheck(this, ListObserver);\n\n  \t\tthis.context = context;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath();\n  \t\tthis.callback = callback;\n\n  \t\tthis.pending = null;\n\n  \t\tmodel.register(this);\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.sliced = [];\n  \t\t\tthis.shuffle([]);\n  \t\t\tthis.handleChange();\n  \t\t} else {\n  \t\t\tthis.sliced = this.slice();\n  \t\t}\n  \t}\n\n  \tListObserver.prototype.handleChange = function handleChange() {\n  \t\tif (this.pending) {\n  \t\t\t// post-shuffle\n  \t\t\tthis.callback(this.pending);\n  \t\t\tthis.pending = null;\n  \t\t} else {\n  \t\t\t// entire array changed\n  \t\t\tthis.shuffle(this.sliced.map(negativeOne));\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tListObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tvar _this = this;\n\n  \t\tvar newValue = this.slice();\n\n  \t\tvar inserted = [];\n  \t\tvar deleted = [];\n  \t\tvar start = undefined;\n\n  \t\tvar hadIndex = {};\n\n  \t\tnewIndices.forEach(function (newIndex, oldIndex) {\n  \t\t\thadIndex[newIndex] = true;\n\n  \t\t\tif (newIndex !== oldIndex && start === undefined) {\n  \t\t\t\tstart = oldIndex;\n  \t\t\t}\n\n  \t\t\tif (newIndex === -1) {\n  \t\t\t\tdeleted.push(_this.sliced[oldIndex]);\n  \t\t\t}\n  \t\t});\n\n  \t\tif (start === undefined) start = newIndices.length;\n\n  \t\tvar len = newValue.length;\n  \t\tfor (var i = 0; i < len; i += 1) {\n  \t\t\tif (!hadIndex[i]) inserted.push(newValue[i]);\n  \t\t}\n\n  \t\tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \t\tthis.sliced = newValue;\n  \t};\n\n  \tListObserver.prototype.slice = function slice() {\n  \t\tvar value = this.model.get();\n  \t\treturn isArray(value) ? value.slice() : [];\n  \t};\n\n  \treturn ListObserver;\n  })();\n\n  function observe(keypath, callback, options) {\n  \tvar _this = this;\n\n  \tvar observers = [];\n  \tvar map = undefined;\n\n  \tif (isObject(keypath)) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys(map).forEach(function (keypath) {\n  \t\t\tvar callback = map[keypath];\n\n  \t\t\tkeypath.split(' ').forEach(function (keypath) {\n  \t\t\t\tobservers.push(createObserver(_this, keypath, callback, options));\n  \t\t\t});\n  \t\t});\n  \t} else {\n  \t\tvar keypaths = undefined;\n\n  \t\tif (typeof keypath === 'function') {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [''];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split(' ');\n  \t\t}\n\n  \t\tkeypaths.forEach(function (keypath) {\n  \t\t\tobservers.push(createObserver(_this, keypath, callback, options || {}));\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply(this._observers, observers);\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach(cancel);\n  \t\t}\n  \t};\n  }\n\n  function createObserver(ractive, keypath, callback, options) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar wildcardIndex = keys.indexOf('*');\n\n  \t// normal keypath - no wildcards\n  \tif (! ~wildcardIndex) {\n  \t\tvar key = keys[0];\n\n  \t\tif (!viewmodel.has(key)) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif (ractive.component) {\n  \t\t\t\tvar _model = resolveReference(ractive.component.parentFragment, key);\n  \t\t\t\tif (_model) viewmodel.map(key, _model);\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model = viewmodel.joinAll(keys);\n  \t\treturn new Observer(ractive, model, callback, options);\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ? viewmodel : viewmodel.joinAll(keys.slice(0, wildcardIndex));\n\n  \treturn new PatternObserver(ractive, baseModel, keys.splice(wildcardIndex), callback, options);\n  }\n\n  var Observer = (function () {\n  \tfunction Observer(ractive, model, callback, options) {\n  \t\tclassCallCheck(this, Observer);\n\n  \t\tthis.context = options.context || ractive;\n  \t\tthis.model = model;\n  \t\tthis.keypath = model.getKeypath(ractive);\n  \t\tthis.callback = callback;\n\n  \t\tthis.oldValue = undefined;\n  \t\tthis.newValue = model.get();\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValue = this.newValue;\n  \t\t}\n\n  \t\tmodel.register(this);\n  \t}\n\n  \tObserver.prototype.cancel = function cancel() {\n  \t\tthis.model.unregister(this);\n  \t};\n\n  \tObserver.prototype.dispatch = function dispatch() {\n  \t\tthis.callback.call(this.context, this.newValue, this.oldValue, this.keypath);\n  \t\tthis.oldValue = this.newValue;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tObserver.prototype.handleChange = function handleChange() {\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValue = this.model.get();\n\n  \t\t\tif (this.strict && this.newValue === this.oldValue) return;\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn Observer;\n  })();\n\n  var PatternObserver = (function () {\n  \tfunction PatternObserver(ractive, baseModel, keys, callback, options) {\n  \t\tvar _this2 = this;\n\n  \t\tclassCallCheck(this, PatternObserver);\n\n  \t\tthis.context = options.context || ractive;\n  \t\tthis.ractive = ractive;\n  \t\tthis.baseModel = baseModel;\n  \t\tthis.keys = keys;\n  \t\tthis.callback = callback;\n\n  \t\tvar pattern = keys.join('\\\\.').replace(/\\*/g, '(.+)');\n  \t\tvar baseKeypath = baseModel.getKeypath(ractive);\n  \t\tthis.pattern = new RegExp('^' + (baseKeypath ? baseKeypath + '\\\\.' : '') + pattern + '$');\n\n  \t\tthis.oldValues = {};\n  \t\tthis.newValues = {};\n\n  \t\tthis.defer = options.defer;\n  \t\tthis.once = options.once;\n  \t\tthis.strict = options.strict;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar models = baseModel.findMatches(this.keys);\n\n  \t\tmodels.forEach(function (model) {\n  \t\t\t_this2.newValues[model.getKeypath(_this2.ractive)] = model.get();\n  \t\t});\n\n  \t\tif (options.init !== false) {\n  \t\t\tthis.dispatch();\n  \t\t} else {\n  \t\t\tthis.oldValues = this.newValues;\n  \t\t}\n\n  \t\tif (baseModel.isRoot && keys.length === 1 && keys[0] === '*') {\n  \t\t\tmodels.forEach(function (model) {\n  \t\t\t\treturn model.register(_this2);\n  \t\t\t});\n  \t\t} else {\n  \t\t\tbaseModel.register(this);\n  \t\t}\n  \t}\n\n  \tPatternObserver.prototype.cancel = function cancel() {\n  \t\tthis.baseModel.unregister(this);\n  \t};\n\n  \tPatternObserver.prototype.dispatch = function dispatch() {\n  \t\tvar _this3 = this;\n\n  \t\tObject.keys(this.newValues).forEach(function (keypath) {\n  \t\t\tif (_this3.newKeys && !_this3.newKeys[keypath]) return;\n\n  \t\t\tvar newValue = _this3.newValues[keypath];\n  \t\t\tvar oldValue = _this3.oldValues[keypath];\n\n  \t\t\tif (_this3.strict && newValue === oldValue) return;\n  \t\t\tif (isEqual(newValue, oldValue)) return;\n\n  \t\t\tvar wildcards = _this3.pattern.exec(keypath).slice(1);\n  \t\t\tvar args = [newValue, oldValue, keypath].concat(wildcards);\n\n  \t\t\t_this3.callback.apply(_this3.context, args);\n  \t\t});\n\n  \t\tthis.oldValues = this.newValues;\n  \t\tthis.newKeys = null;\n  \t\tthis.dirty = false;\n  \t};\n\n  \tPatternObserver.prototype.shuffle = function shuffle(newIndices) {\n  \t\tif (!isArray(this.baseModel.value)) return;\n\n  \t\tvar base = this.baseModel.getKeypath(this.ractive);\n  \t\tvar max = this.baseModel.value.length;\n  \t\tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice(1).join('.') : '';\n\n  \t\tthis.newKeys = {};\n  \t\tfor (var i = 0; i < newIndices.length; i++) {\n  \t\t\tif (newIndices[i] === -1 || newIndices[i] === i) continue;\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n\n  \t\tfor (var i = newIndices.touchedFrom; i < max; i++) {\n  \t\t\tthis.newKeys[base + '.' + i + suffix] = true;\n  \t\t}\n  \t};\n\n  \tPatternObserver.prototype.handleChange = function handleChange() {\n  \t\tvar _this4 = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.newValues = {};\n\n  \t\t\t// handle case where previously extant keypath no longer exists -\n  \t\t\t// observer should still fire, with undefined as new value\n  \t\t\t// TODO huh. according to the test suite that's not the case...\n  \t\t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t\t// \tthis.newValues[ keypath ] = undefined;\n  \t\t\t// });\n\n  \t\t\tthis.baseModel.findMatches(this.keys).forEach(function (model) {\n  \t\t\t\tvar keypath = model.getKeypath(_this4.ractive);\n  \t\t\t\t_this4.newValues[keypath] = model.get();\n  \t\t\t});\n\n  \t\t\trunloop.addObserver(this, this.defer);\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif (this.once) this.cancel();\n  \t\t}\n  \t};\n\n  \treturn PatternObserver;\n  })();\n\n  var comparators = {};\n\n  function getComparator(option) {\n  \tif (!option) return null; // use existing arrays\n  \tif (option === true) return JSON.stringify;\n  \tif (typeof option === 'function') return option;\n\n  \tif (typeof option === 'string') {\n  \t\treturn comparators[option] || (comparators[option] = function (thing) {\n  \t\t\treturn thing[option];\n  \t\t});\n  \t}\n\n  \tthrow new Error('If supplied, options.compare must be a string, function, or `true`'); // TODO link to docs\n  }\n  function Ractive$merge(keypath, array, options) {\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar promise = runloop.start(this, true);\n  \tvar value = model.get();\n\n  \tif (array === value) {\n  \t\tthrow new Error('You cannot merge an array with itself'); // TODO link to docs\n  \t} else if (!isArray(value) || !isArray(array)) {\n  \t\t\tthrow new Error('You cannot merge an array with a non-array');\n  \t\t}\n\n  \tvar comparator = getComparator(options && options.compare);\n  \tmodel.merge(array, comparator);\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function link(there, here) {\n  \tif (here === there || (there + '.').indexOf(here + '.') === 0 || (here + '.').indexOf(there + '.') === 0) {\n  \t\tthrow new Error('A keypath cannot be linked to itself.');\n  \t}\n\n  \tvar unlink = undefined,\n  \t    run = undefined,\n  \t    model = undefined;\n\n  \tvar ln = this._links[here];\n\n  \tif (ln) {\n  \t\tif (ln.source.model.str !== there || ln.dest.model.str !== here) {\n  \t\t\tunlink = this.unlink(here);\n  \t\t} else {\n  \t\t\treturn Promise$1.resolve(true);\n  \t\t}\n  \t}\n\n  \trun = runloop.start();\n\n  \t// may need to allow a mapping to resolve implicitly\n  \tvar sourcePath = splitKeypath(there);\n  \tif (!this.viewmodel.has(sourcePath[0]) && this.component) {\n  \t\tmodel = resolveReference(this.component.parentFragment, sourcePath[0]);\n\n  \t\tif (model) {\n  \t\t\tthis.viewmodel.map(sourcePath[0], model);\n  \t\t}\n  \t}\n\n  \tln = new Link(this.viewmodel.joinAll(sourcePath), this.viewmodel.joinAll(splitKeypath(here)), this);\n  \tthis._links[here] = ln;\n  \tln.source.handleChange();\n\n  \trunloop.end();\n\n  \treturn Promise$1.all([unlink, run]);\n  }\n\n  var Link = (function () {\n  \tfunction Link(source, dest, ractive) {\n  \t\tclassCallCheck(this, Link);\n\n  \t\tthis.source = new LinkSide(source, this);\n  \t\tthis.dest = new LinkSide(dest, this);\n  \t\tthis.ractive = ractive;\n  \t\tthis.locked = false;\n  \t\tthis.initialValue = dest.get();\n  \t}\n\n  \tLink.prototype.sync = function sync(side) {\n  \t\tif (!this.locked) {\n  \t\t\tthis.locked = true;\n\n  \t\t\tif (side === this.dest) {\n  \t\t\t\tthis.source.model.set(this.dest.model.get());\n  \t\t\t} else {\n  \t\t\t\tthis.dest.model.set(this.source.model.get());\n  \t\t\t}\n\n  \t\t\tthis.locked = false;\n  \t\t}\n  \t};\n\n  \tLink.prototype.unlink = function unlink() {\n  \t\tthis.source.model.unregister(this.source);\n  \t\tthis.dest.model.unregister(this.dest);\n  \t};\n\n  \treturn Link;\n  })();\n\n  var LinkSide = (function () {\n  \tfunction LinkSide(model, owner) {\n  \t\tclassCallCheck(this, LinkSide);\n\n  \t\tthis.model = model;\n  \t\tthis.owner = owner;\n  \t\tmodel.register(this);\n  \t}\n\n  \tLinkSide.prototype.handleChange = function handleChange() {\n  \t\tthis.owner.sync(this);\n  \t};\n\n  \treturn LinkSide;\n  })();\n\n  var insertHook = new Hook('insert');\n  function Ractive$insert(target, anchor) {\n  \tif (!this.fragment.rendered) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error('The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.');\n  \t}\n\n  \ttarget = getElement(target);\n  \tanchor = getElement(anchor) || null;\n\n  \tif (!target) {\n  \t\tthrow new Error('You must specify a valid target to insert into');\n  \t}\n\n  \ttarget.insertBefore(this.detach(), anchor);\n  \tthis.el = target;\n\n  \t(target.__ractive_instances__ || (target.__ractive_instances__ = [])).push(this);\n  \tthis.isDetached = false;\n\n  \tfireInsertHook(this);\n  }\n\n  function fireInsertHook(ractive) {\n  \tinsertHook.fire(ractive);\n\n  \tractive.findAllComponents('*').forEach(function (child) {\n  \t\tfireInsertHook(child.instance);\n  \t});\n  }\n\n  function Ractive$get(keypath) {\n  \tif (!keypath) return this.viewmodel.get(true);\n\n  \tvar keys = splitKeypath(keypath);\n  \tvar key = keys[0];\n\n  \tvar model = undefined;\n\n  \tif (!this.viewmodel.has(key)) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif (this.component) {\n  \t\t\tmodel = resolveReference(this.component.parentFragment, key);\n\n  \t\t\tif (model) {\n  \t\t\t\tthis.viewmodel.map(key, model);\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll(keys);\n  \treturn model.get(true);\n  }\n\n  function Ractive$fire(eventName) {\n  \tfor (var _len = arguments.length, args = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n  \t\targs[_key - 1] = arguments[_key];\n  \t}\n\n  \tfireEvent(this, eventName, { args: args });\n  }\n\n  function Ractive$findParent(selector) {\n\n  \tif (this.parent) {\n  \t\tif (this.parent.component && this.parent.component.name === selector) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findContainer(selector) {\n  \tif (this.container) {\n  \t\tif (this.container.component && this.container.component.name === selector) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer(selector);\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findComponent(selector) {\n  \treturn this.fragment.findComponent(selector);\n  }\n\n  function sortByDocumentPosition(node, otherNode) {\n  \tif (node.compareDocumentPosition) {\n  \t\tvar bitmask = node.compareDocumentPosition(otherNode);\n  \t\treturn bitmask & 2 ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition(node, otherNode);\n  }\n\n  function sortByItemPosition(a, b) {\n  \tvar ancestryA = getAncestry(a.component || a._ractive.proxy);\n  \tvar ancestryB = getAncestry(b.component || b._ractive.proxy);\n\n  \tvar oldestA = lastItem(ancestryA);\n  \tvar oldestB = lastItem(ancestryB);\n  \tvar mutualAncestor = undefined;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile (oldestA && oldestA === oldestB) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem(ancestryA);\n  \t\toldestB = lastItem(ancestryB);\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif (fragmentA === fragmentB) {\n  \t\tvar indexA = fragmentA.items.indexOf(oldestA);\n  \t\tvar indexB = fragmentB.items.indexOf(oldestB);\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif (fragments) {\n  \t\tvar indexA = fragments.indexOf(fragmentA);\n  \t\tvar indexB = fragments.indexOf(fragmentB);\n\n  \t\treturn indexA - indexB || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error('An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!');\n  }\n\n  function getParent(item) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif (parentFragment) return parentFragment.owner;\n\n  \tif (item.component && (parentFragment = item.component.parentFragment)) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry(item) {\n  \tvar ancestry = [item];\n  \tvar ancestor = getParent(item);\n\n  \twhile (ancestor) {\n  \t\tancestry.push(ancestor);\n  \t\tancestor = getParent(ancestor);\n  \t}\n\n  \treturn ancestry;\n  }\n\n  var Query = (function () {\n  \tfunction Query(ractive, selector, live, isComponentQuery) {\n  \t\tclassCallCheck(this, Query);\n\n  \t\tthis.ractive = ractive;\n  \t\tthis.selector = selector;\n  \t\tthis.live = live;\n  \t\tthis.isComponentQuery = isComponentQuery;\n\n  \t\tthis.result = [];\n\n  \t\tthis.dirty = true;\n  \t}\n\n  \tQuery.prototype.add = function add(item) {\n  \t\tthis.result.push(item);\n  \t\tthis.makeDirty();\n  \t};\n\n  \tQuery.prototype.cancel = function cancel() {\n  \t\tvar liveQueries = this._root[this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries'];\n  \t\tvar selector = this.selector;\n\n  \t\tvar index = liveQueries.indexOf(selector);\n\n  \t\tif (index !== -1) {\n  \t\t\tliveQueries.splice(index, 1);\n  \t\t\tliveQueries[selector] = null;\n  \t\t}\n  \t};\n\n  \tQuery.prototype.init = function init() {\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.makeDirty = function makeDirty() {\n  \t\tvar _this = this;\n\n  \t\tif (!this.dirty) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\t// Once the DOM has been updated, ensure the query\n  \t\t\t// is correctly ordered\n  \t\t\trunloop.scheduleTask(function () {\n  \t\t\t\treturn _this.update();\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tQuery.prototype.remove = function remove(nodeOrComponent) {\n  \t\tvar index = this.result.indexOf(this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent);\n  \t\tif (index !== -1) this.result.splice(index, 1);\n  \t};\n\n  \tQuery.prototype.update = function update() {\n  \t\tthis.result.sort(this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition);\n  \t\tthis.dirty = false;\n  \t};\n\n  \tQuery.prototype.test = function test(item) {\n  \t\treturn this.isComponentQuery ? !this.selector || item.name === this.selector : item ? matches(item, this.selector) : null;\n  \t};\n\n  \treturn Query;\n  })();\n\n  function Ractive$findAllComponents(selector, options) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, true);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAll(selector, options) {\n  \tif (!this.el) throw new Error('Cannot call ractive.findAll(\\'' + selector + '\\', ...) unless instance is rendered to the DOM');\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[selector];\n  \tif (query) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn options && options.live ? query : query.slice();\n  \t}\n\n  \tquery = new Query(this, selector, !!options.live, false);\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif (query.live) {\n  \t\tliveQueries.push(selector);\n  \t\tliveQueries['_' + selector] = query;\n  \t}\n\n  \tthis.fragment.findAll(selector, query);\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$find(selector) {\n  \tif (!this.el) throw new Error(\"Cannot call ractive.find('\" + selector + \"') unless instance is rendered to the DOM\");\n\n  \treturn this.fragment.find(selector);\n  }\n\n  var detachHook = new Hook('detach');\n  function Ractive$detach() {\n  \tif (this.isDetached) {\n  \t\treturn this.el;\n  \t}\n\n  \tif (this.el) {\n  \t\tremoveFromArray(this.el.__ractive_instances__, this);\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire(this);\n  \treturn this.el;\n  }\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n  var easing = {\n  \tlinear: function (pos) {\n  \t\treturn pos;\n  \t},\n  \teaseIn: function (pos) {\n  \t\treturn Math.pow(pos, 3);\n  \t},\n  \teaseOut: function (pos) {\n  \t\treturn Math.pow(pos - 1, 3) + 1;\n  \t},\n  \teaseInOut: function (pos) {\n  \t\tif ((pos /= 0.5) < 1) {\n  \t\t\treturn 0.5 * Math.pow(pos, 3);\n  \t\t}\n  \t\treturn 0.5 * (Math.pow(pos - 2, 3) + 2);\n  \t}\n  };\n\n  var noAnimation = { stop: noop };\n  var linear = easing.linear;\n\n  function getOptions(options, instance) {\n  \toptions = options || {};\n\n  \tvar easing = undefined;\n  \tif (options.easing) {\n  \t\teasing = typeof options.easing === 'function' ? options.easing : instance.easing[options.easing];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n  function Ractive$animate(keypath, to, options) {\n  \tif (typeof keypath === 'object') {\n  \t\tvar keys = Object.keys(keypath);\n\n  \t\tthrow new Error('ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  ' + keys.map(function (key) {\n  \t\t\treturn '\\'' + key + '\\': ' + keypath[key];\n  \t\t}).join('\\n  ') + '\\n}, {...}), do\\n\\n' + keys.map(function (key) {\n  \t\t\treturn 'ractive.animate(\\'' + key + '\\', ' + keypath[key] + ', {...});';\n  \t\t}).join('\\n') + '\\n');\n  \t}\n\n  \toptions = getOptions(options);\n\n  \tvar model = this.viewmodel.joinAll(splitKeypath(keypath));\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif (isEqual(from, to)) {\n  \t\toptions.complete(options.to);\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate(from, to, this, options.interpolator);\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif (!interpolator) {\n  \t\trunloop.start();\n  \t\tmodel.set(to);\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate(from, to, options, interpolator);\n  }\n\n  function Ractive$add(keypath, d) {\n  \treturn add(this, keypath, d === undefined ? 1 : +d);\n  }\n\n  var proto$1 = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tlink: link,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \tunlink: unlink,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function getNodeInfo (node) {\n  \tif (!node || !node._ractive) return {};\n\n  \tvar storage = node._ractive;\n\n  \treturn {\n  \t\tractive: storage.ractive,\n  \t\tkeypath: storage.keypath,\n  \t\trootpath: storage.rootpath,\n  \t\tindex: extend({}, storage.fragment.indexRefs),\n  \t\tkey: extend({}, storage.fragment.keyRefs)\n  \t};\n  }\n\n  function wrap$1 (method, superMethod, force) {\n\n  \tif (force || needsSuper$1(method, superMethod)) {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ('_super' in this),\n  \t\t\t    _super = this._super,\n  \t\t\t    result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply(this, arguments);\n\n  \t\t\tif (hasSuper) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t} else {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper$1(method, superMethod) {\n  \treturn typeof superMethod === 'function' && /_super/.test(method);\n  }\n\n  function unwrap(Child) {\n  \tvar options = {};\n\n  \twhile (Child) {\n  \t\taddRegistries(Child, options);\n  \t\taddOtherOptions(Child, options);\n\n  \t\tif (Child._Parent !== Ractive) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries(Child, options) {\n  \tregistries.forEach(function (r) {\n  \t\taddRegistry(r.useDefaults ? Child.prototype : Child, options, r.name);\n  \t});\n  }\n\n  function addRegistry(target, options, name) {\n  \tvar registry,\n  \t    keys = Object.keys(target[name]);\n\n  \tif (!keys.length) {\n  \t\treturn;\n  \t}\n\n  \tif (!(registry = options[name])) {\n  \t\tregistry = options[name] = {};\n  \t}\n\n  \tkeys.filter(function (key) {\n  \t\treturn !(key in registry);\n  \t}).forEach(function (key) {\n  \t\treturn registry[key] = target[name][key];\n  \t});\n  }\n\n  function addOtherOptions(Child, options) {\n  \tObject.keys(Child.prototype).forEach(function (key) {\n  \t\tif (key === 'computed') {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar value = Child.prototype[key];\n\n  \t\tif (!(key in options)) {\n  \t\t\toptions[key] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if (typeof options[key] === 'function' && typeof value === 'function' && options[key]._method) {\n\n  \t\t\t\tvar result = undefined,\n  \t\t\t\t    needsSuper = value._method;\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tvalue = value._method;\n  \t\t\t\t}\n\n  \t\t\t\t// rewrap bound directly to parent fn\n  \t\t\t\tresult = wrap$1(options[key]._method, value);\n\n  \t\t\t\tif (needsSuper) {\n  \t\t\t\t\tresult._method = result;\n  \t\t\t\t}\n\n  \t\t\t\toptions[key] = result;\n  \t\t\t}\n  \t});\n  }\n\n  function extend$1() {\n  \tfor (var _len = arguments.length, options = Array(_len), _key = 0; _key < _len; _key++) {\n  \t\toptions[_key] = arguments[_key];\n  \t}\n\n  \tif (!options.length) {\n  \t\treturn extendOne(this);\n  \t} else {\n  \t\treturn options.reduce(extendOne, this);\n  \t}\n  }\n\n  function extendOne(Parent) {\n  \tvar options = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif (options.prototype instanceof Ractive) {\n  \t\toptions = unwrap(options);\n  \t}\n\n  \tChild = function (options) {\n  \t\tif (!(this instanceof Child)) return new Child(options);\n\n  \t\tconstruct(this, options || {});\n  \t\tinitialise(this, options || {}, {});\n  \t};\n\n  \tproto = create(Parent.prototype);\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties(Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend$1, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend(Parent, proto, options);\n\n  \tdataConfigurator.extend(Parent, proto, options);\n\n  \tif (options.computed) {\n  \t\tproto.computed = extend(create(Parent.prototype.computed), options.computed);\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (typeof Date.now !== FUNCTION || typeof String.prototype.trim !== FUNCTION || typeof Object.keys !== FUNCTION || typeof Array.prototype.indexOf !== FUNCTION || typeof Array.prototype.forEach !== FUNCTION || typeof Array.prototype.map !== FUNCTION || typeof Array.prototype.filter !== FUNCTION || win && typeof win.addEventListener !== FUNCTION) {\n  \tthrow new Error('It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.');\n  }\n  function Ractive(options) {\n  \tif (!(this instanceof Ractive)) return new Ractive(options);\n\n  \tconstruct(this, options || {});\n  \tinitialise(this, options || {}, {});\n  }\n\n  extend(Ractive.prototype, proto$1, defaults);\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties(Ractive, {\n\n  \t// debug flag\n  \tDEBUG: { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend: { value: extend$1 },\n  \tgetNodeInfo: { value: getNodeInfo },\n  \tparse: { value: parse },\n\n  \t// namespaced constructors\n  \tPromise: { value: Promise$1 },\n\n  \t// support\n  \tenhance: { writable: true, value: false },\n  \tsvg: { value: svg },\n  \tmagic: { value: magicSupported },\n\n  \t// version\n  \tVERSION: { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors: { writable: true, value: {} },\n  \tcomponents: { writable: true, value: {} },\n  \tdecorators: { writable: true, value: {} },\n  \teasing: { writable: true, value: easing },\n  \tevents: { writable: true, value: {} },\n  \tinterpolators: { writable: true, value: interpolators$1 },\n  \tpartials: { writable: true, value: {} },\n  \ttransitions: { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["styleSheet","styleElement","update","css","prefix","styles","map","s","id","join","cssText","innerHTML","inDom","head","appendChild","add","push","dirty","apply","noop","Parser","ParseError","css$1","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","uid$1","cssConfigurator","name","extend","Parent","proto","options","noCssTransform","transformCss","cssId","init","adaptConfigurator","adapt","combine$2","ensureArray","registryNames$1","Registry","useDefaults","classCallCheck","this","prototype","configure","defaults","constructor","target","option","registry","create","key","reset","ractive","changed","Object","keys","forEach","item","_fn","isOwner","registries","custom","data","dataConfigurator","template","templateConfigurator","defaultKeys","isStandardKey","makeObj","filter","isBlacklisted","concat","r","order","config","c","configHook","Hook","initHook","HookQueue","renderHook$1","completeHook$1","leadingWhitespace","message","Error","e","stack","str","items","lineStart","pos","lines","split","lineEnds","line","lineEnd","length","read","leftover","remaining","result","postProcess","converters","i","len","getLinePos","char","columnNum","lineNum","error","numTabs","annotation","replace","match","Array","character","shortMessage","matchString","string","substr","matchPattern","pattern","exec","allowWhitespace","substring","nextChar","charAt","Child","call","hasOwn","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","Parser$1","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","numberPattern$1","identifier","specials","true","false","null","undefined","specialsPattern","RegExp","numberPattern","placeholderPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","values","test","value","v","parser","placeholder","hasOwnProperty","special","number","stringLiteral","readStringLiteral","$1","pair","getKeyValuePair","valueToken","RactiveEvent","handler","listen","directive","on","event","arguments","node","shift","component","args","slice","fire","unlisten","cancel","teardownHook$1","Component","_Item","ComponentConstructor","type","COMPONENT","instance","parentFragment","complexMappings","liveQueries","el","warnIfDebug","partials","p","content","f","_partials","yielders","fragment","container","owner","YIELDER","parent","root","construct","_inlinePartials","eventHandlers","setupEvents","inherits","bind","_this","viewmodel","childData","a","localKey","model","joinKey","set","parsed","parseJSON","isArray","t","INTERPOLATOR","resolve$1","warnOnceIfDebug","get","findContext","Fragment","valueOf","bubble","initialise","indexRefs","isolated","keyRefs","cssIds","_bind","checkYielders","_this2","runloop","end","detach","find","selector","findAll","query","findComponent","findAllComponents","live","firstNode","rebind","_this3","_rebind","makeDirty","mappings","render","occupants","_render","updateLiveQueries","rendered","_this4","handlers","eventNames","eventName","EventDirective","toString","toHTML","unbind","_unbind","teardown","_observers","removeFromLiveComponentQueries","__ractive_instances__","removeFromArray","_links","k","unlink","unrender","shouldDestroy","_this5","_unrender","remove","_update","Item","Text","TEXT","detachNode","n","nodeType","nodeValue","doc","createTextNode","insertBefore","escape","escapeHtml","constructors","ALIAS","Alias","DOCTYPE","Doctype","Interpolator","PARTIAL","Partial","SECTION","Section","TRIPLE","Triple","Yielder","specialElements","doctype","form","Form","input","Input","Option","select","Select","textarea","Textarea","ReferenceResolver","reference","callback","normalise","splitKeypath","resolved","context","addUnresolved","componentParent","attemptResolution","resolveAmbiguousReference","forceResolution","joinAll","unresolved","isRoot","resolvers","dirtyArgs","dirtyValue","createItems","bound","addFragment","index","createItem","docFrag","createDocumentFragment","found","findNextNode","nextItem","findParentNode","ELEMENT","containerFragment","findRepeatingFragment","isIteration","getArgsList","source","processItems","_guid","argsList","resetTemplate","wasBound","wasRendered","parentNode","anchor","resolve","resolver","toHtml","toEscapedString","_toString","unrenderAndDestroy","shouldRerender","completeHook","resetHook","renderHook","unrenderHook","makeArrayMethod","pop","onceOptions","once","ListObserver","keypath","getKeypath","pending","register","sliced","shuffle","handleChange","negativeOne","newIndices","newValue","inserted","deleted","start","hadIndex","newIndex","oldIndex","Observer","oldValue","defer","strict","dispatch","unregister","addObserver","PatternObserver","baseModel","baseKeypath","oldValues","newValues","models","findMatches","newKeys","isEqual","wildcards","base","max","suffix","touchedFrom","comparators","Link","dest","LinkSide","locked","initialValue","sync","side","insertHook","Query","isComponentQuery","_root","indexOf","splice","scheduleTask","nodeOrComponent","sort","sortByItemPosition","sortByDocumentPosition","matches","detachHook","easing","linear","easeIn","Math","pow","easeOut","easeInOut","noAnimation","stop","proto$1","Ractive$add","animate","Ractive$animate","Ractive$detach","Ractive$find","Ractive$findAll","Ractive$findAllComponents","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","Ractive$fire","Ractive$get","insert","Ractive$insert","link","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","Ractive$on","Ractive$once","Ractive$render","Ractive$reset","resetPartial","Ractive$resetTemplate","reverse","Ractive$set","subtract","Ractive$subtract","Ractive$teardown","toggle","Ractive$toggle","Ractive$toHTML","Ractive$unrender","unshift","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","win","addEventListener","Ractive","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend$1","getNodeInfo","parse","Promise","Promise$1","enhance","svg","magic","magicSupported","VERSION","adaptors","components","decorators","events","interpolators","interpolators$1","transitions","x","canUseCssTransitions","cannotUseCssTransitions","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","testStyle","transition","webkitTransition","createTransitions","to","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","camelCase","unprefix","propertyName","removeEventListener","hashPrefix","namespaceURI","tagName","style","prefix$2","hyphenate","duration","hash","originalValue","propertiesToTransitionInJs","prop","interpolator","getStyle","interpolate","parseFloat","missingPlugin","Ticker","step","_prop","complete","delay","createTransitions$1","getComputedStyle","legacy","Transition","params","d","findInViewHierarchy","animateStyle","visible","setStyle","fulfil","propertyNames","computedStyle","current","props","processParams","originalStyle","getAttribute","completed","noReset","resetStyle","_manager","Binding","element","attribute","attributeByName","twowayBinding","isUnresolved","warnAboutAmbiguity","isReadonly","isTwoway","wasUndefined","getInitialValue","parentForm","findParentForm","resetValue","formBindings","registerTwowayBinding","getValue","_ractive","binding","setFromNode","unregisterTwowayBinding","CheckboxBinding","_Binding","handleDomEvent","attachEvent","checked","BindingGroup","bindings","push$1","CheckboxNameBinding","checkboxName","group","getBindingGroup","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","wasChecked","isChecked","valueSoFar","ContentEditableBinding","lazy","GenericBinding","timeout","isNumeric","handleDelay","handleBlur","MultipleSelectBinding","forceUpdate","selectedValues","selected","optionValue","previousValue","arrayContentsMatch","selectedOptions","setValue","NumericBinding","_GenericBinding","isNaN","siblings","RadioBinding","getSiblings","RadioNameBinding","getValue$2","nameAttributeBinding","getKeypathModel","SingleSelectBinding","optionWasSelected","disabled","Element","toLowerCase","isVoid","voidElementNames","attributes","Attribute","conditionalAttributes","m","ConditionalAttribute","o","decorator","Decorator","fn","CustomEvent","DOMEvent","noContent","createTwowayBinding","shouldBind","twoway","selectBinding","makeDirty$1","namespace","getNamespace","existing","nodeName","toUpperCase","createElement","defineProperty","proxy","rootpath","setAttribute","children","toArray","childNodes","_name","removeAttribute","updateLiveQueries$1","transitionTemplate","t0","t1","transitionsEnabled","registerTransition","_introTransition","attrs","stringifyAttribute","isSelected","inputIsCheckedRadio","detachWhenReady","t2","_transition","nodes","removeFromLiveQueries","_Element","defaultValue","_Input","isBindable","defaultSelected","selectNode","selectValue","isMultiple","shouldSelect","valueContains","findParentSelect","selectedAttribute","handleReset","mutatorMethods","patchedArrayProto","methodName","method","_len","_key","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","array","configurable","unpatch","patch","errorMessage","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","err","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","escapeKey","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","isObject","combine$1","Computation","_Model","signature","setter","computationContext","dependencies","childByKey","deps","boundsSensitive","shouldCapture","capture","startCapturing","getter","console","groupCollapsed","functionBody","prettify","getterString","getterUseStack","truncateStack","groupEnd","stopCapturing","setDependencies","_handleChange","clearUnresolveds","child","ComputationChild","mark","Model","RactiveModel","changes","RootModel","computations","applyChanges","_changeHash","flush","compute","computation","getRactiveModel","ractiveModel","has","GlobalModel$1","origin","wrapper","shouldTeardown","_mark","retrieve","updateFromBindings","cascade","constructHook","registryNames","uid","hook","inProcess","queue","begin","getChildQueue","getElementsByTagName","ReferenceExpressionProxy","resolveAliases","aliases","Mustache","isStatic","booleanAttributes","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","codePointSupport","fromCodePoint","codeToChar","fromCharCode","lessThan","greaterThan","invalid","_Mustache","getString","safeToStringValue","refName","getPartialTemplate","named","setTemplate","partialTemplate","forceResetTemplate","RepeatedFragment","iterations","indexRef","keyRef","indexByKey","pendingNewIndices","previousIterations","createIteration","refs","getRefs","z","iteration","unrenderAndDestroy$1","updatePostShuffle","wasArray","toRemove","oldKeys","_fragment","newLength","indices","previousNewIndex","reinsertFrom","existingFragment","sectionType","templateSectionType","SECTION_UNLESS","SECTION_IF","SECTION_EACH","lastType","getType","newFragment","SECTION_WITH","SECTION_IF_WITH","isEmpty","fragmentShouldExist","elementCache","ieBug","ieBlacklist","TABLE","THEAD","TBODY","TR","SELECT","queryResult","querySelector","queryAllResult","querySelectorAll","numNodes","j","html","insertHtml","decodeCharacterReferences","textTypes","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","updateDelegate","namespaces","useProperty","isBoolean","lookupNamespace","getUpdateDelegate","div$1","isSvg","svg$1","parseAttributes","notIn","missingDecorator","dynamicName","dynamicArgs","nameFragment","argsFragment","intermediary","warnOnce","nameChanged","starMaps","wildcardCache","eventPattern","argumentsPattern","dollarArgsPattern","passthru","argsFn","action","g","ref","argMatch","argument","dollarMatch","resolveReference","getFunction","passedArgs","obj","oldEvent","original","preventDefault","stopPropagation","fireEvent","fatal","eventPlugin","prefix$1","isClient","prefixCache","capped","vendors","vendor","hidden","prefix$3","i$2","onChange","onHide","onShow","from","intermediate","min","properties","unprefixPattern","vendorPattern","promise","getElement","append","others","_teardown","removeChild","listener","notEmptyString","_ret","listeners","_subs","subscribers","observer","observers","createObserver","keypaths","wildcardIndex","_model","getComparator","JSON","stringify","thing","comparator","compare","there","here","run","ln","sourcePath","all","isDetached","fireInsertHook","otherNode","compareDocumentPosition","bitmask","b","ancestryA","getAncestry","ancestryB","oldestA","lastItem","oldestB","mutualAncestor","fragmentA","fragmentB","indexA","indexB","fragments","getParent","ancestry","ancestor","_liveComponentQueries","_liveQueries","getOptions","wrap$1","superMethod","force","needsSuper$1","hasSuper","_super","unwrap","addRegistries","addOtherOptions","_Parent","addRegistry","_method","needsSuper","reduce","extendOne","computed","subClass","superClass","TypeError","enumerable","setPrototypeOf","Constructor","window","document","hasConsole","navigator","appName","warn","log","printWarning","welcome","implementation","hasFeature","delimiters","tripleDelimiters","staticDelimiters","staticTripleDelimiters","csp","preserveWhitespace","sanitize","stripComments","modifyArrays","noIntro","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","_Promise","deprecations","deprecated","replacement","deprecate","arg","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","then","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","div","methodNames","unprefixed","prefixed","i$1","j$1","makeFunction","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","outrosComplete","addChild","list","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","changeHook","batch","returnPromise","fulfilPromise","previousBatch","transitionManager","tasks","immediateObservers","deferredObservers","flushChanges","addToArray","task","postRender","_batch","updateHook","arrayProto","unrenderHook$1","badArguments","noRegistryFunctionReturn","teardownHook","errorMessage$1","TEMPLATE_VERSION","mathml","xlink","xml","xmlns","ns","createElementNS","cloneNode","desc","F","requestAnimationFrame","functions","parseOptions","TEMPLATE_INSTRUCTIONS","COMPUTATION_INSTRUCTIONS","fromId","noThrow","getElementById","textContent","isParsed","getParseOptions","val","throwNoParse","addFunctions","parseFor","parseTemplate","getDynamicTemplate","_config","extendPartials","NUMBER_LITERAL","STRING_LITERAL","REFERENCE","captureGroup","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","KeyModel","dependant","KeypathModel","keypathModels","hasProp","originatingModel","indexModels","unresolvedByKey","ticker","unescapeKey","adaptor","getPrefixer","applyValue","parentValue","createBranch","previousOriginatingModel","specificKey","hasKey","branch","discard","existingMatches","_loop","addChildKey","addChildren","getIndexModel","fragmentIndex","getKeyModel","keypathModel","mapped","Function","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","dep","updateKeypathDependants","_updateFromBindings","_updateKeypathDependants","GlobalModel","global","ExpressionProxy","baseResolver","members","factory","exports","module","define","amd","parts","format","logIfDebug","_len2","_key2","_len3","_key3","isFinite","member","arrayLike","called","resolvePromise","rejectPromise","y","tm","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","intialValue","fromExpression","body","fromComputationString","bindTo","hasThis","output","sources","createFunction","exp","instructions","createFunctionFromString","initial","parseAsString","validate$1","existingPartials","newPartials","overwrite","badReference","localViewmodel","hasContextChain","crossedComponentBoundary","prefixKeypath","rootKeypath","rootDot","relativeKeypath","repeater","rx","section","entity","code","parseInt","validateCode","registryName","findInstance","partial","getPartialFromRegistry","findParentPartial","findOwner","findConstructor","hasIndexRef","selectedOption","selectedIndex","firstChild","updateId","updateMultipleSelectValue","updateSelectValue","updateStringValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","updateIEStyleAttribute","updateBoolean","updateNamespacedAttribute","updateAttribute","updateClassName","valueAttribute","className","setAttributeNS","qualified","hasAttribute","haystack","needle","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","mapper","wildcardKeypath","getStarMap","star","num","binary","l","ones","digit","_noArg","getWildcardNames","fireEventAs","initialFire","notifySubscribers","fullName","originalEvent","stopEvent","hyphenatedStr","interpol","description","res","clearTimeout","bindName","bindChecked","typeAttribute","nameAttribute","_ref","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fnBody","tabs","minIndent","prev","Infinity","truncated","getComputationSignature","setterString","initialiseProperties","deprecateRactiveData","getAdaptors","combine","protoAdapt","lookup","hookQueue","childQueue","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","getSuperMethod","_parent","oldSuper","getMessage","correct","isError","deprecateOption","deprecatedOption","extendOtherMethods","userOptions","okQuote","literal","done","next","charCodeAt","readNumberLiteral","readKey","token","getComponentConstructor","ElementConstructor","guid","counter","placeholderId","collect","collection","rerender"],"mappings":"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,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,OAAQ,IAAKC,KAAM,IAAKC,KAAM,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,SAAU,IAAKC,MAAO,IAAKC,IAAK,IAAKC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,IAAK,KAAMC,IAAK,KAAMC,IAAK,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,QAAS,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,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"}