{"version":3,"file":"ractive-legacy.runtime.min.js","sources":["ractive-legacy.runtime.js"],"sourcesContent":["/*\n\tRactive.js v0.8.0-edge\n\tFri Apr 22 2016 20:13:44 GMT+0000 (UTC) - commit abe0d570642476ae620a26297bf555bd9c999cf5\n\n\thttp://ractivejs.org\n\thttp://twitter.com/RactiveJS\n\n\tReleased under the MIT License.\n*/\n\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? module.exports = factory() :\n  typeof define === 'function' && define.amd ? define(factory) :\n  ((function() { var current = global.Ractive; var next = factory(); next.noConflict = function() { global.Ractive = current; return next; }; return global.Ractive = next; })());\n}(this, function () { 'use strict';\n\n  var defaults = {\n  \t// render placement:\n  \tel:                     void 0,\n  \tappend:\t\t\t\t    false,\n\n  \t// template:\n  \ttemplate:               null,\n\n  \t// parse:\n  \tdelimiters:             [ '{{', '}}' ],\n  \ttripleDelimiters:       [ '{{{', '}}}' ],\n  \tstaticDelimiters:       [ '[[', ']]' ],\n  \tstaticTripleDelimiters: [ '[[[', ']]]' ],\n  \tcsp: \t\t\t\t\ttrue,\n  \tinterpolate:            false,\n  \tpreserveWhitespace:     false,\n  \tsanitize:               false,\n  \tstripComments:          true,\n\n  \t// data & binding:\n  \tdata:                   {},\n  \tcomputed:               {},\n  \tmagic:                  false,\n  \tmodifyArrays:           true,\n  \tadapt:                  [],\n  \tisolated:               false,\n  \ttwoway:                 true,\n  \tlazy:                   false,\n\n  \t// transitions:\n  \tnoIntro:                false,\n  \ttransitionsEnabled:     true,\n  \tcomplete:               void 0,\n\n  \t// css:\n  \tcss:                    null,\n  \tnoCssTransform:         false\n  };\n\n  // These are a subset of the easing equations found at\n  // https://raw.github.com/danro/easing-js - license info\n  // follows:\n\n  // --------------------------------------------------\n  // easing.js v0.5.4\n  // Generic set of easing functions with AMD support\n  // https://github.com/danro/easing-js\n  // This code may be freely distributed under the MIT license\n  // http://danro.mit-license.org/\n  // --------------------------------------------------\n  // All functions adapted from Thomas Fuchs & Jeremy Kahn\n  // Easing Equations (c) 2003 Robert Penner, BSD license\n  // https://raw.github.com/danro/easing-js/master/LICENSE\n  // --------------------------------------------------\n\n  // In that library, the functions named easeIn, easeOut, and\n  // easeInOut below are named easeInCubic, easeOutCubic, and\n  // (you guessed it) easeInOutCubic.\n  //\n  // You can add additional easing functions to this list, and they\n  // will be globally available.\n\n\n  var easing = {\n  \tlinear: function ( pos ) { return pos; },\n  \teaseIn: function ( pos ) { return Math.pow( pos, 3 ); },\n  \teaseOut: function ( pos ) { return ( Math.pow( ( pos - 1 ), 3 ) + 1 ); },\n  \teaseInOut: function ( pos ) {\n  \t\tif ( ( pos /= 0.5 ) < 1 ) { return ( 0.5 * Math.pow( pos, 3 ) ); }\n  \t\treturn ( 0.5 * ( Math.pow( ( pos - 2 ), 3 ) + 2 ) );\n  \t}\n  };\n\n  /*global console, navigator */\n\n  var win = typeof window !== 'undefined' ? window : null;\n  var doc = win ? document : null;\n\n  var isClient = !!doc;\n  var isJsdom = ( typeof navigator !== 'undefined' && /jsDom/.test( navigator.appName ) );\n  var hasConsole = ( typeof console !== 'undefined' && typeof console.warn === 'function' && typeof console.warn.apply === 'function' );\n\n  var magicSupported;\n  try {\n  \tObject.defineProperty({}, 'test', { value: 0 });\n  \tmagicSupported = true;\n  } catch ( e ) {\n  \tmagicSupported = false;\n  }\n\n  var svg = doc ?\n  \tdoc.implementation.hasFeature( 'http://www.w3.org/TR/SVG11/feature#BasicStructure', '1.1' ) :\n  \tfalse;\n\n  var vendors = [ 'o', 'ms', 'moz', 'webkit' ];\n\n  function noop () {}\n\n  var exportedShims;\n\n  if ( !win ) {\n  \texportedShims = null;\n  } else {\n  \texportedShims = {};\n\n  \t// Shims for older browsers\n\n  \tif ( !Date.now ) {\n  \t\tDate.now = function () { return +new Date(); };\n  \t}\n\n  \tif ( !String.prototype.trim ) {\n  \t\tString.prototype.trim = function () {\n  \t\t\treturn this.replace(/^\\s+/, '').replace(/\\s+$/, '');\n  \t\t};\n  \t}\n\n  \t// Polyfill for Object.create\n  \tif ( !Object.create ) {\n  \t\tObject.create = (function () {\n  \t\t\tvar Temp = function () {};\n  \t\t\treturn function ( prototype, properties ) {\n  \t\t\t\tif ( typeof prototype !== 'object' ) {\n  \t\t\t\t\tthrow new TypeError( 'Prototype must be an object' );\n  \t\t\t\t}\n  \t\t\t\tTemp.prototype = prototype;\n  \t\t\t\tvar result = new Temp();\n  \t\t\t\tdefineProperties( result, properties );\n  \t\t\t\tTemp.prototype = null;\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t})();\n  \t}\n\n  \t// Polyfill Object.defineProperty\n  \tif ( !Object.defineProperty ) {\n  \t\tObject.defineProperty = defineProperty;\n  \t}\n\n  \tif ( !Object.freeze ) {\n  \t\tObject.freeze = function () { 'LOL'; };\n  \t}\n\n  \t// Polyfill for Object.keys\n  \t// https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Object/keys\n  \tif ( !Object.keys ) {\n  \t\tObject.keys = (function () {\n  \t\t\tvar hasOwnProperty = Object.prototype.hasOwnProperty,\n  \t\t\t\thasDontEnumBug = !({toString: null}).propertyIsEnumerable('toString'),\n  \t\t\t\tdontEnums = [\n  \t\t\t\t\t'toString',\n  \t\t\t\t\t'toLocaleString',\n  \t\t\t\t\t'valueOf',\n  \t\t\t\t\t'hasOwnProperty',\n  \t\t\t\t\t'isPrototypeOf',\n  \t\t\t\t\t'propertyIsEnumerable',\n  \t\t\t\t\t'constructor'\n  \t\t\t\t],\n  \t\t\t\tdontEnumsLength = dontEnums.length;\n\n  \t\t\treturn function ( obj ) {\n  \t\t\t\tif ( typeof obj !== 'object' && typeof obj !== 'function' || obj === null ) {\n  \t\t\t\t\tthrow new TypeError( 'Object.keys called on non-object' );\n  \t\t\t\t}\n\n  \t\t\t\tvar result = [];\n\n  \t\t\t\tfor ( var prop in obj ) {\n  \t\t\t\t\tif ( hasOwnProperty.call( obj, prop ) ){\n  \t\t\t\t\t\tresult.push( prop );\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tif ( hasDontEnumBug ) {\n  \t\t\t\t\tfor ( var i=0; i < dontEnumsLength; i++ ) {\n  \t\t\t\t\t\tif ( hasOwnProperty.call( obj, dontEnums[i] ) ){\n  \t\t\t\t\t\t\tresult.push( dontEnums[i] );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t\treturn result;\n  \t\t\t};\n  \t\t}());\n  \t}\n\n  \t// TODO: use defineProperty to make these non-enumerable\n\n  \t// Array extras\n  \tif ( !Array.prototype.indexOf ) {\n  \t\tArray.prototype.indexOf = function ( needle, i ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar len;\n\n  \t\t\tif ( i === undefined ) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tif ( i < 0 ) {\n  \t\t\t\ti+= this.length;\n  \t\t\t}\n\n  \t\t\tif ( i < 0 ) {\n  \t\t\t\ti = 0;\n  \t\t\t}\n\n  \t\t\tfor ( len = this$1.length; i<len; i++ ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) && this$1[i] === needle ) {\n  \t\t\t\t\treturn i;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn -1;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.forEach ) {\n  \t\tArray.prototype.forEach = function ( callback, context ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, len;\n\n  \t\t\tfor ( i=0, len=this$1.length; i<len; i+=1 ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) ) {\n  \t\t\t\t\tcallback.call( context, this$1[i], i, this$1 );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.map ) {\n  \t\tArray.prototype.map = function ( mapper, context ) {\n  \t\t\tvar array = this, i, len, mapped = [], isActuallyString;\n\n  \t\t\t// incredibly, if you do something like\n  \t\t\t// Array.prototype.map.call( someString, iterator )\n  \t\t\t// then `this` will become an instance of String in IE8.\n  \t\t\t// And in IE8, you then can't do string[i]. Facepalm.\n  \t\t\tif ( array instanceof String ) {\n  \t\t\t\tarray = array.toString();\n  \t\t\t\tisActuallyString = true;\n  \t\t\t}\n\n  \t\t\tfor ( i=0, len=array.length; i<len; i+=1 ) {\n  \t\t\t\tif ( array.hasOwnProperty( i ) || isActuallyString ) {\n  \t\t\t\t\tmapped[i] = mapper.call( context, array[i], i, array );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn mapped;\n  \t\t};\n  \t}\n\n  \tif ( typeof Array.prototype.reduce !== 'function' ) {\n  \t\tArray.prototype.reduce = function(callback, opt_initialValue){\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, value, len, valueIsSet;\n\n  \t\t\tif ('function' !== typeof callback) {\n  \t\t\t\tthrow new TypeError(callback + ' is not a function');\n  \t\t\t}\n\n  \t\t\tlen = this.length;\n  \t\t\tvalueIsSet = false;\n\n  \t\t\tif ( arguments.length > 1 ) {\n  \t\t\t\tvalue = opt_initialValue;\n  \t\t\t\tvalueIsSet = true;\n  \t\t\t}\n\n  \t\t\tfor ( i = 0; i < len; i += 1) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) ) {\n  \t\t\t\t\tif ( valueIsSet ) {\n  \t\t\t\t\t\tvalue = callback(value, this$1[i], i, this$1);\n  \t\t\t\t\t}\n  \t\t\t\t} else {\n  \t\t\t\t\tvalue = this$1[i];\n  \t\t\t\t\tvalueIsSet = true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( !valueIsSet ) {\n  \t\t\t\tthrow new TypeError( 'Reduce of empty array with no initial value' );\n  \t\t\t}\n\n  \t\t\treturn value;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.filter ) {\n  \t\tArray.prototype.filter = function ( filter, context ) {\n  \t\t\tvar this$1 = this;\n\n  \t\t\tvar i, len, filtered = [];\n\n  \t\t\tfor ( i=0, len=this$1.length; i<len; i+=1 ) {\n  \t\t\t\tif ( this$1.hasOwnProperty( i ) && filter.call( context, this$1[i], i, this$1 ) ) {\n  \t\t\t\t\tfiltered[ filtered.length ] = this$1[i];\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn filtered;\n  \t\t};\n  \t}\n\n  \tif ( !Array.prototype.every ) {\n  \t\tArray.prototype.every = function ( iterator, context ) {\n  \t\t\tvar t, len, i;\n\n  \t\t\tif ( this == null ) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tt = Object( this );\n  \t\t\tlen = t.length >>> 0;\n\n  \t\t\tif ( typeof iterator !== 'function' ) {\n  \t\t\t\tthrow new TypeError();\n  \t\t\t}\n\n  \t\t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\t\tif ( i in t && !iterator.call( context, t[i], i, t) ) {\n  \t\t\t\t\treturn false;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn true;\n  \t\t};\n  \t}\n\n  \tif ( typeof Function.prototype.bind !== 'function' ) {\n  \t\tFunction.prototype.bind = function ( context ) {\n  \t\t\tvar args, fn, Empty, bound, slice = [].slice;\n\n  \t\t\tif ( typeof this !== 'function' ) {\n  \t\t\t\tthrow new TypeError( 'Function.prototype.bind called on non-function' );\n  \t\t\t}\n\n  \t\t\targs = slice.call( arguments, 1 );\n  \t\t\tfn = this;\n  \t\t\tEmpty = function () {};\n\n  \t\t\tbound = function () {\n  \t\t\t\tvar ctx = this instanceof Empty && context ? this : context;\n  \t\t\t\treturn fn.apply( ctx, args.concat( slice.call( arguments ) ) );\n  \t\t\t};\n\n  \t\t\tEmpty.prototype = this.prototype;\n  \t\t\tbound.prototype = new Empty();\n\n  \t\t\treturn bound;\n  \t\t};\n  \t}\n\n  \t// https://gist.github.com/Rich-Harris/6010282 via https://gist.github.com/jonathantneal/2869388\n  \t// addEventListener polyfill IE6+\n  \tif ( !win.addEventListener ) {\n  \t\t((function(win, doc) {\n  \t\t\tvar Event, addEventListener, removeEventListener, head, style, origCreateElement;\n\n  \t\t\t// because sometimes inquiring minds want to know\n  \t\t\twin.appearsToBeIELessEqual8 = true;\n\n  \t\t\tEvent = function ( e, element ) {\n  \t\t\t\tvar property, instance = this;\n\n  \t\t\t\tfor ( property in e ) {\n  \t\t\t\t\tinstance[ property ] = e[ property ];\n  \t\t\t\t}\n\n  \t\t\t\tinstance.currentTarget =  element;\n  \t\t\t\tinstance.target = e.srcElement || element;\n  \t\t\t\tinstance.timeStamp = +new Date();\n\n  \t\t\t\tinstance.preventDefault = function () {\n  \t\t\t\t\te.returnValue = false;\n  \t\t\t\t};\n\n  \t\t\t\tinstance.stopPropagation = function () {\n  \t\t\t\t\te.cancelBubble = true;\n  \t\t\t\t};\n  \t\t\t};\n\n  \t\t\taddEventListener = function ( type, listener ) {\n  \t\t\t\tvar element = this, listeners, i;\n\n  \t\t\t\tlisteners = element.listeners || ( element.listeners = [] );\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\tlisteners[i] = [ listener, function (e) {\n  \t\t\t\t\tlistener.call( element, new Event( e, element ) );\n  \t\t\t\t}];\n\n  \t\t\t\telement.attachEvent( 'on' + type, listeners[i][1] );\n  \t\t\t};\n\n  \t\t\tremoveEventListener = function ( type, listener ) {\n  \t\t\t\tvar element = this, listeners, i;\n\n  \t\t\t\tif ( !element.listeners ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tlisteners = element.listeners;\n  \t\t\t\ti = listeners.length;\n\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tif (listeners[i][0] === listener) {\n  \t\t\t\t\t\telement.detachEvent( 'on' + type, listeners[i][1] );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\twin.addEventListener = doc.addEventListener = addEventListener;\n  \t\t\twin.removeEventListener = doc.removeEventListener = removeEventListener;\n\n  \t\t\tif ( 'Element' in win ) {\n  \t\t\t\twin.Element.prototype.addEventListener = addEventListener;\n  \t\t\t\twin.Element.prototype.removeEventListener = removeEventListener;\n  \t\t\t} else {\n  \t\t\t\t// First, intercept any calls to document.createElement - this is necessary\n  \t\t\t\t// because the CSS hack (see below) doesn't come into play until after a\n  \t\t\t\t// node is added to the DOM, which is too late for a lot of Ractive setup work\n  \t\t\t\torigCreateElement = doc.createElement;\n\n  \t\t\t\tdoc.createElement = function ( tagName ) {\n  \t\t\t\t\tvar el = origCreateElement( tagName );\n  \t\t\t\t\tel.addEventListener = addEventListener;\n  \t\t\t\t\tel.removeEventListener = removeEventListener;\n  \t\t\t\t\treturn el;\n  \t\t\t\t};\n\n  \t\t\t\t// Then, mop up any additional elements that weren't created via\n  \t\t\t\t// document.createElement (i.e. with innerHTML).\n  \t\t\t\thead = doc.getElementsByTagName('head')[0];\n  \t\t\t\tstyle = doc.createElement('style');\n\n  \t\t\t\thead.insertBefore( style, head.firstChild );\n\n  \t\t\t\t//style.styleSheet.cssText = '*{-ms-event-prototype:expression(!this.addEventListener&&(this.addEventListener=addEventListener)&&(this.removeEventListener=removeEventListener))}';\n  \t\t\t}\n  \t\t})( win, doc ));\n  \t}\n\n  \t// The getComputedStyle polyfill interacts badly with jQuery, so we don't attach\n  \t// it to window. Instead, we export it for other modules to use as needed\n\n  \t// https://github.com/jonathantneal/Polyfills-for-IE8/blob/master/getComputedStyle.js\n  \tif ( !win.getComputedStyle ) {\n  \t\texportedShims.getComputedStyle = (function () {\n  \t\t\tvar borderSizes = {};\n\n  \t\t\tfunction getPixelSize ( element, style, property, fontSize ) {\n  \t\t\t\tvar sizeWithSuffix = style[property];\n  \t\t\t\tvar size = parseFloat(sizeWithSuffix);\n  \t\t\t\tvar suffix = sizeWithSuffix.split(/\\d/)[0];\n\n  \t\t\t\tif ( isNaN( size ) ) {\n  \t\t\t\t\tif ( /^thin|medium|thick$/.test( sizeWithSuffix ) ) {\n  \t\t\t\t\t\tsize = getBorderPixelSize( sizeWithSuffix );\n  \t\t\t\t\t\tsuffix = '';\n  \t\t\t\t\t}\n\n  \t\t\t\t\telse {\n  \t\t\t\t\t\t// TODO...\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tfontSize = fontSize != null ? fontSize : /%|em/.test(suffix) && element.parentElement ? getPixelSize(element.parentElement, element.parentElement.currentStyle, 'fontSize', null) : 16;\n  \t\t\t\tvar rootSize = property == 'fontSize' ? fontSize : /width/i.test(property) ? element.clientWidth : element.clientHeight;\n\n  \t\t\t\treturn (suffix == 'em') ? size * fontSize : (suffix == 'in') ? size * 96 : (suffix == 'pt') ? size * 96 / 72 : (suffix == '%') ? size / 100 * rootSize : size;\n  \t\t\t}\n\n  \t\t\tfunction getBorderPixelSize ( size ) {\n  \t\t\t\tvar div, bcr;\n\n  \t\t\t\t// `thin`, `medium` and `thick` vary between browsers. (Don't ever use them.)\n  \t\t\t\tif ( !borderSizes[ size ] ) {\n  \t\t\t\t\tdiv = doc.createElement( 'div' );\n  \t\t\t\t\tdiv.style.display = 'block';\n  \t\t\t\t\tdiv.style.position = 'fixed';\n  \t\t\t\t\tdiv.style.width = div.style.height = '0';\n  \t\t\t\t\tdiv.style.borderRight = size + ' solid black';\n\n  \t\t\t\t\tdoc.getElementsByTagName( 'body' )[0].appendChild( div );\n  \t\t\t\t\tbcr = div.getBoundingClientRect();\n\n  \t\t\t\t\tborderSizes[ size ] = bcr.right - bcr.left;\n  \t\t\t\t}\n\n  \t\t\t\treturn borderSizes[ size ];\n  \t\t\t}\n\n  \t\t\tfunction setShortStyleProperty(style, property) {\n  \t\t\t\tvar borderSuffix = property == 'border' ? 'Width' : '';\n  \t\t\t\tvar t = \"\" + property + \"Top\" + borderSuffix;\n  \t\t\t\tvar r = \"\" + property + \"Right\" + borderSuffix;\n  \t\t\t\tvar b = \"\" + property + \"Bottom\" + borderSuffix;\n  \t\t\t\tvar l = \"\" + property + \"Left\" + borderSuffix;\n\n  \t\t\t\tstyle[property] = (style[t] == style[r] == style[b] == style[l] ? [style[t]]\n  \t\t\t\t: style[t] == style[b] && style[l] == style[r] ? [style[t], style[r]]\n  \t\t\t\t: style[l] == style[r] ? [style[t], style[r], style[b]]\n  \t\t\t\t: [style[t], style[r], style[b], style[l]]).join(' ');\n  \t\t\t}\n\n  \t\t\tvar normalProps = {\n  \t\t\t\tfontWeight: 400,\n  \t\t\t\tlineHeight: 1.2, // actually varies depending on font-family, but is generally close enough...\n  \t\t\t\tletterSpacing: 0\n  \t\t\t};\n\n  \t\t\tfunction CSSStyleDeclaration(element) {\n  \t\t\t\tvar currentStyle, style, fontSize, property;\n\n  \t\t\t\tcurrentStyle = element.currentStyle;\n  \t\t\t\tstyle = this;\n  \t\t\t\tfontSize = getPixelSize(element, currentStyle, 'fontSize', null);\n\n  \t\t\t\t// TODO tidy this up, test it, send PR to jonathantneal!\n  \t\t\t\tfor (property in currentStyle) {\n  \t\t\t\t\tif ( currentStyle[property] === 'normal' && normalProps.hasOwnProperty( property ) ) {\n  \t\t\t\t\t\tstyle[ property ] = normalProps[ property ];\n  \t\t\t\t\t} else if ( /width|height|margin.|padding.|border.+W/.test(property) ) {\n  \t\t\t\t\t\tif ( currentStyle[ property ] === 'auto' ) {\n  \t\t\t\t\t\t\tif ( /^width|height/.test( property ) ) {\n  \t\t\t\t\t\t\t\t// just use clientWidth/clientHeight...\n  \t\t\t\t\t\t\t\tstyle[ property ] = ( property === 'width' ? element.clientWidth : element.clientHeight ) + 'px';\n  \t\t\t\t\t\t\t}\n\n  \t\t\t\t\t\t\telse if ( /(?:padding)?Top|Bottom$/.test( property ) ) {\n  \t\t\t\t\t\t\t\tstyle[ property ] = '0px';\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\telse {\n  \t\t\t\t\t\t\tstyle[ property ] = getPixelSize(element, currentStyle, property, fontSize) + 'px';\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if (property === 'styleFloat') {\n  \t\t\t\t\t\tstyle.float = currentStyle[property];\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\tstyle[property] = currentStyle[property];\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\tsetShortStyleProperty(style, 'margin');\n  \t\t\t\tsetShortStyleProperty(style, 'padding');\n  \t\t\t\tsetShortStyleProperty(style, 'border');\n\n  \t\t\t\tstyle.fontSize = fontSize + 'px';\n\n  \t\t\t\treturn style;\n  \t\t\t}\n\n  \t\t\tCSSStyleDeclaration.prototype = {\n  \t\t\t\tconstructor: CSSStyleDeclaration,\n  \t\t\t\tgetPropertyPriority: noop,\n  \t\t\t\tgetPropertyValue: function ( prop ) {\n  \t\t\t\t\treturn this[prop] || '';\n  \t\t\t\t},\n  \t\t\t\titem: noop,\n  \t\t\t\tremoveProperty: noop,\n  \t\t\t\tsetProperty: noop,\n  \t\t\t\tgetPropertyCSSValue: noop\n  \t\t\t};\n\n  \t\t\tfunction getComputedStyle(element) {\n  \t\t\t\treturn new CSSStyleDeclaration(element);\n  \t\t\t}\n\n  \t\t\treturn getComputedStyle;\n  \t\t}());\n  \t}\n  }\n\n  var legacy = exportedShims;\n\n  var html   = 'http://www.w3.org/1999/xhtml';\n  var mathml = 'http://www.w3.org/1998/Math/MathML';\n  var svg$1    = 'http://www.w3.org/2000/svg';\n  var xlink  = 'http://www.w3.org/1999/xlink';\n  var xml    = 'http://www.w3.org/XML/1998/namespace';\n  var xmlns  = 'http://www.w3.org/2000/xmlns';\n\n  var namespaces = { html: html, mathml: mathml, svg: svg$1, xlink: xlink, xml: xml, xmlns: xmlns };\n\n  var createElement;\n  var matches;\n  var div;\n  var methodNames;\n  var unprefixed;\n  var prefixed;\n  var i;\n  var j;\n  var makeFunction;\n  // Test for SVG support\n  if ( !svg ) {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( ns && ns !== html ) {\n  \t\t\tthrow 'This browser does not support namespaces other than http://www.w3.org/1999/xhtml. The most likely cause of this error is that you\\'re trying to render SVG in an older browser. See http://docs.ractivejs.org/latest/svg-and-older-browsers for more information';\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElement( type, extend ) :\n  \t\t\tdoc.createElement( type );\n  \t};\n  } else {\n  \tcreateElement = function ( type, ns, extend ) {\n  \t\tif ( !ns || ns === html ) {\n  \t\t\treturn extend ?\n  \t\t\t\tdoc.createElement( type, extend ) :\n  \t\t\t\tdoc.createElement( type );\n  \t\t}\n\n  \t\treturn extend ?\n  \t\t\tdoc.createElementNS( ns, type, extend ) :\n  \t\t\tdoc.createElementNS( ns, type );\n  \t};\n  }\n\n  function createDocumentFragment () {\n  \treturn doc.createDocumentFragment();\n  }\n\n  function getElement ( input ) {\n  \tvar output;\n\n  \tif ( !input || typeof input === 'boolean' ) { return; }\n\n  \tif ( !win || !doc || !input ) {\n  \t\treturn null;\n  \t}\n\n  \t// We already have a DOM node - no work to do. (Duck typing alert!)\n  \tif ( input.nodeType ) {\n  \t\treturn input;\n  \t}\n\n  \t// Get node from string\n  \tif ( typeof input === 'string' ) {\n  \t\t// try ID first\n  \t\toutput = doc.getElementById( input );\n\n  \t\t// then as selector, if possible\n  \t\tif ( !output && doc.querySelector ) {\n  \t\t\toutput = doc.querySelector( input );\n  \t\t}\n\n  \t\t// did it work?\n  \t\tif ( output && output.nodeType ) {\n  \t\t\treturn output;\n  \t\t}\n  \t}\n\n  \t// If we've been given a collection (jQuery, Zepto etc), extract the first item\n  \tif ( input[0] && input[0].nodeType ) {\n  \t\treturn input[0];\n  \t}\n\n  \treturn null;\n  }\n\n  if ( !isClient ) {\n  \tmatches = null;\n  } else {\n  \tdiv = createElement( 'div' );\n  \tmethodNames = [ 'matches', 'matchesSelector' ];\n\n  \tmakeFunction = function ( methodName ) {\n  \t\treturn function ( node, selector ) {\n  \t\t\treturn node[ methodName ]( selector );\n  \t\t};\n  \t};\n\n  \ti = methodNames.length;\n\n  \twhile ( i-- && !matches ) {\n  \t\tunprefixed = methodNames[i];\n\n  \t\tif ( div[ unprefixed ] ) {\n  \t\t\tmatches = makeFunction( unprefixed );\n  \t\t} else {\n  \t\t\tj = vendors.length;\n  \t\t\twhile ( j-- ) {\n  \t\t\t\tprefixed = vendors[i] + unprefixed.substr( 0, 1 ).toUpperCase() + unprefixed.substring( 1 );\n\n  \t\t\t\tif ( div[ prefixed ] ) {\n  \t\t\t\t\tmatches = makeFunction( prefixed );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// IE8...\n  \tif ( !matches ) {\n  \t\tmatches = function ( node, selector ) {\n  \t\t\tvar nodes, parentNode, i;\n\n  \t\t\tparentNode = node.parentNode;\n\n  \t\t\tif ( !parentNode ) {\n  \t\t\t\t// empty dummy <div>\n  \t\t\t\tdiv.innerHTML = '';\n\n  \t\t\t\tparentNode = div;\n  \t\t\t\tnode = node.cloneNode();\n\n  \t\t\t\tdiv.appendChild( node );\n  \t\t\t}\n\n  \t\t\tnodes = parentNode.querySelectorAll( selector );\n\n  \t\t\ti = nodes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( nodes[i] === node ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn false;\n  \t\t};\n  \t}\n  }\n\n  function detachNode ( node ) {\n  \tif ( node && typeof node.parentNode !== 'unknown' && node.parentNode ) {\n  \t\tnode.parentNode.removeChild( node );\n  \t}\n\n  \treturn node;\n  }\n\n  function safeToStringValue( value ) {\n  \treturn ( value == null || !value.toString ) ? '' : '' + value;\n  }\n\n  var create;\n  var defineProperty;\n  var defineProperties;\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tif ( doc ) {\n  \t\tObject.defineProperty( createElement( 'div' ), 'test', { value: 0 });\n  \t}\n\n  \tdefineProperty = Object.defineProperty;\n  } catch ( err ) {\n  \t// Object.defineProperty doesn't exist, or we're in IE8 where you can\n  \t// only use it with DOM objects (what were you smoking, MSFT?)\n  \tdefineProperty = function ( obj, prop, desc ) {\n  \t\tobj[ prop ] = desc.value;\n  \t};\n  }\n\n  try {\n  \ttry {\n  \t\tObject.defineProperties({}, { test: { value: 0 } });\n  \t} catch ( err ) {\n  \t\t// TODO how do we account for this? noMagic = true;\n  \t\tthrow err;\n  \t}\n\n  \tif ( doc ) {\n  \t\tObject.defineProperties( createElement( 'div' ), { test: { value: 0 } });\n  \t}\n\n  \tdefineProperties = Object.defineProperties;\n  } catch ( err ) {\n  \tdefineProperties = function ( obj, props ) {\n  \t\tvar prop;\n\n  \t\tfor ( prop in props ) {\n  \t\t\tif ( props.hasOwnProperty( prop ) ) {\n  \t\t\t\tdefineProperty( obj, prop, props[ prop ] );\n  \t\t\t}\n  \t\t}\n  \t};\n  }\n\n  try {\n  \tObject.create( null );\n\n  \tcreate = Object.create;\n  } catch ( err ) {\n  \t// sigh\n  \tcreate = (function () {\n  \t\tvar F = function () {};\n\n  \t\treturn function ( proto, props ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( proto === null ) {\n  \t\t\t\treturn {};\n  \t\t\t}\n\n  \t\t\tF.prototype = proto;\n  \t\t\tobj = new F();\n\n  \t\t\tif ( props ) {\n  \t\t\t\tObject.defineProperties( obj, props );\n  \t\t\t}\n\n  \t\t\treturn obj;\n  \t\t};\n  \t}());\n  }\n\n  function extendObj ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tvar prop;\n\n  \tsources.forEach( function ( source ) {\n  \t\tfor ( prop in source ) {\n  \t\t\tif ( hasOwn.call( source, prop ) ) {\n  \t\t\t\ttarget[ prop ] = source[ prop ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  function fillGaps ( target ) {\n  \tvar sources = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) sources[ len ] = arguments[ len + 1 ];\n\n  \tsources.forEach( function ( s ) {\n  \t\tfor ( var key in s ) {\n  \t\t\tif ( hasOwn.call( s, key ) && !( key in target ) ) {\n  \t\t\t\ttarget[ key ] = s[ key ];\n  \t\t\t}\n  \t\t}\n  \t});\n\n  \treturn target;\n  }\n\n  var hasOwn = Object.prototype.hasOwnProperty;\n\n  var toString = Object.prototype.toString;\n  // thanks, http://perfectionkills.com/instanceof-considered-harmful-or-how-to-write-a-robust-isarray/\n  function isArray ( thing ) {\n  \treturn toString.call( thing ) === '[object Array]';\n  }\n\n  function isEqual ( a, b ) {\n  \tif ( a === null && b === null ) {\n  \t\treturn true;\n  \t}\n\n  \tif ( typeof a === 'object' || typeof b === 'object' ) {\n  \t\treturn false;\n  \t}\n\n  \treturn a === b;\n  }\n\n  // http://stackoverflow.com/questions/18082/validate-numbers-in-javascript-isnumeric\n  function isNumeric ( thing ) {\n  \treturn !isNaN( parseFloat( thing ) ) && isFinite( thing );\n  }\n\n  function isObject ( thing ) {\n  \treturn ( thing && toString.call( thing ) === '[object Object]' );\n  }\n\n  var alreadyWarned = {};\n  var log;\n  var printWarning;\n  var welcome;\n  if ( hasConsole ) {\n  \tvar welcomeIntro = [\n  \t\t(\"%cRactive.js %c0.8.0-edge %cin debug mode, %cmore...\"),\n  \t\t'color: rgb(114, 157, 52); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(85, 85, 85); font-weight: normal;',\n  \t\t'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;'\n  \t];\n  \tvar welcomeMessage = \"You're running Ractive 0.8.0-edge in debug mode - messages will be printed to the console to help you fix problems and optimise your application.\\n\\nTo disable debug mode, add this line at the start of your app:\\n  Ractive.DEBUG = false;\\n\\nTo disable debug mode when your app is minified, add this snippet:\\n  Ractive.DEBUG = /unminified/.test(function(){/*unminified*/});\\n\\nGet help and support:\\n  http://docs.ractivejs.org\\n  http://stackoverflow.com/questions/tagged/ractivejs\\n  http://groups.google.com/forum/#!forum/ractive-js\\n  http://twitter.com/ractivejs\\n\\nFound a bug? Raise an issue:\\n  https://github.com/ractivejs/ractive/issues\\n\\n\";\n\n  \twelcome = function () {\n  \t\tvar hasGroup = !!console.groupCollapsed;\n  \t\tconsole[ hasGroup ? 'groupCollapsed' : 'log' ].apply( console, welcomeIntro );\n  \t\tconsole.log( welcomeMessage );\n  \t\tif ( hasGroup ) {\n  \t\t\tconsole.groupEnd( welcomeIntro );\n  \t\t}\n\n  \t\twelcome = noop;\n  \t};\n\n  \tprintWarning = function ( message, args ) {\n  \t\twelcome();\n\n  \t\t// extract information about the instance this message pertains to, if applicable\n  \t\tif ( typeof args[ args.length - 1 ] === 'object' ) {\n  \t\t\tvar options = args.pop();\n  \t\t\tvar ractive = options ? options.ractive : null;\n\n  \t\t\tif ( ractive ) {\n  \t\t\t\t// if this is an instance of a component that we know the name of, add\n  \t\t\t\t// it to the message\n  \t\t\t\tvar name;\n  \t\t\t\tif ( ractive.component && ( name = ractive.component.name ) ) {\n  \t\t\t\t\tmessage = \"<\" + name + \"> \" + message;\n  \t\t\t\t}\n\n  \t\t\t\tvar node;\n  \t\t\t\tif ( node = ( options.node || ( ractive.fragment && ractive.fragment.rendered && ractive.find( '*' ) ) ) ) {\n  \t\t\t\t\targs.push( node );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tconsole.warn.apply( console, [ '%cRactive.js: %c' + message, 'color: rgb(114, 157, 52);', 'color: rgb(85, 85, 85);' ].concat( args ) );\n  \t};\n\n  \tlog = function () {\n  \t\tconsole.log.apply( console, arguments );\n  \t};\n  } else {\n  \tprintWarning = log = welcome = noop;\n  }\n\n  function format ( message, args ) {\n  \treturn message.replace( /%s/g, function () { return args.shift(); } );\n  }\n\n  function fatal ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tthrow new Error( message );\n  }\n\n  function logIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\tlog.apply( null, arguments );\n  \t}\n  }\n\n  function warn ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n  \tprintWarning( message, args );\n  }\n\n  function warnOnce ( message ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tmessage = format( message, args );\n\n  \tif ( alreadyWarned[ message ] ) {\n  \t\treturn;\n  \t}\n\n  \talreadyWarned[ message ] = true;\n  \tprintWarning( message, args );\n  }\n\n  function warnIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarn.apply( null, arguments );\n  \t}\n  }\n\n  function warnOnceIfDebug () {\n  \tif ( Ractive.DEBUG ) {\n  \t\twarnOnce.apply( null, arguments );\n  \t}\n  }\n\n  // Error messages that are used (or could be) in multiple places\n  var badArguments = 'Bad arguments';\n  var noRegistryFunctionReturn = 'A function was specified for \"%s\" %s, but no %s was returned';\n  var missingPlugin = function ( name, type ) { return (\"Missing \\\"\" + name + \"\\\" \" + type + \" plugin. You may need to download a plugin via http://docs.ractivejs.org/latest/plugins#\" + type + \"s\"); };\n\n  function findInViewHierarchy ( registryName, ractive, name ) {\n  \tvar instance = findInstance( registryName, ractive, name );\n  \treturn instance ? instance[ registryName ][ name ] : null;\n  }\n\n  function findInstance ( registryName, ractive, name ) {\n  \twhile ( ractive ) {\n  \t\tif ( name in ractive[ registryName ] ) {\n  \t\t\treturn ractive;\n  \t\t}\n\n  \t\tif ( ractive.isolated ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tractive = ractive.parent;\n  \t}\n  }\n\n  function interpolate ( from, to, ractive, type ) {\n  \tif ( from === to ) return null;\n\n  \tif ( type ) {\n  \t\tvar interpol = findInViewHierarchy( 'interpolators', ractive, type );\n  \t\tif ( interpol ) return interpol( from, to ) || null;\n\n  \t\tfatal( missingPlugin( type, 'interpolator' ) );\n  \t}\n\n  \treturn interpolators.number( from, to ) ||\n  \t       interpolators.array( from, to ) ||\n  \t       interpolators.object( from, to ) ||\n  \t       null;\n  }\n\n  function snap ( to ) {\n  \treturn function () { return to; };\n  }\n\n  var interpolators = {\n  \tnumber: function ( from, to ) {\n  \t\tvar delta;\n\n  \t\tif ( !isNumeric( from ) || !isNumeric( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tfrom = +from;\n  \t\tto = +to;\n\n  \t\tdelta = to - from;\n\n  \t\tif ( !delta ) {\n  \t\t\treturn function () { return from; };\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\treturn from + ( t * delta );\n  \t\t};\n  \t},\n\n  \tarray: function ( from, to ) {\n  \t\tvar intermediate, interpolators, len, i;\n\n  \t\tif ( !isArray( from ) || !isArray( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tintermediate = [];\n  \t\tinterpolators = [];\n\n  \t\ti = len = Math.min( from.length, to.length );\n  \t\twhile ( i-- ) {\n  \t\t\tinterpolators[i] = interpolate( from[i], to[i] );\n  \t\t}\n\n  \t\t// surplus values - don't interpolate, but don't exclude them either\n  \t\tfor ( i=len; i<from.length; i+=1 ) {\n  \t\t\tintermediate[i] = from[i];\n  \t\t}\n\n  \t\tfor ( i=len; i<to.length; i+=1 ) {\n  \t\t\tintermediate[i] = to[i];\n  \t\t}\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tintermediate[i] = interpolators[i]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t},\n\n  \tobject: function ( from, to ) {\n  \t\tvar properties, len, interpolators, intermediate, prop;\n\n  \t\tif ( !isObject( from ) || !isObject( to ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\tproperties = [];\n  \t\tintermediate = {};\n  \t\tinterpolators = {};\n\n  \t\tfor ( prop in from ) {\n  \t\t\tif ( hasOwn.call( from, prop ) ) {\n  \t\t\t\tif ( hasOwn.call( to, prop ) ) {\n  \t\t\t\t\tproperties.push( prop );\n  \t\t\t\t\tinterpolators[ prop ] = interpolate( from[ prop ], to[ prop ] ) || snap( to[ prop ] );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tintermediate[ prop ] = from[ prop ];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tfor ( prop in to ) {\n  \t\t\tif ( hasOwn.call( to, prop ) && !hasOwn.call( from, prop ) ) {\n  \t\t\t\tintermediate[ prop ] = to[ prop ];\n  \t\t\t}\n  \t\t}\n\n  \t\tlen = properties.length;\n\n  \t\treturn function ( t ) {\n  \t\t\tvar i = len, prop;\n\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprop = properties[i];\n\n  \t\t\t\tintermediate[ prop ] = interpolators[ prop ]( t );\n  \t\t\t}\n\n  \t\t\treturn intermediate;\n  \t\t};\n  \t}\n  };\n\n  var refPattern = /\\[\\s*(\\*|[0-9]|[1-9][0-9]+)\\s*\\]/g;\n  var splitPattern = /([^\\\\](?:\\\\\\\\)*)\\./;\n  var escapeKeyPattern = /\\\\|\\./g;\n  var unescapeKeyPattern = /((?:\\\\)+)\\1|\\\\(\\.)/g;\n\n  function escapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( escapeKeyPattern, '\\\\$&' );\n  \t}\n\n  \treturn key;\n  }\n\n  function normalise ( ref ) {\n  \treturn ref ? ref.replace( refPattern, '.$1' ) : '';\n  }\n\n  function splitKeypathI ( keypath ) {\n  \tvar result = [],\n  \t\tmatch;\n\n  \tkeypath = normalise( keypath );\n\n  \twhile ( match = splitPattern.exec( keypath ) ) {\n  \t\tvar index = match.index + match[1].length;\n  \t\tresult.push( keypath.substr( 0, index ) );\n  \t\tkeypath = keypath.substr( index + 1 );\n  \t}\n\n  \tresult.push(keypath);\n\n  \treturn result;\n  }\n\n  function unescapeKey ( key ) {\n  \tif ( typeof key === 'string' ) {\n  \t\treturn key.replace( unescapeKeyPattern, '$1$2' );\n  \t}\n\n  \treturn key;\n  }\n\n  var errorMessage = 'Cannot add to a non-numeric value';\n\n  function add ( ractive, keypath, d ) {\n  \tif ( typeof keypath !== 'string' || !isNumeric( d ) ) {\n  \t\tthrow new Error( 'Bad arguments' );\n  \t}\n\n  \tvar changes;\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tchanges = {};\n\n  \t\tractive.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tvar value = model.get();\n\n  \t\t\tif ( !isNumeric( value ) ) throw new Error( errorMessage );\n\n  \t\t\tchanges[ model.getKeypath() ] = value + d;\n  \t\t});\n\n  \t\treturn ractive.set( changes );\n  \t}\n\n  \tvar value = ractive.get( keypath );\n\n  \tif ( !isNumeric( value ) ) {\n  \t\tthrow new Error( errorMessage );\n  \t}\n\n  \treturn ractive.set( keypath, +value + d );\n  }\n\n  function Ractive$add ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? 1 : +d ) );\n  }\n\n  // TODO: deprecate in future release\n  var deprecations = {\n  \tconstruct: {\n  \t\tdeprecated: 'beforeInit',\n  \t\treplacement: 'onconstruct'\n  \t},\n  \trender: {\n  \t\tdeprecated: 'init',\n  \t\tmessage: 'The \"init\" method has been deprecated ' +\n  \t\t\t'and will likely be removed in a future release. ' +\n  \t\t\t'You can either use the \"oninit\" method which will fire ' +\n  \t\t\t'only once prior to, and regardless of, any eventual ractive ' +\n  \t\t\t'instance being rendered, or if you need to access the ' +\n  \t\t\t'rendered DOM, use \"onrender\" instead. ' +\n  \t\t\t'See http://docs.ractivejs.org/latest/migrating for more information.'\n  \t},\n  \tcomplete: {\n  \t\tdeprecated: 'complete',\n  \t\treplacement: 'oncomplete'\n  \t}\n  };\n\n  var Hook = function Hook ( event ) {\n  \tthis.event = event;\n  \tthis.method = 'on' + event;\n  \tthis.deprecate = deprecations[ event ];\n  };\n\n  Hook.prototype.call = function call ( method, ractive, arg ) {\n  \tif ( ractive[ method ] ) {\n  \t\targ ? ractive[ method ]( arg ) : ractive[ method ]();\n  \t\treturn true;\n  \t}\n  };\n\n  Hook.prototype.fire = function fire ( ractive, arg ) {\n  \tthis.call( this.method, ractive, arg );\n\n  \t// handle deprecations\n  \tif ( !ractive[ this.method ] && this.deprecate && this.call( this.deprecate.deprecated, ractive, arg ) ) {\n  \t\tif ( this.deprecate.message ) {\n  \t\t\twarnIfDebug( this.deprecate.message );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'The method \"%s\" has been deprecated in favor of \"%s\" and will likely be removed in a future release. See http://docs.ractivejs.org/latest/migrating for more information.', this.deprecate.deprecated, this.deprecate.replacement );\n  \t\t}\n  \t}\n\n  \t// TODO should probably use internal method, in case ractive.fire was overwritten\n  \targ ? ractive.fire( this.event, arg ) : ractive.fire( this.event );\n  };\n\n  function addToArray ( array, value ) {\n  \tvar index = array.indexOf( value );\n\n  \tif ( index === -1 ) {\n  \t\tarray.push( value );\n  \t}\n  }\n\n  function arrayContains ( array, value ) {\n  \tfor ( var i = 0, c = array.length; i < c; i++ ) {\n  \t\tif ( array[i] == value ) {\n  \t\t\treturn true;\n  \t\t}\n  \t}\n\n  \treturn false;\n  }\n\n  function arrayContentsMatch ( a, b ) {\n  \tvar i;\n\n  \tif ( !isArray( a ) || !isArray( b ) ) {\n  \t\treturn false;\n  \t}\n\n  \tif ( a.length !== b.length ) {\n  \t\treturn false;\n  \t}\n\n  \ti = a.length;\n  \twhile ( i-- ) {\n  \t\tif ( a[i] !== b[i] ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  function ensureArray ( x ) {\n  \tif ( typeof x === 'string' ) {\n  \t\treturn [ x ];\n  \t}\n\n  \tif ( x === undefined ) {\n  \t\treturn [];\n  \t}\n\n  \treturn x;\n  }\n\n  function lastItem ( array ) {\n  \treturn array[ array.length - 1 ];\n  }\n\n  function removeFromArray ( array, member ) {\n  \tif ( !array ) {\n  \t\treturn;\n  \t}\n\n  \tvar index = array.indexOf( member );\n\n  \tif ( index !== -1 ) {\n  \t\tarray.splice( index, 1 );\n  \t}\n  }\n\n  function toArray ( arrayLike ) {\n  \tvar array = [], i = arrayLike.length;\n  \twhile ( i-- ) {\n  \t\tarray[i] = arrayLike[i];\n  \t}\n\n  \treturn array;\n  }\n\n  var _Promise;\n  var PENDING = {};\n  var FULFILLED = {};\n  var REJECTED = {};\n  if ( typeof Promise === 'function' ) {\n  \t// use native Promise\n  \t_Promise = Promise;\n  } else {\n  \t_Promise = function ( callback ) {\n  \t\tvar fulfilledHandlers = [],\n  \t\t\trejectedHandlers = [],\n  \t\t\tstate = PENDING,\n\n  \t\t\tresult,\n  \t\t\tdispatchHandlers,\n  \t\t\tmakeResolver,\n  \t\t\tfulfil,\n  \t\t\treject,\n\n  \t\t\tpromise;\n\n  \t\tmakeResolver = function ( newState ) {\n  \t\t\treturn function ( value ) {\n  \t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tresult = value;\n  \t\t\t\tstate = newState;\n\n  \t\t\t\tdispatchHandlers = makeDispatcher( ( state === FULFILLED ? fulfilledHandlers : rejectedHandlers ), result );\n\n  \t\t\t\t// dispatch onFulfilled and onRejected handlers asynchronously\n  \t\t\t\twait( dispatchHandlers );\n  \t\t\t};\n  \t\t};\n\n  \t\tfulfil = makeResolver( FULFILLED );\n  \t\treject = makeResolver( REJECTED );\n\n  \t\ttry {\n  \t\t\tcallback( fulfil, reject );\n  \t\t} catch ( err ) {\n  \t\t\treject( err );\n  \t\t}\n\n  \t\tpromise = {\n  \t\t\t// `then()` returns a Promise - 2.2.7\n  \t\t\tthen: function ( onFulfilled, onRejected ) {\n  \t\t\t\tvar promise2 = new _Promise( function ( fulfil, reject ) {\n\n  \t\t\t\t\tvar processResolutionHandler = function ( handler, handlers, forward ) {\n\n  \t\t\t\t\t\t// 2.2.1.1\n  \t\t\t\t\t\tif ( typeof handler === 'function' ) {\n  \t\t\t\t\t\t\thandlers.push( function ( p1result ) {\n  \t\t\t\t\t\t\t\tvar x;\n\n  \t\t\t\t\t\t\t\ttry {\n  \t\t\t\t\t\t\t\t\tx = handler( p1result );\n  \t\t\t\t\t\t\t\t\tresolve( promise2, x, fulfil, reject );\n  \t\t\t\t\t\t\t\t} catch ( err ) {\n  \t\t\t\t\t\t\t\t\treject( err );\n  \t\t\t\t\t\t\t\t}\n  \t\t\t\t\t\t\t});\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\t// Forward the result of promise1 to promise2, if resolution handlers\n  \t\t\t\t\t\t\t// are not given\n  \t\t\t\t\t\t\thandlers.push( forward );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t};\n\n  \t\t\t\t\t// 2.2\n  \t\t\t\t\tprocessResolutionHandler( onFulfilled, fulfilledHandlers, fulfil );\n  \t\t\t\t\tprocessResolutionHandler( onRejected, rejectedHandlers, reject );\n\n  \t\t\t\t\tif ( state !== PENDING ) {\n  \t\t\t\t\t\t// If the promise has resolved already, dispatch the appropriate handlers asynchronously\n  \t\t\t\t\t\twait( dispatchHandlers );\n  \t\t\t\t\t}\n\n  \t\t\t\t});\n\n  \t\t\t\treturn promise2;\n  \t\t\t}\n  \t\t};\n\n  \t\tpromise[ 'catch' ] = function ( onRejected ) {\n  \t\t\treturn this.then( null, onRejected );\n  \t\t};\n\n  \t\treturn promise;\n  \t};\n\n  \t_Promise.all = function ( promises ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\tvar result = [], pending, i, processPromise;\n\n  \t\t\tif ( !promises.length ) {\n  \t\t\t\tfulfil( result );\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tprocessPromise = function ( promise, i ) {\n  \t\t\t\tif ( promise && typeof promise.then === 'function' ) {\n  \t\t\t\t\tpromise.then( function ( value ) {\n  \t\t\t\t\t\tresult[i] = value;\n  \t\t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t\t}, reject );\n  \t\t\t\t}\n\n  \t\t\t\telse {\n  \t\t\t\t\tresult[i] = promise;\n  \t\t\t\t\t--pending || fulfil( result );\n  \t\t\t\t}\n  \t\t\t};\n\n  \t\t\tpending = i = promises.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tprocessPromise( promises[i], i );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \t_Promise.resolve = function ( value ) {\n  \t\treturn new _Promise( function ( fulfil ) {\n  \t\t\tfulfil( value );\n  \t\t});\n  \t};\n\n  \t_Promise.reject = function ( reason ) {\n  \t\treturn new _Promise( function ( fulfil, reject ) {\n  \t\t\treject( reason );\n  \t\t});\n  \t};\n  }\n\n  var Promise$1 = _Promise;\n\n  // TODO use MutationObservers or something to simulate setImmediate\n  function wait ( callback ) {\n  \tsetTimeout( callback, 0 );\n  }\n\n  function makeDispatcher ( handlers, result ) {\n  \treturn function () {\n  \t\tvar handler;\n\n  \t\twhile ( handler = handlers.shift() ) {\n  \t\t\thandler( result );\n  \t\t}\n  \t};\n  }\n\n  function resolve ( promise, x, fulfil, reject ) {\n  \t// Promise Resolution Procedure\n  \tvar then;\n\n  \t// 2.3.1\n  \tif ( x === promise ) {\n  \t\tthrow new TypeError( 'A promise\\'s fulfillment handler cannot return the same promise' );\n  \t}\n\n  \t// 2.3.2\n  \tif ( x instanceof _Promise ) {\n  \t\tx.then( fulfil, reject );\n  \t}\n\n  \t// 2.3.3\n  \telse if ( x && ( typeof x === 'object' || typeof x === 'function' ) ) {\n  \t\ttry {\n  \t\t\tthen = x.then; // 2.3.3.1\n  \t\t} catch ( e ) {\n  \t\t\treject( e ); // 2.3.3.2\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// 2.3.3.3\n  \t\tif ( typeof then === 'function' ) {\n  \t\t\tvar called, resolvePromise, rejectPromise;\n\n  \t\t\tresolvePromise = function ( y ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\tresolve( promise, y, fulfil, reject );\n  \t\t\t};\n\n  \t\t\trejectPromise = function ( r ) {\n  \t\t\t\tif ( called ) {\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t\tcalled = true;\n  \t\t\t\treject( r );\n  \t\t\t};\n\n  \t\t\ttry {\n  \t\t\t\tthen.call( x, resolvePromise, rejectPromise );\n  \t\t\t} catch ( e ) {\n  \t\t\t\tif ( !called ) { // 2.3.3.3.4.1\n  \t\t\t\t\treject( e ); // 2.3.3.3.4.2\n  \t\t\t\t\tcalled = true;\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\telse {\n  \t\t\tfulfil( x );\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tfulfil( x );\n  \t}\n  }\n\n  var TransitionManager = function TransitionManager ( callback, parent ) {\n  \tthis.callback = callback;\n  \tthis.parent = parent;\n\n  \tthis.intros = [];\n  \tthis.outros = [];\n\n  \tthis.children = [];\n  \tthis.totalChildren = this.outroChildren = 0;\n\n  \tthis.detachQueue = [];\n  \tthis.outrosComplete = false;\n\n  \tif ( parent ) {\n  \t\tparent.addChild( this );\n  \t}\n  };\n\n  TransitionManager.prototype.add = function add ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tlist.push( transition );\n  };\n\n  TransitionManager.prototype.addChild = function addChild ( child ) {\n  \tthis.children.push( child );\n\n  \tthis.totalChildren += 1;\n  \tthis.outroChildren += 1;\n  };\n\n  TransitionManager.prototype.decrementOutros = function decrementOutros () {\n  \tthis.outroChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.decrementTotal = function decrementTotal () {\n  \tthis.totalChildren -= 1;\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.detachNodes = function detachNodes () {\n  \tthis.detachQueue.forEach( detach );\n  \tthis.children.forEach( _detachNodes );\n  };\n\n  TransitionManager.prototype.remove = function remove ( transition ) {\n  \tvar list = transition.isIntro ? this.intros : this.outros;\n  \tremoveFromArray( list, transition );\n  \tcheck( this );\n  };\n\n  TransitionManager.prototype.start = function start () {\n  \tthis.intros.concat( this.outros ).forEach( function ( t ) { return t.start(); } );\n  \tthis.ready = true;\n  \tcheck( this );\n  };\n\n  function detach ( element ) {\n  \telement.detach();\n  }\n\n  function _detachNodes ( tm ) { // _ to avoid transpiler quirk\n  \ttm.detachNodes();\n  }\n\n  function check ( tm ) {\n  \tif ( !tm.ready || tm.outros.length || tm.outroChildren ) return;\n\n  \t// If all outros are complete, and we haven't already done this,\n  \t// we notify the parent if there is one, otherwise\n  \t// start detaching nodes\n  \tif ( !tm.outrosComplete ) {\n  \t\tif ( tm.parent && !tm.parent.outrosComplete ) {\n  \t\t\ttm.parent.decrementOutros( tm );\n  \t\t} else {\n  \t\t\ttm.detachNodes();\n  \t\t}\n\n  \t\ttm.outrosComplete = true;\n  \t}\n\n  \t// Once everything is done, we can notify parent transition\n  \t// manager and call the callback\n  \tif ( !tm.intros.length && !tm.totalChildren ) {\n  \t\tif ( typeof tm.callback === 'function' ) {\n  \t\t\ttm.callback();\n  \t\t}\n\n  \t\tif ( tm.parent ) {\n  \t\t\ttm.parent.decrementTotal();\n  \t\t}\n  \t}\n  }\n\n  var changeHook = new Hook( 'change' );\n\n  var batch;\n\n  var runloop = {\n  \tstart: function ( instance, returnPromise ) {\n  \t\tvar promise, fulfilPromise;\n\n  \t\tif ( returnPromise ) {\n  \t\t\tpromise = new Promise$1( function ( f ) { return ( fulfilPromise = f ); } );\n  \t\t}\n\n  \t\tbatch = {\n  \t\t\tpreviousBatch: batch,\n  \t\t\ttransitionManager: new TransitionManager( fulfilPromise, batch && batch.transitionManager ),\n  \t\t\tfragments: [],\n  \t\t\ttasks: [],\n  \t\t\timmediateObservers: [],\n  \t\t\tdeferredObservers: [],\n  \t\t\tractives: [],\n  \t\t\tinstance: instance\n  \t\t};\n\n  \t\treturn promise;\n  \t},\n\n  \tend: function () {\n  \t\tflushChanges();\n  \t\tbatch = batch.previousBatch;\n  \t},\n\n  \taddFragment: function ( fragment ) {\n  \t\taddToArray( batch.fragments, fragment );\n  \t},\n\n  \taddInstance: function ( instance ) {\n  \t\tif ( batch ) addToArray( batch.ractives, instance );\n  \t},\n\n  \taddObserver: function ( observer, defer ) {\n  \t\taddToArray( defer ? batch.deferredObservers : batch.immediateObservers, observer );\n  \t},\n\n  \tregisterTransition: function ( transition ) {\n  \t\ttransition._manager = batch.transitionManager;\n  \t\tbatch.transitionManager.add( transition );\n  \t},\n\n  \t// synchronise node detachments with transition ends\n  \tdetachWhenReady: function ( thing ) {\n  \t\tbatch.transitionManager.detachQueue.push( thing );\n  \t},\n\n  \tscheduleTask: function ( task, postRender ) {\n  \t\tvar _batch;\n\n  \t\tif ( !batch ) {\n  \t\t\ttask();\n  \t\t} else {\n  \t\t\t_batch = batch;\n  \t\t\twhile ( postRender && _batch.previousBatch ) {\n  \t\t\t\t// this can't happen until the DOM has been fully updated\n  \t\t\t\t// otherwise in some situations (with components inside elements)\n  \t\t\t\t// transitions and decorators will initialise prematurely\n  \t\t\t\t_batch = _batch.previousBatch;\n  \t\t\t}\n\n  \t\t\t_batch.tasks.push( task );\n  \t\t}\n  \t}\n  };\n\n  function dispatch ( observer ) {\n  \tobserver.dispatch();\n  }\n\n  function flushChanges () {\n  \tvar which = batch.immediateObservers;\n  \tbatch.immediateObservers = [];\n  \twhich.forEach( dispatch );\n\n  \t// Now that changes have been fully propagated, we can update the DOM\n  \t// and complete other tasks\n  \tvar i = batch.fragments.length;\n  \tvar fragment;\n\n  \twhich = batch.fragments;\n  \tbatch.fragments = [];\n  \tvar ractives = batch.ractives;\n  \tbatch.ractives = [];\n\n  \twhile ( i-- ) {\n  \t\tfragment = which[i];\n\n  \t\t// TODO deprecate this. It's annoying and serves no useful function\n  \t\tvar ractive = fragment.ractive;\n  \t\tchangeHook.fire( ractive, ractive.viewmodel.changes );\n  \t\tractive.viewmodel.changes = {};\n  \t\tremoveFromArray( ractives, ractive );\n\n  \t\tfragment.update();\n  \t}\n\n  \ti = ractives.length;\n  \twhile ( i-- ) {\n  \t\tvar ractive$1 = ractives[i];\n  \t\tchangeHook.fire( ractive$1, ractive$1.viewmodel.changes );\n  \t\tractive$1.viewmodel.changes = {};\n  \t}\n\n  \tbatch.transitionManager.start();\n\n  \twhich = batch.deferredObservers;\n  \tbatch.deferredObservers = [];\n  \twhich.forEach( dispatch );\n\n  \tvar tasks = batch.tasks;\n  \tbatch.tasks = [];\n\n  \tfor ( i = 0; i < tasks.length; i += 1 ) {\n  \t\ttasks[i]();\n  \t}\n\n  \t// If updating the view caused some model blowback - e.g. a triple\n  \t// containing <option> elements caused the binding on the <select>\n  \t// to update - then we start over\n  \tif ( batch.fragments.length || batch.immediateObservers.length || batch.deferredObservers.length || batch.ractives.length ) return flushChanges();\n  }\n\n  var noAnimation = Promise$1.resolve();\n  defineProperty( noAnimation, 'stop', { value: noop });\n\n  var linear = easing.linear;\n\n  function getOptions ( options, instance ) {\n  \toptions = options || {};\n\n  \tvar easing;\n  \tif ( options.easing ) {\n  \t\teasing = typeof options.easing === 'function' ?\n  \t\t\toptions.easing :\n  \t\t\tinstance.easing[ options.easing ];\n  \t}\n\n  \treturn {\n  \t\teasing: easing || linear,\n  \t\tduration: 'duration' in options ? options.duration : 400,\n  \t\tcomplete: options.complete || noop,\n  \t\tstep: options.step || noop\n  \t};\n  }\n\n  function Ractive$animate ( keypath, to, options ) {\n  \tif ( typeof keypath === 'object' ) {\n  \t\tvar keys = Object.keys( keypath );\n\n  \t\tthrow new Error( (\"ractive.animate(...) no longer supports objects. Instead of ractive.animate({\\n  \" + (keys.map( function ( key ) { return (\"'\" + key + \"': \" + (keypath[ key ])); } ).join( '\\n  ' )) + \"\\n}, {...}), do\\n\\n\" + (keys.map( function ( key ) { return (\"ractive.animate('\" + key + \"', \" + (keypath[ key ]) + \", {...});\"); } ).join( '\\n' )) + \"\\n\") );\n  \t}\n\n  \toptions = getOptions( options, this );\n\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar from = model.get();\n\n  \t// don't bother animating values that stay the same\n  \tif ( isEqual( from, to ) ) {\n  \t\toptions.complete( options.to );\n  \t\treturn noAnimation; // TODO should this have .then and .catch methods?\n  \t}\n\n  \tvar interpolator = interpolate( from, to, this, options.interpolator );\n\n  \t// if we can't interpolate the value, set it immediately\n  \tif ( !interpolator ) {\n  \t\trunloop.start();\n  \t\tmodel.set( to );\n  \t\trunloop.end();\n\n  \t\treturn noAnimation;\n  \t}\n\n  \treturn model.animate( from, to, options, interpolator );\n  }\n\n  var detachHook = new Hook( 'detach' );\n\n  function Ractive$detach () {\n  \tif ( this.isDetached ) {\n  \t\treturn this.el;\n  \t}\n\n  \tif ( this.el ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.el = this.fragment.detach();\n  \tthis.isDetached = true;\n\n  \tdetachHook.fire( this );\n  \treturn this.el;\n  }\n\n  function Ractive$find ( selector ) {\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.find('\" + selector + \"') unless instance is rendered to the DOM\") );\n\n  \treturn this.fragment.find( selector );\n  }\n\n  function sortByDocumentPosition ( node, otherNode ) {\n  \tif ( node.compareDocumentPosition ) {\n  \t\tvar bitmask = node.compareDocumentPosition( otherNode );\n  \t\treturn ( bitmask & 2 ) ? 1 : -1;\n  \t}\n\n  \t// In old IE, we can piggy back on the mechanism for\n  \t// comparing component positions\n  \treturn sortByItemPosition( node, otherNode );\n  }\n\n  function sortByItemPosition ( a, b ) {\n  \tvar ancestryA = getAncestry( a.component || a._ractive.proxy );\n  \tvar ancestryB = getAncestry( b.component || b._ractive.proxy );\n\n  \tvar oldestA = lastItem( ancestryA );\n  \tvar oldestB = lastItem( ancestryB );\n  \tvar mutualAncestor;\n\n  \t// remove items from the end of both ancestries as long as they are identical\n  \t// - the final one removed is the closest mutual ancestor\n  \twhile ( oldestA && ( oldestA === oldestB ) ) {\n  \t\tancestryA.pop();\n  \t\tancestryB.pop();\n\n  \t\tmutualAncestor = oldestA;\n\n  \t\toldestA = lastItem( ancestryA );\n  \t\toldestB = lastItem( ancestryB );\n  \t}\n\n  \t// now that we have the mutual ancestor, we can find which is earliest\n  \toldestA = oldestA.component || oldestA;\n  \toldestB = oldestB.component || oldestB;\n\n  \tvar fragmentA = oldestA.parentFragment;\n  \tvar fragmentB = oldestB.parentFragment;\n\n  \t// if both items share a parent fragment, our job is easy\n  \tif ( fragmentA === fragmentB ) {\n  \t\tvar indexA = fragmentA.items.indexOf( oldestA );\n  \t\tvar indexB = fragmentB.items.indexOf( oldestB );\n\n  \t\t// if it's the same index, it means one contains the other,\n  \t\t// so we see which has the longest ancestry\n  \t\treturn ( indexA - indexB ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \t// if mutual ancestor is a section, we first test to see which section\n  \t// fragment comes first\n  \tvar fragments = mutualAncestor.iterations;\n  \tif ( fragments ) {\n  \t\tvar indexA$1 = fragments.indexOf( fragmentA );\n  \t\tvar indexB$1 = fragments.indexOf( fragmentB );\n\n  \t\treturn ( indexA$1 - indexB$1 ) || ancestryA.length - ancestryB.length;\n  \t}\n\n  \tthrow new Error( 'An unexpected condition was met while comparing the position of two components. Please file an issue at https://github.com/ractivejs/ractive/issues - thanks!' );\n  }\n\n  function getParent ( item ) {\n  \tvar parentFragment = item.parentFragment;\n\n  \tif ( parentFragment ) return parentFragment.owner;\n\n  \tif ( item.component && ( parentFragment = item.component.parentFragment ) ) {\n  \t\treturn parentFragment.owner;\n  \t}\n  }\n\n  function getAncestry ( item ) {\n  \tvar ancestry = [ item ];\n  \tvar ancestor = getParent( item );\n\n  \twhile ( ancestor ) {\n  \t\tancestry.push( ancestor );\n  \t\tancestor = getParent( ancestor );\n  \t}\n\n  \treturn ancestry;\n  }\n\n\n  var Query = function Query ( ractive, selector, live, isComponentQuery ) {\n  \tthis.ractive = ractive;\n  \tthis.selector = selector;\n  \tthis.live = live;\n  \tthis.isComponentQuery = isComponentQuery;\n\n  \tthis.result = [];\n\n  \tthis.dirty = true;\n  };\n\n  Query.prototype.add = function add ( item ) {\n  \tthis.result.push( item );\n  \tthis.makeDirty();\n  };\n\n  Query.prototype.cancel = function cancel () {\n  \tvar liveQueries = this._root[ this.isComponentQuery ? 'liveComponentQueries' : 'liveQueries' ];\n  \tvar selector = this.selector;\n\n  \tvar index = liveQueries.indexOf( selector );\n\n  \tif ( index !== -1 ) {\n  \t\tliveQueries.splice( index, 1 );\n  \t\tliveQueries[ selector ] = null;\n  \t}\n  };\n\n  Query.prototype.init = function init () {\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.makeDirty = function makeDirty () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\t// Once the DOM has been updated, ensure the query\n  \t\t// is correctly ordered\n  \t\trunloop.scheduleTask( function () { return this$1.update(); } );\n  \t}\n  };\n\n  Query.prototype.remove = function remove ( nodeOrComponent ) {\n  \tvar index = this.result.indexOf( this.isComponentQuery ? nodeOrComponent.instance : nodeOrComponent );\n  \tif ( index !== -1 ) this.result.splice( index, 1 );\n  };\n\n  Query.prototype.update = function update () {\n  \tthis.result.sort( this.isComponentQuery ? sortByItemPosition : sortByDocumentPosition );\n  \tthis.dirty = false;\n  };\n\n  Query.prototype.test = function test ( item ) {\n  \treturn this.isComponentQuery ?\n  \t\t( !this.selector || item.name === this.selector ) :\n  \t\t( item ? matches( item, this.selector ) : null );\n  };\n\n  function Ractive$findAll ( selector, options ) {\n  \tif ( !this.el ) throw new Error( (\"Cannot call ractive.findAll('\" + selector + \"', ...) unless instance is rendered to the DOM\") );\n\n  \toptions = options || {};\n  \tvar liveQueries = this._liveQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[ selector ];\n  \tif ( query ) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn ( options && options.live ) ? query : query.slice();\n  \t}\n\n  \tquery = new Query( this, selector, !!options.live, false );\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif ( query.live ) {\n  \t\tliveQueries.push( selector );\n  \t\tliveQueries[ '_' + selector ] = query;\n  \t}\n\n  \tthis.fragment.findAll( selector, query );\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findAllComponents ( selector, options ) {\n  \toptions = options || {};\n  \tvar liveQueries = this._liveComponentQueries;\n\n  \t// Shortcut: if we're maintaining a live query with this\n  \t// selector, we don't need to traverse the parallel DOM\n  \tvar query = liveQueries[ selector ];\n  \tif ( query ) {\n  \t\t// Either return the exact same query, or (if not live) a snapshot\n  \t\treturn ( options && options.live ) ? query : query.slice();\n  \t}\n\n  \tquery = new Query( this, selector, !!options.live, true );\n\n  \t// Add this to the list of live queries Ractive needs to maintain,\n  \t// if applicable\n  \tif ( query.live ) {\n  \t\tliveQueries.push( selector );\n  \t\tliveQueries[ '_' + selector ] = query;\n  \t}\n\n  \tthis.fragment.findAllComponents( selector, query );\n\n  \tquery.init();\n  \treturn query.result;\n  }\n\n  function Ractive$findComponent ( selector ) {\n  \treturn this.fragment.findComponent( selector );\n  }\n\n  function Ractive$findContainer ( selector ) {\n  \tif ( this.container ) {\n  \t\tif ( this.container.component && this.container.component.name === selector ) {\n  \t\t\treturn this.container;\n  \t\t} else {\n  \t\t\treturn this.container.findContainer( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function Ractive$findParent ( selector ) {\n\n  \tif ( this.parent ) {\n  \t\tif ( this.parent.component && this.parent.component.name === selector ) {\n  \t\t\treturn this.parent;\n  \t\t} else {\n  \t\t\treturn this.parent.findParent ( selector );\n  \t\t}\n  \t}\n\n  \treturn null;\n  }\n\n  function enqueue ( ractive, event ) {\n  \tif ( ractive.event ) {\n  \t\tractive._eventQueue.push( ractive.event );\n  \t}\n\n  \tractive.event = event;\n  }\n\n  function dequeue ( ractive ) {\n  \tif ( ractive._eventQueue.length ) {\n  \t\tractive.event = ractive._eventQueue.pop();\n  \t} else {\n  \t\tractive.event = null;\n  \t}\n  }\n\n  var starMaps = {};\n\n  // This function takes a keypath such as 'foo.bar.baz', and returns\n  // all the variants of that keypath that include a wildcard in place\n  // of a key, such as 'foo.bar.*', 'foo.*.baz', 'foo.*.*' and so on.\n  // These are then checked against the dependants map (ractive.viewmodel.depsMap)\n  // to see if any pattern observers are downstream of one or more of\n  // these wildcard keypaths (e.g. 'foo.bar.*.status')\n  function getPotentialWildcardMatches ( keypath ) {\n  \tvar keys, starMap, mapper, i, result, wildcardKeypath;\n\n  \tkeys = splitKeypathI( keypath );\n  \tif( !( starMap = starMaps[ keys.length ]) ) {\n  \t\tstarMap = getStarMap( keys.length );\n  \t}\n\n  \tresult = [];\n\n  \tmapper = function ( star, i ) {\n  \t\treturn star ? '*' : keys[i];\n  \t};\n\n  \ti = starMap.length;\n  \twhile ( i-- ) {\n  \t\twildcardKeypath = starMap[i].map( mapper ).join( '.' );\n\n  \t\tif ( !result.hasOwnProperty( wildcardKeypath ) ) {\n  \t\t\tresult.push( wildcardKeypath );\n  \t\t\tresult[ wildcardKeypath ] = true;\n  \t\t}\n  \t}\n\n  \treturn result;\n  }\n\n  // This function returns all the possible true/false combinations for\n  // a given number - e.g. for two, the possible combinations are\n  // [ true, true ], [ true, false ], [ false, true ], [ false, false ].\n  // It does so by getting all the binary values between 0 and e.g. 11\n  function getStarMap ( num ) {\n  \tvar ones = '', max, binary, starMap, mapper, i, j, l, map;\n\n  \tif ( !starMaps[ num ] ) {\n  \t\tstarMap = [];\n\n  \t\twhile ( ones.length < num ) {\n  \t\t\tones += 1;\n  \t\t}\n\n  \t\tmax = parseInt( ones, 2 );\n\n  \t\tmapper = function ( digit ) {\n  \t\t\treturn digit === '1';\n  \t\t};\n\n  \t\tfor ( i = 0; i <= max; i += 1 ) {\n  \t\t\tbinary = i.toString( 2 );\n  \t\t\twhile ( binary.length < num ) {\n  \t\t\t\tbinary = '0' + binary;\n  \t\t\t}\n\n  \t\t\tmap = [];\n  \t\t\tl = binary.length;\n  \t\t\tfor (j = 0; j < l; j++) {\n  \t\t\t\tmap.push( mapper( binary[j] ) );\n  \t\t\t}\n  \t\t\tstarMap[i] = map;\n  \t\t}\n\n  \t\tstarMaps[ num ] = starMap;\n  \t}\n\n  \treturn starMaps[ num ];\n  }\n\n  var wildcardCache = {};\n\n  function fireEvent ( ractive, eventName, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tif ( !eventName ) { return; }\n\n  \tif ( !options.event ) {\n  \t\toptions.event = {\n  \t\t\tname: eventName,\n  \t\t\t// until event not included as argument default\n  \t\t\t_noArg: true\n  \t\t};\n  \t} else {\n  \t\toptions.event.name = eventName;\n  \t}\n\n  \tvar eventNames = getWildcardNames( eventName );\n\n  \tfireEventAs( ractive, eventNames, options.event, options.args, true );\n  }\n\n  function getWildcardNames ( eventName ) {\n  \tif ( wildcardCache.hasOwnProperty( eventName ) ) {\n  \t\treturn wildcardCache[ eventName ];\n  \t} else {\n  \t\treturn wildcardCache[ eventName ] = getPotentialWildcardMatches( eventName );\n  \t}\n  }\n\n  function fireEventAs  ( ractive, eventNames, event, args, initialFire ) {\n\n  \tif ( initialFire === void 0 ) initialFire = false;\n\n  \tvar subscribers, i, bubble = true;\n\n  \tenqueue( ractive, event );\n\n  \tfor ( i = eventNames.length; i >= 0; i-- ) {\n  \t\tsubscribers = ractive._subs[ eventNames[ i ] ];\n\n  \t\tif ( subscribers ) {\n  \t\t\tbubble = notifySubscribers( ractive, subscribers, event, args ) && bubble;\n  \t\t}\n  \t}\n\n  \tdequeue( ractive );\n\n  \tif ( ractive.parent && bubble ) {\n\n  \t\tif ( initialFire && ractive.component ) {\n  \t\t\tvar fullName = ractive.component.name + '.' + eventNames[ eventNames.length-1 ];\n  \t\t\teventNames = getWildcardNames( fullName );\n\n  \t\t\tif( event && !event.component ) {\n  \t\t\t\tevent.component = ractive;\n  \t\t\t}\n  \t\t}\n\n  \t\tfireEventAs( ractive.parent, eventNames, event, args );\n  \t}\n  }\n\n  function notifySubscribers ( ractive, subscribers, event, args ) {\n  \tvar originalEvent = null, stopEvent = false;\n\n  \tif ( event && !event._noArg ) {\n  \t\targs = [ event ].concat( args );\n  \t}\n\n  \t// subscribers can be modified inflight, e.g. \"once\" functionality\n  \t// so we need to copy to make sure everyone gets called\n  \tsubscribers = subscribers.slice();\n\n  \tfor ( var i = 0, len = subscribers.length; i < len; i += 1 ) {\n  \t\tif ( subscribers[ i ].apply( ractive, args ) === false ) {\n  \t\t\tstopEvent = true;\n  \t\t}\n  \t}\n\n  \tif ( event && !event._noArg && stopEvent && ( originalEvent = event.original ) ) {\n  \t\toriginalEvent.preventDefault && originalEvent.preventDefault();\n  \t\toriginalEvent.stopPropagation && originalEvent.stopPropagation();\n  \t}\n\n  \treturn !stopEvent;\n  }\n\n  function Ractive$fire ( eventName ) {\n  \tvar args = [], len = arguments.length - 1;\n  \twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \tfireEvent( this, eventName, { args: args });\n  }\n\n  function badReference ( key ) {\n  \tthrow new Error( (\"An index or key reference (\" + key + \") cannot have child properties\") );\n  }\n\n  function resolveAmbiguousReference ( fragment, ref ) {\n  \tvar localViewmodel = fragment.findContext().root;\n  \tvar keys = splitKeypathI( ref );\n  \tvar key = keys[0];\n\n  \tvar hasContextChain;\n  \tvar crossedComponentBoundary;\n  \tvar aliases;\n\n  \twhile ( fragment ) {\n  \t\t// repeated fragments\n  \t\tif ( fragment.isIteration ) {\n  \t\t\tif ( key === fragment.parent.keyRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getKeyModel();\n  \t\t\t}\n\n  \t\t\tif ( key === fragment.parent.indexRef ) {\n  \t\t\t\tif ( keys.length > 1 ) badReference( key );\n  \t\t\t\treturn fragment.context.getIndexModel( fragment.index );\n  \t\t\t}\n  \t\t}\n\n  \t\t// alias node or iteration\n  \t\tif ( ( ( aliases = fragment.owner.aliases ) || ( aliases = fragment.aliases ) ) && aliases.hasOwnProperty( key ) ) {\n  \t\t\tvar model = aliases[ key ];\n\n  \t\t\tif ( keys.length === 1 ) return model;\n  \t\t\telse if ( typeof model.joinAll === 'function' ) {\n  \t\t\t\treturn model.joinAll( keys.slice( 1 ) );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( fragment.context ) {\n  \t\t\t// TODO better encapsulate the component check\n  \t\t\tif ( !fragment.isRoot || fragment.ractive.component ) hasContextChain = true;\n\n  \t\t\tif ( fragment.context.has( key ) ) {\n  \t\t\t\tif ( crossedComponentBoundary ) {\n  \t\t\t\t\tlocalViewmodel.map( key, fragment.context.joinKey( key ) );\n  \t\t\t\t}\n\n  \t\t\t\treturn fragment.context.joinAll( keys );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( fragment.componentParent && !fragment.ractive.isolated ) {\n  \t\t\t// ascend through component boundary\n  \t\t\tfragment = fragment.componentParent;\n  \t\t\tcrossedComponentBoundary = true;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \tif ( !hasContextChain ) {\n  \t\treturn localViewmodel.joinAll( keys );\n  \t}\n  }\n\n  var stack = [];\n  var captureGroup;\n\n  function startCapturing () {\n  \tstack.push( captureGroup = [] );\n  }\n\n  function stopCapturing () {\n  \tvar dependencies = stack.pop();\n  \tcaptureGroup = stack[ stack.length - 1 ];\n  \treturn dependencies;\n  }\n\n  function capture ( model ) {\n  \tif ( captureGroup ) {\n  \t\tcaptureGroup.push( model );\n  \t}\n  }\n\n  function bind               ( x ) { x.bind(); }\n  function cancel             ( x ) { x.cancel(); }\n  function handleChange       ( x ) { x.handleChange(); }\n  function mark               ( x ) { x.mark(); }\n  function render             ( x ) { x.render(); }\n  function rebind             ( x ) { x.rebind(); }\n  function teardown           ( x ) { x.teardown(); }\n  function unbind             ( x ) { x.unbind(); }\n  function unrender           ( x ) { x.unrender(); }\n  function unrenderAndDestroy ( x ) { x.unrender( true ); }\n  function update             ( x ) { x.update(); }\n  function toString$1           ( x ) { return x.toString(); }\n  function toEscapedString    ( x ) { return x.toString( true ); }\n\n  var requestAnimationFrame;\n\n  // If window doesn't exist, we don't need requestAnimationFrame\n  if ( !win ) {\n  \trequestAnimationFrame = null;\n  } else {\n  \t// https://gist.github.com/paulirish/1579671\n  \t(function(vendors, lastTime, win) {\n\n  \t\tvar x, setTimeout;\n\n  \t\tif ( win.requestAnimationFrame ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tfor ( x = 0; x < vendors.length && !win.requestAnimationFrame; ++x ) {\n  \t\t\twin.requestAnimationFrame = win[vendors[x]+'RequestAnimationFrame'];\n  \t\t}\n\n  \t\tif ( !win.requestAnimationFrame ) {\n  \t\t\tsetTimeout = win.setTimeout;\n\n  \t\t\twin.requestAnimationFrame = function(callback) {\n  \t\t\t\tvar currTime, timeToCall, id;\n\n  \t\t\t\tcurrTime = Date.now();\n  \t\t\t\ttimeToCall = Math.max( 0, 16 - (currTime - lastTime ) );\n  \t\t\t\tid = setTimeout( function() { callback(currTime + timeToCall); }, timeToCall );\n\n  \t\t\t\tlastTime = currTime + timeToCall;\n  \t\t\t\treturn id;\n  \t\t\t};\n  \t\t}\n\n  \t}( vendors, 0, win ));\n\n  \trequestAnimationFrame = win.requestAnimationFrame;\n  }\n\n  var rAF = requestAnimationFrame;\n\n  var getTime = ( win && win.performance && typeof win.performance.now === 'function' ) ?\n  \tfunction () { return win.performance.now(); } :\n  \tfunction () { return Date.now(); };\n\n  // TODO what happens if a transition is aborted?\n\n  var tickers = [];\n  var running = false;\n\n  function tick () {\n  \trunloop.start();\n\n  \tvar now = getTime();\n\n  \tvar i;\n  \tvar ticker;\n\n  \tfor ( i = 0; i < tickers.length; i += 1 ) {\n  \t\tticker = tickers[i];\n\n  \t\tif ( !ticker.tick( now ) ) {\n  \t\t\t// ticker is complete, remove it from the stack, and decrement i so we don't miss one\n  \t\t\ttickers.splice( i--, 1 );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n\n  \tif ( tickers.length ) {\n  \t\trAF( tick );\n  \t} else {\n  \t\trunning = false;\n  \t}\n  }\n\n  var Ticker = function Ticker ( options ) {\n  \tthis.duration = options.duration;\n  \tthis.step = options.step;\n  \tthis.complete = options.complete;\n  \tthis.easing = options.easing;\n\n  \tthis.start = getTime();\n  \tthis.end = this.start + this.duration;\n\n  \tthis.running = true;\n\n  \ttickers.push( this );\n  \tif ( !running ) rAF( tick );\n  };\n\n  Ticker.prototype.tick = function tick$1 ( now ) {\n  \tif ( !this.running ) return false;\n\n  \tif ( now > this.end ) {\n  \t\tif ( this.step ) this.step( 1 );\n  \t\tif ( this.complete ) this.complete( 1 );\n\n  \t\treturn false;\n  \t}\n\n  \tvar elapsed = now - this.start;\n  \tvar eased = this.easing( elapsed / this.duration );\n\n  \tif ( this.step ) this.step( eased );\n\n  \treturn true;\n  };\n\n  Ticker.prototype.stop = function stop () {\n  \tif ( this.abort ) this.abort();\n  \tthis.running = false;\n  };\n\n  var prefixers = {};\n\n  // TODO this is legacy. sooner we can replace the old adaptor API the better\n  function prefixKeypath ( obj, prefix ) {\n  \tvar prefixed = {}, key;\n\n  \tif ( !prefix ) {\n  \t\treturn obj;\n  \t}\n\n  \tprefix += '.';\n\n  \tfor ( key in obj ) {\n  \t\tif ( obj.hasOwnProperty( key ) ) {\n  \t\t\tprefixed[ prefix + key ] = obj[ key ];\n  \t\t}\n  \t}\n\n  \treturn prefixed;\n  }\n\n  function getPrefixer ( rootKeypath ) {\n  \tvar rootDot;\n\n  \tif ( !prefixers[ rootKeypath ] ) {\n  \t\trootDot = rootKeypath ? rootKeypath + '.' : '';\n\n  \t\tprefixers[ rootKeypath ] = function ( relativeKeypath, value ) {\n  \t\t\tvar obj;\n\n  \t\t\tif ( typeof relativeKeypath === 'string' ) {\n  \t\t\t\tobj = {};\n  \t\t\t\tobj[ rootDot + relativeKeypath ] = value;\n  \t\t\t\treturn obj;\n  \t\t\t}\n\n  \t\t\tif ( typeof relativeKeypath === 'object' ) {\n  \t\t\t\t// 'relativeKeypath' is in fact a hash, not a keypath\n  \t\t\t\treturn rootDot ? prefixKeypath( relativeKeypath, rootKeypath ) : relativeKeypath;\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \treturn prefixers[ rootKeypath ];\n  }\n\n  var KeyModel = function KeyModel ( key ) {\n  \tthis.value = key;\n  \tthis.isReadonly = true;\n  \tthis.dependants = [];\n  };\n\n  KeyModel.prototype.get = function get () {\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.getKeypath = function getKeypath () {\n  \treturn unescapeKey( this.value );\n  };\n\n  KeyModel.prototype.rebind = function rebind ( key ) {\n  \tthis.value = key;\n  \tthis.dependants.forEach( handleChange );\n  };\n\n  KeyModel.prototype.register = function register ( dependant ) {\n  \tthis.dependants.push( dependant );\n  };\n\n  KeyModel.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.dependants, dependant );\n  };\n\n  var KeypathModel = function KeypathModel ( parent, ractive ) {\n  \tthis.parent = parent;\n  \tthis.ractive = ractive;\n  \tthis.value = ractive ? parent.getKeypath( ractive ) : parent.getKeypath();\n  \tthis.dependants = [];\n  \tthis.children = [];\n  };\n\n  KeypathModel.prototype.addChild = function addChild( model ) {\n  \tthis.children.push( model );\n  \tmodel.owner = this;\n  };\n\n  KeypathModel.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.getKeypath = function getKeypath () {\n  \treturn this.value;\n  };\n\n  KeypathModel.prototype.handleChange = function handleChange$1 () {\n  \tthis.value = this.ractive ? this.parent.getKeypath( this.ractive ) : this.parent.getKeypath();\n  \tif ( this.ractive && this.owner ) {\n  \t\tthis.ractive.viewmodel.keypathModels[ this.owner.value ] = this;\n  \t}\n  \tthis.children.forEach( handleChange );\n  \tthis.dependants.forEach( handleChange );\n  };\n\n  KeypathModel.prototype.register = function register ( dependant ) {\n  \tthis.dependants.push( dependant );\n  };\n\n  KeypathModel.prototype.removeChild = function removeChild( model ) {\n  \tremoveFromArray( this.children, model );\n  };\n\n  KeypathModel.prototype.teardown = function teardown$1 () {\n  \tif ( this.owner ) this.owner.removeChild( this );\n  \tthis.children.forEach( teardown );\n  };\n\n  KeypathModel.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.dependants, dependant );\n  };\n\n  var hasProp = Object.prototype.hasOwnProperty;\n\n  function updateFromBindings ( model ) {\n  \tmodel.updateFromBindings( true );\n  }\n\n  function updateKeypathDependants ( model ) {\n  \tmodel.updateKeypathDependants();\n  }\n\n  var originatingModel = null;\n\n  var Model = function Model ( parent, key ) {\n  \tthis.deps = [];\n\n  \tthis.children = [];\n  \tthis.childByKey = {};\n\n  \tthis.indexModels = [];\n\n  \tthis.unresolved = [];\n  \tthis.unresolvedByKey = {};\n\n  \tthis.bindings = [];\n  \tthis.patternObservers = [];\n\n  \tthis.value = undefined;\n\n  \tthis.ticker = null;\n\n  \tif ( parent ) {\n  \t\tthis.parent = parent;\n  \t\tthis.root = parent.root;\n  \t\tthis.key = unescapeKey( key );\n  \t\tthis.isReadonly = parent.isReadonly;\n\n  \t\tif ( parent.value ) {\n  \t\t\tthis.value = parent.value[ this.key ];\n  \t\t\tthis.adapt();\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.adapt = function adapt () {\n  \tvar this$1 = this;\n\n  \t\tvar adaptors = this.root.adaptors;\n  \tvar len = adaptors.length;\n\n  \tthis.rewrap = false;\n\n  \t// Exit early if no adaptors\n  \tif ( len === 0 ) return;\n\n  \tvar value = this.value;\n\n  \t// TODO remove this legacy nonsense\n  \tvar ractive = this.root.ractive;\n  \tvar keypath = this.getKeypath();\n\n  \t// tear previous adaptor down if present\n  \tif ( this.wrapper ) {\n  \t\tvar shouldTeardown = !this.wrapper.reset || this.wrapper.reset( value ) === false;\n\n  \t\tif ( shouldTeardown ) {\n  \t\t\tthis.wrapper.teardown();\n  \t\t\tthis.wrapper = null;\n\n  \t\t\t// don't branch for undefined values\n  \t\t\tif ( this.value !== undefined ) {\n  \t\t\t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\t\t\tif ( parentValue[ this.key ] !== this.value ) parentValue[ this.key ] = value;\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = this.wrapper.get();\n  \t\t\treturn;\n  \t\t}\n  \t}\n\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar adaptor = adaptors[i];\n  \t\tif ( adaptor.filter( value, keypath, ractive ) ) {\n  \t\t\tthis$1.wrapper = adaptor.wrap( ractive, value, keypath, getPrefixer( keypath ) );\n  \t\t\tthis$1.wrapper.value = this$1.value;\n  \t\t\tthis$1.wrapper.__model = this$1; // massive temporary hack to enable array adaptor\n\n  \t\t\tthis$1.value = this$1.wrapper.get();\n\n  \t\t\tbreak;\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.addUnresolved = function addUnresolved ( key, resolver ) {\n  \tif ( !this.unresolvedByKey[ key ] ) {\n  \t\tthis.unresolved.push( key );\n  \t\tthis.unresolvedByKey[ key ] = [];\n  \t}\n\n  \tthis.unresolvedByKey[ key ].push( resolver );\n  };\n\n  Model.prototype.animate = function animate ( from, to, options, interpolator ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.ticker ) this.ticker.stop();\n\n  \tvar fulfilPromise;\n  \tvar promise = new Promise$1( function ( fulfil ) { return fulfilPromise = fulfil; } );\n\n  \tthis.ticker = new Ticker({\n  \t\tduration: options.duration,\n  \t\teasing: options.easing,\n  \t\tstep: function ( t ) {\n  \t\t\tvar value = interpolator( t );\n  \t\t\tthis$1.applyValue( value );\n  \t\t\tif ( options.step ) options.step( t, value );\n  \t\t},\n  \t\tcomplete: function () {\n  \t\t\tthis$1.applyValue( to );\n  \t\t\tif ( options.complete ) options.complete( to );\n\n  \t\t\tthis$1.ticker = null;\n  \t\t\tfulfilPromise();\n  \t\t}\n  \t});\n\n  \tpromise.stop = this.ticker.stop;\n  \treturn promise;\n  };\n\n  Model.prototype.applyValue = function applyValue ( value ) {\n  \tif ( isEqual( value, this.value ) ) return;\n\n  \t// TODO deprecate this nonsense\n  \tthis.registerChange( this.getKeypath(), value );\n\n  \tif ( this.parent.wrapper && this.parent.wrapper.set ) {\n  \t\tthis.parent.wrapper.set( this.key, value );\n  \t\tthis.parent.value = this.parent.wrapper.get();\n\n  \t\tthis.value = this.parent.value[ this.key ];\n  \t\tthis.adapt();\n  \t} else if ( this.wrapper ) {\n  \t\tthis.value = value;\n  \t\tthis.adapt();\n  \t} else {\n  \t\tvar parentValue = this.parent.value || this.parent.createBranch( this.key );\n  \t\tparentValue[ this.key ] = value;\n\n  \t\tthis.value = value;\n  \t\tthis.adapt();\n  \t}\n\n  \tthis.parent.clearUnresolveds();\n  \tthis.clearUnresolveds();\n\n  \t// notify dependants\n  \tvar previousOriginatingModel = originatingModel; // for the array.length special case\n  \toriginatingModel = this;\n\n  \tthis.children.forEach( mark );\n  \tthis.deps.forEach( handleChange );\n\n  \tthis.notifyUpstream();\n\n  \toriginatingModel = previousOriginatingModel;\n  };\n\n  Model.prototype.clearUnresolveds = function clearUnresolveds ( specificKey ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.unresolved.length;\n\n  \twhile ( i-- ) {\n  \t\tvar key = this$1.unresolved[i];\n\n  \t\tif ( specificKey && key !== specificKey ) continue;\n\n  \t\tvar resolvers = this$1.unresolvedByKey[ key ];\n  \t\tvar hasKey = this$1.has( key );\n\n  \t\tvar j = resolvers.length;\n  \t\twhile ( j-- ) {\n  \t\t\tif ( hasKey ) resolvers[j].attemptResolution();\n  \t\t\tif ( resolvers[j].resolved ) resolvers.splice( j, 1 );\n  \t\t}\n\n  \t\tif ( !resolvers.length ) {\n  \t\t\tthis$1.unresolved.splice( i, 1 );\n  \t\t\tthis$1.unresolvedByKey[ key ] = null;\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.createBranch = function createBranch ( key ) {\n  \tvar branch = isNumeric( key ) ? [] : {};\n  \tthis.set( branch );\n\n  \treturn branch;\n  };\n\n  Model.prototype.findMatches = function findMatches ( keys ) {\n  \tvar len = keys.length;\n\n  \tvar existingMatches = [ this ];\n  \tvar matches;\n  \tvar i;\n\n  \tvar loop = function (  ) {\n  \t\tvar key = keys[i];\n\n  \t\tif ( key === '*' ) {\n  \t\t\tmatches = [];\n  \t\t\texistingMatches.forEach( function ( model ) {\n  \t\t\t\tmatches.push.apply( matches, model.getValueChildren( model.get() ) );\n  \t\t\t});\n  \t\t} else {\n  \t\t\tmatches = existingMatches.map( function ( model ) { return model.joinKey( key ); } );\n  \t\t}\n\n  \t\texistingMatches = matches;\n  \t};\n\n  \t\tfor ( i = 0; i < len; i += 1 ) loop(  );\n\n  \treturn matches;\n  };\n\n  Model.prototype.get = function get ( shouldCapture ) {\n  \tif ( shouldCapture ) capture( this );\n  \treturn this.value;\n  };\n\n  Model.prototype.getIndexModel = function getIndexModel ( fragmentIndex ) {\n  \tvar indexModels = this.parent.indexModels;\n\n  \t// non-numeric keys are a special of a numeric index in a object iteration\n  \tif ( typeof this.key === 'string' && fragmentIndex !== undefined ) {\n  \t\treturn new KeyModel( fragmentIndex );\n  \t} else if ( !indexModels[ this.key ] ) {\n  \t\tindexModels[ this.key ] = new KeyModel( this.key );\n  \t}\n\n  \treturn indexModels[ this.key ];\n  };\n\n  Model.prototype.getKeyModel = function getKeyModel () {\n  \t// TODO... different to IndexModel because key can never change\n  \treturn new KeyModel( escapeKey( this.key ) );\n  };\n\n  Model.prototype.getKeypathModel = function getKeypathModel ( ractive ) {\n  \tvar keypath = this.getKeypath(), model = this.keypathModel || ( this.keypathModel = new KeypathModel( this ) );\n\n  \tif ( ractive && ractive.component ) {\n  \t\tvar mapped = this.getKeypath( ractive );\n  \t\tif ( mapped !== keypath ) {\n  \t\t\tvar map = ractive.viewmodel.keypathModels || ( ractive.viewmodel.keypathModels = {} );\n  \t\t\tvar child = map[ keypath ] || ( map[ keypath ] = new KeypathModel( this, ractive ) );\n  \t\t\tmodel.addChild( child );\n  \t\t\treturn child;\n  \t\t}\n  \t}\n\n  \treturn model;\n  };\n\n  Model.prototype.getKeypath = function getKeypath ( ractive ) {\n  \tvar root = this.parent.isRoot ? escapeKey( this.key ) : this.parent.getKeypath() + '.' + escapeKey( this.key );\n\n  \tif ( ractive && ractive.component ) {\n  \t\tvar map = ractive.viewmodel.mappings;\n  \t\tfor ( var k in map ) {\n  \t\t\tif ( root.indexOf( map[ k ].getKeypath() ) >= 0 ) {\n  \t\t\t\troot = root.replace( map[ k ].getKeypath(), k );\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn root;\n  };\n\n  Model.prototype.getValueChildren = function getValueChildren ( value ) {\n  \tvar this$1 = this;\n\n  \t\tvar children;\n  \tif ( isArray( value ) ) {\n  \t\tchildren = [];\n  \t\t// special case - array.length. This is a horrible kludge, but\n  \t\t// it'll do for now. Alternatives welcome\n  \t\tif ( originatingModel && originatingModel.parent === this && originatingModel.key === 'length' ) {\n  \t\t\tchildren.push( originatingModel );\n  \t\t}\n  \t\tvalue.forEach( function ( m, i ) {\n  \t\t\tchildren.push( this$1.joinKey( i ) );\n  \t\t});\n\n  \t}\n\n  \telse if ( isObject( value ) || typeof value === 'function' ) {\n  \t\tchildren = Object.keys( value ).map( function ( key ) { return this$1.joinKey( key ); } );\n  \t}\n\n  \telse if ( value != null ) {\n  \t\treturn [];\n  \t}\n\n  \treturn children;\n  };\n\n  Model.prototype.has = function has ( key ) {\n  \tvar value = this.get();\n  \tif ( !value ) return false;\n\n  \tkey = unescapeKey( key );\n  \tif ( hasProp.call( value, key ) ) return true;\n\n  \t// We climb up the constructor chain to find if one of them contains the key\n  \tvar constructor = value.constructor;\n  \twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\tif ( hasProp.call( constructor.prototype, key ) ) return true;\n  \t\tconstructor = constructor.constructor;\n  \t}\n\n  \treturn false;\n  };\n\n  Model.prototype.joinKey = function joinKey ( key ) {\n  \tif ( key === undefined || key === '' ) return this;\n\n  \tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\tvar child = new Model( this, key );\n  \t\tthis.children.push( child );\n  \t\tthis.childByKey[ key ] = child;\n  \t}\n\n  \treturn this.childByKey[ key ];\n  };\n\n  Model.prototype.joinAll = function joinAll ( keys ) {\n  \tvar model = this;\n  \tfor ( var i = 0; i < keys.length; i += 1 ) {\n  \t\tmodel = model.joinKey( keys[i] );\n  \t}\n\n  \treturn model;\n  };\n\n  Model.prototype.mark = function mark$1 () {\n  \tvar value = this.retrieve();\n\n  \tif ( !isEqual( value, this.value ) ) {\n  \t\tvar old = this.value;\n  \t\tthis.value = value;\n\n  \t\t// make sure the wrapper stays in sync\n  \t\tif ( old !== value || this.rewrap ) this.adapt();\n\n  \t\tthis.children.forEach( mark );\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.clearUnresolveds();\n  \t}\n  };\n\n  Model.prototype.merge = function merge ( array, comparator ) {\n  \tvar oldArray = comparator ? this.value.map( comparator ) : this.value;\n  \tvar newArray = comparator ? array.map( comparator ) : array;\n\n  \tvar oldLength = oldArray.length;\n\n  \tvar usedIndices = {};\n  \tvar firstUnusedIndex = 0;\n\n  \tvar newIndices = oldArray.map( function ( item ) {\n  \t\tvar index;\n  \t\tvar start = firstUnusedIndex;\n\n  \t\tdo {\n  \t\t\tindex = newArray.indexOf( item, start );\n\n  \t\t\tif ( index === -1 ) {\n  \t\t\t\treturn -1;\n  \t\t\t}\n\n  \t\t\tstart = index + 1;\n  \t\t} while ( ( usedIndices[ index ] === true ) && start < oldLength );\n\n  \t\t// keep track of the first unused index, so we don't search\n  \t\t// the whole of newArray for each item in oldArray unnecessarily\n  \t\tif ( index === firstUnusedIndex ) {\n  \t\t\tfirstUnusedIndex += 1;\n  \t\t}\n  \t\t// allow next instance of next \"equal\" to be found item\n  \t\tusedIndices[ index ] = true;\n  \t\treturn index;\n  \t});\n\n  \tthis.parent.value[ this.key ] = array;\n  \tthis._merged = true;\n  \tthis.shuffle( newIndices );\n  };\n\n  Model.prototype.notifyUpstream = function notifyUpstream () {\n  \tvar parent = this.parent, prev = this;\n  \twhile ( parent ) {\n  \t\tif ( parent.patternObservers.length ) parent.patternObservers.forEach( function ( o ) { return o.notify( prev.key ); } );\n  \t\tparent.deps.forEach( handleChange );\n  \t\tprev = parent;\n  \t\tparent = parent.parent;\n  \t}\n  };\n\n  Model.prototype.register = function register ( dep ) {\n  \tthis.deps.push( dep );\n  };\n\n  Model.prototype.registerChange = function registerChange ( key, value ) {\n  \tif ( !this.isRoot ) {\n  \t\tthis.root.registerChange( key, value );\n  \t} else {\n  \t\tthis.changes[ key ] = value;\n  \t\trunloop.addInstance( this.root.ractive );\n  \t}\n  };\n\n  Model.prototype.registerPatternObserver = function registerPatternObserver ( observer ) {\n  \tthis.patternObservers.push( observer );\n  \tthis.register( observer );\n  };\n\n  Model.prototype.registerTwowayBinding = function registerTwowayBinding ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  Model.prototype.retrieve = function retrieve () {\n  \treturn this.parent.value ? this.parent.value[ this.key ] : undefined;\n  };\n\n  Model.prototype.set = function set ( value ) {\n  \tif ( this.ticker ) this.ticker.stop();\n  \tthis.applyValue( value );\n  };\n\n  Model.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tvar indexModels = [];\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tif ( newIndex !== oldIndex && this$1.childByKey[oldIndex] ) this$1.childByKey[oldIndex].shuffled();\n\n  \t\tif ( !~newIndex ) return;\n\n  \t\tvar model = this$1.indexModels[ oldIndex ];\n\n  \t\tif ( !model ) return;\n\n  \t\tindexModels[ newIndex ] = model;\n\n  \t\tif ( newIndex !== oldIndex ) {\n  \t\t\tmodel.rebind( newIndex );\n  \t\t}\n  \t});\n\n  \tthis.indexModels = indexModels;\n\n  \t// shuffles need to happen before marks...\n  \tthis.deps.forEach( function ( dep ) {\n  \t\tif ( dep.shuffle ) dep.shuffle( newIndices );\n  \t});\n\n  \tthis.updateKeypathDependants();\n  \tthis.mark();\n\n  \t// ...but handleChange must happen after (TODO document why)\n  \tthis.deps.forEach( function ( dep ) {\n  \t\tif ( !dep.shuffle ) dep.handleChange();\n  \t});\n  };\n\n  Model.prototype.shuffled = function shuffled () {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.children.length;\n  \twhile ( i-- ) {\n  \t\tthis$1.children[i].shuffled();\n  \t}\n  \tif ( this.wrapper ) {\n  \t\tthis.wrapper.teardown();\n  \t\tthis.wrapper = null;\n  \t\tthis.rewrap = true;\n  \t}\n  };\n\n  Model.prototype.teardown = function teardown$1 () {\n  \tthis.children.forEach( teardown );\n  \tif ( this.wrapper ) this.wrapper.teardown();\n  \tif ( this.keypathModels ) {\n  \t\tfor ( var k in this.keypathModels ) {\n  \t\t\tthis.keypathModels[ k ].teardown();\n  \t\t}\n  \t}\n  };\n\n  Model.prototype.unregister = function unregister ( dependant ) {\n  \tremoveFromArray( this.deps, dependant );\n  };\n\n  Model.prototype.unregisterPatternObserver = function unregisterPatternObserver ( observer ) {\n  \tremoveFromArray( this.patternObservers, observer );\n  \tthis.unregister( observer );\n  };\n\n  Model.prototype.unregisterTwowayBinding = function unregisterTwowayBinding ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  };\n\n  Model.prototype.updateFromBindings = function updateFromBindings$1 ( cascade ) {\n  \tvar this$1 = this;\n\n  \t\tvar i = this.bindings.length;\n  \twhile ( i-- ) {\n  \t\tvar value = this$1.bindings[i].getValue();\n  \t\tif ( value !== this$1.value ) this$1.set( value );\n  \t}\n\n  \tif ( cascade ) {\n  \t\tthis.children.forEach( updateFromBindings );\n  \t}\n  };\n\n  Model.prototype.updateKeypathDependants = function updateKeypathDependants$1 () {\n  \tthis.children.forEach( updateKeypathDependants );\n  \tif ( this.keypathModel ) this.keypathModel.handleChange();\n  };\n\n  var GlobalModel = (function (Model) {\n  \tfunction GlobalModel ( ) {\n  \t\tModel.call( this, null, '@global' );\n  \t\tthis.value = typeof global !== 'undefined' ? global : window;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t}\n\n  \tGlobalModel.prototype = Object.create( Model && Model.prototype );\n  \tGlobalModel.prototype.constructor = GlobalModel;\n\n  \tGlobalModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@global';\n  \t};\n\n  \t// global model doesn't contribute changes events because it has no instance\n  \tGlobalModel.prototype.registerChange = function registerChange () {};\n\n  \treturn GlobalModel;\n  }(Model));\n\n  var GlobalModel$1 = new GlobalModel();\n\n  function resolveReference ( fragment, ref ) {\n  \tvar context = fragment.findContext();\n\n  \t// special references\n  \t// TODO does `this` become `.` at parse time?\n  \tif ( ref === '.' || ref === 'this' ) return context;\n  \tif ( ref === '@keypath' ) return context.getKeypathModel( fragment.ractive );\n  \tif ( ref === '@rootpath' ) return context.getKeypathModel();\n  \tif ( ref === '@index' ) {\n  \t\tvar repeater = fragment.findRepeatingFragment();\n  \t\t// make sure the found fragment is actually an iteration\n  \t\tif ( !repeater.isIteration ) return;\n  \t\treturn repeater.context.getIndexModel( repeater.index );\n  \t}\n  \tif ( ref === '@key' ) return fragment.findRepeatingFragment().context.getKeyModel();\n  \tif ( ref === '@ractive' ) {\n  \t\treturn fragment.ractive.viewmodel.getRactiveModel();\n  \t}\n  \tif ( ref === '@global' ) {\n  \t\treturn GlobalModel$1;\n  \t}\n\n  \t// ancestor references\n  \tif ( ref[0] === '~' ) return fragment.ractive.viewmodel.joinAll( splitKeypathI( ref.slice( 2 ) ) );\n  \tif ( ref[0] === '.' ) {\n  \t\tvar parts = ref.split( '/' );\n\n  \t\twhile ( parts[0] === '.' || parts[0] === '..' ) {\n  \t\t\tvar part = parts.shift();\n\n  \t\t\tif ( part === '..' ) {\n  \t\t\t\tcontext = context.parent;\n  \t\t\t}\n  \t\t}\n\n  \t\tref = parts.join( '/' );\n\n  \t\t// special case - `{{.foo}}` means the same as `{{./foo}}`\n  \t\tif ( ref[0] === '.' ) ref = ref.slice( 1 );\n  \t\treturn context.joinAll( splitKeypathI( ref ) );\n  \t}\n\n  \treturn resolveAmbiguousReference( fragment, ref );\n  }\n\n  function Ractive$get ( keypath ) {\n  \tif ( !keypath ) return this.viewmodel.get( true );\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar key = keys[0];\n\n  \tvar model;\n\n  \tif ( !this.viewmodel.has( key ) ) {\n  \t\t// if this is an inline component, we may need to create\n  \t\t// an implicit mapping\n  \t\tif ( this.component && !this.isolated ) {\n  \t\t\tmodel = resolveReference( this.component.parentFragment, key );\n\n  \t\t\tif ( model ) {\n  \t\t\t\tthis.viewmodel.map( key, model );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tmodel = this.viewmodel.joinAll( keys );\n  \treturn model.get( true );\n  }\n\n  var insertHook = new Hook( 'insert' );\n\n  function Ractive$insert ( target, anchor ) {\n  \tif ( !this.fragment.rendered ) {\n  \t\t// TODO create, and link to, documentation explaining this\n  \t\tthrow new Error( 'The API has changed - you must call `ractive.render(target[, anchor])` to render your Ractive instance. Once rendered you can use `ractive.insert()`.' );\n  \t}\n\n  \ttarget = getElement( target );\n  \tanchor = getElement( anchor ) || null;\n\n  \tif ( !target ) {\n  \t\tthrow new Error( 'You must specify a valid target to insert into' );\n  \t}\n\n  \ttarget.insertBefore( this.detach(), anchor );\n  \tthis.el = target;\n\n  \t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( this );\n  \tthis.isDetached = false;\n\n  \tfireInsertHook( this );\n  }\n\n  function fireInsertHook( ractive ) {\n  \tinsertHook.fire( ractive );\n\n  \tractive.findAllComponents('*').forEach( function ( child ) {\n  \t\tfireInsertHook( child.instance );\n  \t});\n  }\n\n  function link( there, here ) {\n  \tif ( here === there || (there + '.').indexOf( here + '.' ) === 0 || (here + '.').indexOf( there + '.' ) === 0 ) {\n  \t\tthrow new Error( 'A keypath cannot be linked to itself.' );\n  \t}\n\n  \tvar promise = runloop.start();\n\n  \tvar model;\n  \tvar ln = this._links[ here ];\n\n  \tif ( ln ) {\n  \t\tif ( ln.source.model.str !== there || ln.dest.model.str !== here ) {\n  \t\t\tln.unlink();\n  \t\t\tdelete this._links[ here ];\n  \t\t\tthis.viewmodel.joinAll( splitKeypathI( here ) ).set( ln.initialValue );\n  \t\t} else { // already linked, so nothing to do\n  \t\t\trunloop.end();\n  \t\t\treturn promise;\n  \t\t}\n  \t}\n\n  \t// may need to allow a mapping to resolve implicitly\n  \tvar sourcePath = splitKeypathI( there );\n  \tif ( !this.viewmodel.has( sourcePath[0] ) && this.component ) {\n  \t\tmodel = resolveReference( this.component.parentFragment, sourcePath[0] );\n\n  \t\tif ( model ) {\n  \t\t\tthis.viewmodel.map( sourcePath[0], model );\n  \t\t}\n  \t}\n\n  \tln = new Link( this.viewmodel.joinAll( sourcePath ), this.viewmodel.joinAll( splitKeypathI( here ) ), this );\n  \tthis._links[ here ] = ln;\n  \tln.source.handleChange();\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var Link = function Link ( source, dest, ractive ) {\n  \tthis.source = new LinkSide( source, this );\n  \tthis.dest = new LinkSide( dest, this );\n  \tthis.ractive = ractive;\n  \tthis.locked = false;\n  \tthis.initialValue = dest.get();\n  };\n\n  Link.prototype.sync = function sync ( side ) {\n  \tif ( !this.locked ) {\n  \t\tthis.locked = true;\n\n  \t\tif ( side === this.dest ) {\n  \t\t\tthis.source.model.set( this.dest.model.get() );\n  \t\t} else {\n  \t\t\tthis.dest.model.set( this.source.model.get() );\n  \t\t}\n\n  \t\tthis.locked = false;\n  \t}\n  };\n\n  Link.prototype.unlink = function unlink () {\n  \tthis.source.model.unregister( this.source );\n  \tthis.dest.model.unregister( this.dest );\n  };\n\n  var LinkSide = function LinkSide ( model, owner ) {\n  \tthis.model = model;\n  \tthis.owner = owner;\n  \tmodel.register( this );\n  };\n\n  LinkSide.prototype.handleChange = function handleChange () {\n  \tthis.owner.sync( this );\n  };\n\n  var comparators = {};\n\n  function getComparator ( option ) {\n  \tif ( !option ) return null; // use existing arrays\n  \tif ( option === true ) return JSON.stringify;\n  \tif ( typeof option === 'function' ) return option;\n\n  \tif ( typeof option === 'string' ) {\n  \t\treturn comparators[ option ] || ( comparators[ option ] = function ( thing ) { return thing[ option ]; } );\n  \t}\n\n  \tthrow new Error( 'If supplied, options.compare must be a string, function, or `true`' ); // TODO link to docs\n  }\n\n  function Ractive$merge ( keypath, array, options ) {\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar promise = runloop.start( this, true );\n  \tvar value = model.get();\n\n  \tif ( array === value ) {\n  \t\tthrow new Error( 'You cannot merge an array with itself' ); // TODO link to docs\n  \t} else if ( !isArray( value ) || !isArray( array ) ) {\n  \t\tthrow new Error( 'You cannot merge an array with a non-array' );\n  \t}\n\n  \tvar comparator = getComparator( options && options.compare );\n  \tmodel.merge( array, comparator );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function observe ( keypath, callback, options ) {\n  \tvar this$1 = this;\n\n  \tvar observers = [];\n  \tvar map;\n\n  \tif ( isObject( keypath ) ) {\n  \t\tmap = keypath;\n  \t\toptions = callback || {};\n\n  \t\tObject.keys( map ).forEach( function ( keypath ) {\n  \t\t\tvar callback = map[ keypath ];\n\n  \t\t\tkeypath.split( ' ' ).forEach( function ( keypath ) {\n  \t\t\t\tobservers.push( createObserver( this$1, keypath, callback, options ) );\n  \t\t\t});\n  \t\t});\n  \t}\n\n  \telse {\n  \t\tvar keypaths;\n\n  \t\tif ( typeof keypath === 'function' ) {\n  \t\t\toptions = callback;\n  \t\t\tcallback = keypath;\n  \t\t\tkeypaths = [ '' ];\n  \t\t} else {\n  \t\t\tkeypaths = keypath.split( ' ' );\n  \t\t}\n\n  \t\tkeypaths.forEach( function ( keypath ) {\n  \t\t\tobservers.push( createObserver( this$1, keypath, callback, options || {} ) );\n  \t\t});\n  \t}\n\n  \t// add observers to the Ractive instance, so they can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push.apply( this._observers, observers );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobservers.forEach( function ( observer ) {\n  \t\t\t\tremoveFromArray ( this$1._observers, observer );\n  \t\t\t\tobserver.cancel();\n  \t\t\t} );\n  \t\t}\n  \t};\n  }\n\n  function createObserver ( ractive, keypath, callback, options ) {\n  \tvar viewmodel = ractive.viewmodel;\n\n  \tvar keys = splitKeypathI( keypath );\n  \tvar wildcardIndex = keys.indexOf( '*' );\n\n  \t// normal keypath - no wildcards\n  \tif ( !~wildcardIndex ) {\n  \t\tvar key = keys[0];\n\n  \t\t// if not the root model itself, check if viewmodel has key.\n  \t\tif ( key !== '' && !viewmodel.has( key ) ) {\n  \t\t\t// if this is an inline component, we may need to create an implicit mapping\n  \t\t\tif ( ractive.component ) {\n  \t\t\t\tvar model = resolveReference( ractive.component.parentFragment, key );\n  \t\t\t\tif ( model ) viewmodel.map( key, model );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar model$1 = viewmodel.joinAll( keys );\n  \t\treturn new Observer( ractive, model$1, callback, options );\n  \t}\n\n  \t// pattern observers - more complex case\n  \tvar baseModel = wildcardIndex === 0 ?\n  \t\tviewmodel :\n  \t\tviewmodel.joinAll( keys.slice( 0, wildcardIndex ) );\n\n  \treturn new PatternObserver( ractive, baseModel, keys.splice( wildcardIndex ), callback, options );\n  }\n\n  var Observer = function Observer ( ractive, model, callback, options ) {\n  \tthis.context = options.context || ractive;\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath( ractive );\n  \tthis.callback = callback;\n\n  \tthis.oldValue = undefined;\n  \tthis.newValue = model.get();\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValue = this.newValue;\n  \t}\n\n  \tmodel.register( this );\n  };\n\n  Observer.prototype.cancel = function cancel () {\n  \tthis.model.unregister( this );\n  };\n\n  Observer.prototype.dispatch = function dispatch () {\n  \tthis.callback.call( this.context, this.newValue, this.oldValue, this.keypath );\n  \tthis.oldValue = this.newValue;\n  \tthis.dirty = false;\n  };\n\n  Observer.prototype.handleChange = function handleChange () {\n  \tif ( !this.dirty ) {\n  \t\tthis.newValue = this.model.get();\n\n  \t\tif ( this.strict && this.newValue === this.oldValue ) return;\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.once ) this.cancel();\n  \t}\n  };\n\n  var PatternObserver = function PatternObserver ( ractive, baseModel, keys, callback, options ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = options.context || ractive;\n  \tthis.ractive = ractive;\n  \tthis.baseModel = baseModel;\n  \tthis.keys = keys;\n  \tthis.callback = callback;\n\n  \tvar pattern = keys.join( '\\\\.' ).replace( /\\*/g, '(.+)' );\n  \tvar baseKeypath = baseModel.getKeypath( ractive );\n  \tthis.pattern = new RegExp( (\"^\" + (baseKeypath ? baseKeypath + '\\\\.' : '') + \"\" + pattern + \"$\") );\n\n  \tthis.oldValues = {};\n  \tthis.newValues = {};\n\n  \tthis.defer = options.defer;\n  \tthis.once = options.once;\n  \tthis.strict = options.strict;\n\n  \tthis.dirty = false;\n  \tthis.changed = [];\n  \tthis.partial = false;\n\n  \tvar models = baseModel.findMatches( this.keys );\n\n  \tmodels.forEach( function ( model ) {\n  \t\tthis$1.newValues[ model.getKeypath( this$1.ractive ) ] = model.get();\n  \t});\n\n  \tif ( options.init !== false ) {\n  \t\tthis.dispatch();\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tbaseModel.registerPatternObserver( this );\n  };\n\n  PatternObserver.prototype.cancel = function cancel () {\n  \tthis.baseModel.unregisterPatternObserver( this );\n  };\n\n  PatternObserver.prototype.dispatch = function dispatch () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.newValues ).forEach( function ( keypath ) {\n  \t\tif ( this$1.newKeys && !this$1.newKeys[ keypath ] ) return;\n\n  \t\tvar newValue = this$1.newValues[ keypath ];\n  \t\tvar oldValue = this$1.oldValues[ keypath ];\n\n  \t\tif ( this$1.strict && newValue === oldValue ) return;\n  \t\tif ( isEqual( newValue, oldValue ) ) return;\n\n  \t\tvar args = [ newValue, oldValue, keypath ];\n  \t\tif ( keypath ) {\n  \t\t\tvar wildcards = this$1.pattern.exec( keypath ).slice( 1 );\n  \t\t\targs = args.concat( wildcards );\n  \t\t}\n\n  \t\tthis$1.callback.apply( this$1.context, args );\n  \t});\n\n  \tif ( this.partial ) {\n  \t\tfor ( var k in this.newValues ) {\n  \t\t\tthis.oldValues[k] = this.newValues[k];\n  \t\t}\n  \t} else {\n  \t\tthis.oldValues = this.newValues;\n  \t}\n\n  \tthis.newKeys = null;\n  \tthis.dirty = false;\n  };\n\n  PatternObserver.prototype.notify = function notify ( key ) {\n  \tthis.changed.push( key );\n  };\n\n  PatternObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !isArray( this.baseModel.value ) ) return;\n\n  \tvar base = this.baseModel.getKeypath( this.ractive );\n  \tvar max = this.baseModel.value.length;\n  \tvar suffix = this.keys.length > 1 ? '.' + this.keys.slice( 1 ).join( '.' ) : '';\n\n  \tthis.newKeys = {};\n  \tfor ( var i = 0; i < newIndices.length; i++ ) {\n  \t\tif ( newIndices[ i ] === -1 || newIndices[ i ] === i ) continue;\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i + \"\" + suffix) ] = true;\n  \t}\n\n  \tfor ( var i$1 = newIndices.touchedFrom; i$1 < max; i$1++ ) {\n  \t\tthis$1.newKeys[ (\"\" + base + \".\" + i$1 + \"\" + suffix) ] = true;\n  \t}\n  };\n\n  PatternObserver.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\tthis.newValues = {};\n\n  \t\t// handle case where previously extant keypath no longer exists -\n  \t\t// observer should still fire, with undefined as new value\n  \t\t// TODO huh. according to the test suite that's not the case...\n  \t\t// Object.keys( this.oldValues ).forEach( keypath => {\n  \t\t// this.newValues[ keypath ] = undefined;\n  \t\t// });\n\n  \t\tif ( !this.changed.length ) {\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t});\n  \t\t\tthis.partial = false;\n  \t\t} else {\n  \t\t\tvar ok = this.baseModel.isRoot ?\n  \t\t\t\tthis.changed :\n  \t\t\t\tthis.changed.map( function ( key ) { return this$1.baseModel.getKeypath( this$1.ractive ) + '.' + escapeKey( key ); } );\n\n  \t\t\tthis.baseModel.findMatches( this.keys ).forEach( function ( model ) {\n  \t\t\t\tvar keypath = model.getKeypath( this$1.ractive );\n  \t\t\t\t// is this model on a changed keypath?\n  \t\t\t\tif ( ok.filter( function ( k ) { return keypath.indexOf( k ) === 0 && ( keypath.length === k.length || keypath[k.length] === '.' ); } ).length ) {\n  \t\t\t\t\tthis$1.newValues[ keypath ] = model.get();\n  \t\t\t\t}\n  \t\t\t});\n  \t\t\tthis.partial = true;\n  \t\t}\n\n  \t\trunloop.addObserver( this, this.defer );\n  \t\tthis.dirty = true;\n  \t\tthis.changed.length = 0;\n\n  \t\tif ( this.once ) this.cancel();\n  \t}\n  };\n\n  function observeList ( keypath, callback, options ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new Error( 'ractive.observeList() must be passed a string as its first argument' );\n  \t}\n\n  \tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \tvar observer = new ListObserver( this, model, callback, options || {} );\n\n  \t// add observer to the Ractive instance, so it can be\n  \t// cancelled on ractive.teardown()\n  \tthis._observers.push( observer );\n\n  \treturn {\n  \t\tcancel: function () {\n  \t\t\tobserver.cancel();\n  \t\t}\n  \t};\n  }\n\n  function negativeOne () {\n  \treturn -1;\n  }\n\n  var ListObserver = function ListObserver ( context, model, callback, options ) {\n  \tthis.context = context;\n  \tthis.model = model;\n  \tthis.keypath = model.getKeypath();\n  \tthis.callback = callback;\n\n  \tthis.pending = null;\n\n  \tmodel.register( this );\n\n  \tif ( options.init !== false ) {\n  \t\tthis.sliced = [];\n  \t\tthis.shuffle([]);\n  \t\tthis.handleChange();\n  \t} else {\n  \t\tthis.sliced = this.slice();\n  \t}\n  };\n\n  ListObserver.prototype.handleChange = function handleChange () {\n  \tif ( this.pending ) {\n  \t\t// post-shuffle\n  \t\tthis.callback( this.pending );\n  \t\tthis.pending = null;\n  \t}\n\n  \telse {\n  \t\t// entire array changed\n  \t\tthis.shuffle( this.sliced.map( negativeOne ) );\n  \t\tthis.handleChange();\n  \t}\n  };\n\n  ListObserver.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tvar newValue = this.slice();\n\n  \tvar inserted = [];\n  \tvar deleted = [];\n  \tvar start;\n\n  \tvar hadIndex = {};\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\thadIndex[ newIndex ] = true;\n\n  \t\tif ( newIndex !== oldIndex && start === undefined ) {\n  \t\t\tstart = oldIndex;\n  \t\t}\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tdeleted.push( this$1.sliced[ oldIndex ] );\n  \t\t}\n  \t});\n\n  \tif ( start === undefined ) start = newIndices.length;\n\n  \tvar len = newValue.length;\n  \tfor ( var i = 0; i < len; i += 1 ) {\n  \t\tif ( !hadIndex[i] ) inserted.push( newValue[i] );\n  \t}\n\n  \tthis.pending = { inserted: inserted, deleted: deleted, start: start };\n  \tthis.sliced = newValue;\n  };\n\n  ListObserver.prototype.slice = function slice () {\n  \tvar value = this.model.get();\n  \treturn isArray( value ) ? value.slice() : [];\n  };\n\n  var onceOptions = { init: false, once: true };\n\n  function observeOnce ( keypath, callback, options ) {\n  \tif ( isObject( keypath ) || typeof keypath === 'function' ) {\n  \t\toptions = extendObj( callback || {}, onceOptions );\n  \t\treturn this.observe( keypath, options );\n  \t}\n\n  \toptions = extendObj( options || {}, onceOptions );\n  \treturn this.observe( keypath, callback, options );\n  }\n\n  function trim ( str ) { return str.trim(); };\n\n  function notEmptyString ( str ) { return str !== ''; };\n\n  function Ractive$off ( eventName, callback ) {\n  \t// if no arguments specified, remove all callbacks\n  \tvar this$1 = this;\n\n  \tif ( !eventName ) {\n  \t\t// TODO use this code instead, once the following issue has been resolved\n  \t\t// in PhantomJS (tests are unpassable otherwise!)\n  \t\t// https://github.com/ariya/phantomjs/issues/11856\n  \t\t// defineProperty( this, '_subs', { value: create( null ), configurable: true });\n  \t\tfor ( eventName in this._subs ) {\n  \t\t\tdelete this._subs[ eventName ];\n  \t\t}\n  \t}\n\n  \telse {\n  \t\t// Handle multiple space-separated event names\n  \t\tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \t\teventNames.forEach( function ( eventName ) {\n  \t\t\tvar subscribers = this$1._subs[ eventName ];\n\n  \t\t\t// If we have subscribers for this event...\n  \t\t\tif ( subscribers ) {\n  \t\t\t\t// ...if a callback was specified, only remove that\n  \t\t\t\tif ( callback ) {\n  \t\t\t\t\tvar index = subscribers.indexOf( callback );\n  \t\t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\t\tsubscribers.splice( index, 1 );\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// ...otherwise remove all callbacks\n  \t\t\t\telse {\n  \t\t\t\t\tthis$1._subs[ eventName ] = [];\n  \t\t\t\t}\n  \t\t\t}\n  \t\t});\n  \t}\n\n  \treturn this;\n  }\n\n  function Ractive$on ( eventName, callback ) {\n  \t// allow multiple listeners to be bound in one go\n  \tvar this$1 = this;\n\n  \tif ( typeof eventName === 'object' ) {\n  \t\tvar listeners = [];\n  \t\tvar n;\n\n  \t\tfor ( n in eventName ) {\n  \t\t\tif ( eventName.hasOwnProperty( n ) ) {\n  \t\t\t\tlisteners.push( this.on( n, eventName[ n ] ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn {\n  \t\t\tcancel: function () {\n  \t\t\t\tvar listener;\n  \t\t\t\twhile ( listener = listeners.pop() ) listener.cancel();\n  \t\t\t}\n  \t\t};\n  \t}\n\n  \t// Handle multiple space-separated event names\n  \tvar eventNames = eventName.split( ' ' ).map( trim ).filter( notEmptyString );\n\n  \teventNames.forEach( function ( eventName ) {\n  \t\t( this$1._subs[ eventName ] || ( this$1._subs[ eventName ] = [] ) ).push( callback );\n  \t});\n\n  \treturn {\n  \t\tcancel: function () { return this$1.off( eventName, callback ); }\n  \t};\n  }\n\n  function Ractive$once ( eventName, handler ) {\n  \tvar listener = this.on( eventName, function () {\n  \t\thandler.apply( this, arguments );\n  \t\tlistener.cancel();\n  \t});\n\n  \t// so we can still do listener.cancel() manually\n  \treturn listener;\n  }\n\n  // This function takes an array, the name of a mutator method, and the\n  // arguments to call that mutator method with, and returns an array that\n  // maps the old indices to their new indices.\n\n  // So if you had something like this...\n  //\n  //     array = [ 'a', 'b', 'c', 'd' ];\n  //     array.push( 'e' );\n  //\n  // ...you'd get `[ 0, 1, 2, 3 ]` - in other words, none of the old indices\n  // have changed. If you then did this...\n  //\n  //     array.unshift( 'z' );\n  //\n  // ...the indices would be `[ 1, 2, 3, 4, 5 ]` - every item has been moved\n  // one higher to make room for the 'z'. If you removed an item, the new index\n  // would be -1...\n  //\n  //     array.splice( 2, 2 );\n  //\n  // ...this would result in [ 0, 1, -1, -1, 2, 3 ].\n  //\n  // This information is used to enable fast, non-destructive shuffling of list\n  // sections when you do e.g. `ractive.splice( 'items', 2, 2 );\n\n  function getNewIndices ( length, methodName, args ) {\n  \tvar spliceArguments, newIndices = [], removeStart, removeEnd, balance, i;\n\n  \tspliceArguments = getSpliceEquivalent( length, methodName, args );\n\n  \tif ( !spliceArguments ) {\n  \t\treturn null; // TODO support reverse and sort?\n  \t}\n\n  \tbalance = ( spliceArguments.length - 2 ) - spliceArguments[1];\n\n  \tremoveStart = Math.min( length, spliceArguments[0] );\n  \tremoveEnd = removeStart + spliceArguments[1];\n\n  \tfor ( i = 0; i < removeStart; i += 1 ) {\n  \t\tnewIndices.push( i );\n  \t}\n\n  \tfor ( ; i < removeEnd; i += 1 ) {\n  \t\tnewIndices.push( -1 );\n  \t}\n\n  \tfor ( ; i < length; i += 1 ) {\n  \t\tnewIndices.push( i + balance );\n  \t}\n\n  \t// there is a net shift for the rest of the array starting with index + balance\n  \tif ( balance !== 0 ) {\n  \t\tnewIndices.touchedFrom = spliceArguments[0];\n  \t} else {\n  \t\tnewIndices.touchedFrom = length;\n  \t}\n\n  \treturn newIndices;\n  }\n\n\n  // The pop, push, shift an unshift methods can all be represented\n  // as an equivalent splice\n  function getSpliceEquivalent ( length, methodName, args ) {\n  \tswitch ( methodName ) {\n  \t\tcase 'splice':\n  \t\t\tif ( args[0] !== undefined && args[0] < 0 ) {\n  \t\t\t\targs[0] = length + Math.max( args[0], -length );\n  \t\t\t}\n\n  \t\t\twhile ( args.length < 2 ) {\n  \t\t\t\targs.push( length - args[0] );\n  \t\t\t}\n\n  \t\t\t// ensure we only remove elements that exist\n  \t\t\targs[1] = Math.min( args[1], length - args[0] );\n\n  \t\t\treturn args;\n\n  \t\tcase 'sort':\n  \t\tcase 'reverse':\n  \t\t\treturn null;\n\n  \t\tcase 'pop':\n  \t\t\tif ( length ) {\n  \t\t\t\treturn [ length - 1, 1 ];\n  \t\t\t}\n  \t\t\treturn [ 0, 0 ];\n\n  \t\tcase 'push':\n  \t\t\treturn [ length, 0 ].concat( args );\n\n  \t\tcase 'shift':\n  \t\t\treturn [ 0, length ? 1 : 0 ];\n\n  \t\tcase 'unshift':\n  \t\t\treturn [ 0, 0 ].concat( args );\n  \t}\n  }\n\n  var arrayProto = Array.prototype;\n\n  function makeArrayMethod ( methodName ) {\n  \treturn function ( keypath ) {\n  \t\tvar args = [], len = arguments.length - 1;\n  \t\twhile ( len-- > 0 ) args[ len ] = arguments[ len + 1 ];\n\n  \t\tvar model = this.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \t\tvar array = model.get();\n\n  \t\tif ( !isArray( array ) ) {\n  \t\t\tif ( array === undefined ) {\n  \t\t\t\tarray = [];\n  \t\t\t\tvar result$1 = arrayProto[ methodName ].apply( array, args );\n  \t\t\t\treturn this.set( keypath, array ).then( function () { return result$1; } );\n  \t\t\t} else {\n  \t\t\t\tthrow new Error( (\"shuffle array method \" + methodName + \" called on non-array at \" + (model.getKeypath())) );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar newIndices = getNewIndices( array.length, methodName, args );\n  \t\tvar result = arrayProto[ methodName ].apply( array, args );\n\n  \t\tvar promise = runloop.start( this, true ).then( function () { return result; } );\n  \t\tpromise.result = result;\n\n  \t\tif ( newIndices ) {\n  \t\t\tmodel.shuffle( newIndices );\n  \t\t} else {\n  \t\t\tmodel.set( result );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\treturn promise;\n  \t};\n  }\n\n  var pop = makeArrayMethod( 'pop' );\n\n  var push = makeArrayMethod( 'push' );\n\n  var PREFIX = '/* Ractive.js component styles */';\n\n  // Holds current definitions of styles.\n  var styleDefinitions = [];\n\n  // Flag to tell if we need to update the CSS\n  var isDirty = false;\n\n  // These only make sense on the browser. See additional setup below.\n  var styleElement = null;\n  var useCssText = null;\n\n  function addCSS( styleDefinition ) {\n  \tstyleDefinitions.push( styleDefinition );\n  \tisDirty = true;\n  }\n\n  function applyCSS() {\n\n  \t// Apply only seems to make sense when we're in the DOM. Server-side renders\n  \t// can call toCSS to get the updated CSS.\n  \tif ( !doc || !isDirty ) return;\n\n  \tif ( useCssText ) {\n  \t\tstyleElement.styleSheet.cssText = getCSS( null );\n  \t} else {\n  \t\tstyleElement.innerHTML = getCSS( null );\n  \t}\n\n  \tisDirty = false;\n  }\n\n  function getCSS( cssIds ) {\n\n  \tvar filteredStyleDefinitions = cssIds ? styleDefinitions.filter( function ( style ) { return ~cssIds.indexOf( style.id ); } ) : styleDefinitions;\n\n  \treturn filteredStyleDefinitions.reduce( function ( styles, style ) { return (\"\" + styles + \"\\n\\n/* {\" + (style.id) + \"} */\\n\" + (style.styles)); }, PREFIX );\n\n  }\n\n  // If we're on the browser, additional setup needed.\n  if ( doc && ( !styleElement || !styleElement.parentNode ) ) {\n\n  \tstyleElement = doc.createElement( 'style' );\n  \tstyleElement.type = 'text/css';\n\n  \tdoc.getElementsByTagName( 'head' )[ 0 ].appendChild( styleElement );\n\n  \tuseCssText = !!styleElement.styleSheet;\n  }\n\n  var renderHook = new Hook( 'render' );\n  var completeHook = new Hook( 'complete' );\n\n  function render$1 ( ractive, target, anchor, occupants ) {\n  \t// if `noIntro` is `true`, temporarily disable transitions\n  \tvar transitionsEnabled = ractive.transitionsEnabled;\n  \tif ( ractive.noIntro ) ractive.transitionsEnabled = false;\n\n  \tvar promise = runloop.start( ractive, true );\n  \trunloop.scheduleTask( function () { return renderHook.fire( ractive ); }, true );\n\n  \tif ( ractive.fragment.rendered ) {\n  \t\tthrow new Error( 'You cannot call ractive.render() on an already rendered instance! Call ractive.unrender() first' );\n  \t}\n\n  \tanchor = getElement( anchor ) || ractive.anchor;\n\n  \tractive.el = target;\n  \tractive.anchor = anchor;\n\n  \t// ensure encapsulated CSS is up-to-date\n  \tif ( ractive.cssId ) applyCSS();\n\n  \tif ( target ) {\n  \t\t( target.__ractive_instances__ || ( target.__ractive_instances__ = [] ) ).push( ractive );\n\n  \t\tif ( anchor ) {\n  \t\t\tvar docFrag = doc.createDocumentFragment();\n  \t\t\tractive.fragment.render( docFrag );\n  \t\t\ttarget.insertBefore( docFrag, anchor );\n  \t\t} else {\n  \t\t\tractive.fragment.render( target, occupants );\n  \t\t}\n  \t}\n\n  \trunloop.end();\n  \tractive.transitionsEnabled = transitionsEnabled;\n\n  \treturn promise.then( function () { return completeHook.fire( ractive ); } );\n  }\n\n  function Ractive$render ( target, anchor ) {\n  \ttarget = getElement( target ) || this.el;\n\n  \tif ( !this.append && target ) {\n  \t\t// Teardown any existing instances *before* trying to set up the new one -\n  \t\t// avoids certain weird bugs\n  \t\tvar others = target.__ractive_instances__;\n  \t\tif ( others ) others.forEach( teardown );\n\n  \t\t// make sure we are the only occupants\n  \t\tif ( !this.enhance ) {\n  \t\t\ttarget.innerHTML = ''; // TODO is this quicker than removeChild? Initial research inconclusive\n  \t\t}\n  \t}\n\n  \tvar occupants = this.enhance ? toArray( target.childNodes ) : null;\n  \tvar promise = render$1( this, target, anchor, occupants );\n\n  \tif ( occupants ) {\n  \t\twhile ( occupants.length ) target.removeChild( occupants.pop() );\n  \t}\n\n  \treturn promise;\n  }\n\n  var adaptConfigurator = {\n  \textend: function ( Parent, proto, options ) {\n  \t\tproto.adapt = combine( proto.adapt, ensureArray( options.adapt ) );\n  \t},\n\n  \tinit: function () {}\n  };\n\n  function combine ( a, b ) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( !~c.indexOf( b[i] ) ) {\n  \t\t\tc.push( b[i] );\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  var selectorsPattern = /(?:^|\\})?\\s*([^\\{\\}]+)\\s*\\{/g;\n  var commentsPattern = /\\/\\*.*?\\*\\//g;\n  var selectorUnitPattern = /((?:(?:\\[[^\\]+]\\])|(?:[^\\s\\+\\>~:]))+)((?:::?[^\\s\\+\\>\\~\\(:]+(?:\\([^\\)]+\\))?)*\\s*[\\s\\+\\>\\~]?)\\s*/g;\n  var excludePattern = /^(?:@|\\d+%)/;\n  var dataRvcGuidPattern = /\\[data-ractive-css~=\"\\{[a-z0-9-]+\\}\"]/g;\n\n  function trim$1 ( str ) {\n  \treturn str.trim();\n  }\n\n  function extractString ( unit ) {\n  \treturn unit.str;\n  }\n\n  function transformSelector ( selector, parent ) {\n  \tvar selectorUnits = [];\n  \tvar match;\n\n  \twhile ( match = selectorUnitPattern.exec( selector ) ) {\n  \t\tselectorUnits.push({\n  \t\t\tstr: match[0],\n  \t\t\tbase: match[1],\n  \t\t\tmodifiers: match[2]\n  \t\t});\n  \t}\n\n  \t// For each simple selector within the selector, we need to create a version\n  \t// that a) combines with the id, and b) is inside the id\n  \tvar base = selectorUnits.map( extractString );\n\n  \tvar transformed = [];\n  \tvar i = selectorUnits.length;\n\n  \twhile ( i-- ) {\n  \t\tvar appended = base.slice();\n\n  \t\t// Pseudo-selectors should go after the attribute selector\n  \t\tvar unit = selectorUnits[i];\n  \t\tappended[i] = unit.base + parent + unit.modifiers || '';\n\n  \t\tvar prepended = base.slice();\n  \t\tprepended[i] = parent + ' ' + prepended[i];\n\n  \t\ttransformed.push( appended.join( ' ' ), prepended.join( ' ' ) );\n  \t}\n\n  \treturn transformed.join( ', ' );\n  }\n\n  function transformCss ( css, id ) {\n  \tvar dataAttr = \"[data-ractive-css~=\\\"{\" + id + \"}\\\"]\";\n\n  \tvar transformed;\n\n  \tif ( dataRvcGuidPattern.test( css ) ) {\n  \t\ttransformed = css.replace( dataRvcGuidPattern, dataAttr );\n  \t} else {\n  \t\ttransformed = css\n  \t\t.replace( commentsPattern, '' )\n  \t\t.replace( selectorsPattern, function ( match, $1 ) {\n  \t\t\t// don't transform at-rules and keyframe declarations\n  \t\t\tif ( excludePattern.test( $1 ) ) return match;\n\n  \t\t\tvar selectors = $1.split( ',' ).map( trim$1 );\n  \t\t\tvar transformed = selectors\n  \t\t\t\t.map( function ( selector ) { return transformSelector( selector, dataAttr ); } )\n  \t\t\t\t.join( ', ' ) + ' ';\n\n  \t\t\treturn match.replace( $1, transformed );\n  \t\t});\n  \t}\n\n  \treturn transformed;\n  }\n\n  function s4() {\n  \treturn Math.floor((1 + Math.random()) * 0x10000).toString(16).substring(1);\n  }\n\n  function uuid() {\n  \treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' + s4() + '-' + s4() + s4() + s4();\n  }\n\n  var cssConfigurator = {\n  \tname: 'css',\n\n  \t// Called when creating a new component definition\n  \textend: function ( Parent, proto, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\tvar id = uuid();\n  \t\tvar styles = options.noCssTransform ? options.css : transformCss( options.css, id );\n\n  \t\tproto.cssId = id;\n\n  \t\taddCSS( { id: id, styles: styles } );\n\n  \t},\n\n  \t// Called when creating a new component instance\n  \tinit: function ( Parent, target, options ) {\n  \t\tif ( !options.css ) return;\n\n  \t\twarnIfDebug( (\"\\nThe css option is currently not supported on a per-instance basis and will be discarded. Instead, we recommend instantiating from a component definition with a css option.\\n\\nconst Component = Ractive.extend({\\n\\t...\\n\\tcss: '/* your css */',\\n\\t...\\n});\\n\\nconst componentInstance = new Component({ ... })\\n\\t\\t\") );\n  \t}\n\n  };\n\n  function bind$1 ( fn, context ) {\n  \tif ( !/this/.test( fn.toString() ) ) return fn;\n\n  \tvar bound = fn.bind( context );\n  \tfor ( var prop in fn ) bound[ prop ] = fn[ prop ];\n\n  \treturn bound;\n  }\n\n  function validate ( data ) {\n  \t// Warn if userOptions.data is a non-POJO\n  \tif ( data && data.constructor !== Object ) {\n  \t\tif ( typeof data === 'function' ) {\n  \t\t\t// TODO do we need to support this in the new Ractive() case?\n  \t\t} else if ( typeof data !== 'object' ) {\n  \t\t\tfatal( (\"data option must be an object or a function, `\" + data + \"` is not valid\") );\n  \t\t} else {\n  \t\t\twarnIfDebug( 'If supplied, options.data should be a plain JavaScript object - using a non-POJO as the root object may work, but is discouraged' );\n  \t\t}\n  \t}\n  }\n\n  var dataConfigurator = {\n  \tname: 'data',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\tvar key;\n  \t\tvar value;\n\n  \t\t// check for non-primitives, which could cause mutation-related bugs\n  \t\tif ( options.data && isObject( options.data ) ) {\n  \t\t\tfor ( key in options.data ) {\n  \t\t\t\tvalue = options.data[ key ];\n\n  \t\t\t\tif ( value && typeof value === 'object' ) {\n  \t\t\t\t\tif ( isObject( value ) || isArray( value ) ) {\n  \t\t\t\t\t\twarnIfDebug( (\"Passing a `data` option with object and array properties to Ractive.extend() is discouraged, as mutating them is likely to cause bugs. Consider using a data function instead:\\n\\n  // this...\\n  data: function () {\\n    return {\\n      myObject: {}\\n    };\\n  })\\n\\n  // instead of this:\\n  data: {\\n    myObject: {}\\n  }\") );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tproto.data = combine$1( proto.data, options.data );\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\tvar result = combine$1( Parent.prototype.data, options.data );\n\n  \t\tif ( typeof result === 'function' ) result = result.call( ractive );\n\n  \t\t// bind functions to the ractive instance at the top level,\n  \t\t// unless it's a non-POJO (in which case alarm bells should ring)\n  \t\tif ( result && result.constructor === Object ) {\n  \t\t\tfor ( var prop in result ) {\n  \t\t\t\tif ( typeof result[ prop ] === 'function' ) result[ prop ] = bind$1( result[ prop ], ractive );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn result || {};\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = this.init( ractive.constructor, ractive, ractive.viewmodel );\n  \t\tractive.viewmodel.root.set( result );\n  \t\treturn true;\n  \t}\n  };\n\n  function combine$1 ( parentValue, childValue ) {\n  \tvalidate( childValue );\n\n  \tvar parentIsFn = typeof parentValue === 'function';\n  \tvar childIsFn = typeof childValue === 'function';\n\n  \t// Very important, otherwise child instance can become\n  \t// the default data object on Ractive or a component.\n  \t// then ractive.set() ends up setting on the prototype!\n  \tif ( !childValue && !parentIsFn ) {\n  \t\tchildValue = {};\n  \t}\n\n  \t// Fast path, where we just need to copy properties from\n  \t// parent to child\n  \tif ( !parentIsFn && !childIsFn ) {\n  \t\treturn fromProperties( childValue, parentValue );\n  \t}\n\n  \treturn function () {\n  \t\tvar child = childIsFn ? callDataFunction( childValue, this ) : childValue;\n  \t\tvar parent = parentIsFn ? callDataFunction( parentValue, this ) : parentValue;\n\n  \t\treturn fromProperties( child, parent );\n  \t};\n  }\n\n  function callDataFunction ( fn, context ) {\n  \tvar data = fn.call( context );\n\n  \tif ( !data ) return;\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tfatal( 'Data function must return an object' );\n  \t}\n\n  \tif ( data.constructor !== Object ) {\n  \t\twarnOnceIfDebug( 'Data function returned something other than a plain JavaScript object. This might work, but is strongly discouraged' );\n  \t}\n\n  \treturn data;\n  }\n\n  function fromProperties ( primary, secondary ) {\n  \tif ( primary && secondary ) {\n  \t\tfor ( var key in secondary ) {\n  \t\t\tif ( !( key in primary ) ) {\n  \t\t\t\tprimary[ key ] = secondary[ key ];\n  \t\t\t}\n  \t\t}\n\n  \t\treturn primary;\n  \t}\n\n  \treturn primary || secondary;\n  }\n\n  var TEMPLATE_VERSION = 3;\n\n  var pattern = /\\$\\{([^\\}]+)\\}/g;\n\n  function fromExpression ( body, length ) {\n  \tif ( length === void 0 ) length = 0;\n\n  \tvar args = new Array( length );\n\n  \twhile ( length-- ) {\n  \t\targs[length] = \"_\" + length;\n  \t}\n\n  \t// Functions created directly with new Function() look like this:\n  \t//     function anonymous (_0 /**/) { return _0*2 }\n  \t//\n  \t// With this workaround, we get a little more compact:\n  \t//     function (_0){return _0*2}\n  \treturn new Function( [], (\"return function (\" + (args.join(',')) + \"){return(\" + body + \");};\") )();\n  }\n\n  function fromComputationString ( str, bindTo ) {\n  \tvar hasThis;\n\n  \tvar functionBody = 'return (' + str.replace( pattern, function ( match, keypath ) {\n  \t\thasThis = true;\n  \t\treturn (\"__ractive.get(\\\"\" + keypath + \"\\\")\");\n  \t}) + ');';\n\n  \tif ( hasThis ) functionBody = \"var __ractive = this; \" + functionBody;\n  \tvar fn = new Function( functionBody );\n  \treturn hasThis ? fn.bind( bindTo ) : fn;\n  }\n\n  var functions = create( null );\n\n  function getFunction ( str, i ) {\n  \tif ( functions[ str ] ) return functions[ str ];\n  \treturn functions[ str ] = createFunction( str, i );\n  }\n\n  function addFunctions( template ) {\n  \tif ( !template ) return;\n\n  \tvar exp = template.e;\n\n  \tif ( !exp ) return;\n\n  \tObject.keys( exp ).forEach( function ( str ) {\n  \t\tif ( functions[ str ] ) return;\n  \t\tfunctions[ str ] = exp[ str ];\n  \t});\n  }\n\n  var parse = null;\n\n  var parseOptions = [\n  \t'delimiters',\n  \t'tripleDelimiters',\n  \t'staticDelimiters',\n  \t'staticTripleDelimiters',\n  \t'csp',\n  \t'interpolate',\n  \t'preserveWhitespace',\n  \t'sanitize',\n  \t'stripComments'\n  ];\n\n  var TEMPLATE_INSTRUCTIONS = \"Either preparse or use a ractive runtime source that includes the parser. \";\n\n  var COMPUTATION_INSTRUCTIONS = \"Either use:\\n\\n\\tRactive.parse.computedStrings( component.computed )\\n\\nat build time to pre-convert the strings to functions, or use functions instead of strings in computed properties.\";\n\n\n  function throwNoParse ( method, error, instructions ) {\n  \tif ( !method ) {\n  \t\tfatal( (\"Missing Ractive.parse - cannot parse \" + error + \". \" + instructions) );\n  \t}\n  }\n\n  function createFunction ( body, length ) {\n  \tthrowNoParse( fromExpression, 'new expression function', TEMPLATE_INSTRUCTIONS );\n  \treturn fromExpression( body, length );\n  }\n\n  function createFunctionFromString ( str, bindTo ) {\n  \tthrowNoParse( fromComputationString, 'compution string \"${str}\"', COMPUTATION_INSTRUCTIONS );\n  \treturn fromComputationString( str, bindTo );\n  }\n\n  var parser = {\n\n  \tfromId: function ( id, options ) {\n  \t\tif ( !doc ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Cannot retrieve template #\" + id + \" as Ractive is not running in a browser.\") );\n  \t\t}\n\n  \t\tif ( id ) id = id.replace( /^#/, '' );\n\n  \t\tvar template;\n\n  \t\tif ( !( template = doc.getElementById( id ) )) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Could not find template element with id #\" + id) );\n  \t\t}\n\n  \t\tif ( template.tagName.toUpperCase() !== 'SCRIPT' ) {\n  \t\t\tif ( options && options.noThrow ) { return; }\n  \t\t\tthrow new Error( (\"Template element with id #\" + id + \", must be a <script> element\") );\n  \t\t}\n\n  \t\treturn ( 'textContent' in template ? template.textContent : template.innerHTML );\n\n  \t},\n\n  \tisParsed: function ( template) {\n  \t\treturn !( typeof template === 'string' );\n  \t},\n\n  \tgetParseOptions: function ( ractive ) {\n  \t\t// Could be Ractive or a Component\n  \t\tif ( ractive.defaults ) { ractive = ractive.defaults; }\n\n  \t\treturn parseOptions.reduce( function ( val, key ) {\n  \t\t\tval[ key ] = ractive[ key ];\n  \t\t\treturn val;\n  \t\t}, {});\n  \t},\n\n  \tparse: function ( template, options ) {\n  \t\tthrowNoParse( parse, 'template', TEMPLATE_INSTRUCTIONS );\n  \t\tvar parsed = parse( template, options );\n  \t\taddFunctions( parsed );\n  \t\treturn parsed;\n  \t},\n\n  \tparseFor: function( template, ractive ) {\n  \t\treturn this.parse( template, this.getParseOptions( ractive ) );\n  \t}\n  };\n\n  var templateConfigurator = {\n  \tname: 'template',\n\n  \textend: function ( Parent, proto, options ) {\n  \t\t// only assign if exists\n  \t\tif ( 'template' in options ) {\n  \t\t\tvar template = options.template;\n\n  \t\t\tif ( typeof template === 'function' ) {\n  \t\t\t\tproto.template = template;\n  \t\t\t} else {\n  \t\t\t\tproto.template = parseTemplate( template, proto );\n  \t\t\t}\n  \t\t}\n  \t},\n\n  \tinit: function ( Parent, ractive, options ) {\n  \t\t// TODO because of prototypal inheritance, we might just be able to use\n  \t\t// ractive.template, and not bother passing through the Parent object.\n  \t\t// At present that breaks the test mocks' expectations\n  \t\tvar template = 'template' in options ? options.template : Parent.prototype.template;\n  \t\ttemplate = template || { v: TEMPLATE_VERSION, t: [] };\n\n  \t\tif ( typeof template === 'function' ) {\n  \t\t\tvar fn = template;\n  \t\t\ttemplate = getDynamicTemplate( ractive, fn );\n\n  \t\t\tractive._config.template = {\n  \t\t\t\tfn: fn,\n  \t\t\t\tresult: template\n  \t\t\t};\n  \t\t}\n\n  \t\ttemplate = parseTemplate( template, ractive );\n\n  \t\t// TODO the naming of this is confusing - ractive.template refers to [...],\n  \t\t// but Component.prototype.template refers to {v:1,t:[],p:[]}...\n  \t\t// it's unnecessary, because the developer never needs to access\n  \t\t// ractive.template\n  \t\tractive.template = template.t;\n\n  \t\tif ( template.p ) {\n  \t\t\textendPartials( ractive.partials, template.p );\n  \t\t}\n  \t},\n\n  \treset: function ( ractive ) {\n  \t\tvar result = resetValue( ractive );\n\n  \t\tif ( result ) {\n  \t\t\tvar parsed = parseTemplate( result, ractive );\n\n  \t\t\tractive.template = parsed.t;\n  \t\t\textendPartials( ractive.partials, parsed.p, true );\n\n  \t\t\treturn true;\n  \t\t}\n  \t}\n  };\n\n  function resetValue ( ractive ) {\n  \tvar initial = ractive._config.template;\n\n  \t// If this isn't a dynamic template, there's nothing to do\n  \tif ( !initial || !initial.fn ) {\n  \t\treturn;\n  \t}\n\n  \tvar result = getDynamicTemplate( ractive, initial.fn );\n\n  \t// TODO deep equality check to prevent unnecessary re-rendering\n  \t// in the case of already-parsed templates\n  \tif ( result !== initial.result ) {\n  \t\tinitial.result = result;\n  \t\treturn result;\n  \t}\n  }\n\n  function getDynamicTemplate ( ractive, fn ) {\n  \treturn fn.call( ractive, {\n  \t\tfromId: parser.fromId,\n  \t\tisParsed: parser.isParsed,\n  \t\tparse: function ( template, options ) {\n  \t\t\tif ( options === void 0 ) options = parser.getParseOptions( ractive );\n\n  \t\t\treturn parser.parse( template, options );\n  \t\t}\n  \t});\n  }\n\n  function parseTemplate ( template, ractive ) {\n  \tif ( typeof template === 'string' ) {\n  \t\t// parse will validate and add expression functions\n  \t\ttemplate = parseAsString( template, ractive );\n  \t}\n  \telse {\n  \t\t// need to validate and add exp for already parsed template\n  \t\tvalidate$1( template );\n  \t\taddFunctions( template );\n  \t}\n\n  \treturn template;\n  }\n\n  function parseAsString ( template, ractive ) {\n  \t// ID of an element containing the template?\n  \tif ( template[0] === '#' ) {\n  \t\ttemplate = parser.fromId( template );\n  \t}\n\n  \treturn parser.parseFor( template, ractive );\n  }\n\n  function validate$1( template ) {\n\n  \t// Check that the template even exists\n  \tif ( template == undefined ) {\n  \t\tthrow new Error( (\"The template cannot be \" + template + \".\") );\n  \t}\n\n  \t// Check the parsed template has a version at all\n  \telse if ( typeof template.v !== 'number' ) {\n  \t\tthrow new Error( 'The template parser was passed a non-string template, but the template doesn\\'t have a version.  Make sure you\\'re passing in the template you think you are.' );\n  \t}\n\n  \t// Check we're using the correct version\n  \telse if ( template.v !== TEMPLATE_VERSION ) {\n  \t\tthrow new Error( (\"Mismatched template version (expected \" + TEMPLATE_VERSION + \", got \" + (template.v) + \") Please ensure you are using the latest version of Ractive.js in your build process as well as in your app\") );\n  \t}\n  }\n\n  function extendPartials ( existingPartials, newPartials, overwrite ) {\n  \tif ( !newPartials ) return;\n\n  \t// TODO there's an ambiguity here - we need to overwrite in the `reset()`\n  \t// case, but not initially...\n\n  \tfor ( var key in newPartials ) {\n  \t\tif ( overwrite || !existingPartials.hasOwnProperty( key ) ) {\n  \t\t\texistingPartials[ key ] = newPartials[ key ];\n  \t\t}\n  \t}\n  }\n\n  var registryNames = [\n  \t'adaptors',\n  \t'components',\n  \t'computed',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var Registry = function Registry ( name, useDefaults ) {\n  \tthis.name = name;\n  \tthis.useDefaults = useDefaults;\n  };\n\n  Registry.prototype.extend = function extend ( Parent, proto, options ) {\n  \tthis.configure(\n  \t\tthis.useDefaults ? Parent.defaults : Parent,\n  \t\tthis.useDefaults ? proto : proto.constructor,\n  \t\toptions );\n  };\n\n  Registry.prototype.init = function init () {\n  \t// noop\n  };\n\n  Registry.prototype.configure = function configure ( Parent, target, options ) {\n  \tvar name = this.name;\n  \tvar option = options[ name ];\n\n  \tvar registry = create( Parent[name] );\n\n  \tfor ( var key in option ) {\n  \t\tregistry[ key ] = option[ key ];\n  \t}\n\n  \ttarget[ name ] = registry;\n  };\n\n  Registry.prototype.reset = function reset ( ractive ) {\n  \tvar registry = ractive[ this.name ];\n  \tvar changed = false;\n\n  \tObject.keys( registry ).forEach( function ( key ) {\n  \t\tvar item = registry[ key ];\n  \t\t\t\n  \t\tif ( item._fn ) {\n  \t\t\tif ( item._fn.isOwner ) {\n  \t\t\t\tregistry[key] = item._fn;\n  \t\t\t} else {\n  \t\t\t\tdelete registry[key];\n  \t\t\t}\n  \t\t\tchanged = true;\n  \t\t}\n  \t});\n\n  \treturn changed;\n  };\n\n  var registries = registryNames.map( function ( name ) { return new Registry( name, name === 'computed' ); } );\n\n  function wrap ( parent, name, method ) {\n  \tif ( !/_super/.test( method ) ) return method;\n\n  \tfunction wrapper () {\n  \t\tvar superMethod = getSuperMethod( wrapper._parent, name );\n  \t\tvar hasSuper = '_super' in this;\n  \t\tvar oldSuper = this._super;\n\n  \t\tthis._super = superMethod;\n\n  \t\tvar result = method.apply( this, arguments );\n\n  \t\tif ( hasSuper ) {\n  \t\t\tthis._super = oldSuper;\n  \t\t} else {\n  \t\t\tdelete this._super;\n  \t\t}\n\n  \t\treturn result;\n  \t}\n\n  \twrapper._parent = parent;\n  \twrapper._method = method;\n\n  \treturn wrapper;\n  }\n\n  function getSuperMethod ( parent, name ) {\n  \tif ( name in parent ) {\n  \t\tvar value = parent[ name ];\n\n  \t\treturn typeof value === 'function' ?\n  \t\t\tvalue :\n  \t\t\tfunction () { return value; };\n  \t}\n\n  \treturn noop;\n  }\n\n  function getMessage( deprecated, correct, isError ) {\n  \treturn \"options.\" + deprecated + \" has been deprecated in favour of options.\" + correct + \".\"\n  \t\t+ ( isError ? (\" You cannot specify both options, please use options.\" + correct + \".\") : '' );\n  }\n\n  function deprecateOption ( options, deprecatedOption, correct ) {\n  \tif ( deprecatedOption in options ) {\n  \t\tif( !( correct in options ) ) {\n  \t\t\twarnIfDebug( getMessage( deprecatedOption, correct ) );\n  \t\t\toptions[ correct ] = options[ deprecatedOption ];\n  \t\t} else {\n  \t\t\tthrow new Error( getMessage( deprecatedOption, correct, true ) );\n  \t\t}\n  \t}\n  }\n\n  function deprecate ( options ) {\n  \tdeprecateOption( options, 'beforeInit', 'onconstruct' );\n  \tdeprecateOption( options, 'init', 'onrender' );\n  \tdeprecateOption( options, 'complete', 'oncomplete' );\n  \tdeprecateOption( options, 'eventDefinitions', 'events' );\n\n  \t// Using extend with Component instead of options,\n  \t// like Human.extend( Spider ) means adaptors as a registry\n  \t// gets copied to options. So we have to check if actually an array\n  \tif ( isArray( options.adaptors ) ) {\n  \t\tdeprecateOption( options, 'adaptors', 'adapt' );\n  \t}\n  }\n\n  var custom = {\n  \tadapt: adaptConfigurator,\n  \tcss: cssConfigurator,\n  \tdata: dataConfigurator,\n  \ttemplate: templateConfigurator\n  };\n\n  var defaultKeys = Object.keys( defaults );\n\n  var isStandardKey = makeObj( defaultKeys.filter( function ( key ) { return !custom[ key ]; } ) );\n\n  // blacklisted keys that we don't double extend\n  var isBlacklisted = makeObj( defaultKeys.concat( registries.map( function ( r ) { return r.name; } ) ) );\n\n  var order = [].concat(\n  \tdefaultKeys.filter( function ( key ) { return !registries[ key ] && !custom[ key ]; } ),\n  \tregistries,\n  \t//custom.data,\n  \tcustom.template,\n  \tcustom.css\n  );\n\n  var config = {\n  \textend: function ( Parent, proto, options ) { return configure( 'extend', Parent, proto, options ); },\n\n  \tinit: function ( Parent, ractive, options ) { return configure( 'init', Parent, ractive, options ); },\n\n  \treset: function ( ractive ) {\n  \t\treturn order.filter( function ( c ) {\n  \t\t\treturn c.reset && c.reset( ractive );\n  \t\t}).map( function ( c ) { return c.name; } );\n  \t},\n\n  \t// this defines the order. TODO this isn't used anywhere in the codebase,\n  \t// only in the test suite - should get rid of it\n  \torder: order\n  };\n\n  function configure ( method, Parent, target, options ) {\n  \tdeprecate( options );\n\n  \tfor ( var key in options ) {\n  \t\tif ( isStandardKey.hasOwnProperty( key ) ) {\n  \t\t\tvar value = options[ key ];\n\n  \t\t\t// warn the developer if they passed a function and ignore its value\n\n  \t\t\t// NOTE: we allow some functions on \"el\" because we duck type element lists\n  \t\t\t// and some libraries or ef'ed-up virtual browsers (phantomJS) return a\n  \t\t\t// function object as the result of querySelector methods\n  \t\t\tif ( key !== 'el' && typeof value === 'function' ) {\n  \t\t\t\twarnIfDebug( (\"\" + key + \" is a Ractive option that does not expect a function and will be ignored\"),\n  \t\t\t\t\tmethod === 'init' ? target : null );\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\ttarget[ key ] = value;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// disallow combination of `append` and `enhance`\n  \tif ( options.append && options.enhance ) {\n  \t\tthrow new Error( 'Cannot use append and enhance at the same time' );\n  \t}\n\n  \tregistries.forEach( function ( registry ) {\n  \t\tregistry[ method ]( Parent, target, options );\n  \t});\n\n  \tadaptConfigurator[ method ]( Parent, target, options );\n  \ttemplateConfigurator[ method ]( Parent, target, options );\n  \tcssConfigurator[ method ]( Parent, target, options );\n\n  \textendOtherMethods( Parent.prototype, target, options );\n  }\n\n  function extendOtherMethods ( parent, target, options ) {\n  \tfor ( var key in options ) {\n  \t\tif ( !isBlacklisted[ key ] && options.hasOwnProperty( key ) ) {\n  \t\t\tvar member = options[ key ];\n\n  \t\t\t// if this is a method that overwrites a method, wrap it:\n  \t\t\tif ( typeof member === 'function' ) {\n  \t\t\t\tmember = wrap( parent, key, member );\n  \t\t\t}\n\n  \t\t\ttarget[ key ] = member;\n  \t\t}\n  \t}\n  }\n\n  function makeObj ( array ) {\n  \tvar obj = {};\n  \tarray.forEach( function ( x ) { return obj[x] = true; } );\n  \treturn obj;\n  }\n\n  var shouldRerender = [ 'template', 'partials', 'components', 'decorators', 'events' ];\n\n  var completeHook$1 = new Hook( 'complete' );\n  var resetHook = new Hook( 'reset' );\n  var renderHook$1 = new Hook( 'render' );\n  var unrenderHook = new Hook( 'unrender' );\n\n  function Ractive$reset ( data ) {\n  \tdata = data || {};\n\n  \tif ( typeof data !== 'object' ) {\n  \t\tthrow new Error( 'The reset method takes either no arguments, or an object containing new data' );\n  \t}\n\n  \t// TEMP need to tidy this up\n  \tdata = dataConfigurator.init( this.constructor, this, { data: data });\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If the root object is wrapped, try and use the wrapper's reset value\n  \tvar wrapper = this.viewmodel.wrapper;\n  \tif ( wrapper && wrapper.reset ) {\n  \t\tif ( wrapper.reset( data ) === false ) {\n  \t\t\t// reset was rejected, we need to replace the object\n  \t\t\tthis.viewmodel.set( data );\n  \t\t}\n  \t} else {\n  \t\tthis.viewmodel.set( data );\n  \t}\n\n  \t// reset config items and track if need to rerender\n  \tvar changes = config.reset( this );\n  \tvar rerender;\n\n  \tvar i = changes.length;\n  \twhile ( i-- ) {\n  \t\tif ( shouldRerender.indexOf( changes[i] ) > -1 ) {\n  \t\t\trerender = true;\n  \t\t\tbreak;\n  \t\t}\n  \t}\n\n  \tif ( rerender ) {\n  \t\tunrenderHook.fire( this );\n  \t\tthis.fragment.resetTemplate( this.template );\n  \t\trenderHook$1.fire( this );\n  \t\tcompleteHook$1.fire( this );\n  \t}\n\n  \trunloop.end();\n\n  \tresetHook.fire( this, data );\n\n  \treturn promise;\n  }\n\n  var TEXT              = 1;\n  var INTERPOLATOR      = 2;\n  var TRIPLE            = 3;\n  var SECTION           = 4;\n  var ELEMENT           = 7;\n  var PARTIAL           = 8;\n  var COMPONENT         = 15;\n  var YIELDER           = 16;\n  var DOCTYPE           = 18;\n  var ALIAS             = 19;\n\n  var NUMBER_LITERAL    = 20;\n  var STRING_LITERAL    = 21;\n  var REFERENCE         = 30;\n  var SECTION_IF        = 50;\n  var SECTION_UNLESS    = 51;\n  var SECTION_EACH      = 52;\n  var SECTION_WITH      = 53;\n  var SECTION_IF_WITH   = 54;\n\n  function collect( source, name, dest ) {\n  \tsource.forEach( function ( item ) {\n  \t\t// queue to rerender if the item is a partial and the current name matches\n  \t\tif ( item.type === PARTIAL && ( item.refName ===  name || item.name === name ) ) {\n  \t\t\tdest.push( item );\n  \t\t\treturn; // go no further\n  \t\t}\n\n  \t\t// if it has a fragment, process its items\n  \t\tif ( item.fragment ) {\n  \t\t\tcollect( item.fragment.iterations || item.fragment.items, name, dest );\n  \t\t}\n\n  \t\t// or if it is itself a fragment, process its items\n  \t\telse if ( isArray( item.items ) ) {\n  \t\t\tcollect( item.items, name, dest );\n  \t\t}\n\n  \t\t// or if it is a component, step in and process its items\n  \t\telse if ( item.type === COMPONENT && item.instance ) {\n  \t\t\t// ...unless the partial is shadowed\n  \t\t\tif ( item.instance.partials[ name ] ) return;\n  \t\t\tcollect( item.instance.fragment.items, name, dest );\n  \t\t}\n\n  \t\t// if the item is an element, process its attributes too\n  \t\tif ( item.type === ELEMENT ) {\n  \t\t\tif ( isArray( item.attributes ) ) {\n  \t\t\t\tcollect( item.attributes, name, dest );\n  \t\t\t}\n\n  \t\t\tif ( isArray( item.conditionalAttributes ) ) {\n  \t\t\t\tcollect( item.conditionalAttributes, name, dest );\n  \t\t\t}\n  \t\t}\n  \t});\n  }\n\n  function forceResetTemplate ( partial ) {\n  \tpartial.forceResetTemplate();\n  }\n\n  function resetPartial ( name, partial ) {\n  \tvar collection = [];\n  \tcollect( this.fragment.items, name, collection );\n\n  \tvar promise = runloop.start( this, true );\n\n  \tthis.partials[ name ] = partial;\n  \tcollection.forEach( forceResetTemplate );\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var Item = function Item ( options ) {\n  \tthis.parentFragment = options.parentFragment;\n  \tthis.ractive = options.parentFragment.ractive;\n\n  \tthis.template = options.template;\n  \tthis.index = options.index;\n  \tthis.type = options.template.t;\n\n  \tthis.dirty = false;\n  };\n\n  Item.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.parentFragment.bubble();\n  \t}\n  };\n\n  Item.prototype.find = function find () {\n  \treturn null;\n  };\n\n  Item.prototype.findAll = function findAll () {\n  \t// noop\n  };\n\n  Item.prototype.findComponent = function findComponent () {\n  \treturn null;\n  };\n\n  Item.prototype.findAllComponents = function findAllComponents () {\n  \t// noop;\n  };\n\n  Item.prototype.findNextNode = function findNextNode () {\n  \treturn this.parentFragment.findNextNode( this );\n  };\n\n  Item.prototype.valueOf = function valueOf () {\n  \treturn this.toString();\n  };\n\n  var ComputationChild = (function (Model) {\n  \tfunction ComputationChild () {\n  \t\tModel.apply(this, arguments);\n  \t}\n\n  \tComputationChild.prototype = Object.create( Model && Model.prototype );\n  \tComputationChild.prototype.constructor = ComputationChild;\n\n  \tComputationChild.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tvar parentValue = this.parent.get();\n  \t\treturn parentValue ? parentValue[ this.key ] : undefined;\n  \t};\n\n  \tComputationChild.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n  \t\tthis.clearUnresolveds(); // TODO is this necessary?\n  \t};\n\n  \tComputationChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \treturn ComputationChild;\n  }(Model));\n\n  function getValue ( model ) {\n  \treturn model ? model.get( true ) : undefined;\n  }\n\n  var ExpressionProxy = (function (Model) {\n  \tfunction ExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, fragment.ractive.viewmodel, null );\n\n  \t\tthis.fragment = fragment;\n  \t\tthis.template = template;\n\n  \t\tthis.isReadonly = true;\n\n  \t\tthis.fn = getFunction( template.s, template.r.length );\n  \t\tthis.computation = null;\n\n  \t\tthis.resolvers = [];\n  \t\tthis.models = this.template.r.map( function ( ref, index ) {\n  \t\t\tvar model = resolveReference( this$1.fragment, ref );\n  \t\t\tvar resolver;\n\n  \t\t\tif ( !model ) {\n  \t\t\t\tresolver = this$1.fragment.resolve( ref, function ( model ) {\n  \t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\tthis$1.models[ index ] = model;\n  \t\t\t\t\tthis$1.bubble();\n  \t\t\t\t});\n\n  \t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t}\n\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.bubble();\n  \t}\n\n  \tExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tExpressionProxy.prototype.constructor = ExpressionProxy;\n\n  \tExpressionProxy.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tvar ractive = this.fragment.ractive;\n\n  \t\t// TODO the @ prevents computed props from shadowing keypaths, but the real\n  \t\t// question is why it's a computed prop in the first place... (hint, it's\n  \t\t// to do with {{else}} blocks)\n  \t\tvar key = '@' + this.template.s.replace( /_(\\d+)/g, function ( match, i ) {\n  \t\t\tif ( i >= this$1.models.length ) return match;\n\n  \t\t\tvar model = this$1.models[i];\n  \t\t\treturn model ? model.getKeypath() : '@undefined';\n  \t\t});\n\n  \t\t// TODO can/should we reuse computations?\n  \t\tvar signature = {\n  \t\t\tgetter: function () {\n  \t\t\t\tvar values = this$1.models.map( getValue );\n  \t\t\t\treturn this$1.fn.apply( ractive, values );\n  \t\t\t},\n  \t\t\tgetterString: key\n  \t\t};\n\n  \t\tvar computation = ractive.viewmodel.compute( key, signature );\n\n  \t\tthis.value = computation.get(); // TODO should not need this, eventually\n\n  \t\tif ( this.computation ) {\n  \t\t\tthis.computation.unregister( this );\n  \t\t\t// notify children...\n  \t\t}\n\n  \t\tthis.computation = computation;\n  \t\tcomputation.register( this );\n\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.get = function get ( shouldCapture ) {\n  \t\treturn this.computation.get( shouldCapture );\n  \t};\n\n  \tExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\treturn this.computation ? this.computation.getKeypath() : '@undefined';\n  \t};\n\n  \tExpressionProxy.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n\n  \t\tthis.clearUnresolveds();\n  \t};\n\n  \tExpressionProxy.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tExpressionProxy.prototype.mark = function mark () {\n  \t\tthis.handleChange();\n  \t};\n\n  \tExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.get();\n  \t};\n\n  \tExpressionProxy.prototype.teardown = function teardown () {\n  \t\tthis.unbind();\n  \t\tthis.fragment = undefined;\n  \t\tif ( this.computation ) {\n  \t\t\tthis.computation.teardown();\n  \t\t}\n  \t\tthis.computation = undefined;\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \tExpressionProxy.prototype.unregister = function unregister( dep ) {\n  \t\tModel.prototype.unregister.call( this, dep );\n  \t\tif ( !this.deps.length ) this.teardown();\n  \t};\n\n  \tExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.resolvers.forEach( unbind );\n\n  \t\tvar i = this.models.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.models[i] ) this$1.models[i].unregister( this$1 );\n  \t\t}\n  \t};\n\n  \treturn ExpressionProxy;\n  }(Model));\n\n  var ReferenceExpressionChild = (function (Model) {\n  \tfunction ReferenceExpressionChild ( parent, key ) {\n  \t\tModel.call ( this, parent, key );\n  \t}\n\n  \tReferenceExpressionChild.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionChild.prototype.constructor = ReferenceExpressionChild;\n\n  \tReferenceExpressionChild.prototype.applyValue = function applyValue ( value ) {\n  \t\tif ( isEqual( value, this.value ) ) return;\n\n  \t\tvar parent = this.parent, keys = [ this.key ];\n  \t\twhile ( parent ) {\n  \t\t\tif ( parent.base ) {\n  \t\t\t\tvar target = parent.model.joinAll( keys );\n  \t\t\t\ttarget.applyValue( value );\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tkeys.unshift( parent.key );\n\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t};\n\n  \tReferenceExpressionChild.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \treturn ReferenceExpressionChild;\n  }(Model));\n\n  var ReferenceExpressionProxy = (function (Model) {\n  \tfunction ReferenceExpressionProxy ( fragment, template ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.call( this, null, null );\n  \t\tthis.root = fragment.ractive.viewmodel;\n\n  \t\tthis.resolvers = [];\n\n  \t\tthis.base = resolve$1( fragment, template );\n  \t\tvar baseResolver;\n\n  \t\tif ( !this.base ) {\n  \t\t\tbaseResolver = fragment.resolve( template.r, function ( model ) {\n  \t\t\t\tthis$1.base = model;\n  \t\t\t\tthis$1.bubble();\n\n  \t\t\t\tremoveFromArray( this$1.resolvers, baseResolver );\n  \t\t\t});\n\n  \t\t\tthis.resolvers.push( baseResolver );\n  \t\t}\n\n  \t\tvar intermediary = {\n  \t\t\thandleChange: function () { return this$1.bubble(); }\n  \t\t};\n\n  \t\tthis.members = template.m.map( function ( template, i ) {\n  \t\t\tif ( typeof template === 'string' ) {\n  \t\t\t\treturn { get: function () { return template; } };\n  \t\t\t}\n\n  \t\t\tvar model;\n  \t\t\tvar resolver;\n\n  \t\t\tif ( template.t === REFERENCE ) {\n  \t\t\t\tmodel = resolveReference( fragment, template.n );\n\n  \t\t\t\tif ( model ) {\n  \t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t} else {\n  \t\t\t\t\tresolver = fragment.resolve( template.n, function ( model ) {\n  \t\t\t\t\t\tthis$1.members[i] = model;\n\n  \t\t\t\t\t\tmodel.register( intermediary );\n  \t\t\t\t\t\tthis$1.bubble();\n\n  \t\t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t}\n\n  \t\t\tmodel = new ExpressionProxy( fragment, template );\n  \t\t\tmodel.register( intermediary );\n  \t\t\treturn model;\n  \t\t});\n\n  \t\tthis.isUnresolved = true;\n  \t\tthis.bubble();\n  \t}\n\n  \tReferenceExpressionProxy.prototype = Object.create( Model && Model.prototype );\n  \tReferenceExpressionProxy.prototype.constructor = ReferenceExpressionProxy;\n\n  \tReferenceExpressionProxy.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.base ) return;\n\n  \t\t// if some members are not resolved, abort\n  \t\tvar i = this.members.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( !this$1.members[i] ) return;\n  \t\t}\n\n  \t\tthis.isUnresolved = false;\n\n  \t\tvar keys = this.members.map( function ( model ) { return escapeKey( String( model.get() ) ); } );\n  \t\tvar model = this.base.joinAll( keys );\n\n  \t\tif ( this.model ) {\n  \t\t\tthis.model.unregister( this );\n  \t\t\tthis.model.unregisterTwowayBinding( this );\n  \t\t}\n\n  \t\tthis.model = model;\n  \t\tthis.parent = model.parent;\n\n  \t\tmodel.register( this );\n  \t\tmodel.registerTwowayBinding( this );\n\n  \t\tif ( this.keypathModel ) this.keypathModel.handleChange();\n\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.forceResolution = function forceResolution () {\n  \t\tthis.resolvers.forEach( function ( resolver ) { return resolver.forceResolution(); } );\n  \t\tthis.bubble();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.get = function get () {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \t// indirect two-way bindings\n  \tReferenceExpressionProxy.prototype.getValue = function getValue () {\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.bindings.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar value = this$1.bindings[i].getValue();\n  \t\t\tif ( value !== this$1.value ) return value;\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tReferenceExpressionProxy.prototype.getKeypath = function getKeypath () {\n  \t\treturn this.model ? this.model.getKeypath() : '@undefined';\n  \t};\n\n  \tReferenceExpressionProxy.prototype.handleChange = function handleChange () {\n  \t\tthis.mark();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ReferenceExpressionChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tReferenceExpressionProxy.prototype.retrieve = function retrieve () {\n  \t\treturn this.get();\n  \t};\n\n  \tReferenceExpressionProxy.prototype.set = function set ( value ) {\n  \t\tif ( !this.model ) throw new Error( 'Unresolved reference expression. This should not happen!' );\n  \t\tthis.model.set( value );\n  \t};\n\n  \tReferenceExpressionProxy.prototype.unbind = function unbind$1 () {\n  \t\tthis.resolvers.forEach( unbind );\n  \t};\n\n  \treturn ReferenceExpressionProxy;\n  }(Model));\n\n  function resolve$1 ( fragment, template ) {\n  \tif ( template.r ) {\n  \t\treturn resolveReference( fragment, template.r );\n  \t}\n\n  \telse if ( template.x ) {\n  \t\treturn new ExpressionProxy( fragment, template.x );\n  \t}\n\n  \telse {\n  \t\treturn new ReferenceExpressionProxy( fragment, template.rx );\n  \t}\n  }\n\n  function resolveAliases( section ) {\n  \tif ( section.template.z ) {\n  \t\tsection.aliases = {};\n\n  \t\tvar refs = section.template.z;\n  \t\tfor ( var i = 0; i < refs.length; i++ ) {\n  \t\t\tsection.aliases[ refs[i].n ] = resolve$1( section.parentFragment, refs[i].x );\n  \t\t}\n  \t}\n  }\n\n  var Alias = (function (Item) {\n  \tfunction Alias ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.fragment = null;\n  \t}\n\n  \tAlias.prototype = Object.create( Item && Item.prototype );\n  \tAlias.prototype.constructor = Alias;\n\n  \tAlias.prototype.bind = function bind () {\n  \t\tresolveAliases( this );\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.template.f\n  \t\t}).bind();\n  \t};\n\n  \tAlias.prototype.detach = function detach () {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tAlias.prototype.find = function find ( selector ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tAlias.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment && this.fragment.firstNode( skipParent );\n  \t};\n\n  \tAlias.prototype.rebind = function rebind () {\n  \t\tresolveAliases( this );\n  \t\tif ( this.fragment ) this.fragment.rebind();\n  \t};\n\n  \tAlias.prototype.render = function render ( target ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target );\n  \t};\n\n  \tAlias.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment ? this.fragment.toString( escape ) : '';\n  \t};\n\n  \tAlias.prototype.unbind = function unbind () {\n  \t\tthis.aliases = {};\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAlias.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tAlias.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Alias;\n  }(Item));\n\n  function processWrapper ( wrapper, array, methodName, newIndices ) {\n  \tvar __model = wrapper.__model;\n\n  \tif ( newIndices ) {\n  \t\t__model.shuffle( newIndices );\n  \t} else {\n  \t\t// If this is a sort or reverse, we just do root.set()...\n  \t\t// TODO use merge logic?\n  \t\t//root.viewmodel.mark( keypath );\n  \t}\n  }\n\n  var mutatorMethods = [ 'pop', 'push', 'reverse', 'shift', 'sort', 'splice', 'unshift' ];\n  var patchedArrayProto = [];\n\n  mutatorMethods.forEach( function ( methodName ) {\n  \tvar method = function () {\n  \t\tvar this$1 = this;\n  \t\tvar args = [], len = arguments.length;\n  \t\twhile ( len-- ) args[ len ] = arguments[ len ];\n\n  \t\tvar newIndices = getNewIndices( this.length, methodName, args );\n\n  \t\t// apply the underlying method\n  \t\tvar result = Array.prototype[ methodName ].apply( this, arguments );\n\n  \t\t// trigger changes\n  \t\trunloop.start();\n\n  \t\tthis._ractive.setting = true;\n  \t\tvar i = this._ractive.wrappers.length;\n  \t\twhile ( i-- ) {\n  \t\t\tprocessWrapper( this$1._ractive.wrappers[i], this$1, methodName, newIndices );\n  \t\t}\n\n  \t\trunloop.end();\n\n  \t\tthis._ractive.setting = false;\n  \t\treturn result;\n  \t};\n\n  \tdefineProperty( patchedArrayProto, methodName, {\n  \t\tvalue: method\n  \t});\n  });\n\n  var patchArrayMethods;\n  var unpatchArrayMethods;\n\n  // can we use prototype chain injection?\n  // http://perfectionkills.com/how-ecmascript-5-still-does-not-allow-to-subclass-an-array/#wrappers_prototype_chain_injection\n  if ( ({}).__proto__ ) {\n  \t// yes, we can\n  \tpatchArrayMethods = function ( array ) { return array.__proto__ = patchedArrayProto; };\n  \tunpatchArrayMethods = function ( array ) { return array.__proto__ = Array.prototype; };\n  }\n\n  else {\n  \t// no, we can't\n  \tpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar methodName = mutatorMethods[i];\n  \t\t\tdefineProperty( array, methodName, {\n  \t\t\t\tvalue: patchedArrayProto[ methodName ],\n  \t\t\t\tconfigurable: true\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tunpatchArrayMethods = function ( array ) {\n  \t\tvar i = mutatorMethods.length;\n  \t\twhile ( i-- ) {\n  \t\t\tdelete array[ mutatorMethods[i] ];\n  \t\t}\n  \t};\n  }\n\n  patchArrayMethods.unpatch = unpatchArrayMethods; // TODO export separately?\n  var patch = patchArrayMethods;\n\n  var errorMessage$1 = 'Something went wrong in a rather interesting way';\n\n  var arrayAdaptor = {\n  \tfilter: function ( object ) {\n  \t\t// wrap the array if a) b) it's an array, and b) either it hasn't been wrapped already,\n  \t\t// or the array didn't trigger the get() itself\n  \t\treturn isArray( object ) && ( !object._ractive || !object._ractive.setting );\n  \t},\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new ArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  var ArrayWrapper = function ArrayWrapper ( ractive, array ) {\n  \tthis.root = ractive;\n  \tthis.value = array;\n  \tthis.__model = null; // filled in later\n\n  \t// if this array hasn't already been ractified, ractify it\n  \tif ( !array._ractive ) {\n  \t\t// define a non-enumerable _ractive property to store the wrappers\n  \t\tdefineProperty( array, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\twrappers: [],\n  \t\t\t\tinstances: [],\n  \t\t\t\tsetting: false\n  \t\t\t},\n  \t\t\tconfigurable: true\n  \t\t});\n\n  \t\tpatch( array );\n  \t}\n\n  \t// store the ractive instance, so we can handle transitions later\n  \tif ( !array._ractive.instances[ ractive._guid ] ) {\n  \t\tarray._ractive.instances[ ractive._guid ] = 0;\n  \t\tarray._ractive.instances.push( ractive );\n  \t}\n\n  \tarray._ractive.instances[ ractive._guid ] += 1;\n  \tarray._ractive.wrappers.push( this );\n  };\n\n  ArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  ArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  ArrayWrapper.prototype.teardown = function teardown () {\n  \tvar array, storage, wrappers, instances, index;\n\n  \tarray = this.value;\n  \tstorage = array._ractive;\n  \twrappers = storage.wrappers;\n  \tinstances = storage.instances;\n\n  \t// if teardown() was invoked because we're clearing the cache as a result of\n  \t// a change that the array itself triggered, we can save ourselves the teardown\n  \t// and immediate setup\n  \tif ( storage.setting ) {\n  \t\treturn false; // so that we don't remove it from cached wrappers\n  \t}\n\n  \tindex = wrappers.indexOf( this );\n  \tif ( index === -1 ) {\n  \t\tthrow new Error( errorMessage$1 );\n  \t}\n\n  \twrappers.splice( index, 1 );\n\n  \t// if nothing else depends on this array, we can revert it to its\n  \t// natural state\n  \tif ( !wrappers.length ) {\n  \t\tdelete array._ractive;\n  \t\tpatch.unpatch( this.value );\n  \t}\n\n  \telse {\n  \t\t// remove ractive instance if possible\n  \t\tinstances[ this.root._guid ] -= 1;\n  \t\tif ( !instances[ this.root._guid ] ) {\n  \t\t\tindex = instances.indexOf( this.root );\n\n  \t\t\tif ( index === -1 ) {\n  \t\t\t\tthrow new Error( errorMessage$1 );\n  \t\t\t}\n\n  \t\t\tinstances.splice( index, 1 );\n  \t\t}\n  \t}\n  };\n\n  var magicAdaptor;\n\n  try {\n  \tObject.defineProperty({}, 'test', { get: function() {}, set: function() {} });\n\n  \tmagicAdaptor = {\n  \t\tfilter: function ( value ) {\n  \t\t\treturn value && typeof value === 'object';\n  \t\t},\n  \t\twrap: function ( ractive, value, keypath ) {\n  \t\t\treturn new MagicWrapper( ractive, value, keypath );\n  \t\t}\n  \t};\n  } catch ( err ) {\n  \tmagicAdaptor = false;\n  }\n\n  var magicAdaptor$1 = magicAdaptor;\n\n  function createOrWrapDescriptor ( originalDescriptor, ractive, keypath ) {\n  \tif ( originalDescriptor.set && originalDescriptor.set.__magic ) {\n  \t\toriginalDescriptor.set.__magic.dependants.push({ ractive: ractive, keypath: keypath });\n  \t\treturn originalDescriptor;\n  \t}\n\n  \tvar setting;\n\n  \tvar dependants = [{ ractive: ractive, keypath: keypath }];\n\n  \tvar descriptor = {\n  \t\tget: function () {\n  \t\t\treturn 'value' in originalDescriptor ? originalDescriptor.value : originalDescriptor.get();\n  \t\t},\n  \t\tset: function ( value ) {\n  \t\t\tif ( setting ) return;\n\n  \t\t\tif ( 'value' in originalDescriptor ) {\n  \t\t\t\toriginalDescriptor.value = value;\n  \t\t\t} else {\n  \t\t\t\toriginalDescriptor.set( value );\n  \t\t\t}\n\n  \t\t\tsetting = true;\n  \t\t\tdependants.forEach( function (ref) {\n  \t\t\t\tvar ractive = ref.ractive;\n  \t\t\t\tvar keypath = ref.keypath;\n\n  \t\t\t\tractive.set( keypath, value );\n  \t\t\t});\n  \t\t\tsetting = false;\n  \t\t},\n  \t\tenumerable: true\n  \t};\n\n  \tdescriptor.set.__magic = { dependants: dependants, originalDescriptor: originalDescriptor };\n\n  \treturn descriptor;\n  }\n\n  function revert ( descriptor, ractive, keypath ) {\n  \tif ( !descriptor.set || !descriptor.set.__magic ) return true;\n\n  \tvar dependants = descriptor.set.__magic;\n  \tvar i = dependants.length;\n  \twhile ( i-- ) {\n  \t\tvar dependant = dependants[i];\n  \t\tif ( dependant.ractive === ractive && dependant.keypath === keypath ) {\n  \t\t\tdependants.splice( i, 1 );\n  \t\t\treturn false;\n  \t\t}\n  \t}\n  }\n\n  var MagicWrapper = function MagicWrapper ( ractive, value, keypath ) {\n  \tvar this$1 = this;\n\n  \t\tthis.ractive = ractive;\n  \tthis.value = value;\n  \tthis.keypath = keypath;\n\n  \tthis.originalDescriptors = {};\n\n  \t// wrap all properties with getters\n  \tObject.keys( value ).forEach( function ( key ) {\n  \t\tvar originalDescriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tthis$1.originalDescriptors[ key ] = originalDescriptor;\n\n  \t\tvar childKeypath = keypath ? (\"\" + keypath + \".\" + (escapeKey( key ))) : escapeKey( key );\n\n  \t\tvar descriptor = createOrWrapDescriptor( originalDescriptor, ractive, childKeypath );\n\n\n\n  \t\tObject.defineProperty( this$1.value, key, descriptor );\n  \t});\n  };\n\n  MagicWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.value === value;\n  };\n\n  MagicWrapper.prototype.set = function set ( key, value ) {\n  \tthis.value[ key ] = value;\n  };\n\n  MagicWrapper.prototype.teardown = function teardown () {\n  \tvar this$1 = this;\n\n  \t\tObject.keys( this.value ).forEach( function ( key ) {\n  \t\tvar descriptor = Object.getOwnPropertyDescriptor( this$1.value, key );\n  \t\tif ( !descriptor.set || !descriptor.set.__magic ) return;\n\n  \t\trevert( descriptor );\n\n  \t\tif ( descriptor.set.__magic.dependants.length === 1 ) {\n  \t\t\tObject.defineProperty( this$1.value, key, descriptor.set.__magic.originalDescriptor );\n  \t\t}\n  \t});\n  };\n\n  var MagicArrayWrapper = function MagicArrayWrapper ( ractive, array, keypath ) {\n  \tthis.value = array;\n\n  \tthis.magic = true;\n\n  \tthis.magicWrapper = magicAdaptor$1.wrap( ractive, array, keypath );\n  \tthis.arrayWrapper = arrayAdaptor.wrap( ractive, array, keypath );\n\n  \t// ugh, this really is a terrible hack\n  \tObject.defineProperty( this, '__model', {\n  \t\tget: function () {\n  \t\t\treturn this.arrayWrapper.__model;\n  \t\t},\n  \t\tset: function ( model ) {\n  \t\t\tthis.arrayWrapper.__model = model;\n  \t\t}\n  \t});\n  };\n\n  MagicArrayWrapper.prototype.get = function get () {\n  \treturn this.value;\n  };\n\n  MagicArrayWrapper.prototype.teardown = function teardown () {\n  \tthis.arrayWrapper.teardown();\n  \tthis.magicWrapper.teardown();\n  };\n\n  MagicArrayWrapper.prototype.reset = function reset ( value ) {\n  \treturn this.arrayWrapper.reset( value ) && this.magicWrapper.reset( value );\n  };\n\n  var magicArrayAdaptor = {\n  \tfilter: function ( object, keypath, ractive ) {\n  \t\treturn magicAdaptor$1.filter( object, keypath, ractive ) && arrayAdaptor.filter( object );\n  \t},\n\n  \twrap: function ( ractive, array, keypath ) {\n  \t\treturn new MagicArrayWrapper( ractive, array, keypath );\n  \t}\n  };\n\n  // TODO this is probably a bit anal, maybe we should leave it out\n  function prettify ( fnBody ) {\n  \tvar lines = fnBody\n  \t\t.replace( /^\\t+/gm, function ( tabs ) { return tabs.split( '\\t' ).join( '  ' ); } )\n  \t\t.split( '\\n' );\n\n  \tvar minIndent = lines.length < 2 ? 0 :\n  \t\tlines.slice( 1 ).reduce( function ( prev, line ) {\n  \t\t\treturn Math.min( prev, /^\\s*/.exec( line )[0].length );\n  \t\t}, Infinity );\n\n  \treturn lines.map( function ( line, i ) {\n  \t\treturn '    ' + ( i ? line.substring( minIndent ) : line );\n  \t}).join( '\\n' );\n  }\n\n  // Ditto. This function truncates the stack to only include app code\n  function truncateStack ( stack ) {\n  \tif ( !stack ) return '';\n\n  \tvar lines = stack.split( '\\n' );\n  \tvar name = Computation.name + '.getValue';\n\n  \tvar truncated = [];\n\n  \tvar len = lines.length;\n  \tfor ( var i = 1; i < len; i += 1 ) {\n  \t\tvar line = lines[i];\n\n  \t\tif ( ~line.indexOf( name ) ) {\n  \t\t\treturn truncated.join( '\\n' );\n  \t\t} else {\n  \t\t\ttruncated.push( line );\n  \t\t}\n  \t}\n  }\n\n  var Computation = (function (Model) {\n  \tfunction Computation ( viewmodel, signature, key ) {\n  \t\tModel.call( this, null, null );\n\n  \t\tthis.root = this.parent = viewmodel;\n  \t\tthis.signature = signature;\n\n  \t\tthis.key = key; // not actually used, but helps with debugging\n  \t\tthis.isExpression = key && key[0] === '@';\n\n  \t\tthis.isReadonly = !this.signature.setter;\n\n  \t\tthis.context = viewmodel.computationContext;\n\n  \t\tthis.dependencies = [];\n\n  \t\tthis.children = [];\n  \t\tthis.childByKey = {};\n\n  \t\tthis.deps = [];\n\n  \t\tthis.boundsSensitive = true;\n  \t\tthis.dirty = true;\n\n  \t\t// TODO: is there a less hackish way to do this?\n  \t\tthis.shuffle = undefined;\n  \t}\n\n  \tComputation.prototype = Object.create( Model && Model.prototype );\n  \tComputation.prototype.constructor = Computation;\n\n  \tComputation.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tthis.value = this.getValue();\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\treturn this.value;\n  \t};\n\n  \tComputation.prototype.getValue = function getValue () {\n  \t\tstartCapturing();\n  \t\tvar result;\n\n  \t\ttry {\n  \t\t\tresult = this.signature.getter.call( this.context );\n  \t\t} catch ( err ) {\n  \t\t\twarnIfDebug( (\"Failed to compute \" + (this.getKeypath()) + \": \" + (err.message || err)) );\n\n  \t\t\t// TODO this is all well and good in Chrome, but...\n  \t\t\t// ...also, should encapsulate this stuff better, and only\n  \t\t\t// show it if Ractive.DEBUG\n  \t\t\tif ( hasConsole ) {\n  \t\t\t\tif ( console.groupCollapsed ) console.groupCollapsed( '%cshow details', 'color: rgb(82, 140, 224); font-weight: normal; text-decoration: underline;' );\n  \t\t\t\tvar functionBody = prettify( this.signature.getterString );\n  \t\t\t\tvar stack = this.signature.getterUseStack ? '\\n\\n' + truncateStack( err.stack ) : '';\n  \t\t\t\tconsole.error( (\"\" + (err.name) + \": \" + (err.message) + \"\\n\\n\" + functionBody + \"\" + stack) );\n  \t\t\t\tif ( console.groupCollapsed ) console.groupEnd();\n  \t\t\t}\n  \t\t}\n\n  \t\tvar dependencies = stopCapturing();\n  \t\tthis.setDependencies( dependencies );\n\n  \t\treturn result;\n  \t};\n\n  \tComputation.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.dirty = true;\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( handleChange );\n  \t\tthis.clearUnresolveds(); // TODO same question as on Model - necessary for primitives?\n  \t};\n\n  \tComputation.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === undefined || key === '' ) return this;\n\n  \t\tif ( !this.childByKey.hasOwnProperty( key ) ) {\n  \t\t\tvar child = new ComputationChild( this, key );\n  \t\t\tthis.children.push( child );\n  \t\t\tthis.childByKey[ key ] = child;\n  \t\t}\n\n  \t\treturn this.childByKey[ key ];\n  \t};\n\n  \tComputation.prototype.mark = function mark () {\n  \t\tthis.handleChange();\n  \t};\n\n  \tComputation.prototype.set = function set ( value ) {\n  \t\tif ( !this.signature.setter ) {\n  \t\t\tthrow new Error( (\"Cannot set read-only computed value '\" + (this.key) + \"'\") );\n  \t\t}\n\n  \t\tthis.signature.setter( value );\n  \t};\n\n  \tComputation.prototype.setDependencies = function setDependencies ( dependencies ) {\n  \t\t// unregister any soft dependencies we no longer have\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model = this$1.dependencies[i];\n  \t\t\tif ( !~dependencies.indexOf( model ) ) model.unregister( this$1 );\n  \t\t}\n\n  \t\t// and add any new ones\n  \t\ti = dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar model$1 = dependencies[i];\n  \t\t\tif ( !~this$1.dependencies.indexOf( model$1 ) ) model$1.register( this$1 );\n  \t\t}\n\n  \t\tthis.dependencies = dependencies;\n  \t};\n\n  \tComputation.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tvar i = this.dependencies.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( this$1.dependencies[i] ) this$1.dependencies[i].unregister( this$1 );\n  \t\t}\n  \t\tif ( this.root.computations[this.key] === this ) delete this.root.computations[this.key];\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \treturn Computation;\n  }(Model));\n\n  var RactiveModel = (function (Model) {\n  \tfunction RactiveModel ( ractive ) {\n  \t\tModel.call( this, null, '' );\n  \t\tthis.value = ractive;\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.adaptors = [];\n  \t\tthis.ractive = ractive;\n  \t\tthis.changes = {};\n  \t}\n\n  \tRactiveModel.prototype = Object.create( Model && Model.prototype );\n  \tRactiveModel.prototype.constructor = RactiveModel;\n\n  \tRactiveModel.prototype.getKeypath = function getKeypath() {\n  \t\treturn '@ractive';\n  \t};\n\n  \treturn RactiveModel;\n  }(Model));\n\n  var hasProp$1 = Object.prototype.hasOwnProperty;\n\n  var RootModel = (function (Model) {\n  \tfunction RootModel ( options ) {\n  \t\tModel.call( this, null, null );\n\n  \t\t// TODO deprecate this\n  \t\tthis.changes = {};\n\n  \t\tthis.isRoot = true;\n  \t\tthis.root = this;\n  \t\tthis.ractive = options.ractive; // TODO sever this link\n\n  \t\tthis.value = options.data;\n  \t\tthis.adaptors = options.adapt;\n  \t\tthis.adapt();\n\n  \t\tthis.mappings = {};\n\n  \t\tthis.computationContext = options.ractive;\n  \t\tthis.computations = {};\n  \t}\n\n  \tRootModel.prototype = Object.create( Model && Model.prototype );\n  \tRootModel.prototype.constructor = RootModel;\n\n  \tRootModel.prototype.applyChanges = function applyChanges () {\n  \t\tthis._changeHash = {};\n  \t\tthis.flush();\n\n  \t\treturn this._changeHash;\n  \t};\n\n  \tRootModel.prototype.compute = function compute ( key, signature ) {\n  \t\tvar computation = new Computation( this, signature, key );\n  \t\tthis.computations[ key ] = computation;\n\n  \t\treturn computation;\n  \t};\n\n  \tRootModel.prototype.extendChildren = function extendChildren ( fn ) {\n  \t\tvar mappings = this.mappings;\n  \t\tObject.keys( mappings ).forEach( function ( key ) {\n  \t\t\tfn( key, mappings[ key ] );\n  \t\t});\n\n  \t\tvar computations = this.computations;\n  \t\tObject.keys( computations ).forEach( function ( key ) {\n  \t\t\tvar computation = computations[ key ];\n  \t\t\t// exclude template expressions\n  \t\t\tif ( !computation.isExpression ) {\n  \t\t\t\tfn( key, computation );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tRootModel.prototype.get = function get ( shouldCapture ) {\n  \t\tif ( shouldCapture ) capture( this );\n  \t\tvar result = extendObj( {}, this.value );\n\n  \t\tthis.extendChildren( function ( key, model ) {\n  \t\t\tresult[ key ] = model.value;\n  \t\t});\n\n  \t\treturn result;\n  \t};\n\n  \tRootModel.prototype.getKeypath = function getKeypath () {\n  \t\treturn '';\n  \t};\n\n  \tRootModel.prototype.getRactiveModel = function getRactiveModel() {\n  \t\treturn this.ractiveModel || ( this.ractiveModel = new RactiveModel( this.ractive ) );\n  \t};\n\n  \tRootModel.prototype.getValueChildren = function getValueChildren () {\n  \t\tvar children = Model.prototype.getValueChildren.call( this, this.value );\n\n  \t\tthis.extendChildren( function ( key, model ) {\n  \t\t\tchildren.push( model );\n  \t\t});\n\n  \t\treturn children;\n  \t};\n\n  \tRootModel.prototype.handleChange = function handleChange$1 () {\n  \t\tthis.deps.forEach( handleChange );\n  \t};\n\n  \tRootModel.prototype.has = function has ( key ) {\n  \t\tif ( ( key in this.mappings ) || ( key in this.computations ) ) return true;\n\n  \t\tvar value = this.value;\n\n  \t\tkey = unescapeKey( key );\n  \t\tif ( hasProp$1.call( value, key ) ) return true;\n\n  \t\t// We climb up the constructor chain to find if one of them contains the key\n  \t\tvar constructor = value.constructor;\n  \t\twhile ( constructor !== Function && constructor !== Array && constructor !== Object ) {\n  \t\t\tif ( hasProp$1.call( constructor.prototype, key ) ) return true;\n  \t\t\tconstructor = constructor.constructor;\n  \t\t}\n\n  \t\treturn false;\n  \t};\n\n  \tRootModel.prototype.joinKey = function joinKey ( key ) {\n  \t\tif ( key === '@global' ) return GlobalModel$1;\n  \t\tif ( key === '@ractive' ) return this.getRactiveModel();\n\n  \t\treturn this.mappings.hasOwnProperty( key ) ? this.mappings[ key ] :\n  \t\t       this.computations.hasOwnProperty( key ) ? this.computations[ key ] :\n  \t\t       Model.prototype.joinKey.call( this, key );\n  \t};\n\n  \tRootModel.prototype.map = function map ( localKey, origin ) {\n  \t\t// TODO remapping\n  \t\tthis.mappings[ localKey ] = origin;\n  \t\torigin.register( this );\n  \t};\n\n  \tRootModel.prototype.set = function set ( value ) {\n  \t\t// TODO wrapping root node is a baaaad idea. We should prevent this\n  \t\tvar wrapper = this.wrapper;\n  \t\tif ( wrapper ) {\n  \t\t\tvar shouldTeardown = !wrapper.reset || wrapper.reset( value ) === false;\n\n  \t\t\tif ( shouldTeardown ) {\n  \t\t\t\twrapper.teardown();\n  \t\t\t\tthis.wrapper = null;\n  \t\t\t\tthis.value = value;\n  \t\t\t\tthis.adapt();\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.value = value;\n  \t\t\tthis.adapt();\n  \t\t}\n\n  \t\tthis.deps.forEach( handleChange );\n  \t\tthis.children.forEach( mark );\n  \t\tthis.clearUnresolveds(); // TODO do we need to do this with primitive values? if not, what about e.g. unresolved `length` property of null -> string?\n  \t};\n\n  \tRootModel.prototype.retrieve = function retrieve () {\n  \t\treturn this.value;\n  \t};\n\n  \tRootModel.prototype.teardown = function teardown () {\n  \t\tvar this$1 = this;\n\n  \t\tvar keys = Object.keys( this.mappings );\n  \t\tvar i = keys.length;\n  \t\twhile ( i-- ){\n  \t\t\tif ( this$1.mappings[ keys[i] ] ) this$1.mappings[ keys[i] ].unregister( this$1 );\n  \t\t}\n\n  \t\tModel.prototype.teardown.call(this);\n  \t};\n\n  \tRootModel.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \tRootModel.prototype.updateFromBindings = function updateFromBindings ( cascade ) {\n  \t\tvar this$1 = this;\n\n  \t\tModel.prototype.updateFromBindings.call( this, cascade );\n\n  \t\tif ( cascade ) {\n  \t\t\t// TODO computations as well?\n  \t\t\tObject.keys( this.mappings ).forEach( function ( key ) {\n  \t\t\t\tvar model = this$1.mappings[ key ];\n  \t\t\t\tmodel.updateFromBindings( cascade );\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \treturn RootModel;\n  }(Model));\n\n  function getComputationSignature ( ractive, key, signature ) {\n  \tvar getter;\n  \tvar setter;\n\n  \t// useful for debugging\n  \tvar getterString;\n  \tvar getterUseStack;\n  \tvar setterString;\n\n  \tif ( typeof signature === 'function' ) {\n  \t\tgetter = bind$1( signature, ractive );\n  \t\tgetterString = signature.toString();\n  \t\tgetterUseStack = true;\n  \t}\n\n  \tif ( typeof signature === 'string' ) {\n  \t\tgetter = createFunctionFromString( signature, ractive );\n  \t\tgetterString = signature;\n  \t}\n\n  \tif ( typeof signature === 'object' ) {\n  \t\tif ( typeof signature.get === 'string' ) {\n  \t\t\tgetter = createFunctionFromString( signature.get, ractive );\n  \t\t\tgetterString = signature.get;\n  \t\t} else if ( typeof signature.get === 'function' ) {\n  \t\t\tgetter = bind$1( signature.get, ractive );\n  \t\t\tgetterString = signature.get.toString();\n  \t\t\tgetterUseStack = true;\n  \t\t} else {\n  \t\t\tfatal( '`%s` computation must have a `get()` method', key );\n  \t\t}\n\n  \t\tif ( typeof signature.set === 'function' ) {\n  \t\t\tsetter = bind$1( signature.set, ractive );\n  \t\t\tsetterString = signature.set.toString();\n  \t\t}\n  \t}\n\n  \treturn {\n  \t\tgetter: getter,\n  \t\tsetter: setter,\n  \t\tgetterString: getterString,\n  \t\tsetterString: setterString,\n  \t\tgetterUseStack: getterUseStack\n  \t};\n  }\n\n  var constructHook = new Hook( 'construct' );\n\n  var registryNames$1 = [\n  \t'adaptors',\n  \t'components',\n  \t'decorators',\n  \t'easing',\n  \t'events',\n  \t'interpolators',\n  \t'partials',\n  \t'transitions'\n  ];\n\n  var uid = 0;\n\n  function construct ( ractive, options ) {\n  \tif ( Ractive.DEBUG ) welcome();\n\n  \tinitialiseProperties( ractive );\n\n  \t// TODO remove this, eventually\n  \tdefineProperty( ractive, 'data', { get: deprecateRactiveData });\n\n  \t// TODO don't allow `onconstruct` with `new Ractive()`, there's no need for it\n  \tconstructHook.fire( ractive, options );\n\n  \t// Add registries\n  \tregistryNames$1.forEach( function ( name ) {\n  \t\tractive[ name ] = extendObj( create( ractive.constructor[ name ] || null ), options[ name ] );\n  \t});\n\n  \t// Create a viewmodel\n  \tvar viewmodel = new RootModel({\n  \t\tadapt: getAdaptors( ractive, ractive.adapt, options ),\n  \t\tdata: dataConfigurator.init( ractive.constructor, ractive, options ),\n  \t\tractive: ractive\n  \t});\n\n  \tractive.viewmodel = viewmodel;\n\n  \t// Add computed properties\n  \tvar computed = extendObj( create( ractive.constructor.prototype.computed ), options.computed );\n\n  \tfor ( var key in computed ) {\n  \t\tvar signature = getComputationSignature( ractive, key, computed[ key ] );\n  \t\tviewmodel.compute( key, signature );\n  \t}\n  }\n\n  function combine$2 ( a, b ) {\n  \tvar c = a.slice();\n  \tvar i = b.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( !~c.indexOf( b[i] ) ) {\n  \t\t\tc.push( b[i] );\n  \t\t}\n  \t}\n\n  \treturn c;\n  }\n\n  function getAdaptors ( ractive, protoAdapt, options ) {\n  \tprotoAdapt = protoAdapt.map( lookup );\n  \tvar adapt = ensureArray( options.adapt ).map( lookup );\n\n  \tadapt = combine$2( protoAdapt, adapt );\n\n  \tvar magic = 'magic' in options ? options.magic : ractive.magic;\n  \tvar modifyArrays = 'modifyArrays' in options ? options.modifyArrays : ractive.modifyArrays;\n\n  \tif ( magic ) {\n  \t\tif ( !magicSupported ) {\n  \t\t\tthrow new Error( 'Getters and setters (magic mode) are not supported in this browser' );\n  \t\t}\n\n  \t\tif ( modifyArrays ) {\n  \t\t\tadapt.push( magicArrayAdaptor );\n  \t\t}\n\n  \t\tadapt.push( magicAdaptor$1 );\n  \t}\n\n  \tif ( modifyArrays ) {\n  \t\tadapt.push( arrayAdaptor );\n  \t}\n\n  \treturn adapt;\n\n\n  \tfunction lookup ( adaptor ) {\n  \t\tif ( typeof adaptor === 'string' ) {\n  \t\t\tadaptor = findInViewHierarchy( 'adaptors', ractive, adaptor );\n\n  \t\t\tif ( !adaptor ) {\n  \t\t\t\tfatal( missingPlugin( adaptor, 'adaptor' ) );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn adaptor;\n  \t}\n  }\n\n  function initialiseProperties ( ractive ) {\n  \t// Generate a unique identifier, for places where you'd use a weak map if it\n  \t// existed\n  \tractive._guid = 'r-' + uid++;\n\n  \t// events\n  \tractive._subs = create( null );\n\n  \t// storage for item configuration from instantiation to reset,\n  \t// like dynamic functions or original values\n  \tractive._config = {};\n\n  \t// nodes registry\n  \tractive.nodes = {};\n\n  \t// events\n  \tractive.event = null;\n  \tractive._eventQueue = [];\n\n  \t// live queries\n  \tractive._liveQueries = [];\n  \tractive._liveComponentQueries = [];\n\n  \t// observers\n  \tractive._observers = [];\n\n  \t// links\n  \tractive._links = {};\n\n  \tif(!ractive.component){\n  \t\tractive.root = ractive;\n  \t\tractive.parent = ractive.container = null; // TODO container still applicable?\n  \t}\n\n  }\n\n  function deprecateRactiveData () {\n  \tthrow new Error( 'Using `ractive.data` is no longer supported - you must use the `ractive.get()` API instead' );\n  }\n\n  function getChildQueue ( queue, ractive ) {\n  \treturn queue[ ractive._guid ] || ( queue[ ractive._guid ] = [] );\n  }\n\n  function fire ( hookQueue, ractive ) {\n  \tvar childQueue = getChildQueue( hookQueue.queue, ractive );\n\n  \thookQueue.hook.fire( ractive );\n\n  \t// queue is \"live\" because components can end up being\n  \t// added while hooks fire on parents that modify data values.\n  \twhile ( childQueue.length ) {\n  \t\tfire( hookQueue, childQueue.shift() );\n  \t}\n\n  \tdelete hookQueue.queue[ ractive._guid ];\n  }\n\n  var HookQueue = function HookQueue ( event ) {\n  \tthis.hook = new Hook( event );\n  \tthis.inProcess = {};\n  \tthis.queue = {};\n  };\n\n  HookQueue.prototype.begin = function begin ( ractive ) {\n  \tthis.inProcess[ ractive._guid ] = true;\n  };\n\n  HookQueue.prototype.end = function end ( ractive ) {\n  \tvar parent = ractive.parent;\n\n  \t// If this is *isn't* a child of a component that's in process,\n  \t// it should call methods or fire at this point\n  \tif ( !parent || !this.inProcess[ parent._guid ] ) {\n  \t\tfire( this, ractive );\n  \t}\n  \t// elsewise, handoff to parent to fire when ready\n  \telse {\n  \t\tgetChildQueue( this.queue, parent ).push( ractive );\n  \t}\n\n  \tdelete this.inProcess[ ractive._guid ];\n  };\n\n  var configHook = new Hook( 'config' );\n  var initHook = new HookQueue( 'init' );\n\n  function initialise ( ractive, userOptions, options ) {\n  \tObject.keys( ractive.viewmodel.computations ).forEach( function ( key ) {\n  \t\tvar computation = ractive.viewmodel.computations[ key ];\n\n  \t\tif ( ractive.viewmodel.value.hasOwnProperty( key ) ) {\n  \t\t\tcomputation.set( ractive.viewmodel.value[ key ] );\n  \t\t}\n  \t});\n\n  \t// init config from Parent and options\n  \tconfig.init( ractive.constructor, ractive, userOptions );\n\n  \tconfigHook.fire( ractive );\n  \tinitHook.begin( ractive );\n\n  \tvar fragment;\n\n  \t// Render virtual DOM\n  \tif ( ractive.template ) {\n  \t\tvar cssIds;\n\n  \t\tif ( options.cssIds || ractive.cssId ) {\n  \t\t\tcssIds = options.cssIds ? options.cssIds.slice() : [];\n\n  \t\t\tif ( ractive.cssId ) {\n  \t\t\t\tcssIds.push( ractive.cssId );\n  \t\t\t}\n  \t\t}\n\n  \t\tractive.fragment = fragment = new Fragment({\n  \t\t\towner: ractive,\n  \t\t\ttemplate: ractive.template,\n  \t\t\tcssIds: cssIds\n  \t\t}).bind( ractive.viewmodel );\n  \t}\n\n  \tinitHook.end( ractive );\n\n  \tif ( fragment ) {\n  \t\t// render automatically ( if `el` is specified )\n  \t\tvar el = getElement( ractive.el );\n  \t\tif ( el ) {\n  \t\t\tvar promise = ractive.render( el, ractive.append );\n\n  \t\t\tif ( Ractive.DEBUG_PROMISES ) {\n  \t\t\t\tpromise['catch']( function ( err ) {\n  \t\t\t\t\twarnOnceIfDebug( 'Promise debugging is enabled, to help solve errors that happen asynchronously. Some browsers will log unhandled promise rejections, in which case you can safely disable promise debugging:\\n  Ractive.DEBUG_PROMISES = false;' );\n  \t\t\t\t\twarnIfDebug( 'An error happened during rendering', { ractive: ractive });\n  \t\t\t\t\tlogIfDebug( err );\n\n  \t\t\t\t\tthrow err;\n  \t\t\t\t});\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  var Parser;\n  var ParseError;\n  var leadingWhitespace = /^\\s+/;\n  ParseError = function ( message ) {\n  \tthis.name = 'ParseError';\n  \tthis.message = message;\n  \ttry {\n  \t\tthrow new Error(message);\n  \t} catch (e) {\n  \t\tthis.stack = e.stack;\n  \t}\n  };\n\n  ParseError.prototype = Error.prototype;\n\n  Parser = function ( str, options ) {\n  \tvar this$1 = this;\n\n  \tvar items, item, lineStart = 0;\n\n  \tthis.str = str;\n  \tthis.options = options || {};\n  \tthis.pos = 0;\n\n  \tthis.lines = this.str.split( '\\n' );\n  \tthis.lineEnds = this.lines.map( function ( line ) {\n  \t\tvar lineEnd = lineStart + line.length + 1; // +1 for the newline\n\n  \t\tlineStart = lineEnd;\n  \t\treturn lineEnd;\n  \t}, 0 );\n\n  \t// Custom init logic\n  \tif ( this.init ) this.init( str, options );\n\n  \titems = [];\n\n  \twhile ( ( this$1.pos < this$1.str.length ) && ( item = this$1.read() ) ) {\n  \t\titems.push( item );\n  \t}\n\n  \tthis.leftover = this.remaining();\n  \tthis.result = this.postProcess ? this.postProcess( items, options ) : items;\n  };\n\n  Parser.prototype = {\n  \tread: function ( converters ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar pos, i, len, item;\n\n  \t\tif ( !converters ) converters = this.converters;\n\n  \t\tpos = this.pos;\n\n  \t\tlen = converters.length;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tthis$1.pos = pos; // reset for each attempt\n\n  \t\t\tif ( item = converters[i]( this$1 ) ) {\n  \t\t\t\treturn item;\n  \t\t\t}\n  \t\t}\n\n  \t\treturn null;\n  \t},\n\n  \tgetLinePos: function ( char ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar lineNum = 0, lineStart = 0, columnNum;\n\n  \t\twhile ( char >= this$1.lineEnds[ lineNum ] ) {\n  \t\t\tlineStart = this$1.lineEnds[ lineNum ];\n  \t\t\tlineNum += 1;\n  \t\t}\n\n  \t\tcolumnNum = char - lineStart;\n  \t\treturn [ lineNum + 1, columnNum + 1, char ]; // line/col should be one-based, not zero-based!\n  \t},\n\n  \terror: function ( message ) {\n  \t\tvar pos = this.getLinePos( this.pos );\n  \t\tvar lineNum = pos[0];\n  \t\tvar columnNum = pos[1];\n\n  \t\tvar line = this.lines[ pos[0] - 1 ];\n  \t\tvar numTabs = 0;\n  \t\tvar annotation = line.replace( /\\t/g, function ( match, char ) {\n  \t\t\tif ( char < pos[1] ) {\n  \t\t\t\tnumTabs += 1;\n  \t\t\t}\n\n  \t\t\treturn '  ';\n  \t\t}) + '\\n' + new Array( pos[1] + numTabs ).join( ' ' ) + '^----';\n\n  \t\tvar error = new ParseError( (\"\" + message + \" at line \" + lineNum + \" character \" + columnNum + \":\\n\" + annotation) );\n\n  \t\terror.line = pos[0];\n  \t\terror.character = pos[1];\n  \t\terror.shortMessage = message;\n\n  \t\tthrow error;\n  \t},\n\n  \tmatchString: function ( string ) {\n  \t\tif ( this.str.substr( this.pos, string.length ) === string ) {\n  \t\t\tthis.pos += string.length;\n  \t\t\treturn string;\n  \t\t}\n  \t},\n\n  \tmatchPattern: function ( pattern ) {\n  \t\tvar match;\n\n  \t\tif ( match = pattern.exec( this.remaining() ) ) {\n  \t\t\tthis.pos += match[0].length;\n  \t\t\treturn match[1] || match[0];\n  \t\t}\n  \t},\n\n  \tallowWhitespace: function () {\n  \t\tthis.matchPattern( leadingWhitespace );\n  \t},\n\n  \tremaining: function () {\n  \t\treturn this.str.substring( this.pos );\n  \t},\n\n  \tnextChar: function () {\n  \t\treturn this.str.charAt( this.pos );\n  \t}\n  };\n\n  Parser.extend = function ( proto ) {\n  \tvar Parent = this, Child, key;\n\n  \tChild = function ( str, options ) {\n  \t\tParser.call( this, str, options );\n  \t};\n\n  \tChild.prototype = create( Parent.prototype );\n\n  \tfor ( key in proto ) {\n  \t\tif ( hasOwn.call( proto, key ) ) {\n  \t\t\tChild.prototype[ key ] = proto[ key ];\n  \t\t}\n  \t}\n\n  \tChild.extend = Parser.extend;\n  \treturn Child;\n  };\n\n  var Parser$1 = Parser;\n\n  var stringMiddlePattern;\n  var escapeSequencePattern;\n  var lineContinuationPattern;\n  // Match one or more characters until: \", ', \\, or EOL/EOF.\n  // EOL/EOF is written as (?!.) (meaning there's no non-newline char next).\n  stringMiddlePattern = /^(?=.)[^\"'\\\\]+?(?:(?!.)|(?=[\"'\\\\]))/;\n\n  // Match one escape sequence, including the backslash.\n  escapeSequencePattern = /^\\\\(?:['\"\\\\bfnrt]|0(?![0-9])|x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|(?=.)[^ux0-9])/;\n\n  // Match one ES5 line continuation (backslash + line terminator).\n  lineContinuationPattern = /^\\\\(?:\\r\\n|[\\u000A\\u000D\\u2028\\u2029])/;\n\n  // Helper for defining getDoubleQuotedString and getSingleQuotedString.\n  function makeQuotedStringMatcher ( okQuote ) {\n  \treturn function ( parser ) {\n  \t\tvar literal = '\"';\n  \t\tvar done = false;\n  \t\tvar next;\n\n  \t\twhile ( !done ) {\n  \t\t\tnext = ( parser.matchPattern( stringMiddlePattern ) || parser.matchPattern( escapeSequencePattern ) ||\n  \t\t\t\tparser.matchString( okQuote ) );\n  \t\t\tif ( next ) {\n  \t\t\t\tif ( next === (\"\\\"\") ) {\n  \t\t\t\t\tliteral += \"\\\\\\\"\";\n  \t\t\t\t} else if ( next === (\"\\\\'\") ) {\n  \t\t\t\t\tliteral += \"'\";\n  \t\t\t\t} else {\n  \t\t\t\t\tliteral += next;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tnext = parser.matchPattern( lineContinuationPattern );\n  \t\t\t\tif ( next ) {\n  \t\t\t\t\t// convert \\(newline-like) into a \\u escape, which is allowed in JSON\n  \t\t\t\t\tliteral += '\\\\u' + ( '000' + next.charCodeAt(1).toString(16) ).slice( -4 );\n  \t\t\t\t} else {\n  \t\t\t\t\tdone = true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tliteral += '\"';\n\n  \t\t// use JSON.parse to interpret escapes\n  \t\treturn JSON.parse( literal );\n  \t};\n  }\n\n  var getSingleQuotedString = makeQuotedStringMatcher( (\"\\\"\") );\n  var getDoubleQuotedString = makeQuotedStringMatcher( (\"'\") );\n\n  function readStringLiteral ( parser ) {\n  \tvar start, string;\n\n  \tstart = parser.pos;\n\n  \tif ( parser.matchString( '\"' ) ) {\n  \t\tstring = getDoubleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( '\"' ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \tif ( parser.matchString( (\"'\") ) ) {\n  \t\tstring = getSingleQuotedString( parser );\n\n  \t\tif ( !parser.matchString( (\"'\") ) ) {\n  \t\t\tparser.pos = start;\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn {\n  \t\t\tt: STRING_LITERAL,\n  \t\t\tv: string\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  // bulletproof number regex from https://gist.github.com/Rich-Harris/7544330\n  var numberPattern$1 = /^(?:[+-]?)0*(?:(?:(?:[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n\n  function readNumberLiteral ( parser ) {\n  \tvar result;\n\n  \tif ( result = parser.matchPattern( numberPattern$1 ) ) {\n  \t\treturn {\n  \t\t\tt: NUMBER_LITERAL,\n  \t\t\tv: result\n  \t\t};\n  \t}\n\n  \treturn null;\n  }\n\n  var name = /^[a-zA-Z_$][a-zA-Z_$0-9]*/;\n\n  var identifier = /^[a-zA-Z_$][a-zA-Z_$0-9]*$/;\n\n  // http://mathiasbynens.be/notes/javascript-properties\n  // can be any name, string literal, or number literal\n  function readKey ( parser ) {\n  \tvar token;\n\n  \tif ( token = readStringLiteral( parser ) ) {\n  \t\treturn identifier.test( token.v ) ? token.v : '\"' + token.v.replace( /\"/g, '\\\\\"' ) + '\"';\n  \t}\n\n  \tif ( token = readNumberLiteral( parser ) ) {\n  \t\treturn token.v;\n  \t}\n\n  \tif ( token = parser.matchPattern( name ) ) {\n  \t\treturn token;\n  \t}\n\n  \treturn null;\n  }\n\n  // simple JSON parser, without the restrictions of JSON parse\n  // (i.e. having to double-quote keys).\n  //\n  // If passed a hash of values as the second argument, ${placeholders}\n  // will be replaced with those values\n\n  var specials = {\n  \t'true': true,\n  \t'false': false,\n  \t'null': null,\n  \tundefined: undefined\n  };\n\n  var specialsPattern = new RegExp( '^(?:' + Object.keys( specials ).join( '|' ) + ')' );\n  var numberPattern = /^(?:[+-]?)(?:(?:(?:0|[1-9]\\d*)?\\.\\d+)|(?:(?:0|[1-9]\\d*)\\.)|(?:0|[1-9]\\d*))(?:[eE][+-]?\\d+)?/;\n  var placeholderPattern = /\\$\\{([^\\}]+)\\}/g;\n  var placeholderAtStartPattern = /^\\$\\{([^\\}]+)\\}/;\n  var onlyWhitespace = /^\\s*$/;\n\n  var JsonParser = Parser$1.extend({\n  \tinit: function ( str, options ) {\n  \t\tthis.values = options.values;\n  \t\tthis.allowWhitespace();\n  \t},\n\n  \tpostProcess: function ( result ) {\n  \t\tif ( result.length !== 1 || !onlyWhitespace.test( this.leftover ) ) {\n  \t\t\treturn null;\n  \t\t}\n\n  \t\treturn { value: result[0].v };\n  \t},\n\n  \tconverters: [\n  \t\tfunction getPlaceholder ( parser ) {\n  \t\t\tif ( !parser.values ) return null;\n\n  \t\t\tvar placeholder = parser.matchPattern( placeholderAtStartPattern );\n\n  \t\t\tif ( placeholder && ( parser.values.hasOwnProperty( placeholder ) ) ) {\n  \t\t\t\treturn { v: parser.values[ placeholder ] };\n  \t\t\t}\n  \t\t},\n\n  \t\tfunction getSpecial ( parser ) {\n  \t\t\tvar special = parser.matchPattern( specialsPattern );\n  \t\t\tif ( special ) return { v: specials[ special ] };\n  \t\t},\n\n  \t\tfunction getNumber ( parser ) {\n  \t\t\tvar number = parser.matchPattern( numberPattern );\n  \t\t\tif ( number ) return { v: +number };\n  \t\t},\n\n  \t\tfunction getString ( parser ) {\n  \t\t\tvar stringLiteral = readStringLiteral( parser );\n  \t\t\tvar values = parser.values;\n\n  \t\t\tif ( stringLiteral && values ) {\n  \t\t\t\treturn {\n  \t\t\t\t\tv: stringLiteral.v.replace( placeholderPattern, function ( match, $1 ) { return ( $1 in values ? values[ $1 ] : $1 ); } )\n  \t\t\t\t};\n  \t\t\t}\n\n  \t\t\treturn stringLiteral;\n  \t\t},\n\n  \t\tfunction getObject ( parser ) {\n  \t\t\tif ( !parser.matchString( '{' ) ) return null;\n\n  \t\t\tvar result = {};\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar pair;\n  \t\t\twhile ( pair = getKeyValuePair( parser ) ) {\n  \t\t\t\tresult[ pair.key ] = pair.value;\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( '}' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t},\n\n  \t\tfunction getArray ( parser ) {\n  \t\t\tif ( !parser.matchString( '[' ) ) return null;\n\n  \t\t\tvar result = [];\n\n  \t\t\tparser.allowWhitespace();\n\n  \t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\treturn { v: result };\n  \t\t\t}\n\n  \t\t\tvar valueToken;\n  \t\t\twhile ( valueToken = parser.read() ) {\n  \t\t\t\tresult.push( valueToken.v );\n\n  \t\t\t\tparser.allowWhitespace();\n\n  \t\t\t\tif ( parser.matchString( ']' ) ) {\n  \t\t\t\t\treturn { v: result };\n  \t\t\t\t}\n\n  \t\t\t\tif ( !parser.matchString( ',' ) ) {\n  \t\t\t\t\treturn null;\n  \t\t\t\t}\n\n  \t\t\t\tparser.allowWhitespace();\n  \t\t\t}\n\n  \t\t\treturn null;\n  \t\t}\n  \t]\n  });\n\n  function getKeyValuePair ( parser ) {\n  \tparser.allowWhitespace();\n\n  \tvar key = readKey( parser );\n\n  \tif ( !key ) return null;\n\n  \tvar pair = { key: key };\n\n  \tparser.allowWhitespace();\n  \tif ( !parser.matchString( ':' ) ) {\n  \t\treturn null;\n  \t}\n  \tparser.allowWhitespace();\n\n  \tvar valueToken = parser.read();\n\n  \tif ( !valueToken ) return null;\n\n  \tpair.value = valueToken.v;\n  \treturn pair;\n  }\n\n  function parseJSON ( str, values ) {\n  \tvar parser = new JsonParser( str, { values: values });\n  \treturn parser.result;\n  }\n\n  function gatherRefs( fragment ) {\n  \tvar key = {}, index = {};\n\n  \t// walk up the template gather refs as we go\n  \twhile ( fragment ) {\n  \t\tif ( fragment.parent && ( fragment.parent.indexRef || fragment.parent.keyRef ) ) {\n  \t\t\tvar ref = fragment.parent.indexRef;\n  \t\t\tif ( ref && !( ref in index ) ) index[ref] = fragment.index;\n  \t\t\tref = fragment.parent.keyRef;\n  \t\t\tif ( ref && !( ref in key ) ) key[ref] = fragment.key;\n  \t\t}\n\n  \t\tif ( fragment.componentParent && !fragment.ractive.isolated ) {\n  \t\t\tfragment = fragment.componentParent;\n  \t\t} else {\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n  \t}\n\n  \treturn { key: key, index: index };\n  }\n\n  var eventPattern = /^event(?:\\.(.+))?$/;\n  var argumentsPattern = /^arguments\\.(\\d*)$/;\n  var dollarArgsPattern = /^\\$(\\d*)$/;\n\n  var EventDirective = function EventDirective ( owner, event, template ) {\n  \tthis.owner = owner;\n  \tthis.event = event;\n  \tthis.template = template;\n\n  \tthis.ractive = owner.parentFragment.ractive;\n  \tthis.parentFragment = owner.parentFragment;\n\n  \tthis.context = null;\n  \tthis.passthru = false;\n\n  \t// method calls\n  \tthis.method = null;\n  \tthis.resolvers = null;\n  \tthis.models = null;\n  \tthis.argsFn = null;\n\n  \t// handler directive\n  \tthis.action = null;\n  \tthis.args = null;\n  };\n\n  EventDirective.prototype.bind = function bind () {\n  \tvar this$1 = this;\n\n  \t\tthis.context = this.parentFragment.findContext();\n\n  \tvar template = this.template;\n\n  \tif ( template.m ) {\n  \t\tthis.method = template.m;\n\n  \t\t// pass-thru \"...arguments\"\n  \t\tthis.passthru = !!template.g;\n\n  \t\tif ( template.a ) {\n  \t\t\tthis.resolvers = [];\n  \t\t\tthis.models = template.a.r.map( function ( ref, i ) {\n\n  \t\t\t\tif ( eventPattern.test( ref ) ) {\n  \t\t\t\t\t// on-click=\"foo(event.node)\"\n  \t\t\t\t\treturn {\n  \t\t\t\t\t\tevent: true,\n  \t\t\t\t\t\tkeys: ref.length > 5 ? splitKeypathI( ref.slice( 6 ) ) : [],\n  \t\t\t\t\t\tunbind: noop\n  \t\t\t\t\t};\n  \t\t\t\t}\n\n  \t\t\t\tvar argMatch = argumentsPattern.exec( ref );\n  \t\t\t\tif ( argMatch ) {\n  \t\t\t\t\t// on-click=\"foo(arguments[0])\"\n  \t\t\t\t\treturn {\n  \t\t\t\t\t\targument: true,\n  \t\t\t\t\t\tindex: argMatch[1]\n  \t\t\t\t\t};\n  \t\t\t\t}\n\n  \t\t\t\tvar dollarMatch = dollarArgsPattern.exec( ref );\n  \t\t\t\tif ( dollarMatch ) {\n  \t\t\t\t\t// on-click=\"foo($1)\"\n  \t\t\t\t\treturn {\n  \t\t\t\t\t\targument: true,\n  \t\t\t\t\t\tindex: dollarMatch[1] - 1\n  \t\t\t\t\t};\n  \t\t\t\t}\n\n  \t\t\t\tvar resolver;\n\n  \t\t\t\tvar model = resolveReference( this$1.parentFragment, ref );\n  \t\t\t\tif ( !model ) {\n  \t\t\t\t\tresolver = this$1.parentFragment.resolve( ref, function ( model ) {\n  \t\t\t\t\t\tthis$1.models[i] = model;\n  \t\t\t\t\t\tremoveFromArray( this$1.resolvers, resolver );\n  \t\t\t\t\t});\n\n  \t\t\t\t\tthis$1.resolvers.push( resolver );\n  \t\t\t\t}\n\n  \t\t\t\treturn model;\n  \t\t\t});\n\n  \t\t\tthis.argsFn = getFunction( template.a.s, template.a.r.length );\n  \t\t}\n\n  \t}\n\n  \telse {\n  \t\t// TODO deprecate this style of directive\n  \t\tthis.action = typeof template === 'string' ? // on-click='foo'\n  \t\t\ttemplate :\n  \t\t\ttypeof template.n === 'string' ? // on-click='{{dynamic}}'\n  \t\t\t\ttemplate.n :\n  \t\t\t\tnew Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: template.n\n  \t\t\t\t});\n\n  \t\tthis.args = template.a ? // static arguments\n  \t\t\t( typeof template.a === 'string' ? [ template.a ] : template.a ) :\n  \t\t\ttemplate.d ? // dynamic arguments\n  \t\t\t\tnew Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: template.d\n  \t\t\t\t}) :\n  \t\t\t\t[]; // no arguments\n  \t}\n\n  \tif ( this.template.n && typeof this.template.n !== 'string' ) this.action.bind();\n  \tif ( this.template.d ) this.args.bind();\n  };\n\n  EventDirective.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  EventDirective.prototype.fire = function fire ( event, passedArgs ) {\n\n  \t// augment event object\n  \tif ( passedArgs === void 0 ) passedArgs = [];\n\n  \t\tif ( event ) {\n  \t\tvar refs = gatherRefs( this.parentFragment );\n  \t\tevent.keypath = this.context.getKeypath( this.ractive );\n  \t\tevent.rootpath = this.context.getKeypath();\n  \t\tevent.context = this.context.get();\n  \t\tevent.index = refs.index;\n  \t\tevent.key = refs.key;\n  \t}\n\n  \tif ( this.method ) {\n  \t\tif ( typeof this.ractive[ this.method ] !== 'function' ) {\n  \t\t\tthrow new Error( (\"Attempted to call a non-existent method (\\\"\" + (this.method) + \"\\\")\") );\n  \t\t}\n\n  \t\tvar args;\n\n  \t\tif ( event ) passedArgs.unshift( event );\n\n  \t\tif ( this.models ) {\n  \t\t\tvar values = this.models.map( function ( model ) {\n  \t\t\t\tif ( !model ) return undefined;\n\n  \t\t\t\tif ( model.event ) {\n  \t\t\t\t\tvar obj = event;\n  \t\t\t\t\tvar keys = model.keys.slice();\n\n  \t\t\t\t\twhile ( keys.length ) obj = obj[ keys.shift() ];\n  \t\t\t\t\treturn obj;\n  \t\t\t\t}\n\n  \t\t\t\tif ( model.argument ) {\n  \t\t\t\t\treturn passedArgs ? passedArgs[ model.index ] : void 0;\n  \t\t\t\t}\n\n  \t\t\t\tif ( model.wrapper ) {\n  \t\t\t\t\treturn model.wrapper.value;\n  \t\t\t\t}\n\n  \t\t\t\treturn model.get();\n  \t\t\t});\n\n  \t\t\targs = this.argsFn.apply( null, values );\n  \t\t}\n\n  \t\tif ( this.passthru ) {\n  \t\t\targs = args ? args.concat( passedArgs ) : passedArgs;\n  \t\t}\n\n  \t\t// make event available as `this.event`\n  \t\tvar ractive = this.ractive;\n  \t\tvar oldEvent = ractive.event;\n\n  \t\tractive.event = event;\n  \t\tvar result = ractive[ this.method ].apply( ractive, args );\n\n  \t\t// Auto prevent and stop if return is explicitly false\n  \t\tvar original;\n  \t\tif ( result === false && ( original = event.original ) ) {\n  \t\t\toriginal.preventDefault && original.preventDefault();\n  \t\t\toriginal.stopPropagation && original.stopPropagation();\n  \t\t}\n\n  \t\tractive.event = oldEvent;\n  \t}\n\n  \telse {\n  \t\tvar action = this.action.toString();\n  \t\tvar args$1 = this.template.d ? this.args.getArgsList() : this.args;\n\n  \t\tif ( passedArgs.length ) args$1 = args$1.concat( passedArgs );\n\n  \t\tif ( event ) event.name = action;\n\n  \t\tfireEvent( this.ractive, action, {\n  \t\t\tevent: event,\n  \t\t\targs: args$1\n  \t\t});\n  \t}\n  };\n\n  EventDirective.prototype.rebind = function rebind () {\n  \tthis.unbind();\n  \tthis.bind();\n  };\n\n  EventDirective.prototype.render = function render () {\n  \tthis.event.listen( this );\n  };\n\n  EventDirective.prototype.unbind = function unbind$1 () {\n  \tvar template = this.template;\n\n  \tif ( template.m ) {\n  \t\tif ( this.resolvers ) this.resolvers.forEach( unbind );\n  \t\tthis.resolvers = [];\n\n  \t\tthis.models = null;\n  \t}\n\n  \telse {\n  \t\t// TODO this is brittle and non-explicit, fix it\n  \t\tif ( this.action.unbind ) this.action.unbind();\n  \t\tif ( this.args.unbind ) this.args.unbind();\n  \t}\n  };\n\n  EventDirective.prototype.unrender = function unrender () {\n  \tthis.event.unlisten();\n  };\n\n  EventDirective.prototype.update = function update () {\n  \tif ( this.method || !this.dirty ) return; // nothing to do\n\n  \tthis.dirty = false;\n\n  \t// ugh legacy\n  \tif ( this.action.update ) this.action.update();\n  \tif ( this.template.d ) this.args.update();\n  };\n\n  var RactiveEvent = function RactiveEvent ( ractive, name ) {\n  \tthis.ractive = ractive;\n  \tthis.name = name;\n  \tthis.handler = null;\n  };\n\n  RactiveEvent.prototype.listen = function listen ( directive ) {\n  \tvar ractive = this.ractive;\n\n  \tthis.handler = ractive.on( this.name, function () {\n  \t\tvar event;\n\n  \t\t// semi-weak test, but what else? tag the event obj ._isEvent ?\n  \t\tif ( arguments.length && arguments[0] && arguments[0].node ) {\n  \t\t\tevent = Array.prototype.shift.call( arguments );\n  \t\t\tevent.component = ractive;\n  \t\t}\n\n  \t\tvar args = Array.prototype.slice.call( arguments );\n  \t\tdirective.fire( event, args );\n\n  \t\t// cancel bubbling\n  \t\treturn false;\n  \t});\n  };\n\n  RactiveEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.cancel();\n  };\n\n  // TODO it's unfortunate that this has to run every time a\n  // component is rendered... is there a better way?\n  function updateLiveQueries ( component ) {\n  \t// Does this need to be added to any live queries?\n  \tvar instance = component.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveComponentQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar name = liveQueries[i];\n  \t\t\tvar query = liveQueries[ (\"_\" + name) ];\n\n  \t\t\tif ( query.test( component ) ) {\n  \t\t\t\tquery.add( component.instance );\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\tcomponent.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n  \t} while ( instance = instance.parent );\n  }\n\n  function removeFromLiveComponentQueries ( component ) {\n  \tvar instance = component.ractive;\n\n  \twhile ( instance ) {\n  \t\tvar query = instance._liveComponentQueries[ (\"_\" + (component.name)) ];\n  \t\tif ( query ) query.remove( component );\n\n  \t\tinstance = instance.parent;\n  \t}\n  }\n\n  function makeDirty ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var teardownHook = new Hook( 'teardown' );\n\n  var Component = (function (Item) {\n  \tfunction Component ( options, ComponentConstructor ) {\n  \t\tItem.call( this, options );\n  \t\tthis.type = COMPONENT; // override ELEMENT from super\n\n  \t\tvar instance = create( ComponentConstructor.prototype );\n\n  \t\tthis.instance = instance;\n  \t\tthis.name = options.template.e;\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.complexMappings = [];\n\n  \t\tthis.liveQueries = [];\n\n  \t\tif ( instance.el ) {\n  \t\t\twarnIfDebug( (\"The <\" + (this.name) + \"> component has a default 'el' property; it has been disregarded\") );\n  \t\t}\n\n  \t\tvar partials = options.template.p || {};\n  \t\tif ( !( 'content' in partials ) ) partials.content = options.template.f || [];\n  \t\tthis._partials = partials; // TEMP\n\n  \t\tthis.yielders = {};\n\n  \t\t// find container\n  \t\tvar fragment = options.parentFragment;\n  \t\tvar container;\n  \t\twhile ( fragment ) {\n  \t\t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\t\tcontainer = fragment.owner.container;\n  \t\t\t\tbreak;\n  \t\t\t}\n\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\t// add component-instance-specific properties\n  \t\tinstance.parent = this.parentFragment.ractive;\n  \t\tinstance.container = container || null;\n  \t\tinstance.root = instance.parent.root;\n  \t\tinstance.component = this;\n\n  \t\tconstruct( this.instance, { partials: partials });\n\n  \t\t// for hackability, this could be an open option\n  \t\t// for any ractive instance, but for now, just\n  \t\t// for components and just for ractive...\n  \t\tinstance._inlinePartials = partials;\n\n  \t\tthis.eventHandlers = [];\n  \t\tif ( this.template.v ) this.setupEvents();\n  \t}\n\n  \tComponent.prototype = Object.create( Item && Item.prototype );\n  \tComponent.prototype.constructor = Component;\n\n  \tComponent.prototype.bind = function bind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tvar childData = viewmodel.value;\n\n  \t\t// determine mappings\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( localKey ) {\n  \t\t\t\tvar template = this$1.template.a[ localKey ];\n  \t\t\t\tvar model;\n  \t\t\t\tvar fragment;\n\n  \t\t\t\tif ( template === 0 ) {\n  \t\t\t\t\t// empty attributes are `true`\n  \t\t\t\t\tviewmodel.joinKey( localKey ).set( true );\n  \t\t\t\t}\n\n  \t\t\t\telse if ( typeof template === 'string' ) {\n  \t\t\t\t\tvar parsed = parseJSON( template );\n  \t\t\t\t\tviewmodel.joinKey( localKey ).set( parsed ? parsed.value : template );\n  \t\t\t\t}\n\n  \t\t\t\telse if ( isArray( template ) ) {\n  \t\t\t\t\tif ( template.length === 1 && template[0].t === INTERPOLATOR ) {\n  \t\t\t\t\t\tmodel = resolve$1( this$1.parentFragment, template[0] );\n\n  \t\t\t\t\t\tif ( !model ) {\n  \t\t\t\t\t\t\twarnOnceIfDebug( (\"The \" + localKey + \"='{{\" + (template[0].r) + \"}}' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: this$1.instance }); // TODO add docs page explaining this\n  \t\t\t\t\t\t\tthis$1.parentFragment.ractive.get( localKey ); // side-effect: create mappings as necessary\n  \t\t\t\t\t\t\tmodel = this$1.parentFragment.findContext().joinKey( localKey );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\tviewmodel.map( localKey, model );\n\n  \t\t\t\t\t\tif ( model.get() === undefined && localKey in childData ) {\n  \t\t\t\t\t\t\tmodel.set( childData[ localKey ] );\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\telse {\n  \t\t\t\t\t\tfragment = new Fragment({\n  \t\t\t\t\t\t\towner: this$1,\n  \t\t\t\t\t\t\ttemplate: template\n  \t\t\t\t\t\t}).bind();\n\n  \t\t\t\t\t\tmodel = viewmodel.joinKey( localKey );\n  \t\t\t\t\t\tmodel.set( fragment.valueOf() );\n\n  \t\t\t\t\t\t// this is a *bit* of a hack\n  \t\t\t\t\t\tfragment.bubble = function () {\n  \t\t\t\t\t\t\tFragment.prototype.bubble.call( fragment );\n  \t\t\t\t\t\t\tfragment.update();\n  \t\t\t\t\t\t\tmodel.set( fragment.valueOf() );\n  \t\t\t\t\t\t};\n\n  \t\t\t\t\t\tthis$1.complexMappings.push( fragment );\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tinitialise( this.instance, {\n  \t\t\tpartials: this._partials\n  \t\t}, {\n  \t\t\tcssIds: this.parentFragment.cssIds\n  \t\t});\n\n  \t\tthis.eventHandlers.forEach( bind );\n  \t};\n\n  \tComponent.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.parentFragment.bubble();\n  \t\t}\n  \t};\n\n  \tComponent.prototype.checkYielders = function checkYielders () {\n  \t\tvar this$1 = this;\n\n  \t\tObject.keys( this.yielders ).forEach( function ( name ) {\n  \t\t\tif ( this$1.yielders[ name ].length > 1 ) {\n  \t\t\t\trunloop.end();\n  \t\t\t\tthrow new Error( (\"A component template can only have one {{yield\" + (name ? ' ' + name : '') + \"}} declaration at a time\") );\n  \t\t\t}\n  \t\t});\n  \t};\n\n  \tComponent.prototype.detach = function detach () {\n  \t\treturn this.instance.fragment.detach();\n  \t};\n\n  \tComponent.prototype.find = function find ( selector ) {\n  \t\treturn this.instance.fragment.find( selector );\n  \t};\n\n  \tComponent.prototype.findAll = function findAll ( selector, query ) {\n  \t\tthis.instance.fragment.findAll( selector, query );\n  \t};\n\n  \tComponent.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( !name || this.name === name ) return this.instance;\n\n  \t\tif ( this.instance.fragment ) {\n  \t\t\treturn this.instance.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tComponent.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( query.test( this ) ) {\n  \t\t\tquery.add( this.instance );\n\n  \t\t\tif ( query.live ) {\n  \t\t\t\tthis.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.instance.fragment.findAllComponents( name, query );\n  \t};\n\n  \tComponent.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.instance.fragment.firstNode( skipParent );\n  \t};\n\n  \tComponent.prototype.rebind = function rebind$1 () {\n  \t\tvar this$1 = this;\n\n  \t\tthis.complexMappings.forEach( rebind );\n\n  \t\tthis.liveQueries.forEach( makeDirty );\n\n  \t\t// update relevant mappings\n  \t\tvar viewmodel = this.instance.viewmodel;\n  \t\tviewmodel.mappings = {};\n\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( localKey ) {\n  \t\t\t\tvar template = this$1.template.a[ localKey ];\n  \t\t\t\tvar model;\n\n  \t\t\t\tif ( isArray( template ) && template.length === 1 && template[0].t === INTERPOLATOR ) {\n  \t\t\t\t\tmodel = resolve$1( this$1.parentFragment, template[0] );\n\n  \t\t\t\t\tif ( !model ) {\n  \t\t\t\t\t\t// TODO is this even possible?\n  \t\t\t\t\t\twarnOnceIfDebug( (\"The \" + localKey + \"='{{\" + (template[0].r) + \"}}' mapping is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: this$1.instance });\n  \t\t\t\t\t\tthis$1.parentFragment.ractive.get( localKey ); // side-effect: create mappings as necessary\n  \t\t\t\t\t\tmodel = this$1.parentFragment.findContext().joinKey( localKey );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tviewmodel.map( localKey, model );\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.instance.fragment.rebind( viewmodel );\n  \t};\n\n  \tComponent.prototype.render = function render$1$$ ( target, occupants ) {\n  \t\trender$1( this.instance, target, null, occupants );\n\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach( render );\n  \t\tupdateLiveQueries( this );\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tComponent.prototype.setupEvents = function setupEvents () {\n  \t\tvar this$1 = this;\n\n  \t\tvar handlers = this.eventHandlers;\n\n  \t\tObject.keys( this.template.v ).forEach( function ( key ) {\n  \t\t\tvar eventNames = key.split( '-' );\n  \t\t\tvar template = this$1.template.v[ key ];\n\n  \t\t\teventNames.forEach( function ( eventName ) {\n  \t\t\t\tvar event = new RactiveEvent( this$1.instance, eventName );\n  \t\t\t\thandlers.push( new EventDirective( this$1, event, template ) );\n  \t\t\t});\n  \t\t});\n  \t};\n\n  \tComponent.prototype.toString = function toString () {\n  \t\treturn this.instance.toHTML();\n  \t};\n\n  \tComponent.prototype.unbind = function unbind$1 () {\n  \t\tthis.complexMappings.forEach( unbind );\n\n  \t\tvar instance = this.instance;\n  \t\tinstance.viewmodel.teardown();\n  \t\tinstance.fragment.unbind();\n  \t\tinstance._observers.forEach( cancel );\n\n  \t\tremoveFromLiveComponentQueries( this );\n\n  \t\tif ( instance.fragment.rendered && instance.el.__ractive_instances__ ) {\n  \t\t\tremoveFromArray( instance.el.__ractive_instances__, instance );\n  \t\t}\n\n  \t\tObject.keys( instance._links ).forEach( function ( k ) { return instance._links[k].unlink(); } );\n\n  \t\tteardownHook.fire( instance );\n  \t};\n\n  \tComponent.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \t\tvar this$1 = this;\n\n  \t\tthis.shouldDestroy = shouldDestroy;\n  \t\tthis.instance.unrender();\n  \t\tthis.eventHandlers.forEach( unrender );\n  \t\tthis.liveQueries.forEach( function ( query ) { return query.remove( this$1.instance ); } );\n  \t};\n\n  \tComponent.prototype.update = function update$1 () {\n  \t\tthis.dirty = false;\n  \t\tthis.instance.fragment.update();\n  \t\tthis.checkYielders();\n  \t\tthis.eventHandlers.forEach( update );\n  \t\tthis.complexMappings.forEach( update );\n  \t};\n\n  \treturn Component;\n  }(Item));\n\n  var Doctype = (function (Item) {\n  \tfunction Doctype () {\n  \t\tItem.apply(this, arguments);\n  \t}\n\n  \tDoctype.prototype = Object.create( Item && Item.prototype );\n  \tDoctype.prototype.constructor = Doctype;\n\n  \tDoctype.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.render = function render () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.teardown = function teardown () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.toString = function toString () {\n  \t\treturn '<!DOCTYPE' + this.template.a + '>';\n  \t};\n\n  \tDoctype.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tDoctype.prototype.unrender = function unrender () {\n  \t\t// noop\n  \t};\n\n  \treturn Doctype;\n  }(Item));\n\n  function camelCase ( hyphenatedStr ) {\n  \treturn hyphenatedStr.replace( /-([a-zA-Z])/g, function ( match, $1 ) {\n  \t\treturn $1.toUpperCase();\n  \t});\n  }\n\n  var space = /\\s+/;\n  var specials$1 = { 'float': 'cssFloat' };\n  var remove = /\\/\\*(?:[\\s\\S]*?)\\*\\//g;\n  var escape = /url\\(\\s*(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\1\\s*\\)|url\\((?:\\\\[\\s\\S]|[^)])*\\)|(['\"])(?:\\\\[\\s\\S]|(?!\\1).)*\\2/gi;\n  var value = /\\0(\\d+)/g;\n\n  function readStyle ( css ) {\n      var values = [];\n\n      if ( typeof css !== 'string' ) return {};\n\n      return css.replace( escape, function ( match ) { return (\"\\u0000\" + (values.push( match ) - 1)); })\n          .replace( remove, '' )\n          .split( ';' )\n          .filter( function ( rule ) { return !!rule.trim(); } )\n          .map( function ( rule ) { return rule.replace( value, function ( match, n ) { return values[ n ]; } ); } )\n          .reduce(function ( rules, rule ) {\n              var i = rule.indexOf(':');\n              var name = camelCase( rule.substr( 0, i ).trim() );\n              rules[ specials$1[ name ] || name ] = rule.substr( i + 1 ).trim();\n              return rules;\n          }, {});\n  }\n\n  function readClass ( str ) {\n    var list = str.split( space );\n\n    // remove any empty entries\n    var i = list.length;\n    while ( i-- ) {\n      if ( !list[i] ) list.splice( i, 1 );\n    }\n\n    return list;\n  }\n\n  var textTypes = [ undefined, 'text', 'search', 'url', 'email', 'hidden', 'password', 'search', 'reset', 'submit' ];\n\n  function getUpdateDelegate ( attribute ) {\n  \tvar element = attribute.element, name = attribute.name;\n\n  \tif ( name === 'id' ) return updateId;\n\n  \tif ( name === 'value' ) {\n  \t\t// special case - selects\n  \t\tif ( element.name === 'select' && name === 'value' ) {\n  \t\t\treturn element.getAttribute( 'multiple' ) ? updateMultipleSelectValue : updateSelectValue;\n  \t\t}\n\n  \t\tif ( element.name === 'textarea' ) return updateStringValue;\n\n  \t\t// special case - contenteditable\n  \t\tif ( element.getAttribute( 'contenteditable' ) != null ) return updateContentEditableValue;\n\n  \t\t// special case - <input>\n  \t\tif ( element.name === 'input' ) {\n  \t\t\tvar type = element.getAttribute( 'type' );\n\n  \t\t\t// type='file' value='{{fileList}}'>\n  \t\t\tif ( type === 'file' ) return noop; // read-only\n\n  \t\t\t// type='radio' name='{{twoway}}'\n  \t\t\tif ( type === 'radio' && element.binding && element.binding.attribute.name === 'name' ) return updateRadioValue;\n\n  \t\t\tif ( ~textTypes.indexOf( type ) ) return updateStringValue;\n  \t\t}\n\n  \t\treturn updateValue;\n  \t}\n\n  \tvar node = element.node;\n\n  \t// special case - <input type='radio' name='{{twoway}}' value='foo'>\n  \tif ( attribute.isTwoway && name === 'name' ) {\n  \t\tif ( node.type === 'radio' ) return updateRadioName;\n  \t\tif ( node.type === 'checkbox' ) return updateCheckboxName;\n  \t}\n\n  \tif ( name === 'style' ) return updateStyleAttribute;\n\n  \tif ( name.indexOf( 'style-' ) === 0 ) return updateInlineStyle;\n\n  \t// special case - class names. IE fucks things up, again\n  \tif ( name === 'class' && ( !node.namespaceURI || node.namespaceURI === html ) ) return updateClassName;\n\n  \tif ( name.indexOf( 'class-' ) === 0 ) return updateInlineClass;\n\n  \tif ( attribute.isBoolean ) return updateBoolean;\n\n  \tif ( attribute.namespace && attribute.namespace !== attribute.node.namespaceURI ) return updateNamespacedAttribute;\n\n  \treturn updateAttribute;\n  }\n\n  function updateId () {\n  \tvar ref = this, node = ref.node;\n  \tvar value = this.getValue();\n\n  \tdelete this.ractive.nodes[ node.id ];\n  \tthis.ractive.nodes[ value ] = node;\n\n  \tnode.id = value;\n  }\n\n  function updateMultipleSelectValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !isArray( value ) ) value = [ value ];\n\n  \tvar options = this.node.options;\n  \tvar i = options.length;\n\n  \twhile ( i-- ) {\n  \t\tvar option = options[i];\n  \t\tvar optionValue = option._ractive ?\n  \t\t\toption._ractive.value :\n  \t\t\toption.value; // options inserted via a triple don't have _ractive\n\n  \t\toption.selected = arrayContains( value, optionValue );\n  \t}\n  }\n\n  function updateSelectValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) { // TODO is locked still a thing?\n  \t\tthis.node._ractive.value = value;\n\n  \t\tvar options = this.node.options;\n  \t\tvar i = options.length;\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n  \t\t\tvar optionValue = option._ractive ?\n  \t\t\t\toption._ractive.value :\n  \t\t\t\toption.value; // options inserted via a triple don't have _ractive\n\n  \t\t\tif ( optionValue == value ) { // double equals as we may be comparing numbers with strings\n  \t\t\t\toption.selected = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.node.selectedIndex = -1;\n  \t}\n  }\n\n\n  function updateContentEditableValue () {\n  \tvar value = this.getValue();\n\n  \tif ( !this.locked ) {\n  \t\tthis.node.innerHTML = value === undefined ? '' : value;\n  \t}\n  }\n\n  function updateRadioValue () {\n  \tvar node = this.node;\n  \tvar wasChecked = node.checked;\n\n  \tvar value = this.getValue();\n\n  \t//node.value = this.element.getAttribute( 'value' );\n  \tnode.value = this.node._ractive.value = value;\n  \tnode.checked = value === this.element.getAttribute( 'name' );\n\n  \t// This is a special case - if the input was checked, and the value\n  \t// changed so that it's no longer checked, the twoway binding is\n  \t// most likely out of date. To fix it we have to jump through some\n  \t// hoops... this is a little kludgy but it works\n  \tif ( wasChecked && !node.checked && this.element.binding && this.element.binding.rendered ) {\n  \t\tthis.element.binding.group.model.set( this.element.binding.group.getValue() );\n  \t}\n  }\n\n  function updateValue () {\n  \tif ( !this.locked ) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node.value = this.node._ractive.value = value;\n  \t\tthis.node.setAttribute( 'value', value );\n  \t}\n  }\n\n  function updateStringValue () {\n  \tif ( !this.locked ) {\n  \t\tvar value = this.getValue();\n\n  \t\tthis.node._ractive.value = value;\n\n  \t\tthis.node.value = safeToStringValue( value );\n  \t\tthis.node.setAttribute( 'value', safeToStringValue( value ) );\n  \t}\n  }\n\n  function updateRadioName () {\n  \tthis.node.checked = ( this.getValue() == this.node._ractive.value );\n  }\n\n  function updateCheckboxName () {\n  \tvar ref = this, element = ref.element, node = ref.node;\n  \tvar binding = element.binding;\n\n  \tvar value = this.getValue();\n  \tvar valueAttribute = element.getAttribute( 'value' );\n\n  \tif ( !isArray( value ) ) {\n  \t\tbinding.isChecked = node.checked = ( value == valueAttribute );\n  \t} else {\n  \t\tvar i = value.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( valueAttribute == value[i] ) {\n  \t\t\t\tbinding.isChecked = node.checked = true;\n  \t\t\t\treturn;\n  \t\t\t}\n  \t\t}\n  \t\tbinding.isChecked = node.checked = false;\n  \t}\n  }\n\n  function updateStyleAttribute () {\n  \tvar props = readStyle( this.getValue() || '' );\n  \tvar style = this.node.style;\n  \tvar keys = Object.keys( props );\n  \tvar prev = this.previous || [];\n\n  \tvar i = 0;\n  \twhile ( i < keys.length ) {\n  \t\tif ( keys[i] in style ) style[ keys[i] ] = props[ keys[i] ];\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing attrs\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~keys.indexOf( prev[i] ) && prev[i] in style ) style[ prev[i] ] = '';\n  \t}\n\n  \tthis.previous = keys;\n  }\n\n  var camelize = /(-.)/g;\n  function updateInlineStyle () {\n  \tif ( !this.styleName ) {\n  \t\tthis.styleName = this.name.substr( 6 ).replace( camelize, function ( s ) { return s.charAt( 1 ).toUpperCase(); } );\n  \t}\n\n  \tthis.node.style[ this.styleName ] = this.getValue();\n  }\n\n  function updateClassName () {\n  \tvar value = readClass( safeToStringValue( this.getValue() ) );\n  \tvar attr = readClass( this.node.className );\n  \tvar prev = this.previous || [];\n\n  \tvar i = 0;\n  \twhile ( i < value.length ) {\n  \t\tif ( !~attr.indexOf( value[i] ) ) attr.push( value[i] );\n  \t\ti++;\n  \t}\n\n  \t// remove now-missing classes\n  \ti = prev.length;\n  \twhile ( i-- ) {\n  \t\tif ( !~value.indexOf( prev[i] ) ) {\n  \t\t\tvar idx = attr.indexOf( prev[i] );\n  \t\t\tif ( ~idx ) attr.splice( idx, 1 );\n  \t\t}\n  \t}\n\n  \tthis.node.className = attr.join( ' ' );\n\n  \tthis.previous = value;\n  }\n\n  function updateInlineClass () {\n  \tvar name = this.name.substr( 6 );\n  \tvar attr = readClass( this.node.className );\n  \tvar value = this.getValue();\n\n  \tif ( value && !~attr.indexOf( name ) ) attr.push( name );\n  \telse if ( !value && ~attr.indexOf( name ) ) attr.splice( attr.indexOf( name ), 1 );\n\n  \tthis.node.className = attr.join( ' ' );\n  }\n\n  function updateBoolean () {\n  \t// with two-way binding, only update if the change wasn't initiated by the user\n  \t// otherwise the cursor will often be sent to the wrong place\n  \tif ( !this.locked ) {\n  \t\tif ( this.useProperty ) {\n  \t\t\tthis.node[ this.propertyName ] = this.getValue();\n  \t\t} else {\n  \t\t\tif ( this.getValue() ) {\n  \t\t\t\tthis.node.setAttribute( this.propertyName, '' );\n  \t\t\t} else {\n  \t\t\t\tthis.node.removeAttribute( this.propertyName );\n  \t\t\t}\n  \t\t}\n  \t}\n  }\n\n  function updateAttribute () {\n  \tthis.node.setAttribute( this.name, safeToStringValue( this.getString() ) );\n  }\n\n  function updateNamespacedAttribute () {\n  \tthis.node.setAttributeNS( this.namespace, this.name.slice( this.name.indexOf( ':' ) + 1 ), safeToStringValue( this.getString() ) );\n  }\n\n  var propertyNames = {\n  \t'accept-charset': 'acceptCharset',\n  \taccesskey: 'accessKey',\n  \tbgcolor: 'bgColor',\n  \t'class': 'className',\n  \tcodebase: 'codeBase',\n  \tcolspan: 'colSpan',\n  \tcontenteditable: 'contentEditable',\n  \tdatetime: 'dateTime',\n  \tdirname: 'dirName',\n  \t'for': 'htmlFor',\n  \t'http-equiv': 'httpEquiv',\n  \tismap: 'isMap',\n  \tmaxlength: 'maxLength',\n  \tnovalidate: 'noValidate',\n  \tpubdate: 'pubDate',\n  \treadonly: 'readOnly',\n  \trowspan: 'rowSpan',\n  \ttabindex: 'tabIndex',\n  \tusemap: 'useMap'\n  };\n\n  // https://github.com/kangax/html-minifier/issues/63#issuecomment-37763316\n  var booleanAttributes = /^(allowFullscreen|async|autofocus|autoplay|checked|compact|controls|declare|default|defaultChecked|defaultMuted|defaultSelected|defer|disabled|enabled|formNoValidate|hidden|indeterminate|inert|isMap|itemScope|loop|multiple|muted|noHref|noResize|noShade|noValidate|noWrap|open|pauseOnExit|readOnly|required|reversed|scoped|seamless|selected|sortable|translate|trueSpeed|typeMustMatch|visible)$/i;\n  var voidElementNames = /^(?:area|base|br|col|command|doctype|embed|hr|img|input|keygen|link|meta|param|source|track|wbr)$/i;\n\n  var htmlEntities = { quot: 34, amp: 38, apos: 39, lt: 60, gt: 62, nbsp: 160, iexcl: 161, cent: 162, pound: 163, curren: 164, yen: 165, brvbar: 166, sect: 167, uml: 168, copy: 169, ordf: 170, laquo: 171, not: 172, shy: 173, reg: 174, macr: 175, deg: 176, plusmn: 177, sup2: 178, sup3: 179, acute: 180, micro: 181, para: 182, middot: 183, cedil: 184, sup1: 185, ordm: 186, raquo: 187, frac14: 188, frac12: 189, frac34: 190, iquest: 191, Agrave: 192, Aacute: 193, Acirc: 194, Atilde: 195, Auml: 196, Aring: 197, AElig: 198, Ccedil: 199, Egrave: 200, Eacute: 201, Ecirc: 202, Euml: 203, Igrave: 204, Iacute: 205, Icirc: 206, Iuml: 207, ETH: 208, Ntilde: 209, Ograve: 210, Oacute: 211, Ocirc: 212, Otilde: 213, Ouml: 214, times: 215, Oslash: 216, Ugrave: 217, Uacute: 218, Ucirc: 219, Uuml: 220, Yacute: 221, THORN: 222, szlig: 223, agrave: 224, aacute: 225, acirc: 226, atilde: 227, auml: 228, aring: 229, aelig: 230, ccedil: 231, egrave: 232, eacute: 233, ecirc: 234, euml: 235, igrave: 236, iacute: 237, icirc: 238, iuml: 239, eth: 240, ntilde: 241, ograve: 242, oacute: 243, ocirc: 244, otilde: 245, ouml: 246, divide: 247, oslash: 248, ugrave: 249, uacute: 250, ucirc: 251, uuml: 252, yacute: 253, thorn: 254, yuml: 255, OElig: 338, oelig: 339, Scaron: 352, scaron: 353, Yuml: 376, fnof: 402, circ: 710, tilde: 732, Alpha: 913, Beta: 914, Gamma: 915, Delta: 916, Epsilon: 917, Zeta: 918, Eta: 919, Theta: 920, Iota: 921, Kappa: 922, Lambda: 923, Mu: 924, Nu: 925, Xi: 926, Omicron: 927, Pi: 928, Rho: 929, Sigma: 931, Tau: 932, Upsilon: 933, Phi: 934, Chi: 935, Psi: 936, Omega: 937, alpha: 945, beta: 946, gamma: 947, delta: 948, epsilon: 949, zeta: 950, eta: 951, theta: 952, iota: 953, kappa: 954, lambda: 955, mu: 956, nu: 957, xi: 958, omicron: 959, pi: 960, rho: 961, sigmaf: 962, sigma: 963, tau: 964, upsilon: 965, phi: 966, chi: 967, psi: 968, omega: 969, thetasym: 977, upsih: 978, piv: 982, ensp: 8194, emsp: 8195, thinsp: 8201, zwnj: 8204, zwj: 8205, lrm: 8206, rlm: 8207, ndash: 8211, mdash: 8212, lsquo: 8216, rsquo: 8217, sbquo: 8218, ldquo: 8220, rdquo: 8221, bdquo: 8222, dagger: 8224, Dagger: 8225, bull: 8226, hellip: 8230, permil: 8240, prime: 8242, Prime: 8243, lsaquo: 8249, rsaquo: 8250, oline: 8254, frasl: 8260, euro: 8364, image: 8465, weierp: 8472, real: 8476, trade: 8482, alefsym: 8501, larr: 8592, uarr: 8593, rarr: 8594, darr: 8595, harr: 8596, crarr: 8629, lArr: 8656, uArr: 8657, rArr: 8658, dArr: 8659, hArr: 8660, forall: 8704, part: 8706, exist: 8707, empty: 8709, nabla: 8711, isin: 8712, notin: 8713, ni: 8715, prod: 8719, sum: 8721, minus: 8722, lowast: 8727, radic: 8730, prop: 8733, infin: 8734, ang: 8736, and: 8743, or: 8744, cap: 8745, cup: 8746, 'int': 8747, there4: 8756, sim: 8764, cong: 8773, asymp: 8776, ne: 8800, equiv: 8801, le: 8804, ge: 8805, sub: 8834, sup: 8835, nsub: 8836, sube: 8838, supe: 8839, oplus: 8853, otimes: 8855, perp: 8869, sdot: 8901, lceil: 8968, rceil: 8969, lfloor: 8970, rfloor: 8971, lang: 9001, rang: 9002, loz: 9674, spades: 9824, clubs: 9827, hearts: 9829, diams: 9830\t};\n  var controlCharacters = [ 8364, 129, 8218, 402, 8222, 8230, 8224, 8225, 710, 8240, 352, 8249, 338, 141, 381, 143, 144, 8216, 8217, 8220, 8221, 8226, 8211, 8212, 732, 8482, 353, 8250, 339, 157, 382, 376 ];\n  var entityPattern = new RegExp( '&(#?(?:x[\\\\w\\\\d]+|\\\\d+|' + Object.keys( htmlEntities ).join( '|' ) + '));?', 'g' );\n  var codePointSupport = typeof String.fromCodePoint === 'function';\n  var codeToChar = codePointSupport ? String.fromCodePoint : String.fromCharCode;\n\n  function decodeCharacterReferences ( html ) {\n  \treturn html.replace( entityPattern, function ( match, entity ) {\n  \t\tvar code;\n\n  \t\t// Handle named entities\n  \t\tif ( entity[0] !== '#' ) {\n  \t\t\tcode = htmlEntities[ entity ];\n  \t\t} else if ( entity[1] === 'x' ) {\n  \t\t\tcode = parseInt( entity.substring( 2 ), 16 );\n  \t\t} else {\n  \t\t\tcode = parseInt( entity.substring( 1 ), 10 );\n  \t\t}\n\n  \t\tif ( !code ) {\n  \t\t\treturn match;\n  \t\t}\n\n  \t\treturn codeToChar( validateCode( code ) );\n  \t});\n  }\n\n  var lessThan = /</g;\n  var greaterThan = />/g;\n  var amp = /&/g;\n  var invalid = 65533;\n\n  function escapeHtml ( str ) {\n  \treturn str\n  \t\t.replace( amp, '&amp;' )\n  \t\t.replace( lessThan, '&lt;' )\n  \t\t.replace( greaterThan, '&gt;' );\n  }\n\n  // some code points are verboten. If we were inserting HTML, the browser would replace the illegal\n  // code points with alternatives in some cases - since we're bypassing that mechanism, we need\n  // to replace them ourselves\n  //\n  // Source: http://en.wikipedia.org/wiki/Character_encodings_in_HTML#Illegal_characters\n  function validateCode ( code ) {\n  \tif ( !code ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// line feed becomes generic whitespace\n  \tif ( code === 10 ) {\n  \t\treturn 32;\n  \t}\n\n  \t// ASCII range. (Why someone would use HTML entities for ASCII characters I don't know, but...)\n  \tif ( code < 128 ) {\n  \t\treturn code;\n  \t}\n\n  \t// code points 128-159 are dealt with leniently by browsers, but they're incorrect. We need\n  \t// to correct the mistake or we'll end up with missing € signs and so on\n  \tif ( code <= 159 ) {\n  \t\treturn controlCharacters[ code - 128 ];\n  \t}\n\n  \t// basic multilingual plane\n  \tif ( code < 55296 ) {\n  \t\treturn code;\n  \t}\n\n  \t// UTF-16 surrogate halves\n  \tif ( code <= 57343 ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// rest of the basic multilingual plane\n  \tif ( code <= 65535 ) {\n  \t\treturn code;\n  \t} else if ( !codePointSupport ) {\n  \t\treturn invalid;\n  \t}\n\n  \t// supplementary multilingual plane 0x10000 - 0x1ffff\n  \tif ( code >= 65536 && code <= 131071 ) {\n  \t\treturn code;\n  \t}\n\n  \t// supplementary ideographic plane 0x20000 - 0x2ffff\n  \tif ( code >= 131072 && code <= 196607 ) {\n  \t\treturn code;\n  \t}\n\n  \treturn invalid;\n  }\n\n  function lookupNamespace ( node, prefix ) {\n  \tvar qualified = \"xmlns:\" + prefix;\n\n  \twhile ( node ) {\n  \t\tif ( node.hasAttribute( qualified ) ) return node.getAttribute( qualified );\n  \t\tnode = node.parentNode;\n  \t}\n\n  \treturn namespaces[ prefix ];\n  }\n\n  var Attribute = (function (Item) {\n  \tfunction Attribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.name = options.name;\n  \t\tthis.namespace = null;\n  \t\tthis.element = options.element;\n  \t\tthis.parentFragment = options.element.parentFragment; // shared\n  \t\tthis.ractive = this.parentFragment.ractive;\n\n  \t\tthis.rendered = false;\n  \t\tthis.updateDelegate = null;\n  \t\tthis.fragment = null;\n  \t\tthis.value = null;\n\n  \t\tif ( !isArray( options.template ) ) {\n  \t\t\tthis.value = options.template;\n  \t\t\tif ( this.value === 0 ) {\n  \t\t\t\tthis.value = '';\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: options.template\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.interpolator = this.fragment &&\n  \t\t                    this.fragment.items.length === 1 &&\n  \t\t                    this.fragment.items[0].type === INTERPOLATOR &&\n  \t\t                    this.fragment.items[0];\n  \t}\n\n  \tAttribute.prototype = Object.create( Item && Item.prototype );\n  \tAttribute.prototype.constructor = Attribute;\n\n  \tAttribute.prototype.bind = function bind () {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.bind();\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.element.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tAttribute.prototype.getString = function getString () {\n  \t\treturn this.fragment ?\n  \t\t\tthis.fragment.toString() :\n  \t\t\tthis.value != null ? '' + this.value : '';\n  \t};\n\n  \t// TODO could getValue ever be called for a static attribute,\n  \t// or can we assume that this.fragment exists?\n  \tAttribute.prototype.getValue = function getValue () {\n  \t\treturn this.fragment ? this.fragment.valueOf() : booleanAttributes.test( this.name ) ? true : this.value;\n  \t};\n\n  \tAttribute.prototype.rebind = function rebind () {\n  \t\tif (this.fragment) this.fragment.rebind();\n  \t};\n\n  \tAttribute.prototype.render = function render () {\n  \t\tvar node = this.element.node;\n  \t\tthis.node = node;\n\n  \t\t// should we use direct property access, or setAttribute?\n  \t\tif ( !node.namespaceURI || node.namespaceURI === namespaces.html ) {\n  \t\t\tthis.propertyName = propertyNames[ this.name ] || this.name;\n\n  \t\t\tif ( node[ this.propertyName ] !== undefined ) {\n  \t\t\t\tthis.useProperty = true;\n  \t\t\t}\n\n  \t\t\t// is attribute a boolean attribute or 'value'? If so we're better off doing e.g.\n  \t\t\t// node.selected = true rather than node.setAttribute( 'selected', '' )\n  \t\t\tif ( booleanAttributes.test( this.name ) || this.isTwoway ) {\n  \t\t\t\tthis.isBoolean = true;\n  \t\t\t}\n\n  \t\t\tif ( this.propertyName === 'value' ) {\n  \t\t\t\tnode._ractive.value = this.value;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( node.namespaceURI ) {\n  \t\t\tvar index = this.name.indexOf( ':' );\n  \t\t\tif ( index !== -1 ) {\n  \t\t\t\tthis.namespace = lookupNamespace( node, this.name.slice( 0, index ) );\n  \t\t\t} else {\n  \t\t\t\tthis.namespace = node.namespaceURI;\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t\tthis.updateDelegate = getUpdateDelegate( this );\n  \t\tthis.updateDelegate();\n  \t};\n\n  \tAttribute.prototype.toString = function toString () {\n  \t\tvar value = this.getValue();\n\n  \t\t// Special case - select and textarea values (should not be stringified)\n  \t\tif ( this.name === 'value' && ( this.element.getAttribute( 'contenteditable' ) !== undefined || ( this.element.name === 'select' || this.element.name === 'textarea' ) ) ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Special case – bound radio `name` attributes\n  \t\tif ( this.name === 'name' && this.element.name === 'input' && this.interpolator && this.element.getAttribute( 'type' ) === 'radio' ) {\n  \t\t\treturn (\"name=\\\"{{\" + (this.interpolator.model.getKeypath()) + \"}}\\\"\");\n  \t\t}\n\n  \t\tif ( booleanAttributes.test( this.name ) ) return value ? this.name : '';\n  \t\tif ( value == null ) return '';\n\n  \t\tvar str = safeToStringValue( this.getString() )\n  \t\t\t.replace( /&/g, '&amp;' )\n  \t\t\t.replace( /\"/g, '&quot;' )\n  \t\t\t.replace( /'/g, '&#39;' );\n\n  \t\treturn str ?\n  \t\t\t(\"\" + (this.name) + \"=\\\"\" + str + \"\\\"\") :\n  \t\t\tthis.name;\n  \t};\n\n  \tAttribute.prototype.unbind = function unbind () {\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tAttribute.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t\tif ( this.rendered ) this.updateDelegate();\n  \t\t}\n  \t};\n\n  \treturn Attribute;\n  }(Item));\n\n  var div$1 = doc ? createElement( 'div' ) : null;\n\n  var ConditionalAttribute = (function (Item) {\n  \tfunction ConditionalAttribute ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.attributes = [];\n\n  \t\tthis.owner = options.owner;\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\tractive: this.ractive,\n  \t\t\towner: this,\n  \t\t\ttemplate: [ this.template ]\n  \t\t});\n\n  \t\tthis.dirty = false;\n  \t}\n\n  \tConditionalAttribute.prototype = Object.create( Item && Item.prototype );\n  \tConditionalAttribute.prototype.constructor = ConditionalAttribute;\n\n  \tConditionalAttribute.prototype.bind = function bind () {\n  \t\tthis.fragment.bind();\n  \t};\n\n  \tConditionalAttribute.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t};\n\n  \tConditionalAttribute.prototype.rebind = function rebind () {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tConditionalAttribute.prototype.render = function render () {\n  \t\tthis.node = this.owner.node;\n  \t\tthis.isSvg = this.node.namespaceURI === svg$1;\n\n  \t\tthis.rendered = true;\n  \t\tthis.dirty = true; // TODO this seems hacky, but necessary for tests to pass in browser AND node.js\n  \t\tthis.update();\n  \t};\n\n  \tConditionalAttribute.prototype.toString = function toString () {\n  \t\treturn this.fragment.toString();\n  \t};\n\n  \tConditionalAttribute.prototype.unbind = function unbind () {\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tConditionalAttribute.prototype.unrender = function unrender () {\n  \t\tthis.rendered = false;\n  \t};\n\n  \tConditionalAttribute.prototype.update = function update () {\n  \t\tvar this$1 = this;\n\n  \t\tvar str;\n  \t\tvar attrs;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.fragment.update();\n\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tstr = this.fragment.toString();\n  \t\t\t\tattrs = parseAttributes( str, this.isSvg );\n\n  \t\t\t\t// any attributes that previously existed but no longer do\n  \t\t\t\t// must be removed\n  \t\t\t\tthis.attributes.filter( function ( a ) { return notIn( attrs, a ); } ).forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.removeAttribute( a.name );\n  \t\t\t\t});\n\n  \t\t\t\tattrs.forEach( function ( a ) {\n  \t\t\t\t\tthis$1.node.setAttribute( a.name, a.value );\n  \t\t\t\t});\n\n  \t\t\t\tthis.attributes = attrs;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \treturn ConditionalAttribute;\n  }(Item));\n\n  function parseAttributes ( str, isSvg ) {\n  \tvar tagName = isSvg ? 'svg' : 'div';\n  \treturn str\n  \t\t? (div$1.innerHTML = \"<\" + tagName + \" \" + str + \"></\" + tagName + \">\") &&\n  \t\t\ttoArray(div$1.childNodes[0].attributes)\n  \t\t: [];\n  }\n\n  function notIn ( haystack, needle ) {\n  \tvar i = haystack.length;\n\n  \twhile ( i-- ) {\n  \t\tif ( haystack[i].name === needle.name ) {\n  \t\t\treturn false;\n  \t\t}\n  \t}\n\n  \treturn true;\n  }\n\n  var missingDecorator = {\n  \tupdate: noop,\n  \tteardown: noop\n  };\n\n  var Decorator = function Decorator ( owner, template ) {\n  \tthis.owner = owner;\n  \tthis.template = template;\n\n  \tthis.parentFragment = owner.parentFragment;\n  \tthis.ractive = owner.ractive;\n\n  \tthis.dynamicName = typeof template.n === 'object';\n  \tthis.dynamicArgs = !!template.d;\n\n  \tif ( this.dynamicName ) {\n  \t\tthis.nameFragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: template.n\n  \t\t});\n  \t} else {\n  \t\tthis.name = template.n || template;\n  \t}\n\n  \tif ( this.dynamicArgs ) {\n  \t\tthis.argsFragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: template.d\n  \t\t});\n  \t} else {\n  \t\tthis.args = template.a || [];\n  \t}\n\n  \tthis.node = null;\n  \tthis.intermediary = null;\n  };\n\n  Decorator.prototype.bind = function bind () {\n  \tif ( this.dynamicName ) {\n  \t\tthis.nameFragment.bind();\n  \t\tthis.name = this.nameFragment.toString();\n  \t}\n\n  \tif ( this.dynamicArgs ) this.argsFragment.bind();\n  };\n\n  Decorator.prototype.bubble = function bubble () {\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n  \t\tthis.owner.bubble();\n  \t}\n  };\n\n  Decorator.prototype.rebind = function rebind () {\n  \tif ( this.dynamicName ) this.nameFragment.rebind();\n  \tif ( this.dynamicArgs ) this.argsFragment.rebind();\n  };\n\n  Decorator.prototype.render = function render () {\n  \tvar fn = findInViewHierarchy( 'decorators', this.ractive, this.name );\n\n  \tif ( !fn ) {\n  \t\twarnOnce( missingPlugin( this.name, 'decorator' ) );\n  \t\tthis.intermediary = missingDecorator;\n  \t\treturn;\n  \t}\n\n  \tthis.node = this.owner.node;\n\n  \tvar args = this.dynamicArgs ? this.argsFragment.getArgsList() : this.args;\n  \tthis.intermediary = fn.apply( this.ractive, [ this.node ].concat( args ) );\n\n  \tif ( !this.intermediary || !this.intermediary.teardown ) {\n  \t\tthrow new Error( (\"The '\" + (this.name) + \"' decorator must return an object with a teardown method\") );\n  \t}\n  };\n\n  Decorator.prototype.unbind = function unbind () {\n  \tif ( this.dynamicName ) this.nameFragment.unbind();\n  \tif ( this.dynamicArgs ) this.argsFragment.unbind();\n  };\n\n  Decorator.prototype.unrender = function unrender () {\n  \tif ( this.intermediary ) this.intermediary.teardown();\n  };\n\n  Decorator.prototype.update = function update () {\n  \tif ( !this.dirty ) return;\n\n  \tthis.dirty = false;\n\n  \tvar nameChanged = false;\n\n  \tif ( this.dynamicName && this.nameFragment.dirty ) {\n  \t\tvar name = this.nameFragment.toString();\n  \t\tnameChanged = name !== this.name;\n  \t\tthis.name = name;\n  \t}\n\n  \tif ( this.intermediary ) {\n  \t\tif ( nameChanged || !this.intermediary.update ) {\n  \t\t\tthis.unrender();\n  \t\t\tthis.render();\n  \t\t}\n  \t\telse {\n  \t\t\tif ( this.dynamicArgs ) {\n  \t\t\t\tif ( this.argsFragment.dirty ) {\n  \t\t\t\t\tvar args = this.argsFragment.getArgsList();\n  \t\t\t\t\tthis.intermediary.update.apply( this.ractive, args );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t\telse {\n  \t\t\t\tthis.intermediary.update.apply( this.ractive, this.args );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \t// need to run these for unrender/render cases\n  \t// so can't just be in conditional if above\n\n  \tif ( this.dynamicName && this.nameFragment.dirty ) {\n  \t\tthis.nameFragment.update();\n  \t}\n\n  \tif ( this.dynamicArgs && this.argsFragment.dirty ) {\n  \t\tthis.argsFragment.update();\n  \t}\n  };\n\n  var DOMEvent = function DOMEvent ( name, owner ) {\n  \tif ( name.indexOf( '*' ) !== -1 ) {\n  \t\tfatal( (\"Only component proxy-events may contain \\\"*\\\" wildcards, <\" + (owner.name) + \" on-\" + name + \"=\\\"...\\\"/> is not valid\") );\n  \t}\n\n  \tthis.name = name;\n  \tthis.owner = owner;\n  \tthis.node = null;\n  \tthis.handler = null;\n  };\n\n  DOMEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.node = this.owner.node;\n  \tvar name = this.name;\n\n  \tif ( !( (\"on\" + name) in node ) ) {\n  \t\twarnOnce( missingPlugin( name, 'events' ) );\n  \t\t}\n\n  \t\tnode.addEventListener( name, this.handler = function( event ) {\n  \t\tdirective.fire({\n  \t\t\t\tnode: node,\n  \t\t\toriginal: event\n  \t\t\t});\n  \t\t}, false );\n  };\n\n  DOMEvent.prototype.unlisten = function unlisten () {\n  \tthis.node.removeEventListener( this.name, this.handler, false );\n  };\n\n  var CustomEvent = function CustomEvent ( eventPlugin, owner ) {\n  \tthis.eventPlugin = eventPlugin;\n  \tthis.owner = owner;\n  \tthis.handler = null;\n  };\n\n  CustomEvent.prototype.listen = function listen ( directive ) {\n  \tvar node = this.owner.node;\n\n  \tthis.handler = this.eventPlugin( node, function ( event ) {\n  \t\tif ( event === void 0 ) event = {};\n\n  \t\t\tevent.node = event.node || node;\n  \t\tdirective.fire( event );\n  \t});\n  };\n\n  CustomEvent.prototype.unlisten = function unlisten () {\n  \tthis.handler.teardown();\n  };\n\n  var prefix;\n\n  if ( !isClient ) {\n  \tprefix = null;\n  } else {\n  \tvar prefixCache = {};\n  \tvar testStyle = createElement( 'div' ).style;\n\n  \tprefix = function ( prop ) {\n  \t\tprop = camelCase( prop );\n\n  \t\tif ( !prefixCache[ prop ] ) {\n  \t\t\tif ( testStyle[ prop ] !== undefined ) {\n  \t\t\t\tprefixCache[ prop ] = prop;\n  \t\t\t}\n\n  \t\t\telse {\n  \t\t\t\t// test vendors...\n  \t\t\t\tvar capped = prop.charAt( 0 ).toUpperCase() + prop.substring( 1 );\n\n  \t\t\t\tvar i = vendors.length;\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tvar vendor = vendors[i];\n  \t\t\t\t\tif ( testStyle[ vendor + capped ] !== undefined ) {\n  \t\t\t\t\t\tprefixCache[ prop ] = vendor + capped;\n  \t\t\t\t\t\tbreak;\n  \t\t\t\t\t}\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\treturn prefixCache[ prop ];\n  \t};\n  }\n\n  var prefix$1 = prefix;\n\n  var visible;\n  var hidden = 'hidden';\n\n  if ( doc ) {\n  \tvar prefix$2;\n\n  \tif ( hidden in doc ) {\n  \t\tprefix$2 = '';\n  \t} else {\n  \t\tvar i$1 = vendors.length;\n  \t\twhile ( i$1-- ) {\n  \t\t\tvar vendor = vendors[i$1];\n  \t\t\thidden = vendor + 'Hidden';\n\n  \t\t\tif ( hidden in doc ) {\n  \t\t\t\tprefix$2 = vendor;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( prefix$2 !== undefined ) {\n  \t\tdoc.addEventListener( prefix$2 + 'visibilitychange', onChange );\n  \t\tonChange();\n  \t} else {\n  \t\t// gah, we're in an old browser\n  \t\tif ( 'onfocusout' in doc ) {\n  \t\t\tdoc.addEventListener( 'focusout', onHide );\n  \t\t\tdoc.addEventListener( 'focusin', onShow );\n  \t\t}\n\n  \t\telse {\n  \t\t\twin.addEventListener( 'pagehide', onHide );\n  \t\t\twin.addEventListener( 'blur', onHide );\n\n  \t\t\twin.addEventListener( 'pageshow', onShow );\n  \t\t\twin.addEventListener( 'focus', onShow );\n  \t\t}\n\n  \t\tvisible = true; // until proven otherwise. Not ideal but hey\n  \t}\n  }\n\n  function onChange () {\n  \tvisible = !doc[ hidden ];\n  }\n\n  function onHide () {\n  \tvisible = false;\n  }\n\n  function onShow () {\n  \tvisible = true;\n  }\n\n  var unprefixPattern = new RegExp( '^-(?:' + vendors.join( '|' ) + ')-' );\n\n  function unprefix ( prop ) {\n  \treturn prop.replace( unprefixPattern, '' );\n  }\n\n  var vendorPattern = new RegExp( '^(?:' + vendors.join( '|' ) + ')([A-Z])' );\n\n  function hyphenate ( str ) {\n  \tif ( !str ) return ''; // edge case\n\n  \tif ( vendorPattern.test( str ) ) str = '-' + str;\n\n  \treturn str.replace( /[A-Z]/g, function ( match ) { return '-' + match.toLowerCase(); } );\n  }\n\n  var createTransitions;\n\n  if ( !isClient ) {\n  \tcreateTransitions = null;\n  } else {\n  \tvar testStyle$1 = createElement( 'div' ).style;\n  \tvar linear$1 = function ( x ) { return x; };\n\n  \tvar canUseCssTransitions = {};\n  \tvar cannotUseCssTransitions = {};\n\n  \t// determine some facts about our environment\n  \tvar TRANSITION;\n  \tvar TRANSITIONEND;\n  \tvar CSS_TRANSITIONS_ENABLED;\n  \tvar TRANSITION_DURATION;\n  \tvar TRANSITION_PROPERTY;\n  \tvar TRANSITION_TIMING_FUNCTION;\n\n  \tif ( testStyle$1.transition !== undefined ) {\n  \t\tTRANSITION = 'transition';\n  \t\tTRANSITIONEND = 'transitionend';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else if ( testStyle$1.webkitTransition !== undefined ) {\n  \t\tTRANSITION = 'webkitTransition';\n  \t\tTRANSITIONEND = 'webkitTransitionEnd';\n  \t\tCSS_TRANSITIONS_ENABLED = true;\n  \t} else {\n  \t\tCSS_TRANSITIONS_ENABLED = false;\n  \t}\n\n  \tif ( TRANSITION ) {\n  \t\tTRANSITION_DURATION = TRANSITION + 'Duration';\n  \t\tTRANSITION_PROPERTY = TRANSITION + 'Property';\n  \t\tTRANSITION_TIMING_FUNCTION = TRANSITION + 'TimingFunction';\n  \t}\n\n  \tcreateTransitions = function ( t, to, options, changedProperties, resolve ) {\n\n  \t\t// Wait a beat (otherwise the target styles will be applied immediately)\n  \t\t// TODO use a fastdom-style mechanism?\n  \t\tsetTimeout( function () {\n  \t\t\tvar jsTransitionsComplete;\n  \t\t\tvar cssTransitionsComplete;\n\n  \t\t\tfunction checkComplete () {\n  \t\t\t\tif ( jsTransitionsComplete && cssTransitionsComplete ) {\n  \t\t\t\t\t// will changes to events and fire have an unexpected consequence here?\n  \t\t\t\t\tt.ractive.fire( t.name + ':end', t.node, t.isIntro );\n  \t\t\t\t\tresolve();\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\t// this is used to keep track of which elements can use CSS to animate\n  \t\t\t// which properties\n  \t\t\tvar hashPrefix = ( t.node.namespaceURI || '' ) + t.node.tagName;\n\n  \t\t\t// need to reset transition properties\n  \t\t\tvar style = t.node.style;\n  \t\t\tvar previous = {\n  \t\t\t\tproperty: style[ TRANSITION_PROPERTY ],\n  \t\t\t\ttiming: style[ TRANSITION_TIMING_FUNCTION ],\n  \t\t\t\tduration: style[ TRANSITION_DURATION ]\n  \t\t\t};\n\n  \t\t\tstyle[ TRANSITION_PROPERTY ] = changedProperties.map( prefix$1 ).map( hyphenate ).join( ',' );\n  \t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = hyphenate( options.easing || 'linear' );\n  \t\t\tstyle[ TRANSITION_DURATION ] = ( options.duration / 1000 ) + 's';\n\n  \t\t\tfunction transitionEndHandler ( event ) {\n  \t\t\t\tvar index = changedProperties.indexOf( camelCase( unprefix( event.propertyName ) ) );\n\n  \t\t\t\tif ( index !== -1 ) {\n  \t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t}\n\n  \t\t\t\tif ( changedProperties.length ) {\n  \t\t\t\t\t// still transitioning...\n  \t\t\t\t\treturn;\n  \t\t\t\t}\n\n  \t\t\t\tstyle[ TRANSITION_PROPERTY ] = previous.property;\n  \t\t\t\tstyle[ TRANSITION_TIMING_FUNCTION ] = previous.duration;\n  \t\t\t\tstyle[ TRANSITION_DURATION ] = previous.timing;\n\n  \t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\tcheckComplete();\n  \t\t\t}\n\n  \t\t\tt.node.addEventListener( TRANSITIONEND, transitionEndHandler, false );\n\n  \t\t\tsetTimeout( function () {\n  \t\t\t\tvar i = changedProperties.length;\n  \t\t\t\tvar hash;\n  \t\t\t\tvar originalValue;\n  \t\t\t\tvar index;\n  \t\t\t\tvar propertiesToTransitionInJs = [];\n  \t\t\t\tvar prop;\n  \t\t\t\tvar suffix;\n  \t\t\t\tvar interpolator;\n\n  \t\t\t\twhile ( i-- ) {\n  \t\t\t\t\tprop = changedProperties[i];\n  \t\t\t\t\thash = hashPrefix + prop;\n\n  \t\t\t\t\tif ( CSS_TRANSITIONS_ENABLED && !cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\tstyle[ prefix$1( prop ) ] = to[ prop ];\n\n  \t\t\t\t\t\t// If we're not sure if CSS transitions are supported for\n  \t\t\t\t\t\t// this tag/property combo, find out now\n  \t\t\t\t\t\tif ( !canUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n\n  \t\t\t\t\t\t\t// if this property is transitionable in this browser,\n  \t\t\t\t\t\t\t// the current style will be different from the target style\n  \t\t\t\t\t\t\tcanUseCssTransitions[ hash ] = ( t.getStyle( prop ) != to[ prop ] );\n  \t\t\t\t\t\t\tcannotUseCssTransitions[ hash ] = !canUseCssTransitions[ hash ];\n\n  \t\t\t\t\t\t\t// Reset, if we're going to use timers after all\n  \t\t\t\t\t\t\tif ( cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t\t\tstyle[ prefix$1( prop ) ] = originalValue;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t}\n  \t\t\t\t\t}\n\n  \t\t\t\t\tif ( !CSS_TRANSITIONS_ENABLED || cannotUseCssTransitions[ hash ] ) {\n  \t\t\t\t\t\t// we need to fall back to timer-based stuff\n  \t\t\t\t\t\tif ( originalValue === undefined ) {\n  \t\t\t\t\t\t\toriginalValue = t.getStyle( prop );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// need to remove this from changedProperties, otherwise transitionEndHandler\n  \t\t\t\t\t\t// will get confused\n  \t\t\t\t\t\tindex = changedProperties.indexOf( prop );\n  \t\t\t\t\t\tif ( index === -1 ) {\n  \t\t\t\t\t\t\twarnIfDebug( 'Something very strange happened with transitions. Please raise an issue at https://github.com/ractivejs/ractive/issues - thanks!', { node: t.node });\n  \t\t\t\t\t\t} else {\n  \t\t\t\t\t\t\tchangedProperties.splice( index, 1 );\n  \t\t\t\t\t\t}\n\n  \t\t\t\t\t\t// TODO Determine whether this property is animatable at all\n\n  \t\t\t\t\t\tsuffix = /[^\\d]*$/.exec( to[ prop ] )[0];\n  \t\t\t\t\t\tinterpolator = interpolate( parseFloat( originalValue ), parseFloat( to[ prop ] ) ) || ( function () { return to[ prop ]; } );\n\n  \t\t\t\t\t\t// ...then kick off a timer-based transition\n  \t\t\t\t\t\tpropertiesToTransitionInJs.push({\n  \t\t\t\t\t\t\tname: prefix$1( prop ),\n  \t\t\t\t\t\t\tinterpolator: interpolator,\n  \t\t\t\t\t\t\tsuffix: suffix\n  \t\t\t\t\t\t});\n  \t\t\t\t\t}\n  \t\t\t\t}\n\n  \t\t\t\t// javascript transitions\n  \t\t\t\tif ( propertiesToTransitionInJs.length ) {\n  \t\t\t\t\tvar easing;\n\n  \t\t\t\t\tif ( typeof options.easing === 'string' ) {\n  \t\t\t\t\t\teasing = t.ractive.easing[ options.easing ];\n\n  \t\t\t\t\t\tif ( !easing ) {\n  \t\t\t\t\t\t\twarnOnceIfDebug( missingPlugin( options.easing, 'easing' ) );\n  \t\t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t\t}\n  \t\t\t\t\t} else if ( typeof options.easing === 'function' ) {\n  \t\t\t\t\t\teasing = options.easing;\n  \t\t\t\t\t} else {\n  \t\t\t\t\t\teasing = linear$1;\n  \t\t\t\t\t}\n\n  \t\t\t\t\tnew Ticker({\n  \t\t\t\t\t\tduration: options.duration,\n  \t\t\t\t\t\teasing: easing,\n  \t\t\t\t\t\tstep: function ( pos ) {\n  \t\t\t\t\t\t\tvar i = propertiesToTransitionInJs.length;\n  \t\t\t\t\t\t\twhile ( i-- ) {\n  \t\t\t\t\t\t\t\tvar prop = propertiesToTransitionInJs[i];\n  \t\t\t\t\t\t\t\tt.node.style[ prop.name ] = prop.interpolator( pos ) + prop.suffix;\n  \t\t\t\t\t\t\t}\n  \t\t\t\t\t\t},\n  \t\t\t\t\t\tcomplete: function () {\n  \t\t\t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t\t\t\tcheckComplete();\n  \t\t\t\t\t\t}\n  \t\t\t\t\t});\n  \t\t\t\t} else {\n  \t\t\t\t\tjsTransitionsComplete = true;\n  \t\t\t\t}\n\n  \t\t\t\tif ( !changedProperties.length ) {\n  \t\t\t\t\t// We need to cancel the transitionEndHandler, and deal with\n  \t\t\t\t\t// the fact that it will never fire\n  \t\t\t\t\tt.node.removeEventListener( TRANSITIONEND, transitionEndHandler, false );\n  \t\t\t\t\tcssTransitionsComplete = true;\n  \t\t\t\t\tcheckComplete();\n  \t\t\t\t}\n  \t\t\t}, 0 );\n  \t\t}, options.delay || 0 );\n  \t};\n  }\n\n  var createTransitions$1 = createTransitions;\n\n  function resetStyle ( node, style ) {\n  \tif ( style ) {\n  \t\tnode.setAttribute( 'style', style );\n  \t} else {\n  \t\t// Next line is necessary, to remove empty style attribute!\n  \t\t// See http://stackoverflow.com/a/7167553\n  \t\tnode.getAttribute( 'style' );\n  \t\tnode.removeAttribute( 'style' );\n  \t}\n  }\n\n  var getComputedStyle = win && ( win.getComputedStyle || legacy.getComputedStyle );\n  var resolved = Promise$1.resolve();\n\n  var Transition = function Transition ( ractive, node, name, params, eventName ) {\n  \tthis.ractive = ractive;\n  \tthis.node = node;\n  \tthis.name = name;\n  \tthis.params = params;\n\n  \t// TODO this will need to change...\n  \tthis.eventName = eventName;\n  \tthis.isIntro = eventName !== 'outro';\n\n  \tif ( typeof name === 'function' ) {\n  \t\tthis._fn = name;\n  \t}\n  \telse {\n  \t\tthis._fn = findInViewHierarchy( 'transitions', ractive, name );\n\n  \t\tif ( !this._fn ) {\n  \t\t\twarnOnceIfDebug( missingPlugin( name, 'transition' ), { ractive: ractive });\n  \t\t}\n  \t}\n  };\n\n  Transition.prototype.animateStyle = function animateStyle ( style, value, options ) {\n  \tvar this$1 = this;\n\n  \t\tif ( arguments.length === 4 ) {\n  \t\tthrow new Error( 't.animateStyle() returns a promise - use .then() instead of passing a callback' );\n  \t}\n\n  \t// Special case - page isn't visible. Don't animate anything, because\n  \t// that way you'll never get CSS transitionend events\n  \tif ( !visible ) {\n  \t\tthis.setStyle( style, value );\n  \t\treturn resolved;\n  \t}\n\n  \tvar to;\n\n  \tif ( typeof style === 'string' ) {\n  \t\tto = {};\n  \t\tto[ style ] = value;\n  \t} else {\n  \t\tto = style;\n\n  \t\t// shuffle arguments\n  \t\toptions = value;\n  \t}\n\n  \t// As of 0.3.9, transition authors should supply an `option` object with\n  \t// `duration` and `easing` properties (and optional `delay`), plus a\n  \t// callback function that gets called after the animation completes\n\n  \t// TODO remove this check in a future version\n  \tif ( !options ) {\n  \t\twarnOnceIfDebug( 'The \"%s\" transition does not supply an options object to `t.animateStyle()`. This will break in a future version of Ractive. For more info see https://github.com/RactiveJS/Ractive/issues/340', this.name );\n  \t\toptions = this;\n  \t}\n\n  \treturn new Promise$1( function ( fulfil ) {\n  \t\t// Edge case - if duration is zero, set style synchronously and complete\n  \t\tif ( !options.duration ) {\n  \t\t\tthis$1.setStyle( to );\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// Get a list of the properties we're animating\n  \t\tvar propertyNames = Object.keys( to );\n  \t\tvar changedProperties = [];\n\n  \t\t// Store the current styles\n  \t\tvar computedStyle = getComputedStyle( this$1.node );\n\n  \t\tvar i = propertyNames.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar prop = propertyNames[i];\n  \t\t\tvar current = computedStyle[ prefix$1( prop ) ];\n\n  \t\t\tif ( current === '0px' ) current = 0;\n\n  \t\t\t// we need to know if we're actually changing anything\n  \t\t\tif ( current != to[ prop ] ) { // use != instead of !==, so we can compare strings with numbers\n  \t\t\t\tchangedProperties.push( prop );\n\n  \t\t\t\t// make the computed style explicit, so we can animate where\n  \t\t\t\t// e.g. height='auto'\n  \t\t\t\tthis$1.node.style[ prefix$1( prop ) ] = current;\n  \t\t\t}\n  \t\t}\n\n  \t\t// If we're not actually changing anything, the transitionend event\n  \t\t// will never fire! So we complete early\n  \t\tif ( !changedProperties.length ) {\n  \t\t\tfulfil();\n  \t\t\treturn;\n  \t\t}\n\n  \t\tcreateTransitions$1( this$1, to, options, changedProperties, fulfil );\n  \t});\n  };\n\n  Transition.prototype.getStyle = function getStyle ( props ) {\n  \tvar computedStyle = getComputedStyle( this.node );\n\n  \tif ( typeof props === 'string' ) {\n  \t\tvar value = computedStyle[ prefix$1( props ) ];\n  \t\treturn value === '0px' ? 0 : value;\n  \t}\n\n  \tif ( !isArray( props ) ) {\n  \t\tthrow new Error( 'Transition$getStyle must be passed a string, or an array of strings representing CSS properties' );\n  \t}\n\n  \tvar styles = {};\n\n  \tvar i = props.length;\n  \twhile ( i-- ) {\n  \t\tvar prop = props[i];\n  \t\tvar value$1 = computedStyle[ prefix$1( prop ) ];\n\n  \t\tif ( value$1 === '0px' ) value$1 = 0;\n  \t\tstyles[ prop ] = value$1;\n  \t}\n\n  \treturn styles;\n  };\n\n  Transition.prototype.processParams = function processParams ( params, defaults ) {\n  \tif ( typeof params === 'number' ) {\n  \t\tparams = { duration: params };\n  \t}\n\n  \telse if ( typeof params === 'string' ) {\n  \t\tif ( params === 'slow' ) {\n  \t\t\tparams = { duration: 600 };\n  \t\t} else if ( params === 'fast' ) {\n  \t\t\tparams = { duration: 200 };\n  \t\t} else {\n  \t\t\tparams = { duration: 400 };\n  \t\t}\n  \t} else if ( !params ) {\n  \t\tparams = {};\n  \t}\n\n  \treturn extendObj( {}, defaults, params );\n  };\n\n  Transition.prototype.setStyle = function setStyle ( style, value ) {\n  \tif ( typeof style === 'string' ) {\n  \t\tthis.node.style[ prefix$1( style ) ] = value;\n  \t}\n\n  \telse {\n  \t\tvar prop;\n  \t\tfor ( prop in style ) {\n  \t\t\tif ( style.hasOwnProperty( prop ) ) {\n  \t\t\t\tthis.node.style[ prefix$1( prop ) ] = style[ prop ];\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn this;\n  };\n\n  Transition.prototype.start = function start () {\n  \tvar this$1 = this;\n\n  \t\tvar node = this.node;\n  \tvar originalStyle = node.getAttribute( 'style' );\n\n  \tvar completed;\n\n  \t// create t.complete() - we don't want this on the prototype,\n  \t// because we don't want `this` silliness when passing it as\n  \t// an argument\n  \tthis.complete = function ( noReset ) {\n  \t\tif ( completed ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( !noReset && this$1.eventName === 'intro' ) {\n  \t\t\tresetStyle( node, originalStyle);\n  \t\t}\n\n  \t\tthis$1._manager.remove( this$1 );\n\n  \t\tcompleted = true;\n  \t};\n\n  \t// If the transition function doesn't exist, abort\n  \tif ( !this._fn ) {\n  \t\tthis.complete();\n  \t\treturn;\n  \t}\n\n  \tvar promise = this._fn.apply( this.ractive, [ this ].concat( this.params ) );\n  \tif ( promise ) promise.then( this.complete );\n  };\n\n  function updateLiveQueries$1 ( element ) {\n  \t// Does this need to be added to any live queries?\n  \tvar node = element.node;\n  \tvar instance = element.ractive;\n\n  \tdo {\n  \t\tvar liveQueries = instance._liveQueries;\n\n  \t\tvar i = liveQueries.length;\n  \t\twhile ( i-- ) {\n  \t\t\tvar selector = liveQueries[i];\n  \t\t\tvar query = liveQueries[ (\"_\" + selector) ];\n\n  \t\t\tif ( query.test( node ) ) {\n  \t\t\t\tquery.add( node );\n  \t\t\t\t// keep register of applicable selectors, for when we teardown\n  \t\t\t\telement.liveQueries.push( query );\n  \t\t\t}\n  \t\t}\n  \t} while ( instance = instance.parent );\n  }\n\n  // TODO element.parent currently undefined\n  function findParentForm ( element ) {\n  \twhile ( element = element.parent ) {\n  \t\tif ( element.name === 'form' ) {\n  \t\t\treturn element;\n  \t\t}\n  \t}\n  }\n\n  function warnAboutAmbiguity ( description, ractive ) {\n  \twarnOnceIfDebug( (\"The \" + description + \" being used for two-way binding is ambiguous, and may cause unexpected results. Consider initialising your data to eliminate the ambiguity\"), { ractive: ractive });\n  }\n\n  var Binding = function Binding ( element, name ) {\n  \tif ( name === void 0 ) name = 'value';\n\n  \t\tthis.element = element;\n  \tthis.ractive = element.ractive;\n  \tthis.attribute = element.attributeByName[ name ];\n\n  \tvar interpolator = this.attribute.interpolator;\n  \tinterpolator.twowayBinding = this;\n\n  \tvar model = interpolator.model;\n\n  \t// not bound?\n  \tif ( !model ) {\n  \t\t// try to force resolution\n  \t\tinterpolator.resolver.forceResolution();\n  \t\tmodel = interpolator.model;\n\n  \t\twarnAboutAmbiguity( (\"'\" + (interpolator.template.r) + \"' reference\"), this.ractive );\n  \t}\n\n  \telse if ( model.isUnresolved ) {\n  \t\t// reference expressions (e.g. foo[bar])\n  \t\tmodel.forceResolution();\n  \t\twarnAboutAmbiguity( 'expression', this.ractive );\n  \t}\n\n  \t// TODO include index/key/keypath refs as read-only\n  \telse if ( model.isReadonly ) {\n  \t\tvar keypath = model.getKeypath().replace( /^@/, '' );\n  \t\t\twarnOnceIfDebug( (\"Cannot use two-way binding on <\" + (element.name) + \"> element: \" + keypath + \" is read-only. To suppress this warning use <\" + (element.name) + \" twoway='false'...>\"), { ractive: this.ractive });\n  \t\treturn false;\n  \t}\n\n  \tthis.attribute.isTwoway = true;\n  \tthis.model = model;\n\n  \t// initialise value, if it's undefined\n  \tvar value = model.get();\n  \tthis.wasUndefined = value === undefined;\n\n  \tif ( value === undefined && this.getInitialValue ) {\n  \t\tvalue = this.getInitialValue();\n  \t\tmodel.set( value );\n  \t}\n\n  \tvar parentForm = findParentForm( element );\n  \tif ( parentForm ) {\n  \t\tthis.resetValue = value;\n  \t\tparentForm.formBindings.push( this );\n  \t}\n  };\n\n  Binding.prototype.bind = function bind () {\n  \tthis.model.registerTwowayBinding( this );\n  };\n\n  Binding.prototype.handleChange = function handleChange () {\n  \tvar this$1 = this;\n\n  \t\trunloop.start( this.root );\n  \tthis.attribute.locked = true;\n  \tthis.model.set( this.getValue() );\n  \trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \trunloop.end();\n  };\n\n  Binding.prototype.rebind = function rebind () {\n  \t// TODO what does this work with CheckboxNameBinding et al?\n  \tthis.unbind();\n  \tthis.model = this.attribute.interpolator.model;\n  \tthis.bind();\n  };\n\n  Binding.prototype.render = function render () {\n  \tthis.node = this.element.node;\n  \tthis.node._ractive.binding = this;\n  \tthis.rendered = true; // TODO is this used anywhere?\n  \t};\n\n  Binding.prototype.setFromNode = function setFromNode ( node ) {\n  \tthis.model.set( node.value );\n  \t};\n\n  \tBinding.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  };\n\n  Binding.prototype.unrender = function unrender () {\n  \t// noop?\n  };\n\n  // This is the handler for DOM events that would lead to a change in the model\n  // (i.e. change, sometimes, input, and occasionally click and keyup)\n  function handleDomEvent () {\n  \tthis._ractive.binding.handleChange();\n  }\n\n  var CheckboxBinding = (function (Binding) {\n  \tfunction CheckboxBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n  \t}\n\n  \tCheckboxBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxBinding.prototype.constructor = CheckboxBinding;\n\n  \tCheckboxBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \tCheckboxBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn !!this.element.getAttribute( 'checked' );\n  \t};\n\n  \tCheckboxBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tCheckboxBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \treturn CheckboxBinding;\n  }(Binding));\n\n  function getBindingGroup ( group, model, getValue ) {\n  \tvar hash = \"\" + group + \"-bindingGroup\";\n  \treturn model[hash] || ( model[ hash ] = new BindingGroup( hash, model, getValue ) );\n  }\n\n  var BindingGroup = function BindingGroup ( hash, model, getValue ) {\n  \tvar this$1 = this;\n\n  \t\tthis.model = model;\n  \tthis.hash = hash;\n  \tthis.getValue = function () {\n  \t\tthis$1.value = getValue.call(this$1);\n  \t\treturn this$1.value;\n  \t};\n\n  \tthis.bindings = [];\n  };\n\n  BindingGroup.prototype.add = function add ( binding ) {\n  \tthis.bindings.push( binding );\n  };\n\n  BindingGroup.prototype.bind = function bind () {\n  \tthis.value = this.model.get();\n  \tthis.model.registerTwowayBinding( this );\n  \tthis.bound = true;\n  };\n\n  BindingGroup.prototype.remove = function remove ( binding ) {\n  \tremoveFromArray( this.bindings, binding );\n  \tif ( !this.bindings.length ) {\n  \t\tthis.unbind();\n  \t}\n  };\n\n  BindingGroup.prototype.unbind = function unbind () {\n  \tthis.model.unregisterTwowayBinding( this );\n  \tthis.bound = false;\n  \tdelete this.model[this.hash];\n  };\n\n  var push$1 = [].push;\n\n  function getValue$1() {\n  \tvar all = this.bindings.filter(function ( b ) { return b.node && b.node.checked; }).map(function ( b ) { return b.element.getAttribute( 'value' ); });\n  \tvar res = [];\n  \tall.forEach(function ( v ) { if ( !arrayContains( res, v ) ) res.push( v ); });\n  \treturn res;\n  }\n\n  var CheckboxNameBinding = (function (Binding) {\n  \tfunction CheckboxNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.checkboxName = true; // so that ractive.updateModel() knows what to do with this\n\n  \t\t// Each input has a reference to an array containing it and its\n  \t\t// group, as two-way binding depends on being able to ascertain\n  \t\t// the status of all inputs within the group\n  \t\tthis.group = getBindingGroup( 'checkboxes', this.model, getValue$1 );\n  \t\tthis.group.add( this );\n\n  \t\tif ( this.noInitialValue ) {\n  \t\t\tthis.group.noInitialValue = true;\n  \t\t}\n\n  \t\t// If no initial value was set, and this input is checked, we\n  \t\t// update the model\n  \t\tif ( this.group.noInitialValue && this.element.getAttribute( 'checked' ) ) {\n  \t\t\tvar existingValue = this.model.get();\n  \t\t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\t\tif ( !arrayContains( existingValue, bindingValue ) ) {\n  \t\t\t\tpush$1.call( existingValue, bindingValue ); // to avoid triggering runloop with array adaptor\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tCheckboxNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tCheckboxNameBinding.prototype.constructor = CheckboxNameBinding;\n\n  \tCheckboxNameBinding.prototype.bind = function bind () {\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.changed = function changed () {\n  \t\tvar wasChecked = !!this.isChecked;\n  \t\tthis.isChecked = this.node.checked;\n  \t\treturn this.isChecked === wasChecked;\n  \t};\n\n  \tCheckboxNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\t// This only gets called once per group (of inputs that\n  \t\t// share a name), because it only gets called if there\n  \t\t// isn't an initial value. By the same token, we can make\n  \t\t// a note of that fact that there was no initial value,\n  \t\t// and populate it using any `checked` attributes that\n  \t\t// exist (which users should avoid, but which we should\n  \t\t// support anyway to avoid breaking expectations)\n  \t\tthis.noInitialValue = true; // TODO are noInitialValue and wasUndefined the same thing?\n  \t\treturn [];\n  \t};\n\n  \tCheckboxNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.group.value;\n  \t};\n\n  \tCheckboxNameBinding.prototype.handleChange = function handleChange () {\n  \t\tthis.isChecked = this.element.node.checked;\n  \t\tthis.group.value = this.model.get();\n  \t\tvar value = this.element.getAttribute( 'value' );\n  \t\tif ( this.isChecked && !arrayContains( this.group.value, value ) ) {\n  \t\t\tthis.group.value.push( value );\n  \t\t} else if ( !this.isChecked && arrayContains( this.group.value, value ) ) {\n  \t\t\tremoveFromArray( this.group.value, value );\n  \t\t}\n  \t\tBinding.prototype.handleChange.call(this);\n  \t};\n\n  \tCheckboxNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tvar existingValue = this.model.get();\n  \t\tvar bindingValue = this.element.getAttribute( 'value' );\n\n  \t\tif ( isArray( existingValue ) ) {\n  \t\t\tthis.isChecked = arrayContains( existingValue, bindingValue );\n  \t\t} else {\n  \t\t\tthis.isChecked = existingValue == bindingValue;\n  \t\t}\n\n  \t\tnode.name = '{{' + this.model.getKeypath() + '}}';\n  \t\tnode.checked = this.isChecked;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\t// in case of IE emergency, bind to click event as well\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.group.bindings.forEach( function ( binding ) { return binding.wasUndefined = true; } );\n\n  \t\tif ( node.checked ) {\n  \t\t\tvar valueSoFar = this.group.getValue();\n  \t\t\tvalueSoFar.push( this.element.getAttribute( 'value' ) );\n\n  \t\t\tthis.group.model.set( valueSoFar );\n  \t\t}\n  \t};\n\n  \tCheckboxNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n  \t};\n\n  \tCheckboxNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn CheckboxNameBinding;\n  }(Binding));\n\n  var ContentEditableBinding = (function (Binding) {\n  \tfunction ContentEditableBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tContentEditableBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tContentEditableBinding.prototype.constructor = ContentEditableBinding;\n\n  \tContentEditableBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.fragment ? this.element.fragment.toString() : '';\n  \t};\n\n  \tContentEditableBinding.prototype.getValue = function getValue () {\n  \t\treturn this.element.node.innerHTML;\n  \t};\n\n  \tContentEditableBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n  \t\tnode.addEventListener( 'blur', handleDomEvent, false );\n\n  \t\tif ( !this.ractive.lazy ) {\n  \t\t\tnode.addEventListener( 'input', handleDomEvent, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', handleDomEvent, false );\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tContentEditableBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.innerHTML );\n  \t};\n\n  \tContentEditableBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'blur', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'keyup', handleDomEvent, false );\n  \t};\n\n  \treturn ContentEditableBinding;\n  }(Binding));\n\n  function handleBlur () {\n  \thandleDomEvent.call( this );\n\n  \tvar value = this._ractive.binding.model.get();\n  \tthis.value = value == undefined ? '' : value;\n  }\n\n  function handleDelay ( delay ) {\n  \tvar timeout;\n\n  \treturn function () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( timeout ) clearTimeout( timeout );\n\n  \t\ttimeout = setTimeout( function () {\n  \t\t\tvar binding = this$1._ractive.binding;\n  \t\t\tif ( binding.rendered ) handleDomEvent.call( this$1 );\n  \t\t\ttimeout = null;\n  \t\t}, delay );\n  \t};\n  }\n\n  var GenericBinding = (function (Binding) {\n  \tfunction GenericBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tGenericBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tGenericBinding.prototype.constructor = GenericBinding;\n\n  \tGenericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn '';\n  \t};\n\n  \tGenericBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.value;\n  \t};\n\n  \tGenericBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\t// any lazy setting for this element overrides the root\n  \t\t// if the value is a number, it's a timeout\n  \t\tvar lazy = this.ractive.lazy;\n  \t\tvar timeout = false;\n\n  \t\t// TODO handle at parse time\n  \t\tif ( this.element.template.a && ( 'lazy' in this.element.template.a ) ) {\n  \t\t\tlazy = this.element.template.a.lazy;\n  \t\t\tif ( lazy === 0 ) lazy = true; // empty attribute\n  \t\t}\n\n  \t\t// TODO handle this at parse time as well?\n  \t\tif ( lazy === 'false' ) lazy = false;\n\n  \t\tif ( isNumeric( lazy ) ) {\n  \t\t\ttimeout = +lazy;\n  \t\t\tlazy = false;\n  \t\t}\n\n  \t\tthis.handler = timeout ? handleDelay( timeout ) : handleDomEvent;\n\n  \t\tvar node = this.node;\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( !lazy ) {\n  \t\t\tnode.addEventListener( 'input', this.handler, false );\n\n  \t\t\tif ( node.attachEvent ) {\n  \t\t\t\tnode.addEventListener( 'keyup', this.handler, false );\n  \t\t\t}\n  \t\t}\n\n  \t\tnode.addEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \tGenericBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.element.node;\n  \t\tthis.rendered = false;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'input', this.handler, false );\n  \t\tnode.removeEventListener( 'keyup', this.handler, false );\n  \t\tnode.removeEventListener( 'blur', handleBlur, false );\n  \t};\n\n  \treturn GenericBinding;\n  }(Binding));\n\n  function getSelectedOptions ( select ) {\n      return select.selectedOptions\n  \t\t? toArray( select.selectedOptions )\n  \t\t: select.options\n  \t\t\t? toArray( select.options ).filter( function ( option ) { return option.selected; } )\n  \t\t\t: [];\n  }\n\n  var MultipleSelectBinding = (function (Binding) {\n  \tfunction MultipleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tMultipleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tMultipleSelectBinding.prototype.constructor = MultipleSelectBinding;\n\n  \tMultipleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn this.element.options\n  \t\t\t.filter( function ( option ) { return option.getAttribute( 'selected' ); } )\n  \t\t\t.map( function ( option ) { return option.getAttribute( 'value' ); } );\n  \t};\n\n  \tMultipleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.element.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar selectedValues = [];\n\n  \t\tfor ( var i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.selected ) {\n  \t\t\t\tvar optionValue = option._ractive ? option._ractive.value : option.value;\n  \t\t\t\tselectedValues.push( optionValue );\n  \t\t\t}\n  \t\t}\n\n  \t\treturn selectedValues;\n  \t};\n\n  \tMultipleSelectBinding.prototype.handleChange = function handleChange () {\n  \t\tvar attribute = this.attribute;\n  \t\tvar previousValue = attribute.getValue();\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( previousValue === undefined || !arrayContentsMatch( value, previousValue ) ) {\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n\n  \t\treturn this;\n  \t};\n\n  \tMultipleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.model.get() === undefined ) {\n  \t\t\t// get value from DOM, if possible\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMultipleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar selectedOptions = getSelectedOptions( node );\n  \t\tvar i = selectedOptions.length;\n  \t\tvar result = new Array( i );\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = selectedOptions[i];\n  \t\t\tresult[i] = option._ractive ? option._ractive.value : option.value;\n  \t\t}\n\n  \t\tthis.model.set( result );\n  \t};\n\n  \tMultipleSelectBinding.prototype.setValue = function setValue () {\n  \t\tthrow new Error( 'TODO not implemented yet' );\n  \t};\n\n  \tMultipleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tMultipleSelectBinding.prototype.updateModel = function updateModel () {\n  \t\tif ( this.attribute.value === undefined || !this.attribute.value.length ) {\n  \t\t\tthis.keypath.set( this.initialValue );\n  \t\t}\n  \t};\n\n  \treturn MultipleSelectBinding;\n  }(Binding));\n\n  var NumericBinding = (function (GenericBinding) {\n  \tfunction NumericBinding () {\n  \t\tGenericBinding.apply(this, arguments);\n  \t}\n\n  \tNumericBinding.prototype = Object.create( GenericBinding && GenericBinding.prototype );\n  \tNumericBinding.prototype.constructor = NumericBinding;\n\n  \tNumericBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\treturn undefined;\n  \t};\n\n  \tNumericBinding.prototype.getValue = function getValue () {\n  \t\tvar value = parseFloat( this.node.value );\n  \t\treturn isNaN( value ) ? undefined : value;\n  \t};\n\n  \tNumericBinding.prototype.setFromNode = function setFromNode( node ) {\n  \t\tvar value = parseFloat( node.value );\n  \t\tif ( !isNaN( value ) ) this.model.set( value );\n  \t};\n\n  \treturn NumericBinding;\n  }(GenericBinding));\n\n  var siblings = {};\n\n  function getSiblings ( hash ) {\n  \treturn siblings[ hash ] || ( siblings[ hash ] = [] );\n  }\n\n  var RadioBinding = (function (Binding) {\n  \tfunction RadioBinding ( element ) {\n  \t\tBinding.call( this, element, 'checked' );\n\n  \t\tthis.siblings = getSiblings( this.ractive._guid + this.element.getAttribute( 'name' ) );\n  \t\tthis.siblings.push( this );\n  \t}\n\n  \tRadioBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioBinding.prototype.constructor = RadioBinding;\n\n  \tRadioBinding.prototype.getValue = function getValue () {\n  \t\treturn this.node.checked;\n  \t};\n\n  \tRadioBinding.prototype.handleChange = function handleChange () {\n  \t\trunloop.start( this.root );\n\n  \t\tthis.siblings.forEach( function ( binding ) {\n  \t\t\tbinding.model.set( binding.getValue() );\n  \t\t});\n\n  \t\trunloop.end();\n  \t};\n\n  \tRadioBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( this.node.attachEvent ) {\n  \t\t\tthis.node.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tthis.model.set( node.checked );\n  \t};\n\n  \tRadioBinding.prototype.unbind = function unbind () {\n  \t\tremoveFromArray( this.siblings, this );\n  \t};\n\n  \tRadioBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t\tthis.node.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioBinding;\n  }(Binding));\n\n  function getValue$2() {\n  \tvar checked = this.bindings.filter( function ( b ) { return b.node.checked; } );\n  \tif ( checked.length > 0 ) {\n  \t\treturn checked[0].element.getAttribute( 'value' );\n  \t}\n  }\n\n  var RadioNameBinding = (function (Binding) {\n  \tfunction RadioNameBinding ( element ) {\n  \t\tBinding.call( this, element, 'name' );\n\n  \t\tthis.group = getBindingGroup( 'radioname', this.model, getValue$2 );\n  \t\tthis.group.add( this );\n\n  \t\tif ( element.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t}\n  \t}\n\n  \tRadioNameBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tRadioNameBinding.prototype.constructor = RadioNameBinding;\n\n  \tRadioNameBinding.prototype.bind = function bind () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.group.bound ) {\n  \t\t\tthis.group.bind();\n  \t\t}\n\n  \t\t// update name keypath when necessary\n  \t\tthis.nameAttributeBinding = {\n  \t\t\thandleChange: function () { return this$1.node.name = \"{{\" + (this$1.model.getKeypath()) + \"}}\"; }\n  \t\t};\n\n  \t\tthis.model.getKeypathModel().register( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'checked' ) ) {\n  \t\t\treturn this.element.getAttribute( 'value' );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.getValue = function getValue$1 () {\n  \t\treturn this.element.getAttribute( 'value' );\n  \t};\n\n  \tRadioNameBinding.prototype.handleChange = function handleChange () {\n  \t\t// If this <input> is the one that's checked, then the value of its\n  \t\t// `name` model gets set to its value\n  \t\tif ( this.node.checked ) {\n  \t\t\tthis.group.value = this.getValue();\n  \t\t\tBinding.prototype.handleChange.call(this);\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n\n  \t\tvar node = this.node;\n\n  \t\tnode.name = \"{{\" + (this.model.getKeypath()) + \"}}\";\n  \t\tnode.checked = this.model.get() == this.element.getAttribute( 'value' );\n\n  \t\tnode.addEventListener( 'change', handleDomEvent, false );\n\n  \t\tif ( node.attachEvent ) {\n  \t\t\tnode.addEventListener( 'click', handleDomEvent, false );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tif ( node.checked ) {\n  \t\t\tthis.group.model.set( this.element.getAttribute( 'value' ) );\n  \t\t}\n  \t};\n\n  \tRadioNameBinding.prototype.unbind = function unbind () {\n  \t\tthis.group.remove( this );\n\n  \t\tthis.model.getKeypathModel().unregister( this.nameAttributeBinding );\n  \t};\n\n  \tRadioNameBinding.prototype.unrender = function unrender () {\n  \t\tvar node = this.node;\n\n  \t\tnode.removeEventListener( 'change', handleDomEvent, false );\n  \t\tnode.removeEventListener( 'click', handleDomEvent, false );\n  \t};\n\n  \treturn RadioNameBinding;\n  }(Binding));\n\n  var SingleSelectBinding = (function (Binding) {\n  \tfunction SingleSelectBinding () {\n  \t\tBinding.apply(this, arguments);\n  \t}\n\n  \tSingleSelectBinding.prototype = Object.create( Binding && Binding.prototype );\n  \tSingleSelectBinding.prototype.constructor = SingleSelectBinding;\n\n  \tSingleSelectBinding.prototype.forceUpdate = function forceUpdate () {\n  \t\tvar this$1 = this;\n\n  \t\tvar value = this.getValue();\n\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.attribute.locked = true;\n  \t\t\trunloop.scheduleTask( function () { return this$1.attribute.locked = false; } );\n  \t\t\tthis.model.set( value );\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.getInitialValue = function getInitialValue () {\n  \t\tif ( this.element.getAttribute( 'value' ) !== undefined ) {\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar options = this.element.options;\n  \t\tvar len = options.length;\n\n  \t\tif ( !len ) return;\n\n  \t\tvar value;\n  \t\tvar optionWasSelected;\n  \t\tvar i = len;\n\n  \t\t// take the final selected option...\n  \t\twhile ( i-- ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( option.getAttribute( 'selected' ) ) {\n  \t\t\t\tif ( !option.getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = option.getAttribute( 'value' );\n  \t\t\t\t}\n\n  \t\t\t\toptionWasSelected = true;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t}\n\n  \t\t// or the first non-disabled option, if none are selected\n  \t\tif ( !optionWasSelected ) {\n  \t\t\twhile ( ++i < len ) {\n  \t\t\t\tif ( !options[i].getAttribute( 'disabled' ) ) {\n  \t\t\t\t\tvalue = options[i].getAttribute( 'value' );\n  \t\t\t\t\tbreak;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// This is an optimisation (aka hack) that allows us to forgo some\n  \t\t// other more expensive work\n  \t\t// TODO does it still work? seems at odds with new architecture\n  \t\tif ( value !== undefined ) {\n  \t\t\tthis.element.attributeByName.value.value = value;\n  \t\t}\n\n  \t\treturn value;\n  \t};\n\n  \tSingleSelectBinding.prototype.getValue = function getValue () {\n  \t\tvar options = this.node.options;\n  \t\tvar len = options.length;\n\n  \t\tvar i;\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar option = options[i];\n\n  \t\t\tif ( options[i].selected && !options[i].disabled ) {\n  \t\t\t\treturn option._ractive ? option._ractive.value : option.value;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSingleSelectBinding.prototype.render = function render () {\n  \t\tBinding.prototype.render.call(this);\n  \t\tthis.node.addEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \tSingleSelectBinding.prototype.setFromNode = function setFromNode ( node ) {\n  \t\tvar option = getSelectedOptions( node )[0];\n  \t\tthis.model.set( option._ractive ? option._ractive.value : option.value );\n  \t};\n\n  \t// TODO this method is an anomaly... is it necessary?\n  \tSingleSelectBinding.prototype.setValue = function setValue ( value ) {\n  \t\tthis.model.set( value );\n  \t};\n\n  \tSingleSelectBinding.prototype.unrender = function unrender () {\n  \t\tthis.node.removeEventListener( 'change', handleDomEvent, false );\n  \t};\n\n  \treturn SingleSelectBinding;\n  }(Binding));\n\n  function isBindable ( attribute ) {\n  \treturn attribute &&\n  \t       attribute.template.length === 1 &&\n  \t       attribute.template[0].t === INTERPOLATOR &&\n  \t       !attribute.template[0].s;\n  }\n\n  function selectBinding ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \t// contenteditable - bind if the contenteditable attribute is true\n  \t// or is bindable and may thus become true...\n  \tif ( element.getAttribute( 'contenteditable' ) || isBindable( attributes.contenteditable ) ) {\n  \t\t// ...and this element also has a value attribute to bind\n  \t\treturn isBindable( attributes.value ) ? ContentEditableBinding : null;\n  \t}\n\n  \t// <input>\n  \tif ( element.name === 'input' ) {\n  \t\tvar type = element.getAttribute( 'type' );\n\n  \t\tif ( type === 'radio' || type === 'checkbox' ) {\n  \t\t\tvar bindName = isBindable( attributes.name );\n  \t\t\tvar bindChecked = isBindable( attributes.checked );\n\n  \t\t\t// for radios we can either bind the name attribute, or the checked attribute - not both\n  \t\t\tif ( bindName && bindChecked ) {\n  \t\t\t\tif ( type === 'radio' ) {\n  \t\t\t\t\twarnIfDebug( 'A radio input can have two-way binding on its name attribute, or its checked attribute - not both', { ractive: element.root });\n  \t\t\t\t} else {\n  \t\t\t\t\t// A checkbox with bindings for both name and checked - see https://github.com/ractivejs/ractive/issues/1749\n  \t\t\t\t\treturn CheckboxBinding;\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( bindName ) {\n  \t\t\t\treturn type === 'radio' ? RadioNameBinding : CheckboxNameBinding;\n  \t\t\t}\n\n  \t\t\tif ( bindChecked ) {\n  \t\t\t\treturn type === 'radio' ? RadioBinding : CheckboxBinding;\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( type === 'file' && isBindable( attributes.value ) ) {\n  \t\t\treturn Binding;\n  \t\t}\n\n  \t\tif ( isBindable( attributes.value ) ) {\n  \t\t\treturn ( type === 'number' || type === 'range' ) ? NumericBinding : GenericBinding;\n  \t\t}\n\n  \t\treturn null;\n  \t}\n\n  \t// <select>\n  \tif ( element.name === 'select' && isBindable( attributes.value ) ) {\n  \t\treturn element.getAttribute( 'multiple' ) ? MultipleSelectBinding : SingleSelectBinding;\n  \t}\n\n  \t// <textarea>\n  \tif ( element.name === 'textarea' && isBindable( attributes.value ) ) {\n  \t\treturn GenericBinding;\n  \t}\n  }\n\n  function makeDirty$1 ( query ) {\n  \tquery.makeDirty();\n  }\n\n  var Element = (function (Item) {\n  \tfunction Element ( options ) {\n  \t\tvar this$1 = this;\n\n  \t\tItem.call( this, options );\n\n  \t\tthis.liveQueries = []; // TODO rare case. can we handle differently?\n\n  \t\tthis.name = options.template.e.toLowerCase();\n  \t\tthis.isVoid = voidElementNames.test( this.name );\n\n  \t\t// find parent element\n  \t\tvar fragment = this.parentFragment;\n  \t\twhile ( fragment ) {\n  \t\t\tif ( fragment.owner.type === ELEMENT ) {\n  \t\t\t\tthis$1.parent = fragment.owner;\n  \t\t\t\tbreak;\n  \t\t\t}\n  \t\t\tfragment = fragment.parent;\n  \t\t}\n\n  \t\tif ( this.parent && this.parent.name === 'option' ) {\n  \t\t\tthrow new Error( (\"An <option> element cannot contain other elements (encountered <\" + (this.name) + \">)\") );\n  \t\t}\n\n  \t\t// create attributes\n  \t\tthis.attributeByName = {};\n  \t\tthis.attributes = [];\n\n  \t\tif ( this.template.a ) {\n  \t\t\tObject.keys( this.template.a ).forEach( function ( name ) {\n  \t\t\t\t// TODO process this at parse time\n  \t\t\t\tif ( name === 'twoway' || name === 'lazy' ) return;\n\n  \t\t\t\tvar attribute = new Attribute({\n  \t\t\t\t\tname: name,\n  \t\t\t\t\telement: this$1,\n  \t\t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\t\ttemplate: this$1.template.a[ name ]\n  \t\t\t\t});\n\n  \t\t\t\tthis$1.attributeByName[ name ] = attribute;\n\n  \t\t\t\tif ( name !== 'value' && name !== 'type' ) this$1.attributes.push( attribute );\n  \t\t\t});\n\n  \t\t\tif ( this.attributeByName.type ) this.attributes.unshift( this.attributeByName.type );\n  \t\t\tif ( this.attributeByName.value ) this.attributes.push( this.attributeByName.value );\n  \t\t}\n\n  \t\t// create conditional attributes\n  \t\tthis.conditionalAttributes = ( this.template.m || [] ).map( function ( template ) {\n  \t\t\treturn new ConditionalAttribute({\n  \t\t\t\towner: this$1,\n  \t\t\t\tparentFragment: this$1.parentFragment,\n  \t\t\t\ttemplate: template\n  \t\t\t});\n  \t\t});\n\n  \t\t// create decorator\n  \t\tif ( this.template.o ) {\n  \t\t\tthis.decorator = new Decorator( this, this.template.o );\n  \t\t}\n\n  \t\t// attach event handlers\n  \t\tthis.eventHandlers = [];\n  \t\tif ( this.template.v ) {\n  \t\t\tObject.keys( this.template.v ).forEach( function ( key ) {\n  \t\t\t\tvar eventNames = key.split( '-' );\n  \t\t\t\tvar template = this$1.template.v[ key ];\n\n  \t\t\t\teventNames.forEach( function ( eventName ) {\n  \t\t\t\t\tvar fn = findInViewHierarchy( 'events', this$1.ractive, eventName );\n  \t\t\t\t\t// we need to pass in \"this\" in order to get\n  \t\t\t\t\t// access to node when it is created.\n  \t\t\t\t\tvar event = fn ? new CustomEvent( fn, this$1 ) : new DOMEvent( eventName, this$1 );\n  \t\t\t\t\tthis$1.eventHandlers.push( new EventDirective( this$1, event, template ) );\n  \t\t\t\t});\n  \t\t\t});\n  \t\t}\n\n  \t\t// create children\n  \t\tif ( options.template.f && !options.noContent ) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\ttemplate: options.template.f,\n  \t\t\t\towner: this,\n  \t\t\t\tcssIds: null\n  \t\t\t});\n  \t\t}\n\n  \t\tthis.binding = null; // filled in later\n  \t}\n\n  \tElement.prototype = Object.create( Item && Item.prototype );\n  \tElement.prototype.constructor = Element;\n\n  \tElement.prototype.bind = function bind$1 () {\n  \t\tthis.attributes.forEach( bind );\n  \t\tthis.conditionalAttributes.forEach( bind );\n  \t\tthis.eventHandlers.forEach( bind );\n\n  \t\tif ( this.decorator ) this.decorator.bind();\n  \t\tif ( this.fragment ) this.fragment.bind();\n\n  \t\t// create two-way binding if necessary\n  \t\tif ( this.binding = this.createTwowayBinding() ) this.binding.bind();\n  \t};\n\n  \tElement.prototype.createTwowayBinding = function createTwowayBinding () {\n  \t\tvar attributes = this.template.a;\n\n  \t\tif ( !attributes ) return null;\n\n  \t\tvar shouldBind = 'twoway' in attributes ?\n  \t\t\tattributes.twoway === 0 || attributes.twoway === 'true' : // covers `twoway` and `twoway='true'`\n  \t\t\tthis.ractive.twoway;\n\n  \t\tif ( !shouldBind ) return null;\n\n  \t\tvar Binding = selectBinding( this );\n\n  \t\tif ( !Binding ) return null;\n\n  \t\tvar binding = new Binding( this );\n\n  \t\treturn binding && binding.model ?\n  \t\t\tbinding :\n  \t\t\tnull;\n  \t};\n\n  \tElement.prototype.detach = function detach () {\n  \t\tif ( this.decorator ) this.decorator.unrender();\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tElement.prototype.find = function find ( selector ) {\n  \t\tif ( matches( this.node, selector ) ) return this.node;\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAll = function findAll ( selector, query ) {\n  \t\t// Add this node to the query, if applicable, and register the\n  \t\t// query on this element\n  \t\tvar matches = query.test( this.node );\n  \t\tif ( matches ) {\n  \t\t\tquery.add( this.node );\n  \t\t\tif ( query.live ) this.liveQueries.push( query );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tElement.prototype.findNextNode = function findNextNode () {\n  \t\treturn null;\n  \t};\n\n  \tElement.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tElement.prototype.getAttribute = function getAttribute ( name ) {\n  \t\tvar attribute = this.attributeByName[ name ];\n  \t\treturn attribute ? attribute.getValue() : undefined;\n  \t};\n\n  \tElement.prototype.rebind = function rebind$1 () {\n  \t\tthis.attributes.forEach( rebind );\n  \t\tthis.conditionalAttributes.forEach( rebind );\n  \t\tthis.eventHandlers.forEach( rebind );\n  \t\tif ( this.decorator ) this.decorator.rebind();\n  \t\tif ( this.fragment ) this.fragment.rebind();\n  \t\tif ( this.binding ) this.binding.rebind();\n\n  \t\tthis.liveQueries.forEach( makeDirty$1 );\n  \t};\n\n  \tElement.prototype.render = function render$1 ( target, occupants ) {\n  \t\t// TODO determine correct namespace\n  \t\tvar this$1 = this;\n\n  \t\tthis.namespace = getNamespace( this );\n\n  \t\tvar node;\n  \t\tvar existing = false;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n;\n  \t\t\twhile ( ( n = occupants.shift() ) ) {\n  \t\t\t\tif ( n.nodeName === this$1.template.e.toUpperCase() && n.namespaceURI === this$1.namespace ) {\n  \t\t\t\t\tthis$1.node = node = n;\n  \t\t\t\t\texisting = true;\n  \t\t\t\t\tbreak;\n  \t\t\t\t} else {\n  \t\t\t\t\tdetachNode( n );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( !node ) {\n  \t\t\tnode = createElement( this.template.e, this.namespace, this.getAttribute( 'is' ) );\n  \t\t\tthis.node = node;\n  \t\t}\n\n  \t\tdefineProperty( node, '_ractive', {\n  \t\t\tvalue: {\n  \t\t\t\tproxy: this,\n  \t\t\t\tfragment: this.parentFragment\n  \t\t\t}\n  \t\t});\n\n  \t\t// Is this a top-level node of a component? If so, we may need to add\n  \t\t// a data-ractive-css attribute, for CSS encapsulation\n  \t\tif ( this.parentFragment.cssIds ) {\n  \t\t\tnode.setAttribute( 'data-ractive-css', this.parentFragment.cssIds.map( function ( x ) { return (\"{\" + x + \"}\"); } ).join( ' ' ) );\n  \t\t}\n\n  \t\tif ( existing && this.foundNode ) this.foundNode( node );\n\n  \t\tif ( this.fragment ) {\n  \t\t\tvar children = existing ? toArray( node.childNodes ) : undefined;\n  \t\t\tthis.fragment.render( node, children );\n\n  \t\t\t// clean up leftover children\n  \t\t\tif ( children ) {\n  \t\t\t\tchildren.forEach( detachNode );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( existing ) {\n  \t\t\t// store initial values for two-way binding\n  \t\t\tif ( this.binding && this.binding.wasUndefined ) this.binding.setFromNode( node );\n\n  \t\t\t// remove unused attributes\n  \t\t\tvar i = node.attributes.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tvar name = node.attributes[i].name;\n  \t\t\t\tif ( !this$1.template.a || !( name in this$1.template.a ) ) node.removeAttribute( name );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.attributes.forEach( render );\n  \t\tthis.conditionalAttributes.forEach( render );\n\n  \t\tif ( this.decorator ) runloop.scheduleTask( function () { return this$1.decorator.render(); }, true );\n  \t\tif ( this.binding ) this.binding.render();\n\n  \t\tthis.eventHandlers.forEach( render );\n\n  \t\tupdateLiveQueries$1( this );\n\n  \t\t// store so we can abort if it gets removed\n  \t\tthis._introTransition = getTransition( this, this.template.t0 || this.template.t1, 'intro' );\n\n  \t\tif ( !existing ) {\n  \t\t\ttarget.appendChild( node );\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tElement.prototype.toString = function toString () {\n  \t\tvar tagName = this.template.e;\n\n  \t\tvar attrs = this.attributes.map( stringifyAttribute ).join( '' ) +\n  \t\t            this.conditionalAttributes.map( stringifyAttribute ).join( '' );\n\n  \t\t// Special case - selected options\n  \t\tif ( this.name === 'option' && this.isSelected() ) {\n  \t\t\tattrs += ' selected';\n  \t\t}\n\n  \t\t// Special case - two-way radio name bindings\n  \t\tif ( this.name === 'input' && inputIsCheckedRadio( this ) ) {\n  \t\t\tattrs += ' checked';\n  \t\t}\n\n  \t\tvar str = \"<\" + tagName + \"\" + attrs + \">\";\n\n  \t\tif ( this.isVoid ) return str;\n\n  \t\t// Special case - textarea\n  \t\tif ( this.name === 'textarea' && this.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tstr += escapeHtml( this.getAttribute( 'value' ) );\n  \t\t}\n\n  \t\t// Special case - contenteditable\n  \t\telse if ( this.getAttribute( 'contenteditable' ) !== undefined ) {\n  \t\t\tstr += ( this.getAttribute( 'value' ) || '' );\n  \t\t}\n\n  \t\tif ( this.fragment ) {\n  \t\t\tstr += this.fragment.toString( !/^(?:script|style)$/i.test( this.template.e ) ); // escape text unless script/style\n  \t\t}\n\n  \t\tstr += \"</\" + tagName + \">\";\n  \t\treturn str;\n  \t};\n\n  \tElement.prototype.unbind = function unbind$1 () {\n  \t\tthis.attributes.forEach( unbind );\n  \t\tthis.conditionalAttributes.forEach( unbind );\n\n  \t\tif ( this.decorator ) this.decorator.unbind();\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tElement.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \t\tif ( !this.rendered ) return;\n  \t\tthis.rendered = false;\n\n  \t\t// unrendering before intro completed? complete it now\n  \t\t// TODO should be an API for aborting transitions\n  \t\tvar transition = this._introTransition;\n  \t\tif ( transition ) transition.complete();\n\n  \t\t// Detach as soon as we can\n  \t\tif ( this.name === 'option' ) {\n  \t\t\t// <option> elements detach immediately, so that\n  \t\t\t// their parent <select> element syncs correctly, and\n  \t\t\t// since option elements can't have transitions anyway\n  \t\t\tthis.detach();\n  \t\t} else if ( shouldDestroy ) {\n  \t\t\trunloop.detachWhenReady( this );\n  \t\t}\n\n  \t\tif ( this.fragment ) this.fragment.unrender();\n\n  \t\tthis.eventHandlers.forEach( unrender );\n\n  \t\tif ( this.binding ) this.binding.unrender();\n  \t\tif ( !shouldDestroy && this.decorator ) this.decorator.unrender();\n\n  \t\t// outro transition\n  \t\tgetTransition( this, this.template.t0 || this.template.t2, 'outro' );\n\n  \t\t// special case\n  \t\tvar id = this.attributeByName.id;\n  \t\tif ( id  ) {\n  \t\t\tdelete this.ractive.nodes[ id.getValue() ];\n  \t\t}\n\n  \t\tremoveFromLiveQueries( this );\n  \t\t// TODO forms are a special case\n  \t};\n\n  \tElement.prototype.update = function update$1 () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.attributes.forEach( update );\n  \t\t\tthis.conditionalAttributes.forEach( update );\n  \t\t\tthis.eventHandlers.forEach( update );\n\n  \t\t\tif ( this.decorator ) this.decorator.update();\n  \t\t\tif ( this.fragment ) this.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Element;\n  }(Item));\n\n  function getTransition( owner, template, eventName ) {\n  \tif ( !template || !owner.ractive.transitionsEnabled ) return;\n\n  \tvar name = getTransitionName( owner, template );\n  \tif ( !name ) return;\n\n  \tvar params = getTransitionParams( owner, template );\n  \tvar transition = new Transition( owner.ractive, owner.node, name, params, eventName );\n  \trunloop.registerTransition( transition );\n  \treturn transition;\n  }\n\n  function getTransitionName ( owner, template ) {\n  \tvar name = template.n || template;\n\n  \tif ( typeof name === 'string' ) return name;\n\n  \tvar fragment = new Fragment({\n  \t\towner: owner,\n  \t\ttemplate: name\n  \t}).bind(); // TODO need a way to capture values without bind()\n\n  \tname = fragment.toString();\n  \tfragment.unbind();\n\n  \treturn name;\n  }\n\n  function getTransitionParams ( owner, template ) {\n  \tif ( template.a ) return template.a;\n  \tif ( !template.d )  return;\n\n  \t// TODO is there a way to interpret dynamic arguments without all the\n  \t// 'dependency thrashing'?\n  \tvar fragment = new Fragment({\n  \t\towner: owner,\n  \t\ttemplate: template.d\n  \t}).bind();\n\n  \tvar params = fragment.getArgsList();\n  \tfragment.unbind();\n\n  \treturn params;\n  }\n\n  function inputIsCheckedRadio ( element ) {\n  \tvar attributes = element.attributeByName;\n\n  \tvar typeAttribute  = attributes.type;\n  \tvar valueAttribute = attributes.value;\n  \tvar nameAttribute  = attributes.name;\n\n  \tif ( !typeAttribute || ( typeAttribute.value !== 'radio' ) || !valueAttribute || !nameAttribute.interpolator ) {\n  \t\treturn;\n  \t}\n\n  \tif ( valueAttribute.getValue() === nameAttribute.interpolator.model.get() ) {\n  \t\treturn true;\n  \t}\n  }\n\n  function stringifyAttribute ( attribute ) {\n  \tvar str = attribute.toString();\n  \treturn str ? ' ' + str : '';\n  }\n\n  function removeFromLiveQueries ( element ) {\n  \tvar i = element.liveQueries.length;\n  \twhile ( i-- ) {\n  \t\tvar query = element.liveQueries[i];\n  \t\tquery.remove( element.node );\n  \t}\n  }\n\n  function getNamespace ( element ) {\n  \t// Use specified namespace...\n  \tvar xmlns = element.getAttribute( 'xmlns' );\n  \tif ( xmlns ) return xmlns;\n\n  \t// ...or SVG namespace, if this is an <svg> element\n  \tif ( element.name === 'svg' ) return svg$1;\n\n  \tvar parent = element.parent;\n\n  \tif ( parent ) {\n  \t\t// ...or HTML, if the parent is a <foreignObject>\n  \t\tif ( parent.name === 'foreignobject' ) return html;\n\n  \t\t// ...or inherit from the parent node\n  \t\treturn parent.node.namespaceURI;\n  \t}\n\n  \treturn element.ractive.el.namespaceURI;\n  }\n\n  var Form = (function (Element) {\n  \tfunction Form ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.formBindings = [];\n  \t}\n\n  \tForm.prototype = Object.create( Element && Element.prototype );\n  \tForm.prototype.constructor = Form;\n\n  \tForm.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.addEventListener( 'reset', handleReset, false );\n  \t};\n\n  \tForm.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.node.removeEventListener( 'reset', handleReset, false );\n  \t\tElement.prototype.unrender.call( this, shouldDestroy );\n  \t};\n\n  \treturn Form;\n  }(Element));\n\n  function handleReset () {\n  \tvar element = this._ractive.proxy;\n\n  \trunloop.start();\n  \telement.formBindings.forEach( updateModel );\n  \trunloop.end();\n  }\n\n  function updateModel ( binding ) {\n  \tbinding.model.set( binding.resetValue );\n  }\n\n  var Mustache = (function (Item) {\n  \tfunction Mustache ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.parentFragment = options.parentFragment;\n  \t\tthis.template = options.template;\n  \t\tthis.index = options.index;\n\n  \t\tthis.isStatic = !!options.template.s;\n\n  \t\tthis.model = null;\n  \t\tthis.dirty = false;\n  \t}\n\n  \tMustache.prototype = Object.create( Item && Item.prototype );\n  \tMustache.prototype.constructor = Mustache;\n\n  \tMustache.prototype.bind = function bind () {\n  \t\t// try to find a model for this view\n  \t\tvar this$1 = this;\n\n  \t\tvar model = resolve$1( this.parentFragment, this.template );\n  \t\tvar value = model ? model.get() : undefined;\n\n  \t\tif ( this.isStatic ) {\n  \t\t\tthis.model = { get: function () { return value; } };\n  \t\t\treturn;\n  \t\t}\n\n  \t\tif ( model ) {\n  \t\t\tmodel.register( this );\n  \t\t\tthis.model = model;\n  \t\t} else {\n  \t\t\tthis.resolver = this.parentFragment.resolve( this.template.r, function ( model ) {\n  \t\t\t\tthis$1.model = model;\n  \t\t\t\tmodel.register( this$1 );\n\n  \t\t\t\tthis$1.handleChange();\n  \t\t\t\tthis$1.resolver = null;\n  \t\t\t});\n  \t\t}\n  \t};\n\n  \tMustache.prototype.handleChange = function handleChange () {\n  \t\tthis.bubble();\n  \t};\n\n  \tMustache.prototype.rebind = function rebind () {\n  \t\tif ( this.isStatic || !this.model ) return;\n\n  \t\tvar model = resolve$1( this.parentFragment, this.template );\n\n  \t\tif ( model === this.model ) return;\n\n  \t\tthis.model.unregister( this );\n\n  \t\tthis.model = model;\n\n  \t\tif ( model ) {\n  \t\t\tmodel.register( this );\n  \t\t\tthis.handleChange();\n  \t\t}\n  \t};\n\n  \tMustache.prototype.unbind = function unbind () {\n  \t\tif ( !this.isStatic ) {\n  \t\t\tthis.model && this.model.unregister( this );\n  \t\t\tthis.model = undefined;\n  \t\t\tthis.resolver && this.resolver.unbind();\n  \t\t}\n  \t};\n\n  \treturn Mustache;\n  }(Item));\n\n  var Interpolator = (function (Mustache) {\n  \tfunction Interpolator () {\n  \t\tMustache.apply(this, arguments);\n  \t}\n\n  \tInterpolator.prototype = Object.create( Mustache && Mustache.prototype );\n  \tInterpolator.prototype.constructor = Interpolator;\n\n  \tInterpolator.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tInterpolator.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tInterpolator.prototype.getString = function getString () {\n  \t\treturn this.model ? safeToStringValue( this.model.get() ) : '';\n  \t};\n\n  \tInterpolator.prototype.render = function render ( target, occupants ) {\n  \t\tvar value = this.getString();\n\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== value ) {\n  \t\t\t\t\tn.nodeValue = value;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( value );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( value );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.toString = function toString ( escape ) {\n  \t\tvar string = this.getString();\n  \t\treturn escape ? escapeHtml( string ) : string;\n  \t};\n\n  \tInterpolator.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tInterpolator.prototype.update = function update () {\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.node.data = this.getString();\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tInterpolator.prototype.valueOf = function valueOf () {\n  \t\treturn this.model ? this.model.get() : undefined;\n  \t};\n\n  \treturn Interpolator;\n  }(Mustache));\n\n  var Input = (function (Element) {\n  \tfunction Input () {\n  \t\tElement.apply(this, arguments);\n  \t}\n\n  \tInput.prototype = Object.create( Element && Element.prototype );\n  \tInput.prototype.constructor = Input;\n\n  \tInput.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.node.defaultValue = this.node.value;\n  \t};\n\n  \treturn Input;\n  }(Element));\n\n  function findParentSelect ( element ) {\n  \twhile ( element ) {\n  \t\tif ( element.name === 'select' ) return element;\n  \t\telement = element.parent;\n  \t}\n  }\n\n  var Option = (function (Element) {\n  \tfunction Option ( options ) {\n  \t\tvar template = options.template;\n  \t\tif ( !template.a ) template.a = {};\n\n  \t\t// If the value attribute is missing, use the element's content,\n  \t\t// as long as it isn't disabled\n  \t\tif ( template.a.value === undefined && !( 'disabled' in template.a ) ) {\n  \t\t\ttemplate.a.value = template.f || '';\n  \t\t}\n\n  \t\tElement.call( this, options );\n\n  \t\tthis.select = findParentSelect( this.parent );\n  \t}\n\n  \tOption.prototype = Object.create( Element && Element.prototype );\n  \tOption.prototype.constructor = Option;\n\n  \tOption.prototype.bind = function bind () {\n  \t\tif ( !this.select ) {\n  \t\t\tElement.prototype.bind.call(this);\n  \t\t\treturn;\n  \t\t}\n\n  \t\t// If the select has a value, it overrides the `selected` attribute on\n  \t\t// this option - so we delete the attribute\n  \t\tvar selectedAttribute = this.attributeByName.selected;\n  \t\tif ( selectedAttribute && this.select.getAttribute( 'value' ) !== undefined ) {\n  \t\t\tvar index = this.attributes.indexOf( selectedAttribute );\n  \t\t\tthis.attributes.splice( index, 1 );\n  \t\t\tdelete this.attributeByName.selected;\n  \t\t}\n\n  \t\tElement.prototype.bind.call(this);\n  \t\tthis.select.options.push( this );\n  \t};\n\n  \tOption.prototype.isSelected = function isSelected () {\n  \t\tvar optionValue = this.getAttribute( 'value' );\n\n  \t\tif ( optionValue === undefined || !this.select ) {\n  \t\t\treturn false;\n  \t\t}\n\n  \t\tvar selectValue = this.select.getAttribute( 'value' );\n\n  \t\tif ( selectValue == optionValue ) {\n  \t\t\treturn true;\n  \t\t}\n\n  \t\tif ( this.select.getAttribute( 'multiple' ) && isArray( selectValue ) ) {\n  \t\t\tvar i = selectValue.length;\n  \t\t\twhile ( i-- ) {\n  \t\t\t\tif ( selectValue[i] == optionValue ) {\n  \t\t\t\t\treturn true;\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tOption.prototype.unbind = function unbind () {\n  \t\tElement.prototype.unbind.call(this);\n\n  \t\tif ( this.select ) {\n  \t\t\tremoveFromArray( this.select.options, this );\n  \t\t}\n  \t};\n\n  \treturn Option;\n  }(Element));\n\n  function getPartialTemplate ( ractive, name, parentFragment ) {\n  \t// If the partial in instance or view heirarchy instances, great\n  \tvar partial = getPartialFromRegistry( ractive, name, parentFragment || {} );\n  \tif ( partial ) return partial;\n\n  \t// Does it exist on the page as a script tag?\n  \tpartial = parser.fromId( name, { noThrow: true } );\n  \tif ( partial ) {\n  \t\t// parse and register to this ractive instance\n  \t\tvar parsed = parser.parseFor( partial, ractive );\n\n  \t\t// register extra partials on the ractive instance if they don't already exist\n  \t\tif ( parsed.p ) fillGaps( ractive.partials, parsed.p );\n\n  \t\t// register (and return main partial if there are others in the template)\n  \t\treturn ractive.partials[ name ] = parsed.t;\n  \t}\n  }\n\n  function getPartialFromRegistry ( ractive, name, parentFragment ) {\n  \t// if there was an instance up-hierarchy, cool\n  \tvar partial = findParentPartial( name, parentFragment.owner );\n  \tif ( partial ) return partial;\n\n  \t// find first instance in the ractive or view hierarchy that has this partial\n  \tvar instance = findInstance( 'partials', ractive, name );\n\n  \tif ( !instance ) { return; }\n\n  \tpartial = instance.partials[ name ];\n\n  \t// partial is a function?\n  \tvar fn;\n  \tif ( typeof partial === 'function' ) {\n  \t\tfn = partial.bind( instance );\n  \t\tfn.isOwner = instance.partials.hasOwnProperty(name);\n  \t\tpartial = fn.call( ractive, parser );\n  \t}\n\n  \tif ( !partial && partial !== '' ) {\n  \t\twarnIfDebug( noRegistryFunctionReturn, name, 'partial', 'partial', { ractive: ractive });\n  \t\treturn;\n  \t}\n\n  \t// If this was added manually to the registry,\n  \t// but hasn't been parsed, parse it now\n  \tif ( !parser.isParsed( partial ) ) {\n  \t\t// use the parseOptions of the ractive instance on which it was found\n  \t\tvar parsed = parser.parseFor( partial, instance );\n\n  \t\t// Partials cannot contain nested partials!\n  \t\t// TODO add a test for this\n  \t\tif ( parsed.p ) {\n  \t\t\twarnIfDebug( 'Partials ({{>%s}}) cannot contain nested inline partials', name, { ractive: ractive });\n  \t\t}\n\n  \t\t// if fn, use instance to store result, otherwise needs to go\n  \t\t// in the correct point in prototype chain on instance or constructor\n  \t\tvar target = fn ? instance : findOwner( instance, name );\n\n  \t\t// may be a template with partials, which need to be registered and main template extracted\n  \t\ttarget.partials[ name ] = partial = parsed.t;\n  \t}\n\n  \t// store for reset\n  \tif ( fn ) partial._fn = fn;\n\n  \treturn partial.v ? partial.t : partial;\n  }\n\n  function findOwner ( ractive, key ) {\n  \treturn ractive.partials.hasOwnProperty( key )\n  \t\t? ractive\n  \t\t: findConstructor( ractive.constructor, key);\n  }\n\n  function findConstructor ( constructor, key ) {\n  \tif ( !constructor ) { return; }\n  \treturn constructor.partials.hasOwnProperty( key )\n  \t\t? constructor\n  \t\t: findConstructor( constructor._Parent, key );\n  }\n\n  function findParentPartial( name, parent ) {\n  \tif ( parent ) {\n  \t\tif ( parent.template && parent.template.p && parent.template.p[name] ) {\n  \t\t\treturn parent.template.p[name];\n  \t\t} else if ( parent.parentFragment && parent.parentFragment.owner ) {\n  \t\t\treturn findParentPartial( name, parent.parentFragment.owner );\n  \t\t}\n  \t}\n  }\n\n  var Partial = (function (Mustache) {\n  \tfunction Partial () {\n  \t\tMustache.apply(this, arguments);\n  \t}\n\n  \tPartial.prototype = Object.create( Mustache && Mustache.prototype );\n  \tPartial.prototype.constructor = Partial;\n\n  \tPartial.prototype.bind = function bind () {\n  \t\t// keep track of the reference name for future resets\n  \t\tthis.refName = this.template.r;\n\n  \t\t// name matches take priority over expressions\n  \t\tvar template = this.refName ? getPartialTemplate( this.ractive, this.refName, this.parentFragment ) || null : null;\n  \t\tvar templateObj;\n\n  \t\tif ( template ) {\n  \t\t\tthis.named = true;\n  \t\t\tthis.setTemplate( this.template.r, template );\n  \t\t}\n\n  \t\tif ( !template ) {\n  \t\t\tMustache.prototype.bind.call(this);\n  \t\t\tif ( this.model && ( templateObj = this.model.get() ) && typeof templateObj === 'object' && ( typeof templateObj.template === 'string' || isArray( templateObj.t ) ) ) {\n  \t\t\t\tif ( templateObj.template ) {\n  \t\t\t\t\ttemplateObj = parsePartial( this.template.r, templateObj.template, this.ractive );\n  \t\t\t\t}\n  \t\t\t\tthis.setTemplate( this.template.r, templateObj.t );\n  \t\t\t} else if ( ( !this.model || typeof this.model.get() !== 'string' ) && this.refName ) {\n  \t\t\t\tthis.setTemplate( this.refName, template );\n  \t\t\t} else {\n  \t\t\t\tthis.setTemplate( this.model.get() );\n  \t\t\t}\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\ttemplate: this.partialTemplate\n  \t\t}).bind();\n  \t};\n\n  \tPartial.prototype.detach = function detach () {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tPartial.prototype.find = function find ( selector ) {\n  \t\treturn this.fragment.find( selector );\n  \t};\n\n  \tPartial.prototype.findAll = function findAll ( selector, query ) {\n  \t\tthis.fragment.findAll( selector, query );\n  \t};\n\n  \tPartial.prototype.findComponent = function findComponent ( name ) {\n  \t\treturn this.fragment.findComponent( name );\n  \t};\n\n  \tPartial.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tthis.fragment.findAllComponents( name, query );\n  \t};\n\n  \tPartial.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment.firstNode( skipParent );\n  \t};\n\n  \tPartial.prototype.forceResetTemplate = function forceResetTemplate () {\n  \t\tthis.partialTemplate = undefined;\n\n  \t\t// on reset, check for the reference name first\n  \t\tif ( this.refName ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.refName, this.parentFragment );\n  \t\t}\n\n  \t\t// then look for the resolved name\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\tthis.partialTemplate = getPartialTemplate( this.ractive, this.name, this.parentFragment );\n  \t\t}\n\n  \t\tif ( !this.partialTemplate ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + (this.name) + \"'\") );\n  \t\t\tthis.partialTemplate = [];\n  \t\t}\n\n  \t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\tthis.bubble();\n  \t};\n\n  \tPartial.prototype.rebind = function rebind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tMustache.prototype.bind.call(this);\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tPartial.prototype.render = function render ( target, occupants ) {\n  \t\tthis.fragment.render( target, occupants );\n  \t};\n\n  \tPartial.prototype.setTemplate = function setTemplate ( name, template ) {\n  \t\tthis.name = name;\n\n  \t\tif ( !template && template !== null ) template = getPartialTemplate( this.ractive, name, this.parentFragment );\n\n  \t\tif ( !template ) {\n  \t\t\twarnOnceIfDebug( (\"Could not find template for partial '\" + name + \"'\") );\n  \t\t}\n\n  \t\tthis.partialTemplate = template || [];\n  \t};\n\n  \tPartial.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment.toString( escape );\n  \t};\n\n  \tPartial.prototype.unbind = function unbind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tthis.fragment.unbind();\n  \t};\n\n  \tPartial.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.fragment.unrender( shouldDestroy );\n  \t};\n\n  \tPartial.prototype.update = function update () {\n  \t\tvar template;\n\n  \t\tif ( this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tif ( !this.named ) {\n  \t\t\t\tif ( this.model ) {\n  \t\t\t\t\ttemplate = this.model.get();\n  \t\t\t\t}\n\n  \t\t\t\tif ( template && typeof template === 'string' && template !== this.name ) {\n  \t\t\t\t\tthis.setTemplate( template );\n  \t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t} else if ( template && typeof template === 'object' && ( typeof template.template === 'string' || isArray( template.t ) ) ) {\n  \t\t\t\t\tif ( template.template ) {\n  \t\t\t\t\t\ttemplate = parsePartial( this.name, template.template, this.ractive );\n  \t\t\t\t\t}\n  \t\t\t\t\tthis.setTemplate( this.name, template.t );\n  \t\t\t\t\tthis.fragment.resetTemplate( this.partialTemplate );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment.update();\n  \t\t}\n  \t};\n\n  \treturn Partial;\n  }(Mustache));\n\n  function parsePartial( name, partial, ractive ) {\n  \tvar parsed;\n\n  \ttry {\n  \t\tparsed = parser.parse( partial, parser.getParseOptions( ractive ) );\n  \t} catch (e) {\n  \t\twarnIfDebug( (\"Could not parse partial from expression '\" + name + \"'\\n\" + (e.message)) );\n  \t}\n\n  \treturn parsed || { t: [] };\n  }\n\n  var RepeatedFragment = function RepeatedFragment ( options ) {\n  \tthis.parent = options.owner.parentFragment;\n\n  \t// bit of a hack, so reference resolution works without another\n  \t// layer of indirection\n  \tthis.parentFragment = this;\n  \tthis.owner = options.owner;\n  \tthis.ractive = this.parent.ractive;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n  \tthis.iterations = [];\n\n  \tthis.template = options.template;\n\n  \tthis.indexRef = options.indexRef;\n  \tthis.keyRef = options.keyRef;\n\n  \tthis.pendingNewIndices = null;\n  \tthis.previousIterations = null;\n\n  \t// track array versus object so updates of type rest\n  \tthis.isArray = false;\n  };\n\n  RepeatedFragment.prototype.bind = function bind ( context ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = context;\n  \tvar value = context.get();\n\n  \t// {{#each array}}...\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\t// we can't use map, because of sparse arrays\n  \t\tthis.iterations = [];\n  \t\tfor ( var i = 0; i < value.length; i += 1 ) {\n  \t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t}\n  \t}\n\n  \t// {{#each object}}...\n  \telse if ( isObject( value ) ) {\n  \t\tthis.isArray = false;\n\n  \t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\tif ( this.indexRef ) {\n  \t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\tthis.keyRef = refs[0];\n  \t\t\tthis.indexRef = refs[1];\n  \t\t}\n\n  \t\tthis.iterations = Object.keys( value ).map( function ( key, index ) {\n  \t\t\treturn this$1.createIteration( key, index );\n  \t\t});\n  \t}\n\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.bubble = function bubble () {\n  \tthis.owner.bubble();\n  };\n\n  RepeatedFragment.prototype.createIteration = function createIteration ( key, index ) {\n  \tvar fragment = new Fragment({\n  \t\towner: this,\n  \t\ttemplate: this.template\n  \t});\n\n  \t// TODO this is a bit hacky\n  \tfragment.key = key;\n  \tfragment.index = index;\n  \tfragment.isIteration = true;\n\n  \tvar model = this.context.joinKey( key );\n\n  \t// set up an iteration alias if there is one\n  \tif ( this.owner.template.z ) {\n  \t\tfragment.aliases = {};\n  \t\tfragment.aliases[ this.owner.template.z[0].n ] = model;\n  \t}\n\n  \treturn fragment.bind( model );\n  };\n\n  RepeatedFragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.iterations.forEach( function ( fragment ) { return docFrag.appendChild( fragment.detach() ); } );\n  \treturn docFrag;\n  };\n\n  RepeatedFragment.prototype.find = function find ( selector ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].find( selector );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAll( selector, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findComponent = function findComponent ( name ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.iterations[i].findComponent( name );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  RepeatedFragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.iterations.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tthis$1.iterations[i].findAllComponents( name, query );\n  \t}\n  };\n\n  RepeatedFragment.prototype.findNextNode = function findNextNode ( iteration ) {\n  \tvar this$1 = this;\n\n  \t\tif ( iteration.index < this.iterations.length - 1 ) {\n  \t\tfor ( var i = iteration.index + 1; i < this$1.iterations.length; i++ ) {\n  \t\t\tvar node = this$1.iterations[ i ].firstNode( true );\n  \t\t\tif ( node ) return node;\n  \t\t}\n  \t}\n\n  \treturn this.owner.findNextNode();\n  };\n\n  RepeatedFragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \treturn this.iterations[0] ? this.iterations[0].firstNode( skipParent ) : null;\n  };\n\n  RepeatedFragment.prototype.rebind = function rebind ( context ) {\n  \tvar this$1 = this;\n\n  \t\tthis.context = context;\n\n  \tthis.iterations.forEach( function ( fragment ) {\n  \t\tvar model = context.joinKey( fragment.key || fragment.index );\n  \t\tif ( this$1.owner.template.z ) {\n  \t\t\tfragment.aliases = {};\n  \t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t}\n  \t\tfragment.rebind( model );\n  \t});\n  };\n\n  RepeatedFragment.prototype.render = function render ( target, occupants ) {\n  \t// TODO use docFrag.cloneNode...\n\n  \tif ( this.iterations ) {\n  \t\tthis.iterations.forEach( function ( fragment ) { return fragment.render( target, occupants ); } );\n  \t}\n\n  \tthis.rendered = true;\n  };\n\n  RepeatedFragment.prototype.shuffle = function shuffle ( newIndices ) {\n  \tvar this$1 = this;\n\n  \t\tif ( !this.pendingNewIndices ) this.previousIterations = this.iterations.slice();\n\n  \tif ( !this.pendingNewIndices ) this.pendingNewIndices = [];\n\n  \tthis.pendingNewIndices.push( newIndices );\n\n  \tvar iterations = [];\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tif ( newIndex === -1 ) return;\n\n  \t\tvar fragment = this$1.iterations[ oldIndex ];\n  \t\titerations[ newIndex ] = fragment;\n\n  \t\tif ( newIndex !== oldIndex && fragment ) fragment.dirty = true;\n  \t});\n\n  \tthis.iterations = iterations;\n\n  \tthis.bubble();\n  };\n\n  RepeatedFragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.iterations ?\n  \t\tthis.iterations.map( escape ? toEscapedString : toString$1 ).join( '' ) :\n  \t\t'';\n  };\n\n  RepeatedFragment.prototype.unbind = function unbind$1 () {\n  \tthis.iterations.forEach( unbind );\n  \treturn this;\n  };\n\n  RepeatedFragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.iterations.forEach( shouldDestroy ? unrenderAndDestroy : unrender );\n  \tif ( this.pendingNewIndices && this.previousIterations ) {\n  \t\tthis.previousIterations.forEach( function ( fragment ) {\n  \t\t\tif ( fragment.rendered ) shouldDestroy ? unrenderAndDestroy( fragment ) : unrender( fragment );\n  \t\t});\n  \t}\n  \tthis.rendered = false;\n  };\n\n  // TODO smart update\n  RepeatedFragment.prototype.update = function update$1 () {\n  \t// skip dirty check, since this is basically just a facade\n\n  \tvar this$1 = this;\n\n  \t\tif ( this.pendingNewIndices ) {\n  \t\tthis.updatePostShuffle();\n  \t\treturn;\n  \t}\n\n  \tif ( this.updating ) return;\n  \tthis.updating = true;\n\n  \tvar value = this.context.get(),\n  \t\t\t  wasArray = this.isArray;\n\n  \tvar toRemove;\n  \tvar oldKeys;\n  \tvar reset = true;\n  \tvar i;\n\n  \tif ( this.isArray = isArray( value ) ) {\n  \t\tif ( wasArray ) {\n  \t\t\treset = false;\n  \t\t\tif ( this.iterations.length > value.length ) {\n  \t\t\t\ttoRemove = this.iterations.splice( value.length );\n  \t\t\t}\n  \t\t}\n  \t} else if ( isObject( value ) && !wasArray ) {\n  \t\treset = false;\n  \t\ttoRemove = [];\n  \t\toldKeys = {};\n  \t\ti = this.iterations.length;\n\n  \t\twhile ( i-- ) {\n  \t\t\tvar fragment$1 = this$1.iterations[i];\n  \t\t\tif ( fragment$1.key in value ) {\n  \t\t\t\toldKeys[ fragment$1.key ] = true;\n  \t\t\t} else {\n  \t\t\t\tthis$1.iterations.splice( i, 1 );\n  \t\t\t\ttoRemove.push( fragment$1 );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( reset ) {\n  \t\ttoRemove = this.iterations;\n  \t\tthis.iterations = [];\n  \t}\n\n  \tif ( toRemove ) {\n  \t\ttoRemove.forEach( function ( fragment ) {\n  \t\t\tfragment.unbind();\n  \t\t\tfragment.unrender( true );\n  \t\t});\n  \t}\n\n  \t// update the remaining ones\n  \tthis.iterations.forEach( update );\n\n  \t// add new iterations\n  \tvar newLength = isArray( value ) ?\n  \t\tvalue.length :\n  \t\tisObject( value ) ?\n  \t\t\tObject.keys( value ).length :\n  \t\t\t0;\n\n  \tvar docFrag;\n  \tvar fragment;\n\n  \tif ( newLength > this.iterations.length ) {\n  \t\tdocFrag = this.rendered ? createDocumentFragment() : null;\n  \t\ti = this.iterations.length;\n\n  \t\tif ( isArray( value ) ) {\n  \t\t\twhile ( i < value.length ) {\n  \t\t\t\tfragment = this$1.createIteration( i, i );\n\n  \t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\ti += 1;\n  \t\t\t}\n  \t\t}\n\n  \t\telse if ( isObject( value ) ) {\n  \t\t\t// TODO this is a dreadful hack. There must be a neater way\n  \t\t\tif ( this.indexRef && !this.keyRef ) {\n  \t\t\t\tvar refs = this.indexRef.split( ',' );\n  \t\t\t\tthis.keyRef = refs[0];\n  \t\t\t\tthis.indexRef = refs[1];\n  \t\t\t}\n\n  \t\t\tObject.keys( value ).forEach( function ( key ) {\n  \t\t\t\tif ( !oldKeys || !( key in oldKeys ) ) {\n  \t\t\t\t\tfragment = this$1.createIteration( key, i );\n\n  \t\t\t\t\tthis$1.iterations.push( fragment );\n  \t\t\t\t\tif ( this$1.rendered ) fragment.render( docFrag );\n\n  \t\t\t\t\ti += 1;\n  \t\t\t\t}\n  \t\t\t});\n  \t\t}\n\n  \t\tif ( this.rendered ) {\n  \t\t\tvar parentNode = this.parent.findParentNode();\n  \t\t\tvar anchor = this.parent.findNextNode( this.owner );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t}\n  \t}\n\n  \tthis.updating = false;\n  };\n\n  RepeatedFragment.prototype.updatePostShuffle = function updatePostShuffle () {\n  \tvar this$1 = this;\n\n  \t\tvar newIndices = this.pendingNewIndices[ 0 ];\n\n  \t// map first shuffle through\n  \tthis.pendingNewIndices.slice( 1 ).forEach( function ( indices ) {\n  \t\tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\t\tnewIndices[ oldIndex ] = indices[ newIndex ];\n  \t\t});\n  \t});\n\n  \t// This algorithm (for detaching incorrectly-ordered fragments from the DOM and\n  \t// storing them in a document fragment for later reinsertion) seems a bit hokey,\n  \t// but it seems to work for now\n  \tvar len = this.context.get().length;\n  \tvar i, maxIdx = 0, merged = false;\n\n  \tnewIndices.forEach( function ( newIndex, oldIndex ) {\n  \t\tvar fragment = this$1.previousIterations[ oldIndex ];\n\n  \t\t// check for merged shuffles\n  \t\tif ( !merged && newIndex !== -1 ) {\n  \t\t\tif ( newIndex < maxIdx ) merged = true;\n  \t\t\tif ( newIndex > maxIdx ) maxIdx = newIndex;\n  \t\t}\n\n\n  \t\tif ( newIndex === -1 ) {\n  \t\t\tfragment.unbind().unrender( true );\n  \t\t} else {\n  \t\t\tfragment.index = newIndex;\n  \t\t\tvar model = this$1.context.joinKey( newIndex );\n  \t\t\tif ( this$1.owner.template.z ) {\n  \t\t\t\tfragment.aliases = {};\n  \t\t\t\tfragment.aliases[ this$1.owner.template.z[0].n ] = model;\n  \t\t\t}\n  \t\t\tfragment.rebind( model );\n  \t\t}\n  \t});\n\n  \t// create new iterations\n  \tvar docFrag = this.rendered ? createDocumentFragment() : null;\n  \tvar parentNode = this.rendered ? this.parent.findParentNode() : null;\n\n  \tif ( merged ) {\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar frag = this$1.iterations[i];\n\n  \t\t\tif ( this$1.rendered ) {\n  \t\t\t\tif ( frag ) {\n  \t\t\t\t\tdocFrag.appendChild( frag.detach() );\n  \t\t\t\t} else {\n  \t\t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t\tthis$1.iterations[i].render( docFrag );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tif ( !this$1.rendered ) {\n  \t\t\t\tif ( !frag ) {\n  \t\t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t} else {\n  \t\tfor ( i = 0; i < len; i++ ) {\n  \t\t\tvar frag$1 = this$1.iterations[i];\n\n  \t\t\tif ( this$1.rendered ) {\n  \t\t\t\tif ( frag$1 && docFrag.childNodes.length ) {\n  \t\t\t\t\tparentNode.insertBefore( docFrag, frag$1.firstNode() );\n  \t\t\t\t}\n\n  \t\t\t\tif ( !frag$1 ) {\n  \t\t\t\t\tfrag$1 = this$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t\t\tfrag$1.render( docFrag );\n  \t\t\t\t}\n  \t\t\t} else if ( !frag$1 ) {\n  \t\t\t\tthis$1.iterations[i] = this$1.createIteration( i, i );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \tif ( this.rendered && docFrag.childNodes.length ) {\n  \t\tparentNode.insertBefore( docFrag, this.owner.findNextNode() );\n  \t}\n\n  \tthis.iterations.forEach( update );\n\n  \tthis.pendingNewIndices = null;\n  };\n\n  function isEmpty ( value ) {\n  \treturn !value ||\n  \t       ( isArray( value ) && value.length === 0 ) ||\n  \t\t   ( isObject( value ) && Object.keys( value ).length === 0 );\n  }\n\n  function getType ( value, hasIndexRef ) {\n  \tif ( hasIndexRef || isArray( value ) ) return SECTION_EACH;\n  \tif ( isObject( value ) || typeof value === 'function' ) return SECTION_IF_WITH;\n  \tif ( value === undefined ) return null;\n  \treturn SECTION_IF;\n  }\n\n  var Section = (function (Mustache) {\n  \tfunction Section ( options ) {\n  \t\tMustache.call( this, options );\n\n  \t\tthis.sectionType = options.template.n || null;\n  \t\tthis.templateSectionType = this.sectionType;\n  \t\tthis.fragment = null;\n  \t}\n\n  \tSection.prototype = Object.create( Mustache && Mustache.prototype );\n  \tSection.prototype.constructor = Section;\n\n  \tSection.prototype.bind = function bind () {\n  \t\tMustache.prototype.bind.call(this);\n\n  \t\t// if we managed to bind, we need to create children\n  \t\tif ( this.model ) {\n  \t\t\tthis.dirty = true;\n  \t\t\tthis.update();\n  \t\t} else if (this.sectionType && this.sectionType === SECTION_UNLESS) {\n  \t\t\tthis.fragment = new Fragment({\n  \t\t\t\towner: this,\n  \t\t\t\ttemplate: this.template.f\n  \t\t\t}).bind();\n  \t\t}\n  \t};\n\n  \tSection.prototype.detach = function detach () {\n  \t\treturn this.fragment ? this.fragment.detach() : createDocumentFragment();\n  \t};\n\n  \tSection.prototype.find = function find ( selector ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.find( selector );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAll = function findAll ( selector, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAll( selector, query );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findComponent = function findComponent ( name ) {\n  \t\tif ( this.fragment ) {\n  \t\t\treturn this.fragment.findComponent( name );\n  \t\t}\n  \t};\n\n  \tSection.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.findAllComponents( name, query );\n  \t\t}\n  \t};\n\n  \tSection.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment && this.fragment.firstNode( skipParent );\n  \t};\n\n  \tSection.prototype.rebind = function rebind () {\n  \t\tMustache.prototype.rebind.call(this);\n\n  \t\tif ( this.fragment ) {\n  \t\t\tthis.fragment.rebind( this.sectionType === SECTION_IF || this.sectionType === SECTION_UNLESS ? null : this.model );\n  \t\t}\n  \t};\n\n  \tSection.prototype.render = function render ( target, occupants ) {\n  \t\tthis.rendered = true;\n  \t\tif ( this.fragment ) this.fragment.render( target, occupants );\n  \t};\n\n  \tSection.prototype.shuffle = function shuffle ( newIndices ) {\n  \t\tif ( this.fragment && this.sectionType === SECTION_EACH ) {\n  \t\t\tthis.fragment.shuffle( newIndices );\n  \t\t}\n  \t};\n\n  \tSection.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment ? this.fragment.toString( escape ) : '';\n  \t};\n\n  \tSection.prototype.unbind = function unbind () {\n  \t\tMustache.prototype.unbind.call(this);\n  \t\tif ( this.fragment ) this.fragment.unbind();\n  \t};\n\n  \tSection.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && this.fragment ) this.fragment.unrender( shouldDestroy );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tSection.prototype.update = function update () {\n  \t\tif ( !this.dirty ) return;\n  \t\tif ( !this.model && this.sectionType !== SECTION_UNLESS ) return;\n\n  \t\tthis.dirty = false;\n\n  \t\tvar value = !this.model ? undefined : this.model.isRoot ? this.model.value : this.model.get();\n  \t\tvar lastType = this.sectionType;\n\n  \t\t// watch for switching section types\n  \t\tif ( this.sectionType === null || this.templateSectionType === null ) this.sectionType = getType( value, this.template.i );\n  \t\tif ( lastType && lastType !== this.sectionType && this.fragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t}\n\n  \t\t\tthis.fragment = null;\n  \t\t}\n\n  \t\tvar newFragment;\n\n  \t\tif ( this.sectionType === SECTION_EACH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\t// TODO can this happen?\n  \t\t\t\tnewFragment = new RepeatedFragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f,\n  \t\t\t\t\tindexRef: this.template.i\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\t// WITH is now IF_WITH; WITH is only used for {{>partial context}}\n  \t\telse if ( this.sectionType === SECTION_WITH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tthis.fragment.update();\n  \t\t\t} else {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\telse if ( this.sectionType === SECTION_IF_WITH ) {\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tif ( isEmpty( value ) ) {\n  \t\t\t\t\tif ( this.rendered ) {\n  \t\t\t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tthis.fragment = null;\n  \t\t\t\t} else {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t}\n  \t\t\t} else if ( !isEmpty( value ) ) {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( this.model );\n  \t\t\t}\n  \t\t}\n\n  \t\telse {\n  \t\t\tvar fragmentShouldExist = this.sectionType === SECTION_UNLESS ? isEmpty( value ) : !!value && !isEmpty( value );\n\n  \t\t\tif ( this.fragment ) {\n  \t\t\t\tif ( fragmentShouldExist ) {\n  \t\t\t\t\tthis.fragment.update();\n  \t\t\t\t} else {\n  \t\t\t\t\tif ( this.rendered ) {\n  \t\t\t\t\t\tthis.fragment.unbind().unrender( true );\n  \t\t\t\t\t}\n\n  \t\t\t\t\tthis.fragment = null;\n  \t\t\t\t}\n  \t\t\t} else if ( fragmentShouldExist ) {\n  \t\t\t\tnewFragment = new Fragment({\n  \t\t\t\t\towner: this,\n  \t\t\t\t\ttemplate: this.template.f\n  \t\t\t\t}).bind( null );\n  \t\t\t}\n  \t\t}\n\n  \t\tif ( newFragment ) {\n  \t\t\tif ( this.rendered ) {\n  \t\t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\t\tif ( anchor ) {\n  \t\t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\t\tnewFragment.render( docFrag );\n\n  \t\t\t\t\t// we use anchor.parentNode, not parentNode, because the sibling\n  \t\t\t\t\t// may be temporarily detached as a result of a shuffle\n  \t\t\t\t\tanchor.parentNode.insertBefore( docFrag, anchor );\n  \t\t\t\t} else {\n  \t\t\t\t\tnewFragment.render( parentNode );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.fragment = newFragment;\n  \t\t}\n  \t};\n\n  \treturn Section;\n  }(Mustache));\n\n  function valueContains ( selectValue, optionValue ) {\n  \tvar i = selectValue.length;\n  \twhile ( i-- ) {\n  \t\tif ( selectValue[i] == optionValue ) return true;\n  \t}\n  }\n\n  var Select = (function (Element) {\n  \tfunction Select ( options ) {\n  \t\tElement.call( this, options );\n  \t\tthis.options = [];\n  \t}\n\n  \tSelect.prototype = Object.create( Element && Element.prototype );\n  \tSelect.prototype.constructor = Select;\n\n  \tSelect.prototype.foundNode = function foundNode ( node ) {\n  \t\tif ( this.binding ) {\n  \t\t\tvar selectedOptions = getSelectedOptions( node );\n\n  \t\t\tif ( selectedOptions.length > 0 ) {\n  \t\t\t\tthis.selectedOptions = selectedOptions;\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tSelect.prototype.render = function render ( target, occupants ) {\n  \t\tElement.prototype.render.call( this, target, occupants );\n  \t\tthis.sync();\n\n  \t\tvar node = this.node;\n\n  \t\tvar i = node.options.length;\n  \t\twhile ( i-- ) {\n  \t\t\tnode.options[i].defaultSelected = node.options[i].selected;\n  \t\t}\n\n  \t\tthis.rendered = true;\n  \t};\n\n  \tSelect.prototype.sync = function sync () {\n  \t\tvar this$1 = this;\n\n  \t\tvar selectNode = this.node;\n\n  \t\tif ( !selectNode ) return;\n\n  \t\tvar options = toArray( selectNode.options );\n\n  \t\tif ( this.selectedOptions ) {\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tif ( this$1.selectedOptions.indexOf( o ) >= 0 ) o.selected = true;\n  \t\t\t\telse o.selected = false;\n  \t\t\t});\n  \t\t\tthis.binding.setFromNode( selectNode );\n  \t\t\tdelete this.selectedOptions;\n  \t\t\treturn;\n  \t\t}\n\n  \t\tvar selectValue = this.getAttribute( 'value' );\n  \t\tvar isMultiple = this.getAttribute( 'multiple' );\n\n  \t\t// If the <select> has a specified value, that should override\n  \t\t// these options\n  \t\tif ( selectValue !== undefined ) {\n  \t\t\tvar optionWasSelected;\n\n  \t\t\toptions.forEach( function ( o ) {\n  \t\t\t\tvar optionValue = o._ractive ? o._ractive.value : o.value;\n  \t\t\t\tvar shouldSelect = isMultiple ? valueContains( selectValue, optionValue ) : selectValue == optionValue;\n\n  \t\t\t\tif ( shouldSelect ) {\n  \t\t\t\t\toptionWasSelected = true;\n  \t\t\t\t}\n\n  \t\t\t\to.selected = shouldSelect;\n  \t\t\t});\n\n  \t\t\tif ( !optionWasSelected && !isMultiple ) {\n  \t\t\t\tif ( this.binding ) {\n  \t\t\t\t\tthis.binding.forceUpdate();\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n\n  \t\t// Otherwise the value should be initialised according to which\n  \t\t// <option> element is selected, if twoway binding is in effect\n  \t\telse if ( this.binding ) {\n  \t\t\tthis.binding.forceUpdate();\n  \t\t}\n  \t};\n\n  \tSelect.prototype.update = function update () {\n  \t\tElement.prototype.update.call(this);\n  \t\tthis.sync();\n  \t};\n\n  \treturn Select;\n  }(Element));\n\n  var Textarea = (function (Input) {\n  \tfunction Textarea( options ) {\n  \t\tvar template = options.template;\n\n  \t\t// if there is a bindable value, there should be no body\n  \t\tif ( template.a && template.a.value && isBindable( { template: template.a.value } ) ) {\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\t// otherwise, if there is a single bindable interpolator as content, move it to the value attr\n  \t\telse if ( template.f && (!template.a || !template.a.value) && isBindable( { template: template.f } ) ) {\n  \t\t\tif ( !template.a ) template.a = {};\n  \t\t\ttemplate.a.value = template.f;\n  \t\t\toptions.noContent = true;\n  \t\t}\n\n  \t\tInput.call( this, options );\n  \t}\n\n  \tTextarea.prototype = Object.create( Input && Input.prototype );\n  \tTextarea.prototype.constructor = Textarea;\n\n  \tTextarea.prototype.bubble = function bubble () {\n  \t\tvar this$1 = this;\n\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.dirty = true;\n\n  \t\t\tif ( this.rendered && !this.binding && this.fragment ) {\n  \t\t\t\trunloop.scheduleTask( function () {\n  \t\t\t\t\tthis$1.dirty = false;\n  \t\t\t\t\tthis$1.node.value = this$1.fragment.toString();\n  \t\t\t\t});\n  \t\t\t}\n\n  \t\t\tthis.parentFragment.bubble(); // default behaviour\n  \t\t}\n  \t};\n\n  \treturn Textarea;\n  }(Input));\n\n  var Text = (function (Item) {\n  \tfunction Text ( options ) {\n  \t\tItem.call( this, options );\n  \t\tthis.type = TEXT;\n  \t}\n\n  \tText.prototype = Object.create( Item && Item.prototype );\n  \tText.prototype.constructor = Text;\n\n  \tText.prototype.bind = function bind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.detach = function detach () {\n  \t\treturn detachNode( this.node );\n  \t};\n\n  \tText.prototype.firstNode = function firstNode () {\n  \t\treturn this.node;\n  \t};\n\n  \tText.prototype.rebind = function rebind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.render = function render ( target, occupants ) {\n  \t\tthis.rendered = true;\n\n  \t\tif ( occupants ) {\n  \t\t\tvar n = occupants[0];\n  \t\t\tif ( n && n.nodeType === 3 ) {\n  \t\t\t\toccupants.shift();\n  \t\t\t\tif ( n.nodeValue !== this.template ) {\n  \t\t\t\t\tn.nodeValue = this.template;\n  \t\t\t\t}\n  \t\t\t} else {\n  \t\t\t\tn = this.node = doc.createTextNode( this.template );\n  \t\t\t\tif ( occupants[0] ) {\n  \t\t\t\t\ttarget.insertBefore( n, occupants[0] );\n  \t\t\t\t} else {\n  \t\t\t\t\ttarget.appendChild( n );\n  \t\t\t\t}\n  \t\t\t}\n\n  \t\t\tthis.node = n;\n  \t\t} else {\n  \t\t\tthis.node = doc.createTextNode( this.template );\n  \t\t\ttarget.appendChild( this.node );\n  \t\t}\n  \t};\n\n  \tText.prototype.toString = function toString ( escape ) {\n  \t\treturn escape ? escapeHtml( this.template ) : this.template;\n  \t};\n\n  \tText.prototype.unbind = function unbind () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tif ( this.rendered && shouldDestroy ) this.detach();\n  \t\tthis.rendered = false;\n  \t};\n\n  \tText.prototype.update = function update () {\n  \t\t// noop\n  \t};\n\n  \tText.prototype.valueOf = function valueOf () {\n  \t\treturn this.template;\n  \t};\n\n  \treturn Text;\n  }(Item));\n\n  var elementCache = {};\n\n  var ieBug;\n  var ieBlacklist;\n\n  try {\n  \tcreateElement( 'table' ).innerHTML = 'foo';\n  } catch ( err ) {\n  \tieBug = true;\n\n  \tieBlacklist = {\n  \t\tTABLE:  [ '<table class=\"x\">', '</table>' ],\n  \t\tTHEAD:  [ '<table><thead class=\"x\">', '</thead></table>' ],\n  \t\tTBODY:  [ '<table><tbody class=\"x\">', '</tbody></table>' ],\n  \t\tTR:     [ '<table><tr class=\"x\">', '</tr></table>' ],\n  \t\tSELECT: [ '<select class=\"x\">', '</select>' ]\n  \t};\n  }\n\n  function insertHtml ( html, node, docFrag ) {\n  \tvar nodes = [];\n\n  \t// render 0 and false\n  \tif ( html == null || html === '' ) return nodes;\n\n  \tvar container;\n  \tvar wrapper;\n  \tvar selectedOption;\n\n  \tif ( ieBug && ( wrapper = ieBlacklist[ node.tagName ] ) ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = wrapper[0] + html + wrapper[1];\n  \t\tcontainer = container.querySelector( '.x' );\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \telse if ( node.namespaceURI === svg$1 ) {\n  \t\tcontainer = element( 'DIV' );\n  \t\tcontainer.innerHTML = '<svg class=\"x\">' + html + '</svg>';\n  \t\tcontainer = container.querySelector( '.x' );\n  \t}\n\n  \telse if ( node.tagName === 'TEXTAREA' ) {\n  \t\tcontainer = createElement( 'div' );\n\n  \t\tif ( typeof container.textContent !== 'undefined' ) {\n  \t\t\tcontainer.textContent = html;\n  \t\t} else {\n  \t\t\tcontainer.innerHTML = html;\n  \t\t}\n  \t}\n\n  \telse {\n  \t\tcontainer = element( node.tagName );\n  \t\tcontainer.innerHTML = html;\n\n  \t\tif ( container.tagName === 'SELECT' ) {\n  \t\t\tselectedOption = container.options[ container.selectedIndex ];\n  \t\t}\n  \t}\n\n  \tvar child;\n  \twhile ( child = container.firstChild ) {\n  \t\tnodes.push( child );\n  \t\tdocFrag.appendChild( child );\n  \t}\n\n  \t// This is really annoying. Extracting <option> nodes from the\n  \t// temporary container <select> causes the remaining ones to\n  \t// become selected. So now we have to deselect them. IE8, you\n  \t// amaze me. You really do\n  \t// ...and now Chrome too\n  \tvar i;\n  \tif ( node.tagName === 'SELECT' ) {\n  \t\ti = nodes.length;\n  \t\twhile ( i-- ) {\n  \t\t\tif ( nodes[i] !== selectedOption ) {\n  \t\t\t\tnodes[i].selected = false;\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn nodes;\n  }\n\n  function element ( tagName ) {\n  \treturn elementCache[ tagName ] || ( elementCache[ tagName ] = createElement( tagName ) );\n  }\n\n  var Triple = (function (Mustache) {\n  \tfunction Triple ( options ) {\n  \t\tMustache.call( this, options );\n  \t}\n\n  \tTriple.prototype = Object.create( Mustache && Mustache.prototype );\n  \tTriple.prototype.constructor = Triple;\n\n  \tTriple.prototype.detach = function detach () {\n  \t\tvar docFrag = createDocumentFragment();\n  \t\tthis.nodes.forEach( function ( node ) { return docFrag.appendChild( node ); } );\n  \t\treturn docFrag;\n  \t};\n\n  \tTriple.prototype.find = function find ( selector ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( matches( node, selector ) ) return node;\n\n  \t\t\tvar queryResult = node.querySelector( selector );\n  \t\t\tif ( queryResult ) return queryResult;\n  \t\t}\n\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.findAll = function findAll ( selector, query ) {\n  \t\tvar this$1 = this;\n\n  \t\tvar len = this.nodes.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar node = this$1.nodes[i];\n\n  \t\t\tif ( node.nodeType !== 1 ) continue;\n\n  \t\t\tif ( query.test( node ) ) query.add( node );\n\n  \t\t\tvar queryAllResult = node.querySelectorAll( selector );\n  \t\t\tif ( queryAllResult ) {\n  \t\t\t\tvar numNodes = queryAllResult.length;\n  \t\t\t\tvar j;\n\n  \t\t\t\tfor ( j = 0; j < numNodes; j += 1 ) {\n  \t\t\t\t\tquery.add( queryAllResult[j] );\n  \t\t\t\t}\n  \t\t\t}\n  \t\t}\n  \t};\n\n  \tTriple.prototype.findComponent = function findComponent () {\n  \t\treturn null;\n  \t};\n\n  \tTriple.prototype.firstNode = function firstNode () {\n  \t\treturn this.nodes[0];\n  \t};\n\n  \tTriple.prototype.render = function render ( target ) {\n  \t\tvar html = this.model ? this.model.get() : '';\n  \t\tthis.nodes = insertHtml( html, this.parentFragment.findParentNode(), target );\n  \t\tthis.rendered = true;\n  \t};\n\n  \tTriple.prototype.toString = function toString () {\n  \t\treturn this.model && this.model.get() != null ? decodeCharacterReferences( '' + this.model.get() ) : '';\n  \t};\n\n  \tTriple.prototype.unrender = function unrender () {\n  \t\tif ( this.nodes ) this.nodes.forEach( function ( node ) { return detachNode( node ); } );\n  \t\tthis.rendered = false;\n  \t};\n\n  \tTriple.prototype.update = function update () {\n  \t\tif ( this.rendered && this.dirty ) {\n  \t\t\tthis.dirty = false;\n\n  \t\t\tthis.unrender();\n  \t\t\tvar docFrag = createDocumentFragment();\n  \t\t\tthis.render( docFrag );\n\n  \t\t\tvar parentNode = this.parentFragment.findParentNode();\n  \t\t\tvar anchor = this.parentFragment.findNextNode( this );\n\n  \t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t}\n  \t};\n\n  \treturn Triple;\n  }(Mustache));\n\n  var Yielder = (function (Item) {\n  \tfunction Yielder ( options ) {\n  \t\tItem.call( this, options );\n\n  \t\tthis.container = options.parentFragment.ractive;\n  \t\tthis.component = this.container.component;\n\n  \t\tthis.containerFragment = options.parentFragment;\n  \t\tthis.parentFragment = this.component.parentFragment;\n\n  \t\t// {{yield}} is equivalent to {{yield content}}\n  \t\tthis.name = options.template.n || '';\n  \t}\n\n  \tYielder.prototype = Object.create( Item && Item.prototype );\n  \tYielder.prototype.constructor = Yielder;\n\n  \tYielder.prototype.bind = function bind () {\n  \t\tvar name = this.name;\n\n  \t\t( this.component.yielders[ name ] || ( this.component.yielders[ name ] = [] ) ).push( this );\n\n  \t\t// TODO don't parse here\n  \t\tvar template = this.container._inlinePartials[ name || 'content' ];\n\n  \t\tif ( typeof template === 'string' ) {\n  \t\t\ttemplate = parse( template ).t;\n  \t\t}\n\n  \t\tif ( !template ) {\n  \t\t\twarnIfDebug( (\"Could not find template for partial \\\"\" + name + \"\\\"\"), { ractive: this.ractive });\n  \t\t\ttemplate = [];\n  \t\t}\n\n  \t\tthis.fragment = new Fragment({\n  \t\t\towner: this,\n  \t\t\tractive: this.container.parent,\n  \t\t\ttemplate: template\n  \t\t}).bind();\n  \t};\n\n  \tYielder.prototype.bubble = function bubble () {\n  \t\tif ( !this.dirty ) {\n  \t\t\tthis.containerFragment.bubble();\n  \t\t\tthis.dirty = true;\n  \t\t}\n  \t};\n\n  \tYielder.prototype.detach = function detach () {\n  \t\treturn this.fragment.detach();\n  \t};\n\n  \tYielder.prototype.find = function find ( selector ) {\n  \t\treturn this.fragment.find( selector );\n  \t};\n\n  \tYielder.prototype.findAll = function findAll ( selector, queryResult ) {\n  \t\tthis.fragment.find( selector, queryResult );\n  \t};\n\n  \tYielder.prototype.findComponent = function findComponent ( name ) {\n  \t\treturn this.fragment.findComponent( name );\n  \t};\n\n  \tYielder.prototype.findAllComponents = function findAllComponents ( name, queryResult ) {\n  \t\tthis.fragment.findAllComponents( name, queryResult );\n  \t};\n\n  \tYielder.prototype.findNextNode = function findNextNode() {\n  \t\treturn this.containerFragment.findNextNode( this );\n  \t};\n\n  \tYielder.prototype.firstNode = function firstNode ( skipParent ) {\n  \t\treturn this.fragment.firstNode( skipParent );\n  \t};\n\n  \tYielder.prototype.rebind = function rebind () {\n  \t\tthis.fragment.rebind();\n  \t};\n\n  \tYielder.prototype.render = function render ( target, occupants ) {\n  \t\treturn this.fragment.render( target, occupants );\n  \t};\n\n  \tYielder.prototype.setTemplate = function setTemplate ( name ) {\n  \t\tvar template = this.parentFragment.ractive.partials[ name ];\n\n  \t\tif ( typeof template === 'string' ) {\n  \t\t\ttemplate = parse( template ).t;\n  \t\t}\n\n  \t\tthis.partialTemplate = template || []; // TODO warn on missing partial\n  \t};\n\n  \tYielder.prototype.toString = function toString ( escape ) {\n  \t\treturn this.fragment.toString( escape );\n  \t};\n\n  \tYielder.prototype.unbind = function unbind () {\n  \t\tthis.fragment.unbind();\n  \t\tremoveFromArray( this.component.yielders[ this.name ], this );\n  \t};\n\n  \tYielder.prototype.unrender = function unrender ( shouldDestroy ) {\n  \t\tthis.fragment.unrender( shouldDestroy );\n  \t};\n\n  \tYielder.prototype.update = function update () {\n  \t\tthis.dirty = false;\n  \t\tthis.fragment.update();\n  \t};\n\n  \treturn Yielder;\n  }(Item));\n\n  // finds the component constructor in the registry or view hierarchy registries\n  function getComponentConstructor ( ractive, name ) {\n  \tvar instance = findInstance( 'components', ractive, name );\n  \tvar Component;\n\n  \tif ( instance ) {\n  \t\tComponent = instance.components[ name ];\n\n  \t\t// best test we have for not Ractive.extend\n  \t\tif ( !Component._Parent ) {\n  \t\t\t// function option, execute and store for reset\n  \t\t\tvar fn = Component.bind( instance );\n  \t\t\tfn.isOwner = instance.components.hasOwnProperty( name );\n  \t\t\tComponent = fn();\n\n  \t\t\tif ( !Component ) {\n  \t\t\t\twarnIfDebug( noRegistryFunctionReturn, name, 'component', 'component', { ractive: ractive });\n  \t\t\t\treturn;\n  \t\t\t}\n\n  \t\t\tif ( typeof Component === 'string' ) {\n  \t\t\t\t// allow string lookup\n  \t\t\t\tComponent = getComponentConstructor( ractive, Component );\n  \t\t\t}\n\n  \t\t\tComponent._fn = fn;\n  \t\t\tinstance.components[ name ] = Component;\n  \t\t}\n  \t}\n\n  \treturn Component;\n  }\n\n  var constructors = {};\n  constructors[ ALIAS ] = Alias;\n  constructors[ DOCTYPE ] = Doctype;\n  constructors[ INTERPOLATOR ] = Interpolator;\n  constructors[ PARTIAL ] = Partial;\n  constructors[ SECTION ] = Section;\n  constructors[ TRIPLE ] = Triple;\n  constructors[ YIELDER ] = Yielder;\n\n  var specialElements = {\n  \tdoctype: Doctype,\n  \tform: Form,\n  \tinput: Input,\n  \toption: Option,\n  \tselect: Select,\n  \ttextarea: Textarea\n  };\n\n  function createItem ( options ) {\n  \tif ( typeof options.template === 'string' ) {\n  \t\treturn new Text( options );\n  \t}\n\n  \tif ( options.template.t === ELEMENT ) {\n  \t\t// could be component or element\n  \t\tvar ComponentConstructor = getComponentConstructor( options.parentFragment.ractive, options.template.e );\n  \t\tif ( ComponentConstructor ) {\n  \t\t\treturn new Component( options, ComponentConstructor );\n  \t\t}\n\n  \t\tvar tagName = options.template.e.toLowerCase();\n\n  \t\tvar ElementConstructor = specialElements[ tagName ] || Element;\n  \t\treturn new ElementConstructor( options );\n  \t}\n\n  \tvar Item = constructors[ options.template.t ];\n\n  \tif ( !Item ) throw new Error( (\"Unrecognised item type \" + (options.template.t)) );\n\n  \treturn new Item( options );\n  }\n\n  var ReferenceResolver = function ReferenceResolver ( fragment, reference, callback ) {\n  \tvar this$1 = this;\n\n  \t\tthis.fragment = fragment;\n  \tthis.reference = normalise( reference );\n  \tthis.callback = callback;\n\n  \tthis.keys = splitKeypathI( reference );\n  \tthis.resolved = false;\n\n  \t// TODO the consumer should take care of addUnresolved\n  \t// we attach to all the contexts between here and the root\n  \t// - whenever their values change, they can quickly\n  \t// check to see if we can resolve\n  \twhile ( fragment ) {\n  \t\tif ( fragment.context ) {\n  \t\t\tfragment.context.addUnresolved( this$1.keys[0], this$1 );\n  \t\t}\n\n  \t\tfragment = fragment.componentParent || fragment.parent;\n  \t}\n  };\n\n  ReferenceResolver.prototype.attemptResolution = function attemptResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = resolveAmbiguousReference( this.fragment, this.reference );\n\n  \tif ( model ) {\n  \t\tthis.resolved = true;\n  \t\tthis.callback( model );\n  \t}\n  };\n\n  ReferenceResolver.prototype.forceResolution = function forceResolution () {\n  \tif ( this.resolved ) return;\n\n  \tvar model = this.fragment.findContext().joinAll( this.keys );\n  \tthis.callback( model );\n  \tthis.resolved = true;\n  };\n\n  ReferenceResolver.prototype.unbind = function unbind () {\n  \tremoveFromArray( this.fragment.unresolved, this );\n  };\n\n  // TODO all this code needs to die\n  function processItems ( items, values, guid, counter ) {\n  \tif ( counter === void 0 ) counter = 0;\n\n  \treturn items.map( function ( item ) {\n  \t\tif ( item.type === TEXT ) {\n  \t\t\treturn item.template;\n  \t\t}\n\n  \t\tif ( item.fragment ) {\n  \t\t\tif ( item.fragment.iterations ) {\n  \t\t\t\treturn item.fragment.iterations.map( function ( fragment ) {\n  \t\t\t\t\treturn processItems( fragment.items, values, guid, counter );\n  \t\t\t\t}).join( '' );\n  \t\t\t} else {\n  \t\t\t\treturn processItems( item.fragment.items, values, guid, counter );\n  \t\t\t}\n  \t\t}\n\n  \t\tvar placeholderId = \"\" + guid + \"-\" + (counter++);\n\n  \t\tvalues[ placeholderId ] = item.model ?\n  \t\t\titem.model.wrapper ?\n  \t\t\t\titem.model.wrapper.value :\n  \t\t\t\titem.model.get() :\n  \t\t\tundefined;\n\n  \t\treturn '${' + placeholderId + '}';\n  \t}).join( '' );\n  }\n\n  function unrenderAndDestroy$1 ( item ) {\n  \titem.unrender( true );\n  }\n\n  var Fragment = function Fragment ( options ) {\n  \tthis.owner = options.owner; // The item that owns this fragment - an element, section, partial, or attribute\n\n  \tthis.isRoot = !options.owner.parentFragment;\n  \tthis.parent = this.isRoot ? null : this.owner.parentFragment;\n  \tthis.ractive = options.ractive || ( this.isRoot ? options.owner : this.parent.ractive );\n\n  \tthis.componentParent = ( this.isRoot && this.ractive.component ) ? this.ractive.component.parentFragment : null;\n\n  \tthis.context = null;\n  \tthis.rendered = false;\n\n  \t// encapsulated styles should be inherited until they get applied by an element\n  \tthis.cssIds = 'cssIds' in options ? options.cssIds : ( this.parent ? this.parent.cssIds : null );\n\n  \tthis.resolvers = [];\n\n  \tthis.dirty = false;\n  \tthis.dirtyArgs = this.dirtyValue = true; // TODO getArgsList is nonsense - should deprecate legacy directives style\n\n  \tthis.template = options.template || [];\n  \tthis.createItems();\n  };\n\n  Fragment.prototype.bind = function bind$1 ( context ) {\n  \tthis.context = context;\n  \tthis.items.forEach( bind );\n  \tthis.bound = true;\n\n  \t// in rare cases, a forced resolution (or similar) will cause the\n  \t// fragment to be dirty before it's even finished binding. In those\n  \t// cases we update immediately\n  \tif ( this.dirty ) this.update();\n\n  \treturn this;\n  };\n\n  Fragment.prototype.bubble = function bubble () {\n  \tthis.dirtyArgs = this.dirtyValue = true;\n\n  \tif ( !this.dirty ) {\n  \t\tthis.dirty = true;\n\n  \t\tif ( this.isRoot ) { // TODO encapsulate 'is component root, but not overall root' check?\n  \t\t\tif ( this.ractive.component ) {\n  \t\t\t\tthis.ractive.component.bubble();\n  \t\t\t} else if ( this.bound ) {\n  \t\t\t\trunloop.addFragment( this );\n  \t\t\t}\n  \t\t} else {\n  \t\t\tthis.owner.bubble();\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.createItems = function createItems () {\n  \tvar this$1 = this;\n\n  \t\tthis.items = this.template.map( function ( template, index ) {\n  \t\treturn createItem({ parentFragment: this$1, template: template, index: index });\n  \t});\n  };\n\n  Fragment.prototype.detach = function detach () {\n  \tvar docFrag = createDocumentFragment();\n  \tthis.items.forEach( function ( item ) { return docFrag.appendChild( item.detach() ); } );\n  \treturn docFrag;\n  };\n\n  Fragment.prototype.find = function find ( selector ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].find( selector );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAll = function findAll ( selector, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAll ) {\n  \t\t\t\titem.findAll( selector, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findComponent = function findComponent ( name ) {\n  \tvar this$1 = this;\n\n  \t\tvar len = this.items.length;\n  \tvar i;\n\n  \tfor ( i = 0; i < len; i += 1 ) {\n  \t\tvar found = this$1.items[i].findComponent( name );\n  \t\tif ( found ) return found;\n  \t}\n  };\n\n  Fragment.prototype.findAllComponents = function findAllComponents ( name, query ) {\n  \tvar this$1 = this;\n\n  \t\tif ( this.items ) {\n  \t\tvar len = this.items.length;\n  \t\tvar i;\n\n  \t\tfor ( i = 0; i < len; i += 1 ) {\n  \t\t\tvar item = this$1.items[i];\n\n  \t\t\tif ( item.findAllComponents ) {\n  \t\t\t\titem.findAllComponents( name, query );\n  \t\t\t}\n  \t\t}\n  \t}\n\n  \treturn query;\n  };\n\n  Fragment.prototype.findContext = function findContext () {\n  \tvar fragment = this;\n  \twhile ( !fragment.context ) fragment = fragment.parent;\n  \treturn fragment.context;\n  };\n\n  Fragment.prototype.findNextNode = function findNextNode ( item ) {\n  \t// search for the next node going forward\n  \tvar this$1 = this;\n\n  \t\tfor ( var i = item.index + 1; i < this$1.items.length; i++ ) {\n  \t\tif ( !this$1.items[ i ] ) continue;\n\n  \t\tvar node = this$1.items[ i ].firstNode( true );\n  \t\tif ( node ) return node;\n  \t}\n\n  \t// if this is the root fragment, and there are no more items,\n  \t// it means we're at the end...\n  \tif ( this.isRoot ) {\n  \t\tif ( this.ractive.component ) {\n  \t\t\treturn this.ractive.component.parentFragment.findNextNode( this.ractive.component );\n  \t\t}\n\n  \t\t// TODO possible edge case with other content\n  \t\t// appended to this.ractive.el?\n  \t\treturn null;\n  \t}\n\n  \treturn this.owner.findNextNode( this ); // the argument is in case the parent is a RepeatedFragment\n  };\n\n  Fragment.prototype.findParentNode = function findParentNode () {\n  \tvar fragment = this;\n\n  \tdo {\n  \t\tif ( fragment.owner.type === ELEMENT ) {\n  \t\t\treturn fragment.owner.node;\n  \t\t}\n\n  \t\tif ( fragment.isRoot && !fragment.ractive.component ) { // TODO encapsulate check\n  \t\t\treturn fragment.ractive.el;\n  \t\t}\n\n  \t\tif ( fragment.owner.type === YIELDER ) {\n  \t\t\tfragment = fragment.owner.containerFragment;\n  \t\t} else {\n  \t\t\tfragment = fragment.componentParent || fragment.parent; // TODO ugh\n  \t\t}\n  \t} while ( fragment );\n\n  \tthrow new Error( 'Could not find parent node' ); // TODO link to issue tracker\n  };\n\n  Fragment.prototype.findRepeatingFragment = function findRepeatingFragment () {\n  \tvar fragment = this;\n  \t// TODO better check than fragment.parent.iterations\n  \twhile ( fragment.parent && !fragment.isIteration ) {\n  \t\tfragment = fragment.parent || fragment.componentParent;\n  \t}\n\n  \treturn fragment;\n  };\n\n  Fragment.prototype.firstNode = function firstNode ( skipParent ) {\n  \tvar this$1 = this;\n\n  \t\tvar node;\n  \tfor ( var i = 0; i < this$1.items.length; i++ ) {\n  \t\tnode = this$1.items[i].firstNode( true );\n\n  \t\tif ( node ) {\n  \t\t\treturn node;\n  \t\t}\n  \t}\n\n  \tif ( skipParent ) return null;\n\n  \treturn this.parent.findNextNode( this.owner );\n  };\n\n  // TODO ideally, this would be deprecated in favour of an\n  // expression-like approach\n  Fragment.prototype.getArgsList = function getArgsList () {\n  \tif ( this.dirtyArgs ) {\n  \t\tvar values = {};\n  \t\tvar source = processItems( this.items, values, this.ractive._guid );\n  \t\tvar parsed = parseJSON( '[' + source + ']', values );\n\n  \t\tthis.argsList = parsed ?\n  \t\t\tparsed.value :\n  \t\t\t[ this.toString() ];\n\n  \t\tthis.dirtyArgs = false;\n  \t}\n\n  \treturn this.argsList;\n  };\n\n  Fragment.prototype.rebind = function rebind$1 ( context ) {\n  \tthis.context = context;\n\n  \tthis.items.forEach( rebind );\n  };\n\n  Fragment.prototype.render = function render ( target, occupants ) {\n  \tif ( this.rendered ) throw new Error( 'Fragment is already rendered!' );\n  \tthis.rendered = true;\n\n  \tthis.items.forEach( function ( item ) { return item.render( target, occupants ); } );\n  };\n\n  Fragment.prototype.resetTemplate = function resetTemplate ( template ) {\n  \tvar wasBound = this.bound;\n  \tvar wasRendered = this.rendered;\n\n  \t// TODO ensure transitions are disabled globally during reset\n\n  \tif ( wasBound ) {\n  \t\tif ( wasRendered ) this.unrender( true );\n  \t\tthis.unbind();\n  \t}\n\n  \tthis.template = template;\n  \tthis.createItems();\n\n  \tif ( wasBound ) {\n  \t\tthis.bind( this.context );\n\n  \t\tif ( wasRendered ) {\n  \t\t\tvar parentNode = this.findParentNode();\n  \t\t\tvar anchor = this.parent ? this.parent.findNextNode( this.owner ) : null;\n\n  \t\t\tif ( anchor ) {\n  \t\t\t\tvar docFrag = createDocumentFragment();\n  \t\t\t\tthis.render( docFrag );\n  \t\t\t\tparentNode.insertBefore( docFrag, anchor );\n  \t\t\t} else {\n  \t\t\t\tthis.render( parentNode );\n  \t\t\t}\n  \t\t}\n  \t}\n  };\n\n  Fragment.prototype.resolve = function resolve ( template, callback ) {\n  \tif ( !this.context ) {\n  \t\treturn this.parent.resolve( template, callback );\n  \t}\n\n  \tvar resolver = new ReferenceResolver( this, template, callback );\n  \tthis.resolvers.push( resolver );\n\n  \treturn resolver; // so we can e.g. force resolution\n  };\n\n  Fragment.prototype.toHtml = function toHtml () {\n  \treturn this.toString();\n  };\n\n  Fragment.prototype.toString = function toString$1$$ ( escape ) {\n  \treturn this.items.map( escape ? toEscapedString : toString$1 ).join( '' );\n  };\n\n  Fragment.prototype.unbind = function unbind$1 () {\n  \tthis.items.forEach( unbind );\n  \tthis.bound = false;\n\n  \treturn this;\n  };\n\n  Fragment.prototype.unrender = function unrender$1 ( shouldDestroy ) {\n  \tthis.items.forEach( shouldDestroy ? unrenderAndDestroy$1 : unrender );\n  \tthis.rendered = false;\n  };\n\n  Fragment.prototype.update = function update$1 () {\n  \tif ( this.dirty && !this.updating ) {\n  \t\tthis.dirty = false;\n  \t\tthis.updating = true;\n  \t\tthis.items.forEach( update );\n  \t\tthis.updating = false;\n  \t}\n  };\n\n  Fragment.prototype.valueOf = function valueOf () {\n  \tif ( this.items.length === 1 ) {\n  \t\treturn this.items[0].valueOf();\n  \t}\n\n  \tif ( this.dirtyValue ) {\n  \t\tvar values = {};\n  \t\tvar source = processItems( this.items, values, this.ractive._guid );\n  \t\tvar parsed = parseJSON( source, values );\n\n  \t\tthis.value = parsed ?\n  \t\t\tparsed.value :\n  \t\t\tthis.toString();\n\n  \t\tthis.dirtyValue = false;\n  \t}\n\n  \treturn this.value;\n  };\n\n  // TODO should resetTemplate be asynchronous? i.e. should it be a case\n  // of outro, update template, intro? I reckon probably not, since that\n  // could be achieved with unrender-resetTemplate-render. Also, it should\n  // conceptually be similar to resetPartial, which couldn't be async\n\n  function Ractive$resetTemplate ( template ) {\n  \ttemplateConfigurator.init( null, this, { template: template });\n\n  \tvar transitionsEnabled = this.transitionsEnabled;\n  \tthis.transitionsEnabled = false;\n\n  \t// Is this is a component, we need to set the `shouldDestroy`\n  \t// flag, otherwise it will assume by default that a parent node\n  \t// will be detached, and therefore it doesn't need to bother\n  \t// detaching its own nodes\n  \tvar component = this.component;\n  \tif ( component ) component.shouldDestroy = true;\n  \tthis.unrender();\n  \tif ( component ) component.shouldDestroy = false;\n\n  \t// remove existing fragment and create new one\n  \tthis.fragment.unbind().unrender( true );\n\n  \tthis.fragment = new Fragment({\n  \t\ttemplate: this.template,\n  \t\troot: this,\n  \t\towner: this\n  \t});\n\n  \tvar docFrag = createDocumentFragment();\n  \tthis.fragment.bind( this.viewmodel ).render( docFrag );\n  \tthis.el.insertBefore( docFrag, this.anchor );\n\n  \tthis.transitionsEnabled = transitionsEnabled;\n  }\n\n  var reverse = makeArrayMethod( 'reverse' );\n\n  function Ractive$set ( keypath, value ) {\n  \tvar promise = runloop.start( this, true );\n\n  \t// Set multiple keypaths in one go\n  \tif ( isObject( keypath ) ) {\n  \t\tvar map = keypath;\n\n  \t\tfor ( var k in map ) {\n  \t\t\tif ( map.hasOwnProperty( k) ) {\n  \t\t\t\tset( this, k, map[k] );\n  \t\t\t}\n  \t\t}\n  \t}\n  \t// Set a single keypath\n  \telse {\n  \t\tset( this, keypath, value );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n\n  function set ( ractive, keypath, value ) {\n  \tif ( typeof value === 'function' ) value = bind$1( value, ractive );\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tractive.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tmodel.set( value );\n  \t\t});\n  \t} else {\n  \t\tvar model = ractive.viewmodel.joinAll( splitKeypathI( keypath ) );\n  \t\tmodel.set( value );\n  \t}\n  }\n\n  var shift = makeArrayMethod( 'shift' );\n\n  var sort = makeArrayMethod( 'sort' );\n\n  var splice = makeArrayMethod( 'splice' );\n\n  function Ractive$subtract ( keypath, d ) {\n  \treturn add( this, keypath, ( d === undefined ? -1 : -d ) );\n  }\n\n  var teardownHook$1 = new Hook( 'teardown' );\n\n  // Teardown. This goes through the root fragment and all its children, removing observers\n  // and generally cleaning up after itself\n\n  function Ractive$teardown () {\n  \tvar this$1 = this;\n\n  \tthis.fragment.unbind();\n  \tthis.viewmodel.teardown();\n\n  \tthis._observers.forEach( cancel );\n\n  \tif ( this.fragment.rendered && this.el.__ractive_instances__ ) {\n  \t\tremoveFromArray( this.el.__ractive_instances__, this );\n  \t}\n\n  \tthis.shouldDestroy = true;\n  \tvar promise = ( this.fragment.rendered ? this.unrender() : Promise$1.resolve() );\n\n  \tObject.keys( this._links ).forEach( function ( k ) { return this$1._links[k].unlink(); } );\n\n  \tteardownHook$1.fire( this );\n\n  \treturn promise;\n  }\n\n  function Ractive$toggle ( keypath ) {\n  \tif ( typeof keypath !== 'string' ) {\n  \t\tthrow new TypeError( badArguments );\n  \t}\n\n  \tvar changes;\n\n  \tif ( /\\*/.test( keypath ) ) {\n  \t\tchanges = {};\n\n  \t\tthis.viewmodel.findMatches( splitKeypathI( keypath ) ).forEach( function ( model ) {\n  \t\t\tchanges[ model.getKeypath() ] = !model.get();\n  \t\t});\n\n  \t\treturn this.set( changes );\n  \t}\n\n  \treturn this.set( keypath, !this.get( keypath ) );\n  }\n\n  function Ractive$toCSS() {\n  \tvar cssIds = [ this.cssId ].concat( this.findAllComponents().map( function ( c ) { return c.cssId; } ) );\n  \tvar uniqueCssIds = Object.keys(cssIds.reduce( function ( ids, id ) { return (ids[id] = true, ids); }, {}));\n  \treturn getCSS( uniqueCssIds );\n  }\n\n  function Ractive$toHTML () {\n  \treturn this.fragment.toString( true );\n  }\n\n  function Ractive$transition ( name, node, params ) {\n\n  \tif ( node instanceof HTMLElement ) {\n  \t\t// good to go\n  \t}\n  \telse if ( isObject( node ) ) {\n  \t\t// omitted, use event node\n  \t\tparams = node;\n  \t}\n\n  \t// if we allow query selector, then it won't work\n  \t// simple params like \"fast\"\n\n  \t// else if ( typeof node === 'string' ) {\n  \t// \t// query selector\n  \t// \tnode = this.find( node )\n  \t// }\n\n  \tnode = node || this.event.node;\n\n  \tif ( !node ) {\n  \t\tfatal( (\"No node was supplied for transition \" + name) );\n  \t}\n\n  \tvar transition = new Transition( this, node, name, params );\n  \tvar promise = runloop.start( this, true );\n  \trunloop.registerTransition( transition );\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  function unlink( here ) {\n  \tvar ln = this._links[ here ];\n\n  \tif ( ln ) {\n  \t\tln.unlink();\n  \t\tdelete this._links[ here ];\n  \t\treturn this.set( here, ln.intialValue );\n  \t} else {\n  \t\treturn Promise$1.resolve( true );\n  \t}\n  }\n\n  var unrenderHook$1 = new Hook( 'unrender' );\n\n  function Ractive$unrender () {\n  \tif ( !this.fragment.rendered ) {\n  \t\twarnIfDebug( 'ractive.unrender() was called on a Ractive instance that was not rendered' );\n  \t\treturn Promise$1.resolve();\n  \t}\n\n  \tvar promise = runloop.start( this, true );\n\n  \t// If this is a component, and the component isn't marked for destruction,\n  \t// don't detach nodes from the DOM unnecessarily\n  \tvar shouldDestroy = !this.component || this.component.shouldDestroy || this.shouldDestroy;\n  \tthis.fragment.unrender( shouldDestroy );\n\n  \tremoveFromArray( this.el.__ractive_instances__, this );\n\n  \tunrenderHook$1.fire( this );\n\n  \trunloop.end();\n  \treturn promise;\n  }\n\n  var unshift = makeArrayMethod( 'unshift' );\n\n  var updateHook = new Hook( 'update' );\n\n  function Ractive$update ( keypath ) {\n  \tif ( keypath ) keypath = splitKeypathI( keypath );\n\n  \tvar model = keypath ?\n  \t\tthis.viewmodel.joinAll( keypath ) :\n  \t\tthis.viewmodel;\n\n  \tif ( model.parent && model.parent.wrapper ) return this.update( model.parent.getKeypath( this ) );\n\n  \tvar promise = runloop.start( this, true );\n\n  \tmodel.mark();\n  \tmodel.registerChange( model.getKeypath(), model.retrieve() );\n\n  \tif ( keypath ) {\n  \t\t// there may be unresolved refs that are now resolvable up the context tree\n  \t\tvar parent = model.parent;\n  \t\twhile ( keypath.length && parent ) {\n  \t\t\tif ( parent.clearUnresolveds ) parent.clearUnresolveds( keypath.pop() );\n  \t\t\tparent = parent.parent;\n  \t\t}\n  \t}\n\n  \t// notify upstream of changes\n  \tmodel.notifyUpstream();\n\n  \trunloop.end();\n\n  \tupdateHook.fire( this, model );\n\n  \treturn promise;\n  }\n\n  function Ractive$updateModel ( keypath, cascade ) {\n  \tvar promise = runloop.start( this, true );\n\n  \tif ( !keypath ) {\n  \t\tthis.viewmodel.updateFromBindings( true );\n  \t} else {\n  \t\tthis.viewmodel.joinAll( splitKeypathI( keypath ) ).updateFromBindings( cascade !== false );\n  \t}\n\n  \trunloop.end();\n\n  \treturn promise;\n  }\n\n  var proto = {\n  \tadd: Ractive$add,\n  \tanimate: Ractive$animate,\n  \tdetach: Ractive$detach,\n  \tfind: Ractive$find,\n  \tfindAll: Ractive$findAll,\n  \tfindAllComponents: Ractive$findAllComponents,\n  \tfindComponent: Ractive$findComponent,\n  \tfindContainer: Ractive$findContainer,\n  \tfindParent: Ractive$findParent,\n  \tfire: Ractive$fire,\n  \tget: Ractive$get,\n  \tinsert: Ractive$insert,\n  \tlink: link,\n  \tmerge: Ractive$merge,\n  \tobserve: observe,\n  \tobserveList: observeList,\n  \tobserveOnce: observeOnce,\n  \t// TODO reinstate these\n  \t// observeListOnce,\n  \toff: Ractive$off,\n  \ton: Ractive$on,\n  \tonce: Ractive$once,\n  \tpop: pop,\n  \tpush: push,\n  \trender: Ractive$render,\n  \treset: Ractive$reset,\n  \tresetPartial: resetPartial,\n  \tresetTemplate: Ractive$resetTemplate,\n  \treverse: reverse,\n  \tset: Ractive$set,\n  \tshift: shift,\n  \tsort: sort,\n  \tsplice: splice,\n  \tsubtract: Ractive$subtract,\n  \tteardown: Ractive$teardown,\n  \ttoggle: Ractive$toggle,\n  \ttoCSS: Ractive$toCSS,\n  \ttoCss: Ractive$toCSS,\n  \ttoHTML: Ractive$toHTML,\n  \ttoHtml: Ractive$toHTML,\n  \ttransition: Ractive$transition,\n  \tunlink: unlink,\n  \tunrender: Ractive$unrender,\n  \tunshift: unshift,\n  \tupdate: Ractive$update,\n  \tupdateModel: Ractive$updateModel\n  };\n\n  function wrap$1 ( method, superMethod, force ) {\n\n  \tif ( force || needsSuper( method, superMethod ) )  {\n\n  \t\treturn function () {\n\n  \t\t\tvar hasSuper = ( '_super' in this ), _super = this._super, result;\n\n  \t\t\tthis._super = superMethod;\n\n  \t\t\tresult = method.apply( this, arguments );\n\n  \t\t\tif ( hasSuper ) {\n  \t\t\t\tthis._super = _super;\n  \t\t\t}\n\n  \t\t\treturn result;\n  \t\t};\n  \t}\n\n  \telse {\n  \t\treturn method;\n  \t}\n  }\n\n  function needsSuper ( method, superMethod ) {\n  \treturn typeof superMethod === 'function' && /_super/.test( method );\n  }\n\n  function unwrap ( Child ) {\n  \tvar options = {};\n\n  \twhile ( Child ) {\n  \t\taddRegistries( Child, options );\n  \t\taddOtherOptions( Child, options );\n\n  \t\tif ( Child._Parent !== Ractive ) {\n  \t\t\tChild = Child._Parent;\n  \t\t} else {\n  \t\t\tChild = false;\n  \t\t}\n  \t}\n\n  \treturn options;\n  }\n\n  function addRegistries ( Child, options ) {\n  \tregistries.forEach( function ( r ) {\n  \t\taddRegistry(\n  \t\t\tr.useDefaults ? Child.prototype : Child,\n  \t\t\toptions, r.name );\n  \t});\n  }\n\n  function addRegistry ( target, options, name ) {\n  \tvar registry, keys = Object.keys( target[ name ] );\n\n  \tif ( !keys.length ) { return; }\n\n  \tif ( !( registry = options[ name ] ) ) {\n  \t\tregistry = options[ name ] = {};\n  \t}\n\n  \tkeys\n  \t\t.filter( function ( key ) { return !( key in registry ); } )\n  \t\t.forEach( function ( key ) { return registry[ key ] = target[ name ][ key ]; } );\n  }\n\n  function addOtherOptions ( Child, options ) {\n  \tObject.keys( Child.prototype ).forEach( function ( key ) {\n  \t\tif ( key === 'computed' ) { return; }\n\n  \t\tvar value = Child.prototype[ key ];\n\n  \t\tif ( !( key in options ) ) {\n  \t\t\toptions[ key ] = value._method ? value._method : value;\n  \t\t}\n\n  \t\t// is it a wrapped function?\n  \t\telse if ( typeof options[ key ] === 'function'\n  \t\t\t\t&& typeof value === 'function'\n  \t\t\t\t&& options[ key ]._method ) {\n\n  \t\t\tvar result, needsSuper = value._method;\n\n  \t\t\tif ( needsSuper ) { value = value._method; }\n\n  \t\t\t// rewrap bound directly to parent fn\n  \t\t\tresult = wrap$1( options[ key ]._method, value );\n\n  \t\t\tif ( needsSuper ) { result._method = result; }\n\n  \t\t\toptions[ key ] = result;\n  \t\t}\n  \t});\n  }\n\n  function extend () {\n  \tvar options = [], len = arguments.length;\n  \twhile ( len-- ) options[ len ] = arguments[ len ];\n\n  \tif( !options.length ) {\n  \t\treturn extendOne( this );\n  \t} else {\n  \t\treturn options.reduce( extendOne, this );\n  \t}\n  }\n\n  function extendOne ( Parent, options ) {\n  \tif ( options === void 0 ) options = {};\n\n  \tvar Child, proto;\n\n  \t// if we're extending with another Ractive instance...\n  \t//\n  \t//   var Human = Ractive.extend(...), Spider = Ractive.extend(...);\n  \t//   var Spiderman = Human.extend( Spider );\n  \t//\n  \t// ...inherit prototype methods and default options as well\n  \tif ( options.prototype instanceof Ractive ) {\n  \t\toptions = unwrap( options );\n  \t}\n\n  \tChild = function ( options ) {\n  \t\tif ( !( this instanceof Child ) ) return new Child( options );\n\n  \t\tconstruct( this, options || {} );\n  \t\tinitialise( this, options || {}, {} );\n  \t};\n\n  \tproto = create( Parent.prototype );\n  \tproto.constructor = Child;\n\n  \t// Static properties\n  \tdefineProperties( Child, {\n  \t\t// alias prototype as defaults\n  \t\tdefaults: { value: proto },\n\n  \t\t// extendable\n  \t\textend: { value: extend, writable: true, configurable: true },\n\n  \t\t// Parent - for IE8, can't use Object.getPrototypeOf\n  \t\t_Parent: { value: Parent }\n  \t});\n\n  \t// extend configuration\n  \tconfig.extend( Parent, proto, options );\n\n  \tdataConfigurator.extend( Parent, proto, options );\n\n  \tif ( options.computed ) {\n  \t\tproto.computed = extendObj( create( Parent.prototype.computed ), options.computed );\n  \t}\n\n  \tChild.prototype = proto;\n\n  \treturn Child;\n  }\n\n  function getNodeInfo( node ) {\n  \tif ( !node || !node._ractive ) return {};\n\n  \tvar storage = node._ractive;\n  \tvar ractive = storage.fragment.ractive;\n  \tvar ref = gatherRefs( storage.fragment ), key = ref.key, index = ref.index;\n  \tvar context = storage.fragment.findContext();\n\n  \treturn {\n  \t\tractive: ractive,\n  \t\tkeypath: context.getKeypath( ractive ),\n  \t\trootpath: context.getKeypath(),\n  \t\tindex: index,\n  \t\tkey: key\n  \t};\n  }\n\n  function joinKeys () {\n  \tvar keys = [], len = arguments.length;\n  \twhile ( len-- ) keys[ len ] = arguments[ len ];\n\n  \treturn keys.map( escapeKey ).join( '.' );\n  }\n\n  function splitKeypath ( keypath ) {\n  \treturn splitKeypathI( keypath ).map( unescapeKey );\n  }\n\n  // Ractive.js makes liberal use of things like Array.prototype.indexOf. In\n  // older browsers, these are made available via a shim - here, we do a quick\n  // pre-flight check to make sure that either a) we're not in a shit browser,\n  // or b) we're using a Ractive-legacy.js build\n  var FUNCTION = 'function';\n\n  if (\n  \ttypeof Date.now !== FUNCTION                 ||\n  \ttypeof String.prototype.trim !== FUNCTION    ||\n  \ttypeof Object.keys !== FUNCTION              ||\n  \ttypeof Array.prototype.indexOf !== FUNCTION  ||\n  \ttypeof Array.prototype.forEach !== FUNCTION  ||\n  \ttypeof Array.prototype.map !== FUNCTION      ||\n  \ttypeof Array.prototype.filter !== FUNCTION   ||\n  \t( win && typeof win.addEventListener !== FUNCTION )\n  ) {\n  \tthrow new Error( 'It looks like you\\'re attempting to use Ractive.js in an older browser. You\\'ll need to use one of the \\'legacy builds\\' in order to continue - see http://docs.ractivejs.org/latest/legacy-builds for more information.' );\n  }\n\n  function Ractive ( options ) {\n  \tif ( !( this instanceof Ractive ) ) return new Ractive( options );\n\n  \tconstruct( this, options || {} );\n  \tinitialise( this, options || {}, {} );\n  }\n\n  extendObj( Ractive.prototype, proto, defaults );\n  Ractive.prototype.constructor = Ractive;\n\n  // alias prototype as `defaults`\n  Ractive.defaults = Ractive.prototype;\n\n  // static properties\n  defineProperties( Ractive, {\n\n  \t// debug flag\n  \tDEBUG:          { writable: true, value: true },\n  \tDEBUG_PROMISES: { writable: true, value: true },\n\n  \t// static methods:\n  \textend:         { value: extend },\n  \tescapeKey:      { value: escapeKey },\n  \tgetNodeInfo:    { value: getNodeInfo },\n  \tjoinKeys:       { value: joinKeys },\n  \tparse:          { value: parse },\n  \tsplitKeypath:   { value: splitKeypath },\n  \tunescapeKey:    { value: unescapeKey },\n  \tgetCSS:         { value: getCSS },\n\n  \t// namespaced constructors\n  \tPromise:        { value: Promise$1 },\n\n  \t// support\n  \tenhance:        { writable: true, value: false },\n  \tsvg:            { value: svg },\n  \tmagic:          { value: magicSupported },\n\n  \t// version\n  \tVERSION:        { value: '0.8.0-edge' },\n\n  \t// plugins\n  \tadaptors:       { writable: true, value: {} },\n  \tcomponents:     { writable: true, value: {} },\n  \tdecorators:     { writable: true, value: {} },\n  \teasing:         { writable: true, value: easing },\n  \tevents:         { writable: true, value: {} },\n  \tinterpolators:  { writable: true, value: interpolators },\n  \tpartials:       { writable: true, value: {} },\n  \ttransitions:    { writable: true, value: {} }\n  });\n\n  return Ractive;\n\n}));"],"names":["Fragment","prototype","firstNode","skipParent","node","this$1","this","i","items","length","parent","findNextNode","owner","getArgsList","dirtyArgs","values","source","processItems","ractive","_guid","parsed","parseJSON","argsList","value","toString","rebind","context","forEach","render","target","occupants","rendered","Error","item","resetTemplate","template","wasBound","bound","wasRendered","unrender","unbind","createItems","bind","parentNode","findParentNode","anchor","docFrag","createDocumentFragment","insertBefore","resolve","callback","resolver","ReferenceResolver","resolvers","push","toHtml","escape","map","toEscapedString","toString$1","join","shouldDestroy","unrenderAndDestroy$1","update","dirty","updating","valueOf","dirtyValue","reverse","makeArrayMethod","shift","sort","splice","teardownHook$1","Hook","unrenderHook$1","unshift","updateHook","proto","add","Ractive$add","animate","Ractive$animate","detach","Ractive$detach","find","Ractive$find","findAll","Ractive$findAll","findAllComponents","Ractive$findAllComponents","findComponent","Ractive$findComponent","findContainer","Ractive$findContainer","findParent","Ractive$findParent","fire","Ractive$fire","get","Ractive$get","insert","Ractive$insert","link","merge","Ractive$merge","observe","observeList","observeOnce","off","Ractive$off","on","Ractive$on","once","Ractive$once","pop","Ractive$render","reset","Ractive$reset","resetPartial","Ractive$resetTemplate","set","Ractive$set","subtract","Ractive$subtract","teardown","Ractive$teardown","toggle","Ractive$toggle","toCSS","Ractive$toCSS","toCss","toHTML","Ractive$toHTML","transition","Ractive$transition","unlink","Ractive$unrender","Ractive$update","updateModel","Ractive$updateModel","FUNCTION","Date","now","String","trim","Object","keys","Array","indexOf","filter","win","addEventListener","extendObj","Ractive","defaults","constructor","defineProperties","DEBUG","writable","DEBUG_PROMISES","extend","escapeKey","getNodeInfo","joinKeys","parse","splitKeypath","unescapeKey","getCSS","Promise","Promise$1","enhance","svg","magic","magicSupported","VERSION","adaptors","components","decorators","easing","events","interpolators","partials","transitions","model","checked","RadioBinding","removeFromArray","siblings","removeEventListener","handleDomEvent","Binding","RadioNameBinding","element","call","group","getBindingGroup","getValue$2","getValue","create","nameAttributeBinding","handleChange","name","getKeypath","getKeypathModel","register","getInitialValue","getAttribute","attachEvent","setFromNode","remove","unregister","SingleSelectBinding","apply","arguments","forceUpdate","undefined","attribute","locked","runloop","scheduleTask","options","len","optionWasSelected","option","attributeByName","selected","disabled","_ractive","getSelectedOptions","setValue","Element","Item","liveQueries","e","toLowerCase","isVoid","voidElementNames","test","fragment","parentFragment","type","ELEMENT","attributes","a","Attribute","conditionalAttributes","m","ConditionalAttribute","o","decorator","Decorator","eventHandlers","v","key","eventNames","split","eventName","fn","findInViewHierarchy","event","CustomEvent","DOMEvent","EventDirective","f","noContent","cssIds","binding","createTwowayBinding","shouldBind","twoway","selectBinding","detachNode","selector","matches","query","live","makeDirty$1","namespace","getNamespace","existing","n","nodeName","toUpperCase","namespaceURI","createElement","defineProperty","proxy","setAttribute","x","foundNode","children","toArray","childNodes","wasUndefined","removeAttribute","updateLiveQueries$1","_introTransition","getTransition","t0","t1","appendChild","tagName","attrs","stringifyAttribute","isSelected","inputIsCheckedRadio","str","escapeHtml","complete","detachWhenReady","t2","id","nodes","removeFromLiveQueries","Form","formBindings","handleReset","Mustache","index","isStatic","s","resolve$1","r","bubble","Interpolator","getString","safeToStringValue","nodeType","nodeValue","doc","createTextNode","string","data","Input","defaultValue","Option","select","findParentSelect","selectedAttribute","optionValue","selectValue","isArray","Partial","refName","templateObj","getPartialTemplate","named","setTemplate","t","parsePartial","partialTemplate","forceResetTemplate","warnOnceIfDebug","RepeatedFragment","iterations","indexRef","keyRef","pendingNewIndices","previousIterations","createIteration","isObject","refs","isIteration","joinKey","z","aliases","found","iteration","shuffle","newIndices","slice","newIndex","oldIndex","unrenderAndDestroy","updatePostShuffle","toRemove","oldKeys","wasArray","fragment$1","newLength","indices","maxIdx","merged","frag","frag$1","ieBug","ieBlacklist","Section","sectionType","templateSectionType","SECTION_UNLESS","SECTION_IF","SECTION_EACH","isRoot","lastType","getType","newFragment","SECTION_WITH","SECTION_IF_WITH","isEmpty","fragmentShouldExist","Select","selectedOptions","sync","defaultSelected","selectNode","isMultiple","shouldSelect","valueContains","Textarea","isBindable","Text","TEXT","elementCache","innerHTML","err","TABLE","THEAD","TBODY","TR","SELECT","Triple","queryResult","querySelector","queryAllResult","querySelectorAll","j","numNodes","html","insertHtml","decodeCharacterReferences","Yielder","container","component","containerFragment","yielders","_inlinePartials","warnIfDebug","constructors","ALIAS","Alias","DOCTYPE","Doctype","INTERPOLATOR","PARTIAL","SECTION","TRIPLE","YIELDER","specialElements","doctype","form","input","textarea","reference","normalise","splitKeypathI","resolved","addUnresolved","componentParent","attemptResolution","resolveAmbiguousReference","forceResolution","findContext","joinAll","unresolved","addFragment","createItem","el","findRepeatingFragment","number","parser","stringLiteral","readStringLiteral","replace","placeholderPattern","match","$1","matchString","result","allowWhitespace","pair","getKeyValuePair","valueToken","read","eventPattern","argumentsPattern","dollarArgsPattern","passthru","method","models","argsFn","action","args","g","ref","noop","argMatch","exec","argument","dollarMatch","resolveReference","getFunction","d","passedArgs","gatherRefs","keypath","rootpath","obj","wrapper","concat","oldEvent","original","preventDefault","stopPropagation","args$1","fireEvent","listen","unlisten","RactiveEvent","handler","directive","cancel","teardownHook","Component","ComponentConstructor","COMPONENT","instance","complexMappings","p","content","_partials","root","construct","setupEvents","viewmodel","childData","localKey","initialise","checkYielders","end","makeDirty","mappings","render$1","updateLiveQueries","handlers","_observers","removeFromLiveComponentQueries","__ractive_instances__","_links","k","space","specials$1","float","textTypes","camelize","propertyNames","accept-charset","accesskey","bgcolor","class","codebase","colspan","contenteditable","datetime","dirname","for","http-equiv","ismap","maxlength","novalidate","pubdate","readonly","rowspan","tabindex","usemap","booleanAttributes","htmlEntities","quot","amp","apos","lt","gt","nbsp","iexcl","cent","pound","curren","yen","brvbar","sect","uml","copy","ordf","laquo","not","shy","reg","macr","deg","plusmn","sup2","sup3","acute","micro","para","middot","cedil","sup1","ordm","raquo","frac14","frac12","frac34","iquest","Agrave","Aacute","Acirc","Atilde","Auml","Aring","AElig","Ccedil","Egrave","Eacute","Ecirc","Euml","Igrave","Iacute","Icirc","Iuml","ETH","Ntilde","Ograve","Oacute","Ocirc","Otilde","Ouml","times","Oslash","Ugrave","Uacute","Ucirc","Uuml","Yacute","THORN","szlig","agrave","aacute","acirc","atilde","auml","aring","aelig","ccedil","egrave","eacute","ecirc","euml","igrave","iacute","icirc","iuml","eth","ntilde","ograve","oacute","ocirc","otilde","ouml","divide","oslash","ugrave","uacute","ucirc","uuml","yacute","thorn","yuml","OElig","oelig","Scaron","scaron","Yuml","fnof","circ","tilde","Alpha","Beta","Gamma","Delta","Epsilon","Zeta","Eta","Theta","Iota","Kappa","Lambda","Mu","Nu","Xi","Omicron","Pi","Rho","Sigma","Tau","Upsilon","Phi","Chi","Psi","Omega","alpha","beta","gamma","delta","epsilon","zeta","eta","theta","iota","kappa","lambda","mu","nu","xi","omicron","pi","rho","sigmaf","sigma","tau","upsilon","phi","chi","psi","omega","thetasym","upsih","piv","ensp","emsp","thinsp","zwnj","zwj","lrm","rlm","ndash","mdash","lsquo","rsquo","sbquo","ldquo","rdquo","bdquo","dagger","Dagger","bull","hellip","permil","prime","Prime","lsaquo","rsaquo","oline","frasl","euro","image","weierp","real","trade","alefsym","larr","uarr","rarr","darr","harr","crarr","lArr","uArr","rArr","dArr","hArr","forall","part","exist","empty","nabla","isin","notin","ni","prod","sum","minus","lowast","radic","prop","infin","ang","and","or","cap","cup","int","there4","sim","cong","asymp","ne","equiv","le","ge","sub","sup","nsub","sube","supe","oplus","otimes","perp","sdot","lceil","rceil","lfloor","rfloor","lang","rang","loz","spades","clubs","hearts","diams","controlCharacters","entityPattern","RegExp","codePointSupport","fromCodePoint","codeToChar","fromCharCode","lessThan","greaterThan","invalid","updateDelegate","interpolator","namespaces","propertyName","useProperty","isTwoway","isBoolean","lookupNamespace","getUpdateDelegate","div$1","isSvg","svg$1","parseAttributes","notIn","missingDecorator","dynamicName","dynamicArgs","nameFragment","argsFragment","intermediary","warnOnce","missingPlugin","nameChanged","fatal","eventPlugin","prefix","isClient","prefixCache","testStyle","style","camelCase","capped","charAt","substring","vendors","vendor","visible","prefix$1","hidden","prefix$2","i$1","onChange","onHide","onShow","createTransitions","unprefixPattern","vendorPattern","TRANSITION","TRANSITIONEND","CSS_TRANSITIONS_ENABLED","TRANSITION_DURATION","TRANSITION_PROPERTY","TRANSITION_TIMING_FUNCTION","testStyle$1","linear$1","canUseCssTransitions","cannotUseCssTransitions","webkitTransition","to","changedProperties","setTimeout","checkComplete","jsTransitionsComplete","cssTransitionsComplete","isIntro","transitionEndHandler","unprefix","previous","property","duration","timing","hashPrefix","hyphenate","hash","originalValue","suffix","propertiesToTransitionInJs","getStyle","interpolate","parseFloat","Ticker","step","pos","delay","createTransitions$1","getComputedStyle","legacy","Transition","params","_fn","animateStyle","setStyle","fulfil","computedStyle","current","props","styles","value$1","processParams","hasOwnProperty","start","completed","originalStyle","noReset","resetStyle","_manager","promise","then","twowayBinding","isUnresolved","warnAboutAmbiguity","isReadonly","parentForm","findParentForm","resetValue","registerTwowayBinding","unregisterTwowayBinding","CheckboxBinding","BindingGroup","bindings","push$1","CheckboxNameBinding","checkboxName","getValue$1","noInitialValue","existingValue","bindingValue","arrayContains","changed","wasChecked","isChecked","valueSoFar","ContentEditableBinding","lazy","GenericBinding","timeout","isNumeric","handleDelay","handleBlur","MultipleSelectBinding","selectedValues","previousValue","arrayContentsMatch","initialValue","NumericBinding","isNaN","getSiblings","unresolvedByKey","Model","createBranch","branch","findMatches","existingMatches","loop","getValueChildren","shouldCapture","capture","getIndexModel","fragmentIndex","indexModels","KeyModel","getKeyModel","keypathModel","KeypathModel","mapped","keypathModels","child","addChild","originatingModel","has","hasProp","Function","childByKey","mark","retrieve","isEqual","old","rewrap","adapt","deps","clearUnresolveds","array","comparator","oldArray","newArray","oldLength","usedIndices","firstUnusedIndex","_merged","notifyUpstream","prev","patternObservers","notify","dep","registerChange","changes","addInstance","registerPatternObserver","observer","ticker","stop","applyValue","shuffled","updateKeypathDependants","dependant","unregisterPatternObserver","updateFromBindings","cascade","GlobalModel","global","window","GlobalModel$1","insertHook","Link","dest","LinkSide","side","comparators","Observer","oldValue","newValue","defer","strict","init","dispatch","addObserver","PatternObserver","baseModel","pattern","baseKeypath","oldValues","newValues","partial","newKeys","wildcards","base","max","touchedFrom","ok","ListObserver","pending","sliced","negativeOne","inserted","deleted","hadIndex","onceOptions","arrayProto","PREFIX","styleDefinitions","isDirty","styleElement","useCssText","getElementsByTagName","styleSheet","renderHook","completeHook","adaptConfigurator","Parent","combine","ensureArray","selectorsPattern","commentsPattern","selectorUnitPattern","excludePattern","dataRvcGuidPattern","cssConfigurator","css","uuid","noCssTransform","transformCss","cssId","addCSS","dataConfigurator","combine$1","bind$1","TEMPLATE_VERSION","functions","parseOptions","TEMPLATE_INSTRUCTIONS","COMPUTATION_INSTRUCTIONS","fromId","noThrow","getElementById","textContent","isParsed","getParseOptions","reduce","val","throwNoParse","addFunctions","parseFor","templateConfigurator","parseTemplate","getDynamicTemplate","_config","extendPartials","registryNames","Registry","useDefaults","configure","registry","isOwner","registries","custom","defaultKeys","isStandardKey","makeObj","isBlacklisted","order","config","c","shouldRerender","completeHook$1","resetHook","renderHook$1","unrenderHook","NUMBER_LITERAL","STRING_LITERAL","REFERENCE","ComputationChild","parentValue","ExpressionProxy","computation","signature","getter","getterString","compute","ReferenceExpressionChild","ReferenceExpressionProxy","baseResolver","members","resolveAliases","mutatorMethods","patchedArrayProto","methodName","getNewIndices","setting","wrappers","processWrapper","patchArrayMethods","unpatchArrayMethods","__proto__","configurable","unpatch","patch","errorMessage$1","arrayAdaptor","object","wrap","ArrayWrapper","__model","instances","storage","magicAdaptor","MagicWrapper","magicAdaptor$1","originalDescriptors","originalDescriptor","getOwnPropertyDescriptor","childKeypath","descriptor","createOrWrapDescriptor","__magic","revert","dependants","MagicArrayWrapper","magicWrapper","arrayWrapper","magicArrayAdaptor","Computation","isExpression","setter","computationContext","dependencies","boundsSensitive","startCapturing","message","hasConsole","console","groupCollapsed","functionBody","prettify","stack","getterUseStack","truncateStack","error","groupEnd","stopCapturing","setDependencies","model$1","computations","RactiveModel","hasProp$1","RootModel","applyChanges","_changeHash","flush","extendChildren","getRactiveModel","ractiveModel","origin","shouldTeardown","constructHook","registryNames$1","uid","HookQueue","hook","inProcess","queue","begin","getChildQueue","Parser","ParseError","configHook","initHook","leadingWhitespace","lineStart","lines","lineEnds","line","lineEnd","leftover","remaining","postProcess","converters","getLinePos","char","columnNum","lineNum","numTabs","annotation","character","shortMessage","substr","matchPattern","nextChar","Child","hasOwn","stringMiddlePattern","escapeSequencePattern","lineContinuationPattern","Parser$1","getSingleQuotedString","makeQuotedStringMatcher","getDoubleQuotedString","numberPattern$1","identifier","specials","true","false","null","specialsPattern","numberPattern","placeholderAtStartPattern","onlyWhitespace","JsonParser","placeholder","special","updateAttribute","updateNamespacedAttribute","setAttributeNS","entity","code","parseInt","validateCode","qualified","hasAttribute","haystack","needle","_liveQueries","description","all","b","res","clearTimeout","bindName","bindChecked","transitionsEnabled","getTransitionName","getTransitionParams","registerTransition","typeAttribute","valueAttribute","nameAttribute","xmlns","getPartialFromRegistry","fillGaps","findParentPartial","findInstance","noRegistryFunctionReturn","findOwner","findConstructor","_Parent","hasIndexRef","selectedOption","selectedIndex","firstChild","getComponentConstructor","ElementConstructor","guid","counter","placeholderId","TypeError","badArguments","uniqueCssIds","ids","HTMLElement","here","ln","intialValue","wrap$1","superMethod","force","needsSuper","hasSuper","_super","unwrap","addRegistries","addOtherOptions","addRegistry","_method","extendOne","computed","append","delimiters","tripleDelimiters","staticDelimiters","staticTripleDelimiters","csp","preserveWhitespace","sanitize","stripComments","modifyArrays","isolated","noIntro","linear","easeIn","Math","pow","easeOut","easeInOut","document","navigator","appName","warn","exportedShims","implementation","hasFeature","Temp","properties","freeze","hasDontEnumBug","propertyIsEnumerable","dontEnums","dontEnumsLength","mapper","isActuallyString","opt_initialValue","valueIsSet","filtered","every","iterator","Empty","ctx","Event","head","origCreateElement","appearsToBeIELessEqual8","currentTarget","srcElement","timeStamp","returnValue","cancelBubble","listener","listeners","detachEvent","getPixelSize","fontSize","sizeWithSuffix","size","getBorderPixelSize","parentElement","currentStyle","rootSize","clientWidth","clientHeight","div","bcr","borderSizes","display","position","width","height","borderRight","getBoundingClientRect","right","left","setShortStyleProperty","borderSuffix","l","CSSStyleDeclaration","normalProps","fontWeight","lineHeight","letterSpacing","getPropertyPriority","getPropertyValue","removeProperty","setProperty","getPropertyCSSValue","methodNames","unprefixed","prefixed","makeFunction","mathml","xlink","xml","ns","createElementNS","cloneNode","desc","F","log","printWarning","welcome","alreadyWarned","welcomeIntro","welcomeMessage","hasGroup","from","intermediate","min","snap","refPattern","splitPattern","escapeKeyPattern","unescapeKeyPattern","errorMessage","deprecations","deprecated","replacement","deprecate","arg","_Promise","PENDING","FULFILLED","REJECTED","dispatchHandlers","makeResolver","reject","fulfilledHandlers","rejectedHandlers","state","newState","makeDispatcher","wait","onFulfilled","onRejected","promise2","processResolutionHandler","forward","p1result","promises","processPromise","reason","TransitionManager","intros","outros","totalChildren","outroChildren","detachQueue","outrosComplete","list","decrementOutros","check","decrementTotal","detachNodes","_detachNodes","ready","batch","changeHook","returnPromise","fulfilPromise","previousBatch","transitionManager","fragments","tasks","immediateObservers","deferredObservers","ractives","flushChanges","addToArray","thing","task","postRender","_batch","noAnimation","detachHook","Query","isComponentQuery","_root","nodeOrComponent","sortByItemPosition","sortByDocumentPosition","captureGroup","requestAnimationFrame","starMaps","wildcardCache","lastTime","currTime","timeToCall","rAF","getTime","performance","tickers","running","tick","elapsed","eased","abort","prefixers","removeChild","adaptor","getPrefixer","previousOriginatingModel","specificKey","hasKey","factory","exports","module","define","amd","next","noConflict","getElement","output","sources","isFinite","format","logIfDebug","registryName","interpol","lastItem","member","arrayLike","called","resolvePromise","rejectPromise","y","tm","which","ractive$1","getOptions","isDetached","otherNode","compareDocumentPosition","bitmask","mutualAncestor","ancestryA","getAncestry","ancestryB","oldestA","oldestB","fragmentA","fragmentB","indexA","indexB","indexA$1","indexB$1","getParent","ancestry","ancestor","_liveComponentQueries","enqueue","_eventQueue","dequeue","getPotentialWildcardMatches","starMap","wildcardKeypath","getStarMap","star","num","binary","ones","digit","_noArg","getWildcardNames","fireEventAs","initialFire","subscribers","_subs","notifySubscribers","fullName","originalEvent","stopEvent","badReference","hasContextChain","crossedComponentBoundary","localViewmodel","prefixKeypath","rootKeypath","rootDot","relativeKeypath","repeater","parts","fireInsertHook","there","sourcePath","getComparator","JSON","stringify","compare","observers","createObserver","keypaths","wildcardIndex","notEmptyString","spliceArguments","removeStart","removeEnd","balance","getSpliceEquivalent","result$1","styleDefinition","applyCSS","cssText","filteredStyleDefinitions","others","trim$1","extractString","unit","transformSelector","selectorUnits","modifiers","transformed","appended","prepended","dataAttr","selectors","s4","floor","random","validate","childValue","parentIsFn","childIsFn","callDataFunction","fromProperties","primary","secondary","fromExpression","body","fromComputationString","bindTo","hasThis","createFunction","exp","instructions","createFunctionFromString","initial","parseAsString","validate$1","existingPartials","newPartials","overwrite","getSuperMethod","_parent","oldSuper","getMessage","correct","isError","deprecateOption","deprecatedOption","extendOtherMethods","rerender","collect","collection","rx","section","enumerable","fnBody","tabs","minIndent","Infinity","truncated","getComputationSignature","setterString","initialiseProperties","deprecateRactiveData","getAdaptors","combine$2","protoAdapt","lookup","hookQueue","childQueue","userOptions","okQuote","literal","done","charCodeAt","readNumberLiteral","readKey","token","hyphenatedStr","readStyle","rule","rules","readClass","updateId","updateMultipleSelectValue","updateSelectValue","updateStringValue","updateContentEditableValue","updateRadioValue","updateValue","updateRadioName","updateCheckboxName","updateStyleAttribute","updateInlineStyle","updateInlineClass","updateBoolean","updateClassName","styleName","attr","className","idx"],"mappings":"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KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,MAAO,IAAKC,QAAS,IAAKC,KAAM,IAAKC,IAAK,IAAKC,MAAO,IAAKC,KAAM,IAAKC,MAAO,IAAKC,OAAQ,IAAKC,GAAI,IAAKC,GAAI,IAAKC,GAAI,IAAKC,QAAS,IAAKC,GAAI,IAAKC,IAAK,IAAKC,OAAQ,IAAKC,MAAO,IAAKC,IAAK,IAAKC,QAAS,IAAKC,IAAK,IAAKC,IAAK,IAAKC,IAAK,IAAKC,MAAO,IAAKC,SAAU,IAAKC,MAAO,IAAKC,IAAK,IAAKC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,IAAK,KAAMC,IAAK,KAAMC,IAAK,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,OAAQ,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,QAAS,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,MAAO,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,KAAM,KAAMC,OAAQ,KAAMC,KAAM,KAAMC,MAAO,KAAMC,MAAO,KAAMC,MAAO,KAAMC,KAAM,KAAMC,MAAO,KAAMC,GAAI,KAAMC,KAAM,KAAMC,IAAK,KAAMC,MAAO,KAAMC,OAAQ,KAAMC,M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"}