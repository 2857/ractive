/*! Anglebars - v0.1.2 - 2012-11-23
* http://rich-harris.github.com/Anglebars/
* Copyright (c) 2012 Rich Harris; Licensed WTFPL */

/*jslint eqeq: true, plusplus: true */
/*global document, HTMLElement */

'use strict';


"use strict";var Anglebars=function(a){a=a||{},a.el!==undefined&&(this.el=Anglebars.utils.getEl(a.el)),a.compiled!==undefined&&(this.compiled=a.compiled),a.template!==undefined&&(this.template=a.template),a.partials!==undefined&&(this.partials=a.partials),this.viewmodel=a.data instanceof Anglebars.ViewModel?a.data:new Anglebars.ViewModel(a.data),a.formatters!==undefined&&(this.formatters=a.formatters),this.preserveWhitespace=a.preserveWhitespace===undefined?!1:a.preserveWhitespace,this.replaceSrcAttributes=a.replaceSrcAttributes===undefined?!0:a.replaceSrcAttributes,this.namespace=a.namespace?a.namespace:this.el&&this.el.namespaceURI!=="http://www.w3.org/1999/xhtml"?this.el.namespaceURI:null,!this.compiled&&this.template&&(this.compiled=Anglebars.compile(this.template,{preserveWhitespace:this.preserveWhitespace,replaceSrcAttributes:this.replaceSrcAttributes,namespace:this.namespace,partials:this.partials})),this.compiled&&this.el&&(this.el.innerHTML="",this.render())};Anglebars.prototype={render:function(a){a=a?Anglebars.utils.getEl(a):this.el;if(!a)throw new Error("You must specify a DOM element to render to");this.rendered=new Anglebars.DomViews.Fragment({model:this.compiled,anglebars:this,parentNode:a})},teardown:function(){this.rendered.teardown(),this.el.innerHTML=""},set:function(){return this.viewmodel.set.apply(this.viewmodel,arguments),this},get:function(){return this.viewmodel.get.apply(this.viewmodel,arguments)},update:function(){return this.viewmodel.update.apply(this.viewmodel,arguments),this},_format:function(a,b){var c,d,e,f,g;if(!b)return a;d=b.length;for(c=0;c<d;c+=1)e=b[c],f=e.name,g=e.args||[],this.formatters[f]&&(a=this.formatters[f].apply(this,[a].concat(g)));return a}},Anglebars.compile=function(a,b){var c,d,e=[],f,g,h=Anglebars.utils;return b=b||{},Anglebars.delimiters=b.delimiters||["{{","}}"],Anglebars.tripleDelimiters=b.tripleDelimiters||["{{{","}}}"],Anglebars.utils.compileMustachePattern(),a=h.preProcess(a),c=h.getNodeArrayFromHtml(a,b.replaceSrcAttributes===undefined?!0:b.replaceSrcAttributes),d=h.getStubsFromNodes(c),e=h.compileStubs(d,0,b.namespace,b.preserveWhitespace),e},Anglebars.patterns={formatter:/([a-zA-Z_$][a-zA-Z_$0-9]*)(\[[^\]]*\])?/,preprocessorTypes:/section|comment|delimiterChange/,standalonePre:/(?:\r)?\n[ \t]*$/,standalonePost:/^[ \t]*(\r)?\n/,standalonePreStrip:/[ \t]+$/},Anglebars.types={TEXT:0,INTERPOLATOR:1,TRIPLE:2,SECTION:3,ELEMENT:4,PARTIAL:5,COMMENT:6,DELIMCHANGE:7,MUSTACHE:8},function(a){"use strict";var b=a.types,c=a.utils={remove:function(a){a.parentNode&&a.parentNode.removeChild(a)},getNodeArrayFromHtml:function(a,b){var c,d,e,f=[],g,h,i;a=""+a;if(b){g=["src","poster"];for(d=0;d<g.length;d+=1)i=new RegExp("(<[^>]+\\s)("+g[d]+"=)","g"),a=a.replace(i,"$1data-anglebars-"+g[d]+"=")}var j=!0;if(j){h=["table","thead","tbody","tr","th","td"];for(d=0;d<h.length;d+=1)i=new RegExp("<("+h[d]+")(\\s|>)","gi"),a=a.replace(i,'<div data-anglebars-elementname="$1"$2'),i=new RegExp("<\\/"+h[d]+">","gi"),a=a.replace(i,"</div>")}c=document.createElement("div"),c.innerHTML=a,f=[];for(d=0;d<c.childNodes.length;d+=1)f[d]=c.childNodes[d];return f},getEl:function(a){var b;if(!a)throw new Error("No container element specified");if(a.tagName)return a;if(typeof a=="string"){b=document.getElementById(a);if(b.tagName)return b}throw new Error("Could not find container element")},splitKeypath:function(a){var b,d=[],e;b=a.split(".");for(e=0;e<b.length;e+=1)d=d.concat(c.parseArrayNotation(b[e]));return d},parseArrayNotation:function(a){var b,c,d,e,f;b=a.indexOf("[");if(b===-1)return a;f=[a.substr(0,b)],c=a.substring(b),d=/\[([0-9]+)\]/;while(c.length){e=d.exec(c);if(!e)return f;f[f.length]=+e[1],c=c.substring(e[0].length)}return f},escape:function(a){var b=/[\[\]\(\)\{\}\^\$\*\+\?\.\|]/g;return a.replace(b,"\\$&")},compileMustachePattern:function(){var b=this.escape(a.delimiters[0]),c=this.escape(a.delimiters[1]),d=this.escape(a.tripleDelimiters[0]),e=this.escape(a.tripleDelimiters[1]);a.patterns.mustache=new RegExp("(?:("+d+")|("+b+"))"+"(?:(?:"+"(=)\\s*([^\\s]+)\\s+([^\\s]+)\\s*(=)"+"(?:("+e+")|("+c+"))"+")|(?:"+"(#|\\^|\\/)?"+"(\\>)?"+"(&)?"+"(!)?"+"\\s*"+"([\\s\\S]+?)"+"\\s*"+"(?:("+e+")|("+c+"))"+"))","g")},preProcess:function(d){var e="",f=d,g,h,i,j,k,l,m,n,o;m=a.delimiters.concat(),n=a.tripleDelimiters.concat(),j=/(?:\r)?\n\s*$/,k=/^\s*(?:\r)?\n/;while(f.length){g=c.findMustache(f);if(!g){e+=f;break}g.type===b.SECTION||g.type===b.COMMENT||g.type===b.DELIMCHANGE?(h=f.substr(0,g.start),i=f.substring(g.end),j.test(h)&&k.test(i)&&(h=h.replace(/(?:\r)?\n\s*$/,"")),e+=h,g.type!==b.COMMENT&&(e+=g[0]),f=i):(e+=f.substr(0,g.end),f=f.substring(g.end))}if(a.delimiters[0]!==m[0]||a.delimiters[1]!==m[1])a.delimiters=m,o=!0;if(a.tripleDelimiters[0]!==n[0]||a.tripleDelimiters[1]!==n[1])a.tripleDelimiters=n,o=!0;return o&&c.compileMustachePattern(),e},findMustache:function(d,e){var f,g,h,i,j,k,l,m,n,o;h=a.patterns.mustache,i=" | ",m=a.patterns.formatter,f=c.findMatch(d,h,e);if(f){if(f[3]&&f[6])f.type=b.DELIMCHANGE,f[1]&&f[7]?a.tripleDelimiters=[f[4],f[5]]:a.delimiters=[f[4],f[5]],c.compileMustachePattern();else{f.formula=f[13],g=f.formula.split(i),f.partialKeypath=g.shift(),k=[];for(j=0;j<g.length;j+=1){l=m.exec(g[j]);if(l){n={name:l[1]};if(l[2])try{n.args=JSON.parse(l[2])}catch(p){throw new Error("Illegal arguments for formatter '"+n.name+"': "+l[2]+" (JSON.parse() failed)")}k.push(n)}}k.length&&(f.formatters=k);if(f[9])f.type=b.SECTION,f.inverted=f[9]==="^"?!0:!1,f.closing=f[9]==="/"?!0:!1;else if(f[10])f.type=b.PARTIAL;else if(f[1]){if(!f[14])return!1;f.type=b.TRIPLE}else f[12]?f.type=b.COMMENT:f.type=b.INTERPOLATOR}return f.isMustache=!0,f}return!1},findMatch:function(a,b,c){var d;if(b.global)b.lastIndex=c||0;else throw new Error("You must pass findMatch() a regex with the global flag set");d=b.exec(a);if(d)return d.end=b.lastIndex,d.start=d.end-d[0].length,d},getStubsFromNodes:function(a){var d,e,f,g=[],h;e=a.length;for(d=0;d<e;d+=1)f=a[d],f.nodeType===1?g[g.length]={type:b.ELEMENT,original:f}:f.nodeType===3&&(h=c.expandText(f.data),h&&(g=g.concat(h)));return g},expandText:function(a){var d=[],e,f,g,h,i,j,k;e=c.findMustache(a);while(e.type===b.DELIMCHANGE)e.start>0&&(d[d.length]={type:b.TEXT,text:a.substr(0,e.start)}),a=a.substring(e.end),e=c.findMustache(a);return e?(j=!0,g=/\s*\n\s*$/,e.start>0&&(h=a.substr(0,e.start),d[d.length]={type:b.TEXT,text:h}),d[d.length]={type:b.MUSTACHE,mustache:e},e.end<a.length&&(k=c.expandText(a.substring(e.end)),k&&(d=d.concat(k))),d):a?d.concat({type:b.TEXT,text:a}):d.length?d:!1},isEqual:function(a,b){var c=function(a,b,d){var e,f,g,h,i,j;e=Object.prototype.toString;if(a===b)return a!==0||1/a==1/b;if(a==null||b==null)return a===b;f=e.call(a);if(f!=e.call(b))return!1;switch(f){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:a==0?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if(typeof a!="object"||typeof b!="object")return!1;g=d.length;while(g--)if(d[g]==a)return!0;d.push(a),h=0,i=!0;if(f=="[object Array]"){h=a.length,i=h==b.length;if(i)while(h--)if(!(i=h in a==h in b&&c(a[h],b[h],d)))break}else{if("constructor"in a!="constructor"in b||a.constructor!=b.constructor)return!1;for(j in a)if(a.hasOwnProperty(j)){h++;if(!(i=b.hasOwnProperty(j)&&c(a[j],b[j],d)))break}if(i){for(j in b)if(b.hasOwnProperty(j)&&!(h--))break;i=!h}}return d.pop(),i};return c(a,b,[])},isArray:function(a){return Object.prototype.toString.call(a)==="[object Array]"},isObject:function(a){return Object.prototype.toString.call(a)==="[object Object]"&&typeof a!="function"},compileStubs:function(a,d,e,f){var g,h,i;g=[],i=function(h){var i,j,k,l,m,n,o,p,q,r,s,t;i=/^\s*\n\r?\s*$/,n=a[h];switch(n.type){case b.TEXT:if(!f)if(i.test(n.text)||n.text==="")return h+1;return g[g.length]=n,h+1;case b.ELEMENT:return g[g.length]=c.processElementStub(n,d,e),h+1;case b.MUSTACHE:s=n.mustache.partialKeypath;switch(n.mustache.type){case b.SECTION:h+=1,o=h,q=1;while(h<a.length&&!p)r=a[h],r.type===b.MUSTACHE&&r.mustache.type===b.SECTION&&r.mustache.partialKeypath===s&&(r.mustache.closing?(q-=1,q||(p=h)):q+=1),h+=1;if(!p)throw new Error('Illegal section "'+s+'"');return t={type:b.SECTION,partialKeypath:s,inverted:n.mustache.inverted,children:c.compileStubs(a.slice(o,p),d+1,e,f),priority:d},n.mustache.formatters&&(t.formatters=n.mustache.formatters),g[g.length]=t,h;case b.TRIPLE:return t={type:b.TRIPLE,partialKeypath:n.mustache.partialKeypath,priority:d},n.mustache.formatters&&(t.formatters=n.mustache.formatters),g[g.length]=t,h+1;case b.INTERPOLATOR:return t={type:b.INTERPOLATOR,partialKeypath:n.mustache.partialKeypath,priority:d},n.mustache.formatters&&(t.formatters=n.mustache.formatters),g[g.length]=t,h+1;default:throw console&&console.error&&console.error("Bad mustache: ",n.mustache),new Error("Error compiling template: Illegal mustache ("+n.mustache[0]+")")}break;default:throw new Error("Error compiling template. Something *very weird* has happened")}},h=0;while(h<a.length)h=i(h);return g},processElementStub:function(a,b,d){var e,f,g,h,i,j;j=a.original,e={type:"element",tag:j.getAttribute("data-anglebars-elementname")||j.localName||j.tagName,priority:b},d&&(e.namespace=d),f=[],g=j.attributes.length;for(i=0;i<g;i+=1){h=j.attributes[i];if(f.name==="data-anglebars-elementname")continue;h.name==="xmlns"?e.namespace=h.value:f[f.length]=c.processAttribute(h.name,h.value,b+1)}return e.attributes=f,e.children=c.compileStubs(c.getStubsFromNodes(j.childNodes),b+1,e.namespace),e},processAttribute:function(a,b,d){var e,f;return f=c.expandText(b),e={name:a.replace("data-anglebars-","")},!c.findMustache(b)||!f?(e.value=b,e):(e.isDynamic=!0,e.priority=d,e.components=c.compileStubs(f,d,null),e)}}}(Anglebars),Anglebars.ViewModel=function(a){this.data=a||{},this.pendingResolution=[],this.observers={}},Anglebars.ViewModel.prototype={set:function(a,b){var c,d,e,f,g,h,i,j;if(typeof a=="object"){for(c in a)a.hasOwnProperty(c)&&this.set(c,a[c]);return}i=this.get(a),d=Anglebars.utils.splitKeypath(a),f=this.data;while(d.length>1)e=d.shift(),f=f[e]||{};e=d[0],f[e]=b,Anglebars.utils.isEqual(i,b)||this.publish(a,b),g=this.pendingResolution.length;while(g--)h=this.pendingResolution.splice(g,1)[0],j=this.getFullKeypath(h.view.model.partialKeypath,h.view.contextStack),j!==undefined?h.callback(j):this.registerUnresolvedKeypath(h.view,h.callback)},get:function(a){var b,c;if(!a)return undefined;b=a.split("."),c=this.data;while(b.length){c&&(c=c[b.shift()]);if(c===undefined)return c}return c},update:function(a){var b=this.get(a);this.publish(a,b)},registerView:function(a){var b=this,c,d,e,f;d=function(c){a.keypath=c,a.observerRefs=b.observe({keypath:c,priority:a.model.priority,view:a}),e=b.get(c),f=a.anglebars._format(e,a.model.formatters),a.update(f)},c=this.getFullKeypath(a.model.partialKeypath,a.contextStack),c===undefined?this.registerUnresolvedKeypath(a,d):d(c)},getFullKeypath:function(a,b){var c;if(a===".")return b[b.length-1];b=b.concat();while(b.length){c=b.pop();if(this.get(c+"."+a)!==undefined)return c+"."+a}if(this.get(a)!==undefined)return a},registerUnresolvedKeypath:function(a,b){this.pendingResolution[this.pendingResolution.length]={view:a,callback:b}},cancelAddressResolution:function(a){if(this.pendingResolution.filter)this.pendingResolution=this.pendingResolution.filter(function(b){return b.view!==a});else{var b,c=[];for(b=0;b<this.pendingResolution.length;b+=1)this.pendingResolution[b].view!==a&&(c[c.length]=this.pendingResolution[b]);this.pendingResolution=c}},publish:function(a,b){var c=this,d=this.observers[a]||[],e,f,g,h,i;for(e=0;e<d.length;e+=1){g=d[e];if(g)for(f=0;f<g.length;f+=1)h=g[f],a!==h.originalAddress&&(b=c.get(h.originalAddress)),h.view&&(i=h.view.anglebars._format(b,h.view.model.formatters),h.view.update(i)),h.callback&&h.callback(b)}},observe:function(a){var b=this,c,d=a.keypath,e=a.priority,f=[],g;if(!a.keypath)return undefined;g=function(c){var g,h;g=b.observers[c]=b.observers[c]||[],g=g[e]=g[e]||[],h={originalAddress:d},a.view&&(h.view=a.view),a.callback&&(h.callback=a.callback),g[g.length]=h,f[f.length]={keypath:c,priority:e,observer:h}},c=a.keypath;while(c.lastIndexOf(".")!==-1)g(c),c=c.substr(0,c.lastIndexOf("."));return g(c),f},unobserve:function(a){var b,c,d;b=this.observers[a.keypath];if(!b)return;c=b[a.priority];if(!c)return;if(c.indexOf)d=c.indexOf(a.observer);else for(var e=0,f=c.length;e<f;e+=1)if(c[e]===a.observer){d=e;break}if(d===-1)return;c.splice(d,1),c.length===0&&delete b[a.priority],b.length===0&&delete this.observers[a.keypath]},unobserveAll:function(a){while(a.length)this.unobserve(a.shift())}},function(a){"use strict";var b,c,d,e,f;e=a.types,f=[],f[e.TEXT]="Text",f[e.INTERPOLATOR]="Interpolator",f[e.TRIPLE]="Triple",f[e.SECTION]="Section",f[e.ELEMENT]="Element",d=a.utils,b=function(a){var b;return b=function(a){this.model=a.model,this.anglebars=a.anglebars,this.viewmodel=a.anglebars.viewmodel,this.parentNode=a.parentNode,this.parentFragment=a.parentFragment,this.contextStack=a.contextStack||[],this.anchor=a.anchor,this.index=a.index,this.initialize(),this.viewmodel.registerView(this),!this.keypath&&this.model.inverted&&this.update(!1)},b.prototype=a,b},c=a.DomViews={create:function(a){return new c[f[a.model.type]](a)}},c.Fragment=function(a){var b,d,e;this.parentSection=a.parentSection,this.index=a.index,e={anglebars:a.anglebars,parentNode:a.parentNode,contextStack:a.contextStack,anchor:a.anchor,parentFragment:this},this.items=[],b=a.model.length;for(d=0;d<b;d+=1)e.model=a.model[d],e.index=d,this.items[d]=c.create(e)},c.Fragment.prototype={teardown:function(){var a,b;b=this.items.length;for(a=0;a<b;a+=1)this.items[a].teardown();delete this.items},firstNode:function(){return this.items[0]?this.items[0].firstNode():this.parentSection?this.parentSection.findNextNode(this):null},findNextNode:function(a){var b;return b=a.index,this.items[b+1]?this.items[b+1].firstNode():this.parentSection?this.parentSection.findNextNode(this):null}},c.Text=function(a){this.node=document.createTextNode(a.model.text),this.index=a.index,a.parentNode.insertBefore(this.node,a.anchor)},c.Text.prototype={teardown:function(){d.remove(this.node)},firstNode:function(){return this.node}},c.Element=function(a){var b,d,e,f,g,h,i;i=this.model=a.model,this.viewmodel=a.anglebars.viewmodel,this.parentFragment=a.parentFragment,this.index=a.index,i.namespace?this.node=document.createElementNS(i.namespace,i.tag):this.node=document.createElement(i.tag),this.attributes=[],d=i.attributes.length;for(b=0;b<d;b+=1)f=i.attributes[b],f.name!=="data-bind"||i.tag!=="INPUT"&&i.tag!=="TEXTAREA"?this.attributes[b]=new c.Attribute({model:f,anglebars:a.anglebars,parentNode:this.node,contextStack:a.contextStack}):h=f.value;h&&this.bind(h,a.anglebars.lazy),this.children=new c.Fragment({model:i.children,anglebars:a.anglebars,parentNode:this.node,contextStack:a.contextStack,anchor:null}),a.parentNode.insertBefore(this.node,a.anchor||null)},c.Element.prototype={bind:function(a,b){var c=this.viewmodel,d=this.node,e;e=function(){var b=d.value;b==="0"?b=0:b!==""&&(b=+b||b),c.set(a,b)},e(),d.addEventListener("change",e),b||d.addEventListener("keyup",e)},teardown:function(){var a,b;this.children.teardown(),a=this.attributes.length;for(b=0;b<a;b+=1)this.attributes[b].teardown();d.remove(this.node)},firstNode:function(){return this.node}},c.Attribute=function(b){var c,d,e;e=b.model;if(!e.isDynamic){b.parentNode.setAttribute(e.name,e.value);return}this.parentNode=b.parentNode,this.name=e.name,this.children=[],d=e.components.length;for(c=0;c<d;c+=1)this.children[c]=a.TextViews.create({model:e.components[c],anglebars:b.anglebars,parent:this,contextStack:b.contextStack});this.update()},c.Attribute.prototype={teardown:function(){var a,b,c;if(!this.children)return;a=this.children.length;for(b=0;b<a;b+=1)c=this.children[b],c.teardown&&c.teardown()},bubble:function(){this.update()},update:function(){this.value=this.toString(),this.parentNode.setAttribute(this.name,this.value)},toString:function(){var a="",b,c,d;c=this.children.length;for(b=0;b<c;b+=1)d=this.children[b],a+=d.toString();return a}},c.Interpolator=b({initialize:function(){this.node=document.createTextNode(""),this.parentNode.insertBefore(this.node,this.anchor||null)},teardown:function(){this.observerRefs?this.viewmodel.unobserveAll(this.observerRefs):this.viewmodel.cancelAddressResolution(this),d.remove(this.node)},update:function(a){this.node.data=a},firstNode:function(){return this.node}}),c.Triple=b({initialize:function(){this.nodes=[]},teardown:function(){while(this.nodes.length)d.remove(this.nodes.shift());this.observerRefs?this.viewmodel.unobserveAll(this.observerRefs):this.viewmodel.cancelAddressResolution(this)},firstNode:function(){return this.nodes[0]?this.nodes[0]:this.parentFragment.findNextNode(this)},update:function(a){var b,c,e;e=this.initialised?this.parentFragment.findNextNode(this):this.anchor,b=this.nodes.length;for(c=0;c<b;c+=1)d.remove(this.nodes[c]);this.nodes=d.getNodeArrayFromHtml(a,!1),b=this.nodes.length,b&&(e=this.parentFragment.findNextNode(this));for(c=0;c<b;c+=1)this.parentNode.insertBefore(this.nodes[c],e);this.initialised=!0}}),c.Section=b({initialize:function(){this.views=[],this.length=0},teardown:function(){this.unrender(),this.observerRefs?this.viewmodel.unobserveAll(this.observerRefs):this.viewmodel.cancelAddressResolution(this)},firstNode:function(){return this.views[0]?this.views[0].firstNode():this.parentFragment.findNextNode(this)},findNextNode:function(a){return this.views[a.index+1]?this.views[a.index+1].firstNode():this.parentFragment.findNextNode(this)},unrender:function(){while(this.views.length)this.views.shift().teardown()},update:function(a){var b,e,f,g,h;h={model:this.model.children,anglebars:this.anglebars,parentNode:this.parentNode,anchor:this.parentFragment.findNextNode(this),parentSection:this},d.isArray(a)&&a.length===0&&(b=!0);if(this.model.inverted){if(a&&!b){if(this.length){this.unrender(),this.length=0;return}}else if(!this.length){g=this.parentFragment.findNextNode(this),h.contextStack=this.contextStack,h.index=0,this.views[0]=new c.Fragment(h),this.length=1;return}return}if(d.isArray(a)){if(a.length<this.length){f=this.views.splice(a.length,this.length-a.length);while(f.length)f.shift().teardown()}else{for(e=0;e<this.length;e+=1)this.viewmodel.update(this.keypath+"."+e);if(a.length>this.length)for(e=this.length;e<a.length;e+=1)h.contextStack=this.contextStack.concat(this.keypath+"."+e),h.index=e,this.views[e]=new c.Fragment(h)}this.length=a.length}else d.isObject(a)?this.length||(h.contextStack=this.contextStack.concat(this.keypath),h.index=0,this.views[0]=new c.Fragment(h),this.length=1):a&&!b?this.length||(h.contextStack=this.contextStack,h.index=0,this.views[0]=new c.Fragment(h),this.length=1):this.length&&(this.unrender(),this.length=0)}})}(Anglebars),function(a){"use strict";var b,c;b=function(a){var b;return b=function(a){this.model=a.model,this.anglebars=a.anglebars,this.viewmodel=a.anglebars.viewmodel,this.parent=a.parent,this.contextStack=a.contextStack||[],this.initialize&&this.initialize(),this.viewmodel.registerView(this),!this.keypath&&this.model.inverted&&this.update(!1)},b.prototype=a,b},c=a.TextViews={create:function(a){var b=a.model.type;return b=b.charAt(0).toUpperCase()+b.slice(1),new c[b](a)}},c.Fragment=function(a){var b,d,e;this.parent=a.parent,this.items=[],e={anglebars:a.anglebars,parent:this,contextStack:a.contextStack},b=a.models.length;for(d=0;d<b;d+=1)e.model=this.models[d],this.items[this.items.length]=c.create(e);this.value=this.items.join("")},c.Fragment.prototype={bubble:function(){this.value=this.items.join(""),this.parent.bubble()},teardown:function(){var a,b;a=this.items.length;for(b=0;b<a;b+=1)this.items[b].teardown()},toString:function(){return this.value||""}},c.Text=function(a){this.text=a.model.text},c.Text.prototype={toString:function(){return this.text},teardown:function(){}},c.Interpolator=b({update:function(a){this.value=a,this.parent.bubble()},bubble:function(){this.parent.bubble()},teardown:function(){this.observerRefs?this.viewmodel.unobserveAll(this.observerRefs):this.viewmodel.cancelAddressResolution(this)},toString:function(){return this.value||""}}),c.Triple=c.Interpolator,c.Section=b({initialize:function(){this.children=[],this.length=0},teardown:function(){this.unrender(),this.observerRefs?this.viewmodel.unobserveAll(this.observerRefs):this.viewmodel.cancelAddressResolution(this)},unrender:function(){while(this.children.length)this.children.shift().teardown();this.length=0},bubble:function(){this.value=this.children.join(""),this.parent.bubble()},update:function(b){var d,e,f;a.utils.isArray(b)&&b.length===0&&(d=!0);if(this.model.inverted){b&&!d?this.length&&(this.unrender(),this.length=0):this.length||(this.children[0]=new c.Fragment(this.model.children,this.anglebars,this,this.contextStack),this.length=1),this.value=this.children.join(""),this.parent.bubble();return}if(typeof b=="object")if(a.utils.isArray(b)){if(b.length<this.length){f=this.children.splice(b.length,this.length-b.length);while(f.length)f.shift().teardown()}else{for(e=0;e<this.length;e+=1)this.viewmodel.update(this.keypath+"."+e);if(b.length>this.length)for(e=this.length;e<b.length;e+=1)this.children[e]=new c.Fragment(this.model.children,this.anglebars,this,this.contextStack.concat(this.keypath+"."+e))}this.length=b.length}else this.length||(this.children[0]=new c.Fragment(this.model.children,this.anglebars,this,this.contextStack.concat(this.keypath)),this.length=1);else b&&!d?this.length||(this.children[0]=new c.Fragment(this.model.children,this.anglebars,this,this.contextStack),this.length=1):this.length&&(this.unrender(),this.length=0);this.value=this.children.join(""),this.parent.bubble()},toString:function(){return this.value||""}})}(Anglebars);